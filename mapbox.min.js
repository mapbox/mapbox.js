/*
 * Modest Maps JS v3.1.1
 * http://modestmaps.com/
 *
 * Copyright (c) 2011 Stamen Design, All Rights Reserved.
 *
 * Open source under the BSD License.
 * http://creativecommons.org/licenses/BSD/
 *
 * Versioned using Semantic Versioning (v.major.minor.patch)
 * See CHANGELOG and http://semver.org/ for more details.
 *
 */function mmg(){function l(t){t.coord||(t.coord=e.map.locationCoordinate(t.location));var n=e.map.coordinatePoint(t.coord),r;n.x<0?(r=new MM.Location(t.location.lat,t.location.lon),r.lon+=Math.ceil((a.lon-t.location.lon)/360)*360,n=e.map.locationPoint(r),t.coord=e.map.locationCoordinate(r)):n.x>e.map.dimensions.x&&(r=new MM.Location(t.location.lat,t.location.lon),r.lon-=Math.ceil((t.location.lon-f.lon)/360)*360,n=e.map.locationPoint(r),t.coord=e.map.locationCoordinate(r)),n.scale=1,n.width=n.height=0,MM.moveElement(t.element,n)}var e={},t=[],n=[],r=new MM.CallbackManager(e,["drawn","markeradded"]),i=null,s=null,o=null,u,a=null,f=null;e.addCallback=function(t,n){return r.addCallback(t,n),e},e.removeCallback=function(t,n){return r.removeCallback(t,n),e},e.draw=function(){if(!e.map)return;a=e.map.pointLocation(new MM.Point(0,0)),f=e.map.pointLocation(new MM.Point(e.map.dimensions.x,0)),r.dispatchCallback("drawn",e);for(var t=0;t<n.length;t++)l(n[t])},e.add=function(e){return!e||!e.element?null:(c.appendChild(e.element),n.push(e),r.dispatchCallback("markeradded",e),e)},e.remove=function(e){if(!e)return null;c.removeChild(e.element);for(var t=0;t<n.length;t++)if(n[t]===e)return n.splice(t,1),e;return e},e.markers=function(e){if(!arguments.length)return n},e.features=function(r){if(!arguments.length)return t;while(c.hasChildNodes())c.removeChild(c.lastChild);n=[],r||(r=[]),t=r.slice(),t.sort(o);for(var i=0;i<t.length;i++)e.add({element:s(t[i]),location:new MM.Location(t[i].geometry.coordinates[1],t[i].geometry.coordinates[0]),data:t[i]});return e.map&&e.map.coordinate&&e.map.draw(),e},e.url=function(t,n){function r(t){t&&t.features&&e.features(t.features),n&&n(t.features,e)}if(!arguments.length)return u;if(typeof reqwest=="undefined")throw"reqwest is required for url loading";return typeof t=="string"&&(t=[t]),u=t,reqwest(u[0].match(/geojsonp$/)?{url:u[0]+(~u[0].indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:r,error:r}:{url:u[0],type:"json",success:r,error:r}),e},e.extent=function(){var t=[{lat:Infinity,lon:Infinity},{lat:-Infinity,lon:-Infinity}],n=e.features();for(var r=0;r<n.length;r++){var i=n[r].geometry.coordinates;i[0]<t[0].lon&&(t[0].lon=i[0]),i[1]<t[0].lat&&(t[0].lat=i[1]),i[0]>t[1].lon&&(t[1].lon=i[0]),i[1]>t[1].lat&&(t[1].lat=i[1])}return t},e.factory=function(t){return arguments.length?(s=t,e):s},e.factory(function(t){var n=document.createElement("div");return n.className="mmg-default",n.style.position="absolute",n}),e.sort=function(t){return arguments.length?(o=t,e):o},e.sort(function(e,t){return t.geometry.coordinates[1]-e.geometry.coordinates[1]}),e.destroy=function(){this.parent.parentNode&&this.parent.parentNode.removeChild(this.parent)};var c=document.createElement("div");return c.style.cssText="position: absolute; top: 0px;left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",e.parent=c,e}function mmg_interaction(e){function a(){e.map.addCallback("panned",function(){if(i)while(n.length)e.remove(n.pop())})}var t={},n=[],r=!0,i=!0,s=!0,o=null,u;t.formatter=function(e){return arguments.length?(u=e,t):u},t.formatter(function(e){var t="",n=e.properties;return n.title&&(t+='<div class="mmg-title">'+n.title+"</div>"),n.description&&(t+='<div class="mmg-description">'+n.description+"</div>"),typeof html_sanitize!==undefined&&(t=html_sanitize(t,function(e){if(/^(https?:\/\/|data:image)/.test(e))return e},function(e){return e})),t}),t.hide_on_move=function(e){return arguments.length?(i=e,t):i},t.exclusive=function(e){return arguments.length?(r=e,t):r},t.show_on_hover=function(e){return arguments.length?(s=e,t):s},t.hide_tooltips=function(){while(n.length)e.remove(n.pop());for(var t=0;t<f.length;t++)delete f[t].clicked},t.bind_marker=function(i){var a=function(){i.clicked||(o=window.setTimeout(function(){t.hide_tooltips()},200))},f=function(f){var l=u(i.data);if(!l)return;r&&n.length>0&&(t.hide_tooltips(),o&&window.clearTimeout(o));var c=document.createElement("div");c.className="wax-movetip",c.style.width="100%";var h=c.appendChild(document.createElement("div"));h.style.cssText="position: absolute; pointer-events: none;";var p=h.appendChild(document.createElement("div"));p.className="wax-intip",p.style.cssText="pointer-events: auto;",typeof l=="string"?p.innerHTML=l:p.appendChild(l),h.style.bottom=i.element.offsetHeight/2+20+"px",s&&(c.onmouseover=function(){o&&window.clearTimeout(o)},c.onmouseout=a);var d={element:c,data:{},interactive:!1,location:i.location.copy()};n.push(d),e.add(d),e.draw()};i.element.onclick=function(){f(),i.clicked=!0},s&&(i.element.onmouseover=f,i.element.onmouseout=a)};if(e){e.addCallback("drawn",a),e.removeCallback("drawn",a);var f=e.markers();for(var l=0;l<f.length;l++)t.bind_marker(f[l]);e.addCallback("markeradded",function(e,n){n.interactive!==!1&&t.bind_marker(n)})}return t}function simplestyle_factory(e){var t={small:[20,50],medium:[30,70],large:[35,90]},n=e.properties||{},r=n["marker-size"]||"medium",i=n["marker-symbol"]?"-"+n["marker-symbol"]:"",s=n["marker-color"]||"7e7e7e";s=s.replace("#","");var o=document.createElement("img");o.width=t[r][0],o.height=t[r][1],o.className="simplestyle-marker",o.alt=n.title||"",o.src=(simplestyle_factory.baseurl||"http://a.tiles.mapbox.com/v3/marker/")+"pin-"+r[0]+i+"+"+s+".png";var u=o.style;return u.position="absolute",u.clip="rect(auto auto "+t[r][1]*.75+"px auto)",u.marginTop=-(t[r][1]/2)+"px",u.marginLeft=-(t[r][0]/2)+"px",u.cursor="pointer",o}var previousMM=MM;if(!com){var com={};com.modestmaps||(com.modestmaps={})}var MM=com.modestmaps={noConflict:function(){return MM=previousMM,this}};(function(e){e.extend=function(e,t){for(var n in t.prototype)typeof e.prototype[n]=="undefined"&&(e.prototype[n]=t.prototype[n]);return e},e.getFrame=function(){return function(e){(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(+(new Date))},10)})(e)}}(),e.transformProperty=function(e){if(!this.document)return;var t=document.documentElement.style;for(var n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}(["transformProperty","WebkitTransform","OTransform","MozTransform","msTransform"]),e.matrixString=function(t){t.scale*t.width%1&&(t.scale+=(1-t.scale*t.width%1)/t.width);var n=t.scale||1;return e._browser.webkit3d?"translate3d("+t.x.toFixed(0)+"px,"+t.y.toFixed(0)+"px, 0px)scale3d("+n+","+n+", 1)":"translate("+t.x.toFixed(6)+"px,"+t.y.toFixed(6)+"px)scale("+n+","+n+")"},e._browser=function(e){return{webkit:"WebKitCSSMatrix"in e,webkit3d:"WebKitCSSMatrix"in e&&"m11"in new WebKitCSSMatrix}}(this),e.moveElement=function(t,n){if(e.transformProperty){n.scale||(n.scale=1),n.width||(n.width=0),n.height||(n.height=0);var r=e.matrixString(n);t[e.transformProperty]!==r&&(t.style[e.transformProperty]=t[e.transformProperty]=r)}else t.style.left=n.x+"px",t.style.top=n.y+"px",n.width&&n.height&&n.scale&&(t.style.width=Math.ceil(n.width*n.scale)+"px",t.style.height=Math.ceil(n.height*n.scale)+"px")},e.cancelEvent=function(e){return e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},e.coerceLayer=function(t){return typeof t=="string"?new e.Layer(new e.TemplatedLayer(t)):"draw"in t&&typeof t.draw=="function"?t:new e.Layer(t)},e.addEvent=function(e,t,n){e.addEventListener?(e.addEventListener(t,n,!1),t=="mousewheel"&&e.addEventListener("DOMMouseScroll",n,!1)):e.attachEvent&&(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n]))},e.removeEvent=function(e,t,n){e.removeEventListener?(e.removeEventListener(t,n,!1),t=="mousewheel"&&e.removeEventListener("DOMMouseScroll",n,!1)):e.detachEvent&&(e.detachEvent("on"+t,e[t+n]),e[t+n]=null)},e.getStyle=function(e,t){if(e.currentStyle)return e.currentStyle[t];if(window.getComputedStyle)return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)},e.Point=function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},e.Point.prototype={x:0,y:0,toString:function(){return"("+this.x.toFixed(3)+", "+this.y.toFixed(3)+")"},copy:function(){return new e.Point(this.x,this.y)}},e.Point.distance=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},e.Point.interpolate=function(t,n,r){return new e.Point(t.x+(n.x-t.x)*r,t.y+(n.y-t.y)*r)},e.Coordinate=function(e,t,n){this.row=e,this.column=t,this.zoom=n},e.Coordinate.prototype={row:0,column:0,zoom:0,toString:function(){return"("+this.row.toFixed(3)+", "+this.column.toFixed(3)+" @"+this.zoom.toFixed(3)+")"},toKey:function(){return this.zoom+","+this.row+","+this.column},copy:function(){return new e.Coordinate(this.row,this.column,this.zoom)},container:function(){return new e.Coordinate(Math.floor(this.row),Math.floor(this.column),Math.floor(this.zoom))},zoomTo:function(t){var n=Math.pow(2,t-this.zoom);return new e.Coordinate(this.row*n,this.column*n,t)},zoomBy:function(t){var n=Math.pow(2,t);return new e.Coordinate(this.row*n,this.column*n,this.zoom+t)},up:function(t){return t===undefined&&(t=1),new e.Coordinate(this.row-t,this.column,this.zoom)},right:function(t){return t===undefined&&(t=1),new e.Coordinate(this.row,this.column+t,this.zoom)},down:function(t){return t===undefined&&(t=1),new e.Coordinate(this.row+t,this.column,this.zoom)},left:function(t){return t===undefined&&(t=1),new e.Coordinate(this.row,this.column-t,this.zoom)}},e.Location=function(e,t){this.lat=parseFloat(e),this.lon=parseFloat(t)},e.Location.prototype={lat:0,lon:0,toString:function(){return"("+this.lat.toFixed(3)+", "+this.lon.toFixed(3)+")"},copy:function(){return new e.Location(this.lat,this.lon)}},e.Location.distance=function(e,t,n){n||(n=6378e3);var r=Math.PI/180,i=e.lat*r,s=e.lon*r,o=t.lat*r,u=t.lon*r,a=Math.cos(i)*Math.cos(s)*Math.cos(o)*Math.cos(u),f=Math.cos(i)*Math.sin(s)*Math.cos(o)*Math.sin(u),l=Math.sin(i)*Math.sin(o);return Math.acos(a+f+l)*n},e.Location.interpolate=function(t,n,r){if(t.lat===n.lat&&t.lon===n.lon)return new e.Location(t.lat,t.lon);var i=Math.PI/180,s=t.lat*i,o=t.lon*i,u=n.lat*i,f=n.lon*i,l=2*Math.asin(Math.sqrt(Math.pow(Math.sin((s-u)/2),2)+Math.cos(s)*Math.cos(u)*Math.pow(Math.sin((o-f)/2),2))),c=Math.sin((1-r)*l)/Math.sin(l),h=Math.sin(r*l)/Math.sin(l),p=c*Math.cos(s)*Math.cos(o)+h*Math.cos(u)*Math.cos(f),d=c*Math.cos(s)*Math.sin(o)+h*Math.cos(u)*Math.sin(f),v=c*Math.sin(s)+h*Math.sin(u),m=Math.atan2(v,Math.sqrt(Math.pow(p,2)+Math.pow(d,2))),g=Math.atan2(d,p);return new e.Location(m/i,g/i)},e.Location.bearing=function(e,t){var n=Math.PI/180,r=e.lat*n,i=e.lon*n,s=t.lat*n,o=t.lon*n,u=Math.atan2(Math.sin(i-o)*Math.cos(s),Math.cos(r)*Math.sin(s)-Math.sin(r)*Math.cos(s)*Math.cos(i-o))/-(Math.PI/180);return u<0?u+360:u},e.Extent=function(t,n,r,i){if(t instanceof e.Location&&n instanceof e.Location){var s=t,o=n;t=s.lat,n=s.lon,r=o.lat,i=o.lon}isNaN(r)&&(r=t),isNaN(i)&&(i=n),this.north=Math.max(t,r),this.south=Math.min(t,r),this.east=Math.max(i,n),this.west=Math.min(i,n)},e.Extent.prototype={north:0,south:0,east:0,west:0,copy:function(){return new e.Extent(this.north,this.west,this.south,this.east)},toString:function(e){return isNaN(e)&&(e=3),[this.north.toFixed(e),this.west.toFixed(e),this.south.toFixed(e),this.east.toFixed(e)].join(", ")},northWest:function(){return new e.Location(this.north,this.west)},southEast:function(){return new e.Location(this.south,this.east)},northEast:function(){return new e.Location(this.north,this.east)},southWest:function(){return new e.Location(this.south,this.west)},center:function(){return new e.Location(this.south+(this.north-this.south)/2,this.east+(this.west-this.east)/2)},encloseLocation:function(e){e.lat>this.north&&(this.north=e.lat),e.lat<this.south&&(this.south=e.lat),e.lon>this.east&&(this.east=e.lon),e.lon<this.west&&(this.west=e.lon)},encloseLocations:function(e){var t=e.length;for(var n=0;n<t;n++)this.encloseLocation(e[n])},setFromLocations:function(e){var t=e.length,n=e[0];this.north=this.south=n.lat,this.east=this.west=n.lon;for(var r=1;r<t;r++)this.encloseLocation(e[r])},encloseExtent:function(e){e.north>this.north&&(this.north=e.north),e.south<this.south&&(this.south=e.south),e.east>this.east&&(this.east=e.east),e.west<this.west&&(this.west=e.west)},containsLocation:function(e){return e.lat>=this.south&&e.lat<=this.north&&e.lon>=this.west&&e.lon<=this.east},toArray:function(){return[this.northWest(),this.southEast()]}},e.Extent.fromString=function(t){var n=t.split(/\s*,\s*/);if(n.length!=4)throw"Invalid extent string (expecting 4 comma-separated numbers)";return new e.Extent(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))},e.Extent.fromArray=function(t){var n=new e.Extent;return n.setFromLocations(t),n},e.Transformation=function(e,t,n,r,i,s){this.ax=e,this.bx=t,this.cx=n,this.ay=r,this.by=i,this.cy=s},e.Transformation.prototype={ax:0,bx:0,cx:0,ay:0,by:0,cy:0,transform:function(t){return new e.Point(this.ax*t.x+this.bx*t.y+this.cx,this.ay*t.x+this.by*t.y+this.cy)},untransform:function(t){return new e.Point((t.x*this.by-t.y*this.bx-this.cx*this.by+this.cy*this.bx)/(this.ax*this.by-this.ay*this.bx),(t.x*this.ay-t.y*this.ax-this.cx*this.ay+this.cy*this.ax)/(this.bx*this.ay-this.by*this.ax))}},e.deriveTransformation=function(t,n,r,i,s,o,u,f,l,c,h,p){var d=e.linearSolution(t,n,r,s,o,u,l,c,h),v=e.linearSolution(t,n,i,s,o,f,l,c,p);return new e.Transformation(d[0],d[1],d[2],v[0],v[1],v[2])},e.linearSolution=function(e,t,n,r,i,s,o,u,a){e=parseFloat(e),t=parseFloat(t),n=parseFloat(n),r=parseFloat(r),i=parseFloat(i),s=parseFloat(s),o=parseFloat(o),u=parseFloat(u),a=parseFloat(a);var f=((s-a)*(t-i)-(n-s)*(i-u))/((r-o)*(t-i)-(e-r)*(i-u)),l=((s-a)*(e-r)-(n-s)*(r-o))/((i-u)*(e-r)-(t-i)*(r-o)),c=n-e*f-t*l;return[f,l,c]},e.Projection=function(t,n){n||(n=new e.Transformation(1,0,0,0,1,0)),this.zoom=t,this.transformation=n},e.Projection.prototype={zoom:0,transformation:null,rawProject:function(e){throw"Abstract method not implemented by subclass."},rawUnproject:function(e){throw"Abstract method not implemented by subclass."},project:function(e){return e=this.rawProject(e),this.transformation&&(e=this.transformation.transform(e)),e},unproject:function(e){return this.transformation&&(e=this.transformation.untransform(e)),e=this.rawUnproject(e),e},locationCoordinate:function(t){var n=new e.Point(Math.PI*t.lon/180,Math.PI*t.lat/180);return n=this.project(n),new e.Coordinate(n.y,n.x,this.zoom)},coordinateLocation:function(t){t=t.zoomTo(this.zoom);var n=new e.Point(t.column,t.row);return n=this.unproject(n),new e.Location(180*n.y/Math.PI,180*n.x/Math.PI)}},e.LinearProjection=function(t,n){e.Projection.call(this,t,n)},e.LinearProjection.prototype={rawProject:function(t){return new e.Point(t.x,t.y)},rawUnproject:function(t){return new e.Point(t.x,t.y)}},e.extend(e.LinearProjection,e.Projection),e.MercatorProjection=function(t,n){e.Projection.call(this,t,n)},e.MercatorProjection.prototype={rawProject:function(t){return new e.Point(t.x,Math.log(Math.tan(.25*Math.PI+.5*t.y)))},rawUnproject:function(t){return new e.Point(t.x,2*Math.atan(Math.pow(Math.E,t.y))-.5*Math.PI)}},e.extend(e.MercatorProjection,e.Projection),e.MapProvider=function(e){e&&(this.getTile=e)},e.MapProvider.prototype={tileLimits:[new e.Coordinate(0,0,0),(new e.Coordinate(1,1,0)).zoomTo(18)],getTileUrl:function(e){throw"Abstract method not implemented by subclass."},getTile:function(e){throw"Abstract method not implemented by subclass."},releaseTile:function(e){},setZoomRange:function(e,t){this.tileLimits[0]=this.tileLimits[0].zoomTo(e),this.tileLimits[1]=this.tileLimits[1].zoomTo(t)},sourceCoordinate:function(t){var n=this.tileLimits[0].zoomTo(t.zoom),r=this.tileLimits[1].zoomTo(t.zoom),i=Math.pow(2,t.zoom),s;return t.column<0?s=(t.column%i+i)%i:s=t.column%i,t.row<n.row||t.row>=r.row?null:s<n.column||s>=r.column?null:new e.Coordinate(t.row,s,t.zoom)}},e.Template=function(t,n){function s(e,t,n){var r="";for(var i=1;i<=n;i++)r+=(e>>n-i&1)<<1|t>>n-i&1;return r||"0"}var r=t.match(/{(Q|quadkey)}/);r&&(t=t.replace("{subdomains}","{S}").replace("{zoom}","{Z}").replace("{quadkey}","{Q}"));var i=n&&n.length&&t.indexOf("{S}")>=0,o=function(e){var o=this.sourceCoordinate(e);if(!o)return null;var u=t;if(i){var a=parseInt(o.zoom+o.row+o.column,10)%n.length;u=u.replace("{S}",n[a])}return r?u.replace("{Z}",o.zoom.toFixed(0)).replace("{Q}",s(o.row,o.column,o.zoom)):u.replace("{Z}",o.zoom.toFixed(0)).replace("{X}",o.column.toFixed(0)).replace("{Y}",o.row.toFixed(0))};e.MapProvider.call(this,o)},e.Template.prototype={getTile:function(e){return this.getTileUrl(e)}},e.extend(e.Template,e.MapProvider),e.TemplatedLayer=function(t,n){return new e.Layer(new e.Template(t,n))},e.getMousePoint=function(t,n){var r=new e.Point(t.clientX,t.clientY);r.x+=document.body.scrollLeft+document.documentElement.scrollLeft,r.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var i=n.parent;i;i=i.offsetParent)r.x-=i.offsetLeft,r.y-=i.offsetTop;return r},e.MouseWheelHandler=function(){function o(t){var o=0;i=i||(new Date).getTime();try{r.scrollTop=1e3,r.dispatchEvent(t),o=1e3-r.scrollTop}catch(u){o=t.wheelDelta||-t.detail*5}var l=(new Date).getTime()-i,h=e.getMousePoint(t,n);return Math.abs(o)>0&&l>200&&!s?(n.zoomByAbout(o>0?1:-1,h),i=(new Date).getTime()):s&&n.zoomByAbout(o*.001,h),e.cancelEvent(t)}var t={},n,r,i,s=!1;return t.init=function(i){n=i,r=document.body.appendChild(document.createElement("div")),r.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var s=r.appendChild(document.createElement("div"));return s.style.height="2000px",e.addEvent(n.parent,"mousewheel",o),t},t.precise=function(e){return arguments.length?(s=e,t):s},t.remove=function(){e.removeEvent(n.parent,"mousewheel",o),r.parentNode.removeChild(r)},t},e.DoubleClickHandler=function(){function r(t){var r=e.getMousePoint(t,n);return n.zoomByAbout(t.shiftKey?-1:1,r),e.cancelEvent(t)}var t={},n;return t.init=function(i){return n=i,e.addEvent(n.parent,"dblclick",r),t},t.remove=function(){e.removeEvent(n.parent,"dblclick",r)},t},e.DragHandler=function(){function i(t){if(t.shiftKey||t.button==2)return;return e.addEvent(document,"mouseup",s),e.addEvent(document,"mousemove",o),n=new e.Point(t.clientX,t.clientY),r.parent.style.cursor="move",e.cancelEvent(t)}function s(t){return e.removeEvent(document,"mouseup",s),e.removeEvent(document,"mousemove",o),n=null,r.parent.style.cursor="",e.cancelEvent(t)}function o(t){return n&&(r.panBy(t.clientX-n.x,t.clientY-n.y),n.x=t.clientX,n.y=t.clientY,n.t=+(new Date)),e.cancelEvent(t)}var t={},n,r;return t.init=function(n){return r=n,e.addEvent(r.parent,"mousedown",i),t},t.remove=function(){e.removeEvent(r.parent,"mousedown",i)},t},e.MouseHandler=function(){var t={},n,r;return t.init=function(i){return n=i,r=[e.DragHandler().init(n),e.DoubleClickHandler().init(n),e.MouseWheelHandler().init(n)],t},t.remove=function(){for(var e=0;e<r.length;e++)r[e].remove();return t},t},e.TouchHandler=function(){function h(){var e=document.createElement("div");return e.setAttribute("ongesturestart","return;"),typeof e.ongesturestart=="function"}function p(e){for(var t=0;t<e.touches.length;t+=1){var n=e.touches[t];if(n.identifier in o){var r=o[n.identifier];r.x=n.screenX,r.y=n.screenY,r.scale=e.scale}else o[n.identifier]={scale:e.scale,startPos:{x:n.screenX,y:n.screenY},x:n.screenX,y:n.screenY,time:(new Date).getTime()}}}function d(e,t){return e&&e.touch&&t.identifier==e.touch.identifier}function v(e){p(e)}function m(t){switch(t.touches.length){case 1:E(t.touches[0]);break;case 2:S(t)}return p(t),e.cancelEvent(t)}function g(t){var n=(new Date).getTime();t.touches.length===0&&l&&x(c);for(var s=0;s<t.changedTouches.length;s+=1){var u=t.changedTouches[s],f=o[u.identifier];if(!f||f.wasPinch)continue;var h={x:u.screenX,y:u.screenY},p=n-f.time,d=e.Point.distance(h,f.startPos);d>i||(p>r?(h.end=n,h.duration=p,y(h)):(h.time=n,b(h)))}var v={};for(var m=0;m<t.touches.length;m++)v[t.touches[m].identifier]=!0;for(var g in o)g in v||delete v[g];return e.cancelEvent(t)}function y(e){}function b(e){if(u.length&&e.time-u[0].time<s){w(e),u=[];return}u=[e]}function w(t){var r=n.getZoom(),i=Math.round(r)+1,s=i-r,o=new e.Point(t.x,t.y);n.zoomByAbout(s,o)}function E(e){var t={x:e.screenX,y:e.screenY},r=o[e.identifier];n.panBy(t.x-r.x,t.y-r.y)}function S(t){var r=t.touches[0],i=t.touches[1],s=new e.Point(r.screenX,r.screenY),u=new e.Point(i.screenX,i.screenY),f=o[r.identifier],h=o[i.identifier];f.wasPinch=!0,h.wasPinch=!0;var p=e.Point.interpolate(s,u,.5);n.zoomByAbout(Math.log(t.scale)/Math.LN2-Math.log(f.scale)/Math.LN2,p);var d=e.Point.interpolate(f,h,.5);n.panBy(p.x-d.x,p.y-d.y),l=!0,c=p}function x(e){if(f){var t=n.getZoom(),r=Math.round(t);n.zoomByAbout(r-t,e)}l=!1}var t={},n,r=250,i=30,s=350,o={},u=[],f=!0,l=!1,c=null;return t.init=function(r){return n=r,h()?(e.addEvent(n.parent,"touchstart",v),e.addEvent(n.parent,"touchmove",m),e.addEvent(n.parent,"touchend",g),t):t},t.remove=function(){return h()?(e.removeEvent(n.parent,"touchstart",v),e.removeEvent(n.parent,"touchmove",m),e.removeEvent(n.parent,"touchend",g),t):t},t},e.CallbackManager=function(e,t){this.owner=e,this.callbacks={};for(var n=0;n<t.length;n++)this.callbacks[t[n]]=[]},e.CallbackManager.prototype={owner:null,callbacks:null,addCallback:function(e,t){typeof t=="function"&&this.callbacks[e]&&this.callbacks[e].push(t)},removeCallback:function(e,t){if(typeof t=="function"&&this.callbacks[e]){var n=this.callbacks[e],r=n.length;for(var i=0;i<r;i++)if(n[i]===t){n.splice(i,1);break}}},dispatchCallback:function(e,t){if(this.callbacks[e])for(var n=0;n<this.callbacks[e].length;n+=1)try{this.callbacks[e][n](this.owner,t)}catch(r){}}},e.RequestManager=function(){this.loadingBay=document.createDocumentFragment(),this.requestsById={},this.openRequestCount=0,this.maxOpenRequests=4,this.requestQueue=[],this.callbackManager=new e.CallbackManager(this,["requestcomplete","requesterror"])},e.RequestManager.prototype={loadingBay:null,requestsById:null,requestQueue:null,openRequestCount:null,maxOpenRequests:null,callbackManager:null,addCallback:function(e,t){this.callbackManager.addCallback(e,t)},removeCallback:function(e,t){this.callbackManager.removeCallback(e,t)},dispatchCallback:function(e,t){this.callbackManager.dispatchCallback(e,t)},clear:function(){this.clearExcept({})},clearRequest:function(e){e in this.requestsById&&delete this.requestsById[e];for(var t=0;t<this.requestQueue.length;t++){var n=this.requestQueue[t];n&&n.id==e&&(this.requestQueue[t]=null)}},clearExcept:function(e){for(var t=0;t<this.requestQueue.length;t++){var n=this.requestQueue[t];n&&!(n.id in e)&&(this.requestQueue[t]=null)}var r=this.loadingBay.childNodes;for(var i=r.length-1;i>=0;i--){var s=r[i];s.id in e||(this.loadingBay.removeChild(s),this.openRequestCount--,s.src=s.coord=s.onload=s.onerror=null)}for(var o in this.requestsById)if(!(o in e)&&this.requestsById.hasOwnProperty(o)){var u=this.requestsById[o];delete this.requestsById[o],u!==null&&(u=u.id=u.coord=u.url=null)}},hasRequest:function(e){return e in this.requestsById},requestTile:function(e,t,n){if(!(e in this.requestsById)){var r={id:e,coord:t.copy(),url:n};this.requestsById[e]=r,n&&this.requestQueue.push(r)}},getProcessQueue:function(){if(!this._processQueue){var e=this;this._processQueue=function(){e.processQueue()}}return this._processQueue},processQueue:function(e){e&&this.requestQueue.length>8&&this.requestQueue.sort(e);while(this.openRequestCount<this.maxOpenRequests&&this.requestQueue.length>0){var t=this.requestQueue.pop();if(t){this.openRequestCount++;var n=document.createElement("img");n.id=t.id,n.style.position="absolute",n.coord=t.coord,this.loadingBay.appendChild(n),n.onload=n.onerror=this.getLoadComplete(),n.src=t.url,t=t.id=t.coord=t.url=null}}},_loadComplete:null,getLoadComplete:function(){if(!this._loadComplete){var e=this;this._loadComplete=function(t){t=t||window.event;var n=t.srcElement||t.target;n.onload=n.onerror=null,e.loadingBay.removeChild(n),e.openRequestCount--,delete e.requestsById[n.id],t.type==="load"&&(n.complete||n.readyState&&n.readyState=="complete")?e.dispatchCallback("requestcomplete",n):(e.dispatchCallback("requesterror",{element:n,url:""+n.src}),n.src=null),setTimeout(e.getProcessQueue(),0)}}return this._loadComplete}},e.Layer=function(t,n){this.parent=n||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new e.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),t&&this.setProvider(t)},e.Layer.prototype={map:null,parent:null,tiles:null,levels:null,requestManager:null,provider:null,emptyImage:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",_tileComplete:null,getTileComplete:function(){if(!this._tileComplete){var e=this;this._tileComplete=function(t,n){e.tiles[n.id]=n,e.positionTile(n)}}return this._tileComplete},getTileError:function(){if(!this._tileError){var e=this;this._tileError=function(t,n){n.src=e.emptyImage,e.tiles[n.id]=n,e.positionTile(n)}}return this._tileError},draw:function(){function n(e,n){if(e&&n){var r=e.coord,i=n.coord;if(r.zoom==i.zoom){var s=Math.abs(t.row-r.row-.5)+Math.abs(t.column-r.column-.5),o=Math.abs(t.row-i.row-.5)+Math.abs(t.column-i.column-.5);return s<o?1:s>o?-1:0}return r.zoom<i.zoom?1:r.zoom>i.zoom?-1:0}return e?1:n?-1:0}var t=this.map.coordinate.zoomTo(Math.round(this.map.coordinate.zoom)),r=Math.round(this.map.coordinate.zoom),i=this.map.pointCoordinate(new e.Point(0,0)).zoomTo(r).container(),s=this.map.pointCoordinate(this.map.dimensions).zoomTo(r).container().right().down(),o={},u=this.createOrGetLevel(i.zoom),f=i.copy();for(f.column=i.column;f.column<=s.column;f.column++)for(f.row=i.row;f.row<=s.row;f.row++){var l=this.inventoryVisibleTile(u,f);while(l.length)o[l.pop()]=!0}for(var c in this.levels)if(this.levels.hasOwnProperty(c)){var h=parseInt(c,10);if(h>=i.zoom-5&&h<i.zoom+2)continue;var p=this.levels[c];p.style.display="none";var d=this.tileElementsInLevel(p);while(d.length)this.provider.releaseTile(d[0].coord),this.requestManager.clearRequest(d[0].coord.toKey()),p.removeChild(d[0]),d.shift()}var v=i.zoom-5,m=i.zoom+2;for(var g=v;g<m;g++)this.adjustVisibleLevel(this.levels[g],g,o);this.requestManager.clearExcept(o),this.requestManager.processQueue(n)},inventoryVisibleTile:function(e,t){var n=t.toKey(),r=[n];if(n in this.tiles){var i=this.tiles[n];return i.parentNode!=e&&(e.appendChild(i),"reAddTile"in this.provider&&this.provider.reAddTile(n,t,i)),r}if(!this.requestManager.hasRequest(n)){var s=this.provider.getTile(t);typeof s=="string"?this.addTileImage(n,t,s):s&&this.addTileElement(n,t,s)}var o=!1,u=t.zoom;for(var a=1;a<=u;a++){var f=t.zoomBy(-a).container(),l=f.toKey();if(l in this.tiles){r.push(l),o=!0;break}}if(!o){var c=t.zoomBy(1);r.push(c.toKey()),c.column+=1,r.push(c.toKey()),c.row+=1,r.push(c.toKey()),c.column-=1,r.push(c.toKey())}return r},tileElementsInLevel:function(e){var t=[];for(var n=e.firstChild;n;n=n.nextSibling)n.nodeType==1&&t.push(n);return t},adjustVisibleLevel:function(t,n,r){if(!t)return;var i=1,s=this.map.coordinate.copy();if(!(t.childNodes.length>0))return t.style.display="none",!1;t.style.display="block",i=Math.pow(2,this.map.coordinate.zoom-n),s=s.zoomTo(n);var o=this.map.tileSize.x*i,u=this.map.tileSize.y*i,f=new e.Point(this.map.dimensions.x/2,this.map.dimensions.y/2),l=this.tileElementsInLevel(t);while(l.length){var c=l.pop();r[c.id]?e.moveElement(c,{x:Math.round(f.x+(c.coord.column-s.column)*o),y:Math.round(f.y+(c.coord.row-s.row)*u),scale:i,width:this.map.tileSize.x,height:this.map.tileSize.y}):(this.provider.releaseTile(c.coord),this.requestManager.clearRequest(c.coord.toKey()),t.removeChild(c))}},createOrGetLevel:function(e){if(e in this.levels)return this.levels[e];var t=document.createElement("div");return t.id=this.parent.id+"-zoom-"+e,t.style.cssText=this.parent.style.cssText,t.style.zIndex=e,this.parent.appendChild(t),this.levels[e]=t,t},addTileImage:function(e,t,n){this.requestManager.requestTile(e,t,n)},addTileElement:function(e,t,n){n.id=e,n.coord=t.copy(),this.positionTile(n)},positionTile:function(t){var n=this.map.coordinate.zoomTo(t.coord.zoom);t.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;",t.ondragstart=function(){return!1};var r=Math.pow(2,this.map.coordinate.zoom-t.coord.zoom);e.moveElement(t,{x:Math.round(this.map.dimensions.x/2+(t.coord.column-n.column)*this.map.tileSize.x),y:Math.round(this.map.dimensions.y/2+(t.coord.row-n.row)*this.map.tileSize.y),scale:r,width:this.map.tileSize.x,height:this.map.tileSize.y});var i=this.levels[t.coord.zoom];i.appendChild(t),t.className="map-tile-loaded",Math.round(this.map.coordinate.zoom)==t.coord.zoom&&(i.style.display="block"),this.requestRedraw()},_redrawTimer:undefined,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var e=this;this._redraw=function(){e.draw(),e._redrawTimer=0}}return this._redraw},setProvider:function(e){var t=this.provider===null;if(!t){this.requestManager.clear();for(var n in this.levels)if(this.levels.hasOwnProperty(n)){var r=this.levels[n];while(r.firstChild)this.provider.releaseTile(r.firstChild.coord),r.removeChild(r.firstChild)}}this.tiles={},this.provider=e,t||this.draw()},destroy:function(){this.requestManager.clear(),this.requestManager.removeCallback("requestcomplete",this.getTileComplete()),this.provider=null,this.parent.parentNode&&this.parent.parentNode.removeChild(this.parent),this.map=null}},e.Map=function(t,n,r,i){if(typeof t=="string"){t=document.getElementById(t);if(!t)throw"The ID provided to modest maps could not be found."}this.parent=t,this.parent.style.padding="0",this.parent.style.overflow="hidden";var s=e.getStyle(this.parent,"position");s!="relative"&&s!="absolute"&&(this.parent.style.position="relative"),this.layers=[],n||(n=[]),n instanceof Array||(n=[n]);for(var o=0;o<n.length;o++)this.addLayer(n[o]);this.projection=new e.MercatorProjection(0,e.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1)),this.tileSize=new e.Point(256,256),this.coordLimits=[new e.Coordinate(0,-Infinity,0),(new e.Coordinate(1,Infinity,0)).zoomTo(18)],this.coordinate=new e.Coordinate(.5,.5,0),r?(this.autoSize=!1,this.parent.style.width=Math.round(r.x)+"px",this.parent.style.height=Math.round(r.y)+"px"):(r=new e.Point(this.parent.offsetWidth,this.parent.offsetHeight),this.autoSize=!0,e.addEvent(window,"resize",this.windowResize())),this.dimensions=r,this.callbackManager=new e.CallbackManager(this,["zoomed","panned","centered","extentset","resized","drawn"]);if(i===undefined)this.eventHandlers=[e.MouseHandler().init(this),e.TouchHandler().init(this)];else{this.eventHandlers=i;if(i instanceof Array)for(var u=0;u<i.length;u++)i[u].init(this)}},e.Map.prototype={parent:null,dimensions:null,projection:null,coordinate:null,tileSize:null,coordLimits:null,layers:null,callbackManager:null,eventHandlers:null,autoSize:null,toString:function(){return"Map(#"+this.parent.id+")"},addCallback:function(e,t){return this.callbackManager.addCallback(e,t),this},removeCallback:function(e,t){return this.callbackManager.removeCallback(e,t),this},dispatchCallback:function(e,t){return this.callbackManager.dispatchCallback(e,t),this},windowResize:function(){if(!this._windowResize){var t=this;this._windowResize=function(n){t.dimensions=new e.Point(t.parent.offsetWidth,t.parent.offsetHeight),t.draw(),t.dispatchCallback("resized",[t.dimensions])}}return this._windowResize},setZoomRange:function(e,t){return this.coordLimits[0]=this.coordLimits[0].zoomTo(e),this.coordLimits[1]=this.coordLimits[1].zoomTo(t),this},zoomBy:function(t){return this.coordinate=this.enforceLimits(this.coordinate.zoomBy(t)),e.getFrame(this.getRedraw()),this.dispatchCallback("zoomed",t),this},zoomIn:function(){return this.zoomBy(1)},zoomOut:function(){return this.zoomBy(-1)},setZoom:function(e){return this.zoomBy(e-this.coordinate.zoom)},zoomByAbout:function(e,t){var n=this.pointLocation(t);this.coordinate=this.enforceLimits(this.coordinate
.zoomBy(e));var r=this.locationPoint(n);return this.dispatchCallback("zoomed",e),this.panBy(t.x-r.x,t.y-r.y)},panBy:function(t,n){return this.coordinate.column-=t/this.tileSize.x,this.coordinate.row-=n/this.tileSize.y,this.coordinate=this.enforceLimits(this.coordinate),e.getFrame(this.getRedraw()),this.dispatchCallback("panned",[t,n]),this},panLeft:function(){return this.panBy(100,0)},panRight:function(){return this.panBy(-100,0)},panDown:function(){return this.panBy(0,-100)},panUp:function(){return this.panBy(0,100)},setCenter:function(e){return this.setCenterZoom(e,this.coordinate.zoom)},setCenterZoom:function(t,n){return this.coordinate=this.projection.locationCoordinate(t).zoomTo(parseFloat(n)||0),e.getFrame(this.getRedraw()),this.dispatchCallback("centered",[t,n]),this},extentCoordinate:function(t,n){t instanceof e.Extent&&(t=t.toArray());var r,i;for(var s=0;s<t.length;s++){var o=this.projection.locationCoordinate(t[s]);r?(r.row=Math.min(r.row,o.row),r.column=Math.min(r.column,o.column),r.zoom=Math.min(r.zoom,o.zoom),i.row=Math.max(i.row,o.row),i.column=Math.max(i.column,o.column),i.zoom=Math.max(i.zoom,o.zoom)):(r=o.copy(),i=o.copy())}var u=this.dimensions.x+1,f=this.dimensions.y+1,l=(i.column-r.column)/(u/this.tileSize.x),c=Math.log(l)/Math.log(2),h=r.zoom-(n?c:Math.ceil(c)),p=(i.row-r.row)/(f/this.tileSize.y),d=Math.log(p)/Math.log(2),v=r.zoom-(n?d:Math.ceil(d)),m=Math.min(h,v);m=Math.min(m,this.coordLimits[1].zoom),m=Math.max(m,this.coordLimits[0].zoom);var g=(r.row+i.row)/2,y=(r.column+i.column)/2,b=r.zoom;return(new e.Coordinate(g,y,b)).zoomTo(m)},setExtent:function(e,t){return this.coordinate=this.extentCoordinate(e,t),this.draw(),this.dispatchCallback("extentset",e),this},setSize:function(t){return this.dimensions=new e.Point(t.x,t.y),this.parent.style.width=Math.round(this.dimensions.x)+"px",this.parent.style.height=Math.round(this.dimensions.y)+"px",this.autoSize&&(e.removeEvent(window,"resize",this.windowResize()),this.autoSize=!1),this.draw(),this.dispatchCallback("resized",this.dimensions),this},coordinatePoint:function(t){t.zoom!=this.coordinate.zoom&&(t=t.zoomTo(this.coordinate.zoom));var n=new e.Point(this.dimensions.x/2,this.dimensions.y/2);return n.x+=this.tileSize.x*(t.column-this.coordinate.column),n.y+=this.tileSize.y*(t.row-this.coordinate.row),n},pointCoordinate:function(e){var t=this.coordinate.copy();return t.column+=(e.x-this.dimensions.x/2)/this.tileSize.x,t.row+=(e.y-this.dimensions.y/2)/this.tileSize.y,t},locationCoordinate:function(e){return this.projection.locationCoordinate(e)},coordinateLocation:function(e){return this.projection.coordinateLocation(e)},locationPoint:function(e){return this.coordinatePoint(this.locationCoordinate(e))},pointLocation:function(e){return this.coordinateLocation(this.pointCoordinate(e))},getExtent:function(){return new e.Extent(this.pointLocation(new e.Point(0,0)),this.pointLocation(this.dimensions))},extent:function(e,t){return e?this.setExtent(e,t):this.getExtent()},getCenter:function(){return this.projection.coordinateLocation(this.coordinate)},center:function(e){return e?this.setCenter(e):this.getCenter()},getZoom:function(){return this.coordinate.zoom},zoom:function(e){return e!==undefined?this.setZoom(e):this.getZoom()},getLayers:function(){return this.layers.slice()},getLayerAt:function(e){return this.layers[e]},addLayer:function(t){return this.layers.push(t),this.parent.appendChild(t.parent),t.map=this,this.coordinate&&e.getFrame(this.getRedraw()),this},removeLayer:function(e){for(var t=0;t<this.layers.length;t++)if(e==this.layers[t]){this.removeLayerAt(t);break}return this},setLayerAt:function(t,n){if(t<0||t>=this.layers.length)throw new Error("invalid index in setLayerAt(): "+t);if(this.layers[t]!=n){if(t<this.layers.length){var r=this.layers[t];this.parent.insertBefore(n.parent,r.parent),r.destroy()}else this.parent.appendChild(n.parent);this.layers[t]=n,n.map=this,e.getFrame(this.getRedraw())}return this},insertLayerAt:function(t,n){if(t<0||t>this.layers.length)throw new Error("invalid index in insertLayerAt(): "+t);if(t==this.layers.length)this.layers.push(n),this.parent.appendChild(n.parent);else{var r=this.layers[t];this.parent.insertBefore(n.parent,r.parent),this.layers.splice(t,0,n)}return n.map=this,e.getFrame(this.getRedraw()),this},removeLayerAt:function(e){if(e<0||e>=this.layers.length)throw new Error("invalid index in removeLayer(): "+e);var t=this.layers[e];return this.layers.splice(e,1),t.destroy(),this},swapLayersAt:function(e,t){if(e<0||e>=this.layers.length||t<0||t>=this.layers.length)throw new Error("invalid index in swapLayersAt(): "+index);var n=this.layers[e],r=this.layers[t],i=document.createElement("div");return this.parent.replaceChild(i,r.parent),this.parent.replaceChild(r.parent,n.parent),this.parent.replaceChild(n.parent,i),this.layers[e]=r,this.layers[t]=n,this},enforceZoomLimits:function(e){var t=this.coordLimits;if(t){var n=t[0].zoom,r=t[1].zoom;e.zoom<n?e=e.zoomTo(n):e.zoom>r&&(e=e.zoomTo(r))}return e},enforcePanLimits:function(t){if(this.coordLimits){t=t.copy();var n=this.coordLimits[0].zoomTo(t.zoom),r=this.coordLimits[1].zoomTo(t.zoom),i=this.pointCoordinate(new e.Point(0,0)).zoomTo(t.zoom),s=this.pointCoordinate(this.dimensions).zoomTo(t.zoom);r.row-n.row<s.row-i.row?t.row=(r.row+n.row)/2:i.row<n.row?t.row+=n.row-i.row:s.row>r.row&&(t.row-=s.row-r.row),r.column-n.column<s.column-i.column?t.column=(r.column+n.column)/2:i.column<n.column?t.column+=n.column-i.column:s.column>r.column&&(t.column-=s.column-r.column)}return t},enforceLimits:function(e){return this.enforcePanLimits(this.enforceZoomLimits(e))},draw:function(){this.coordinate=this.enforceLimits(this.coordinate);if(this.dimensions.x<=0||this.dimensions.y<=0){if(!this.autoSize)return;var t=this.parent.offsetWidth,n=this.parent.offsetHeight;this.dimensions=new e.Point(t,n);if(t<=0||n<=0)return}for(var r=0;r<this.layers.length;r++)this.layers[r].draw();this.dispatchCallback("drawn")},_redrawTimer:undefined,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var e=this;this._redraw=function(){e.draw(),e._redrawTimer=0}}return this._redraw},destroy:function(){for(var t=0;t<this.layers.length;t++)this.layers[t].destroy();this.layers=[],this.projection=null;for(var n=0;n<this.eventHandlers.length;n++)this.eventHandlers[n].remove();this.autoSize&&e.removeEvent(window,"resize",this.windowResize())}},e.mapByCenterZoom=function(t,n,r,i){var s=e.coerceLayer(n),o=new e.Map(t,s,!1);return o.setCenterZoom(r,i).draw(),o},e.mapByExtent=function(t,n,r,i){var s=e.coerceLayer(n),o=new e.Map(t,s,!1);return o.setExtent([r,i]).draw(),o},typeof module!="undefined"&&module.exports&&(module.exports={Point:e.Point,Projection:e.Projection,MercatorProjection:e.MercatorProjection,LinearProjection:e.LinearProjection,Transformation:e.Transformation,Location:e.Location,MapProvider:e.MapProvider,Template:e.Template,Coordinate:e.Coordinate,deriveTransformation:e.deriveTransformation})})(MM),function(e,t){var n=function(){function f(e,t,n){return n===0?e:n===1?t:e+(t-e)*n}function c(e,n){var r=new t.Point(a.dimensions.x/2,a.dimensions.y/2);return r.x+=a.tileSize.x*(n.column-e.column),r.y+=a.tileSize.y*(n.row-e.row),r}var e={},n=!1,r=!1,i={easeIn:function(e){return e*e},easeOut:function(e){return Math.sin(e*Math.PI/2)},easeInOut:function(e){return(1-Math.cos(Math.PI*e))/2},linear:function(e){return e}},s=i.easeOut,o,u,a;e.stop=function(){r=!0},e.running=function(){return n},e.point=function(t){return u=a.pointCoordinate(t),e},e.zoom=function(t){return u=a.enforceZoomLimits(u.zoomTo(t)),e},e.location=function(t){return u=a.locationCoordinate(t),e},e.from=function(t){return arguments.length?(o=t.copy(),e):o.copy()},e.to=function(t){return arguments.length?(u=a.enforceZoomLimits(t.copy()),e):u.copy()},e.path=function(t){return h=l[t],e},e.easing=function(t){return s=i[t],e},e.map=function(t){return arguments.length?(a=t,o=a.coordinate.copy(),u=a.coordinate.copy(),e):a};var l={};l.screen=function(e,n,r){var i=f(e.zoom,n.zoom,r),s=e.copy(),o=n.copy().zoomTo(e.zoom);return(new t.Coordinate(f(s.row,o.row,r),f(s.column,o.column,r),s.zoom)).zoomTo(i)},l.about=function(e,t,n){var r=f(e.zoom,t.zoom,n),i=t.copy().zoomTo(e.zoom),s=e.copy().zoomTo(r),o=t.copy().zoomTo(r),u=c(e,i),l=c(s,o);return s.column-=(u.x-l.x)/a.tileSize.x,s.row-=(u.y-l.y)/a.tileSize.y,s};var h=l.screen;e.t=function(t){return a.coordinate=h(o,u,s(t)),a.draw(),e},e.future=function(e){var t=[];for(var n=0;n<e;n++)t.push(h(o,u,n/(e-1)));return t};var p;return e.resetRun=function(){return p=+(new Date),e},e.run=function(e,i){function f(){var l=+(new Date)-p;if(r)return void (r=n=!1);if(l>e){n=!1,a.coordinate=h(o,u,1),a.draw();if(i)return i(a)}else a.coordinate=h(o,u,s(l/e)),a.draw(),t.getFrame(f)}e=e||1e3,p=+(new Date),n=!0,t.getFrame(f)},e};this.easey=n}(this,com.modestmaps),function(e,t){easey.TouchHandler=function(){function m(e){var r={x:0,y:0},s=Math.max(.001,(e-n)/1e3);h&&p&&d>+(new Date)-50?(r.x=h.x-p.x,r.y=h.y-p.y,i.x=r.x,i.y=r.y):(i.x-=i.x*a,i.y-=i.y*a,Math.abs(i.x)<.001&&(i.x=0),Math.abs(i.y)<.001&&(i.y=0)),(i.x||i.y)&&map.panBy(i.x,i.y),n=e,t.getFrame(m)}function g(e,t){return e&&e.touch&&t.identifier==e.touch.identifier}function y(e){for(var t=0;t<e.touches.length;t+=1){var n=e.touches[t];if(n.identifier in f){var r=f[n.identifier];r.x=n.screenX,r.y=n.screenY,r.scale=e.scale}else f[n.identifier]={scale:e.scale,startPos:{x:n.screenX,y:n.screenY},x:n.screenX,y:n.screenY,time:(new Date).getTime()}}}function b(e){return y(e),t.cancelEvent(e)}function w(e){switch(e.touches.length){case 1:T(e.touches[0]);break;case 2:N(e)}return y(e),t.cancelEvent(e)}function E(e){if(l.length&&e.time-l[0].time<u){S(e),l=[];return}l=[e]}function S(e){easey().map(map).to(map.pointCoordinate(e).zoomTo(map.getZoom()+1)).path("about").run(200,function(){map.dispatchCallback("zoomed")})}function x(){var e=document.createElement("div");return e.setAttribute("ongesturestart","return;"),typeof e.ongesturestart=="function"}function T(e){d=+(new Date),p=h,h={x:e.screenX,y:e.screenY}}function N(e){var n=e.touches[0],r=e.touches[1],i=new t.Point(n.screenX,n.screenY),s=new t.Point(r.screenX,r.screenY),o=f[n.identifier],u=f[r.identifier];o.wasPinch=!0,u.wasPinch=!0;var a=t.Point.interpolate(i,s,.5);map.zoomByAbout(Math.log(e.scale)/Math.LN2-Math.log(o.scale)/Math.LN2,a);var l=t.Point.interpolate(o,u,.5);map.panBy(a.x-l.x,a.y-l.y),c=!0,v=a}function C(e){var t=map.getZoom(),n=Math.round(t);map.zoomByAbout(n-t,e),c=!1}function k(e){var n=(new Date).getTime();e.touches.length===0&&c&&C(v),p=h=null;for(var r=0;r<e.changedTouches.length;r+=1){var i=e.changedTouches[r],u=f[i.identifier];if(!u||u.wasPinch)continue;var a={x:i.screenX,y:i.screenY},l=n-u.time,d=t.Point.distance(a,u.startPos);d>o||(l>s?(a.end=n,a.duration=l,onHold(a)):(a.time=n,E(a)))}var m={};for(var g=0;g<e.touches.length;g++)m[e.touches[g].identifier]=!0;for(var y in f)y in m||delete m[y];return t.cancelEvent(e)}var e={},n=0,r=25,i=null,s=250,o=30,u=350,a=.1,f={},l=[],c=!1,h=null,p=null,d=null,v=null;return e.init=function(e){if(!x())return!1;t.addEvent(e.parent,"touchstart",b),t.addEvent(e.parent,"touchmove",w),t.addEvent(e.parent,"touchend",k),n=(new Date).getTime(),i={x:0,y:0},t.getFrame(m)},e.remove=function(){if(!x())return!1;t.removeEvent(map.parent,"touchstart",b),t.removeEvent(map.parent,"touchmove",w),t.removeEvent(map.parent,"touchend",k)},e},easey.DoubleClickHandler=function(){function r(e){var r=t.getMousePoint(e,n);return z=n.getZoom()+(e.shiftKey?-1:1),easey().map(n).to(n.pointCoordinate(t.getMousePoint(e,n)).zoomTo(z)).path("about").run(100,function(){n.dispatchCallback("zoomed")}),t.cancelEvent(e)}var e={},n;return e.init=function(i){return n=i,t.addEvent(n.parent,"dblclick",r),e},e.remove=function(){t.removeEvent(n.parent,"dblclick",r)},e},easey.MouseWheelHandler=function(){function u(e){function l(){n.dispatchCallback("zoomed")}var o=0;s=s||(new Date).getTime();try{r.scrollTop=1e3,r.dispatchEvent(e),o=1e3-r.scrollTop}catch(u){o=e.wheelDelta||-e.detail*5}var a=(new Date).getTime()-s,f=t.getMousePoint(e,n);if(!i.running()){var f=t.getMousePoint(e,n),c=n.getZoom();i.map(n).easing("easeOut").to(n.pointCoordinate(t.getMousePoint(e,n)).zoomTo(c+(o>0?1:-1))).path("about").run(100,l),s=(new Date).getTime()}else a>150&&(i.zoom(i.to().zoom+(o>0?1:-1)).from(n.coordinate).resetRun(),s=(new Date).getTime());return t.cancelEvent(e)}var e={},n,r,i=easey(),s,o=!1;return e.init=function(i){n=i,r=document.body.appendChild(document.createElement("div")),r.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var s=r.appendChild(document.createElement("div"));return s.style.height="2000px",t.addEvent(n.parent,"mousewheel",u),e},e.precise=function(t){return arguments.length?(o=t,e):o},e.remove=function(){t.removeEvent(n.parent,"mousewheel",u),r.parentNode.removeChild(r)},e},easey.DragHandler=function(){function d(e){n.parent.focus()}function v(e){if(e.shiftKey||e.button==2)return;return t.addEvent(document,"mousemove",m),t.addEvent(document,"mouseup",g),f=l=t.getMousePoint(e,n),c=h=+(new Date),n.parent.style.cursor="move",t.cancelEvent(e)}function m(e){if(f)return p&&(l=f,h=c,p=!1),f=t.getMousePoint(e,n),c=+(new Date),t.cancelEvent(e)}function g(e){t.removeEvent(document,"mousemove",m),t.removeEvent(document,"mouseup",g);if(+(new Date)-h<50){dt=Math.max(1,c-h);var r={x:0,y:0};r.x=f.x-l.x,r.y=f.y-l.y,i.x=r.x/dt,i.y=r.y/dt}else i.x=0,i.y=0;return f=l=null,c=lastMoveTime=null,n.parent.style.cursor="",t.cancelEvent(e)}function y(e){var u={x:0,y:0},a=Math.max(1,e-r);f&&l?p||(u.x=f.x-l.x,u.y=f.y-l.y,n.panBy(u.x,u.y),p=!0):(i.x*=Math.pow(1-s,a*60/1e3),i.y*=Math.pow(1-s,a*60/1e3),Math.abs(i.x)<.001&&(i.x=0),Math.abs(i.y)<.001&&(i.y=0),(i.x||i.y)&&n.panBy(i.x*a,i.y*a)),r=e,o||t.getFrame(y)}var e={},n,r=0,i=null,s=.15,o=!1,u=null,a=0,f=null,l=null,c=null,h=null,p=!0;return e.init=function(e){n=e,t.addEvent(n.parent,"click",d),t.addEvent(n.parent,"mousedown",v),r=(new Date).getTime(),i={x:0,y:0},o=!1,t.getFrame(y)},e.remove=function(){t.removeEvent(n.parent,"click",d),t.removeEvent(n.parent,"mousedown",v),o=!0},e}}(this,MM),!function(e,t,n){typeof module!="undefined"?module.exports=n(e,t):typeof define=="function"&&typeof define.amd=="object"?define(n):t[e]=n(e,t)}("bean",this,function(e,t){var n=window,r=t[e],i=/over|out/,s=/[^\.]*(?=\..*)\.|.*/,o=/\..*/,u="addEventListener",a="attachEvent",f="removeEventListener",l="detachEvent",c=document||{},h=c.documentElement||{},p=h[u],d=p?u:a,v=Array.prototype.slice,m=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,g=/mouse.*(wheel|scroll)/i,y=/^text/i,b=/^touch|^gesture/i,w={one:1},E=function(e,t,n){for(n=0;n<t.length;n++)e[t[n]]=1;return e}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(p?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend message readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),S=function(){function e(e,t){while((t=t.parentNode)!==null)if(t===e)return!0;return!1}function t(t){var n=t.relatedTarget;return n?n!==this&&n.prefix!=="xul"&&!/document/.test(this.toString())&&!e(this,n):n===null}return{mouseenter:{base:"mouseover",condition:t},mouseleave:{base:"mouseout",condition:t},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),x=function(){var e="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),t=e.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),n=t.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),r=e.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),s=e.concat(["data"]),o=e.concat("touches targetTouches changedTouches scale rotation".split(" ")),u="preventDefault",a=function(e){return function(){e[u]?e[u]():e.returnValue=!1}},f="stopPropagation",l=function(e){return function(){e[f]?e[f]():e.cancelBubble=!0}},p=function(e){return function(){e[u](),e[f](),e.stopped=!0}},d=function(e,t,n){var r,i;for(r=n.length;r--;)i=n[r],!(i in t)&&i in e&&(t[i]=e[i])};return function(v,w){var E={originalEvent:v,isNative:w};if(!v)return E;var S,x=v.type,T=v.target||v.srcElement;E[u]=a(v),E[f]=l(v),E.stop=p(E),E.target=T&&T.nodeType===3?T.parentNode:T;if(w){if(x.indexOf("key")!==-1)S=r,E.keyCode=v.which||v.keyCode;else if(m.test(x)){S=t,E.rightClick=v.which===3||v.button===2,E.pos={x:0,y:0};if(v.pageX||v.pageY)E.clientX=v.pageX,E.clientY=v.pageY;else if(v.clientX||v.clientY)E.clientX=v.clientX+c.body.scrollLeft+h.scrollLeft,E.clientY=v.clientY+c.body.scrollTop+h.scrollTop;i.test(x)&&(E.relatedTarget=v.relatedTarget||v[(x==="mouseover"?"from":"to")+"Element"])}else b.test(x)?S=o:g.test(x)?S=n:y.test(x)&&(S=s);d(v,E,S||e)}return E}}(),T=function(e,t){return!p&&!t&&(e===c||e===n)?h:e},N=function(){function e(e,t,n,r,i){this.element=e,this.type=t,this.handler=n,this.original=r,this.namespaces=i,this.custom=S[t],this.isNative=E[t]&&e[d],this.eventType=p||this.isNative?t:"propertychange",this.customType=!p&&!this.isNative&&t,this.target=T(e,this.isNative),this.eventSupport=this.target[d]}return e.prototype={inNamespaces:function(e){var t,n;if(!e)return!0;if(!this.namespaces)return!1;for(t=e.length;t--;)for(n=this.namespaces.length;n--;)if(e[t]===this.namespaces[n])return!0;return!1},matches:function(e,t,n){return this.element===e&&(!t||this.original===t)&&(!n||this.handler===n)}},e}(),C=function(){var e={},t=function(n,r,i,s,o){if(!r||r==="*")for(var u in e)u.charAt(0)==="$"&&t(n,u.substr(1),i,s,o);else{var a=0,f,l=e["$"+r],c=n==="*";if(!l)return;for(f=l.length;a<f;a++)if(c||l[a].matches(n,i,s))if(!o(l[a],l,a,r))return}},n=function(t,n,r){var i,s=e["$"+n];if(s)for(i=s.length;i--;)if(s[i].matches(t,r,null))return!0;return!1},r=function(e,n,r){var i=[];return t(e,n,r,null,function(e){return i.push(e)}),i},i=function(t){return(e["$"+t.type]||(e["$"+t.type]=[])).push(t),t},s=function(n){t(n.element,n.type,null,n.handler,function(t,n,r){return n.splice(r,1),n.length===0&&delete e["$"+t.type],!1})},o=function(){var t,n=[];for(t in e)t.charAt(0)==="$"&&(n=n.concat(e[t]));return n};return{has:n,get:r,put:i,del:s,entries:o}}(),k=p?function(e,t,n,r){e[r?u:f](t,n,!1)}:function(e,t,n,r,i){i&&r&&e["_on"+i]===null&&(e["_on"+i]=0),e[r?a:l]("on"+t,n)},L=function(e,t,r){return function(i){return i=x(i||((this.ownerDocument||this.document||this).parentWindow||n).event,!0),t.apply(e,[i].concat(r))}},A=function(e,t,r,i,s,o){return function(u){if(i?i.apply(this,arguments):p?!0:u&&u.propertyName==="_on"+r||!u)u&&(u=x(u||((this.ownerDocument||this.document||this).parentWindow||n).event,o)),t.apply(e,u&&(!s||s.length===0)?arguments:v.call(arguments,u?0:1).concat(s))}},O=function(e,t,n,r,i){return function(){e(t,n,i),r.apply(this,arguments)}},M=function(e,t,n,r){var i,s,u,a=t&&t.replace(o,""),f=C.get(e,a,n);for(i=0,s=f.length;i<s;i++)f[i].inNamespaces(r)&&((u=f[i]).eventSupport&&k(u.target,u.eventType,u.handler,!1,u.type),C.del(u))},_=function(e,t,n,r,i){var u,a=t.replace(o,""),f=t.replace(s,"").split(".");if(C.has(e,a,n))return e;a==="unload"&&(n=O(M,e,a,n,r)),S[a]&&(S[a].condition&&(n=A(e,n,a,S[a].condition,!0)),a=S[a].base||a),u=C.put(new N(e,a,n,r,f[0]&&f)),u.handler=u.isNative?L(e,u.handler,i):A(e,u.handler,a,!1,i,!1),u.eventSupport&&k(u.target,u.eventType,u.handler,!0,u.customType)},D=function(e,t,n){return function(r){var i,s,o=typeof e=="string"?n(e,this):e;for(i=r.target;i&&i!==this;i=i.parentNode)for(s=o.length;s--;)if(o[s]===i)return t.apply(i,arguments)}},P=function(e,t,n){var r,i,u,a,f,l=M,c=t&&typeof t=="string";if(c&&t.indexOf(" ")>0){t=t.split(" ");for(f=t.length;f--;)P(e,t[f],n);return e}u=c&&t.replace(o,""),u&&S[u]&&(u=S[u].type);if(!t||c){if(a=c&&t.replace(s,""))a=a.split(".");l(e,u,n,a)}else if(typeof t=="function")l(e,null,t);else for(r in t)t.hasOwnProperty(r)&&P(e,r,t[r]);return e},H=function(e,t,n,r,i){var s,o,u,a,f=n,l=n&&typeof n=="string";if(t&&!n&&typeof t=="object")for(s in t)t.hasOwnProperty(s)&&H.apply(this,[e,s,t[s]]);else{a=arguments.length>3?v.call(arguments,3):[],o=(l?n:t).split(" "),l&&(n=D(t,f=r,i))&&(a=v.call(a,1)),this===w&&(n=O(P,e,t,n,f));for(u=o.length;u--;)_(e,o[u],n,f,a)}return e},B=function(){return H.apply(w,arguments)},j=p?function(e,t,r){var i=c.createEvent(e?"HTMLEvents":"UIEvents");i[e?"initEvent":"initUIEvent"](t,!0,!0,n,1),r.dispatchEvent(i)}:function(e,t,n){n=T(n,e),e?n.fireEvent("on"+t,c.createEventObject()):n["_on"+t]++},F=function(e,t,n){var r,i,u,a,f,l=t.split(" ");for(r=l.length;r--;){t=l[r].replace(o,"");if(a=l[r].replace(s,""))a=a.split(".");if(!a&&!n&&e[d])j(E[t],t,e);else{f=C.get(e,t),n=[!1].concat(n);for(i=0,u=f.length;i<u;i++)f[i].inNamespaces(a)&&f[i].handler.apply(e,n)}}return e},I=function(e,t,n){var r=0,i=C.get(t,n),s=i.length;for(;r<s;r++)i[r].original&&H(e,i[r].type,i[r].original);return e},q={add:H,one:B,remove:P,clone:I,fire:F,noConflict:function(){return t[e]=r,this}};if(n[a]){var R=function(){var e,t=C.entries();for(e in t)t[e].type&&t[e].type!=="unload"&&P(t[e].element,t[e].type);n[l]("onunload",R),n.CollectGarbage&&n.CollectGarbage()};n[a]("onunload",R)}return q});var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};var html=function(e){function o(e){e=t(e);if(n.hasOwnProperty(e))return n[e];var r=e.match(i);return r?String.fromCharCode(parseInt(r[1],10)):(r=e.match(s))?String.fromCharCode(parseInt(r[1],16)):""}function u(e,t){return o(t)}function f(e){return e.replace(a,"")}function c(e){return e.replace(l,u)}function y(e){return e.replace(h,"&amp;").replace(d,"&lt;").replace(v,"&gt;").replace(m,"&#34;").replace(g,"&#61;")}function b(e){return e.replace(p,"&amp;$1").replace(d,"&lt;").replace(v,"&gt;")}function S(n){return function(i,s){i=String(i);var o=null,u=!1,a=[],l=void 0,h=void 0,p=void 0;n.startDoc&&n.startDoc(s);while(i){var d=i.match(u?w:E);i=i.substring(d[0].length);if(u){if(d[1]){var v=t(d[1]),m;if(d[2]){var g=d[3];switch(g.charCodeAt(0)){case 34:case 39:g=g.substring(1,g.length-1)}m=c(f(g))}else m=v;a.push(v,m)}else if(d[4]){h!==void 0&&(p?n.startTag&&n.startTag(l,a,s):n.endTag&&n.endTag(l,s));if(p&&h&(e.eflags.CDATA|e.eflags.RCDATA)){o===null?o=t(i):o=o.substring(o.length-i.length);var y=o.indexOf("</"+l);y<0&&(y=i.length),y&&(h&e.eflags.CDATA?n.cdata&&n.cdata(i.substring(0,y),s):n.rcdata&&n.rcdata(b(i.substring(0,y)),s),i=i.substring(y))}l=h=p=void 0,a.length=0,u=!1}}else if(d[1])n.pcdata&&n.pcdata(d[0],s);else if(d[3])p=!d[2],u=!0,l=t(d[3]),h=e.ELEMENTS.hasOwnProperty(l)?e.ELEMENTS[l]:void 0;else if(d[4])n.pcdata&&n.pcdata(d[4],s);else if(d[5]&&n.pcdata){var S=d[5];n.pcdata(S==="<"?"&lt;":S===">"?"&gt;":"&amp;",s)}}n.endDoc&&n.endDoc(s)}}function x(t){var n,r;return S({startDoc:function(e){n=[],r=!1},startTag:function(i,s,o){if(r)return;if(!e.ELEMENTS.hasOwnProperty(i))return;var u=e.ELEMENTS[i];if(u&e.eflags.FOLDABLE)return;if(u&e.eflags.UNSAFE){r=!(u&e.eflags.EMPTY);return}s=t(i,s);if(s){u&e.eflags.EMPTY||n.push(i),o.push("<",i);for(var a=0,f=s.length;a<f;a+=2){var l=s[a],c=s[a+1];c!==null&&c!==void 0&&o.push(" ",l,'="',y(c),'"')}o.push(">")}},endTag:function(t,i){if(r){r=!1;return}if(!e.ELEMENTS.hasOwnProperty(t))return;var s=e.ELEMENTS[t];if(!(s&(e.eflags.UNSAFE|e.eflags.EMPTY|e.eflags.FOLDABLE))){var o;if(s&e.eflags.OPTIONAL_ENDTAG)for(o=n.length;--o>=0;){var u=n[o];if(u===t)break;if(!(e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG))return}else for(o=n.length;--o>=0;)if(n[o]===t)break;if(o<0)return;for(var a=n.length;--a>o;){var u=n[a];e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG||i.push("</",u,">")}n.length=o,i.push("</",t,">")}},pcdata:function(e,t){r||t.push(e)},rcdata:function(e,t){r||t.push(e)},cdata:function(e,t){r||t.push(e)},endDoc:function(e){for(var t=n.length;--t>=0;)e.push("</",n[t],">");n.length=0}})}function N(t,n,i){var s=[];return x(function(s,o){for(var u=0;u<o.length;u+=2){var a=o[u],f=o[u+1],l=null,c;if((c=s+"::"+a,e.ATTRIBS.hasOwnProperty(c))||(c="*::"+a,e.ATTRIBS.hasOwnProperty(c)))l=e.ATTRIBS[c];if(l!==null)switch(l){case e.atype.NONE:break;case e.atype.SCRIPT:case e.atype.STYLE:f=null;break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:f=i?i(f):f;break;case e.atype.URI:var h=(""+f).match(T);h?!h[1]||r.test(h[1])?f=n&&n(f):f=null:f=null;break;case e.atype.URI_FRAGMENT:f&&"#"===f.charAt(0)?(f=i?i(f):f,f&&(f="#"+f)):f=null;break;default:f=null}else f=null;o[u+1]=f}return o})(t,s),s.join("")}var t;"script"==="SCRIPT".toLowerCase()?t=function(e){return e.toLowerCase()}:t=function(e){return e.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)|32)})};var n={lt:"<",gt:">",amp:"&",nbsp:"",quot:'"',apos:"'"},r=/^(?:https?|mailto|data)$/i,i=/^#(\d+)$/,s=/^#x([0-9A-Fa-f]+)$/,a=/\0/g,l=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,h=/&/g,p=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,d=/</g,v=/>/g,m=/\"/g,g=/\=/g,w=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),E=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),T=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:y,makeHtmlSanitizer:x,makeSaxParser:S,normalizeRCData:b,sanitize:N,unescapeEntities:c}}(html4),html_sanitize=html.sanitize;typeof window!="undefined"&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0;var Mustache=typeof module!="undefined"&&module.exports||{};(function(e){function a(e){return u.test(e)}function p(e){return String(e).replace(/[&<>"'\/]/g,function(e){return h[e]||e})}function d(e,t,n,r){r=r||"<template>";var i=t.split("\n"),s=Math.max(n-3,0),o=Math.min(i.length,n+3),u=i.slice(s,o),a;for(var f=0,l=u.length;f<l;++f)a=f+s+1,u[f]=(a===n?" >> ":"    ")+u[f];return e.template=t,e.line=n,e.file=r,e.message=[r+":"+n,u.join("\n"),"",e.message].join("\n"),e}function v(e,t,n){if(e===".")return t[t.length-1];var r=e.split("."),i=r.length-1,s=r[i],o,u,a=t.length,f,l;while(a){l=t.slice(0),u=t[--a],f=0;while(f<i){u=u[r[f++]];if(u==null)break;l.push(u)}if(u&&typeof u=="object"&&s in u){o=u[s];break}}return typeof o=="function"&&(o=o.call(l[l.length-1])),o==null?n:o}function m(e,t,n,r){var i="",u=v(e,t);if(r){if(u==null||u===!1||s(u)&&u.length===0)i+=n()}else if(s(u))o(u,function(e){t.push(e),i+=
n(),t.pop()});else if(typeof u=="object")t.push(u),i+=n(),t.pop();else if(typeof u=="function"){var a=t[t.length-1],f=function(e){return S(e,a)};i+=u.call(a,n(),f)||""}else u&&(i+=n());return i}function g(t,n){n=n||{};var r=n.tags||e.tags,i=r[0],s=r[r.length-1],o=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],u=[],l=!1,c=!1,h=function(){if(l&&!c&&!n.space)while(u.length)o.splice(u.pop(),1);else u=[];l=!1,c=!1},p=[],v,m,g,y=function(e){r=f(e).split(/\s+/),m=r[0],g=r[r.length-1]},b=function(e){o.push('";',v,'\nvar partial = partials["'+f(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},w=function(e,r){var i=f(e);if(i==="")throw d(new Error("Section name may not be empty"),t,N,n.file);p.push({name:i,inverted:r}),o.push('";',v,'\nvar name = "'+i+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},E=function(e){w(e,!0)},S=function(e){var r=f(e),i=p.length!=0&&p[p.length-1].name;if(!i||r!=i)throw d(new Error('Section named "'+r+'" was never opened'),t,N,n.file);var s=p.pop();o.push('";',"\n    return buffer;","\n  };","\n})();"),s.inverted?o.push("\nbuffer += renderSection(name,stack,callback,true);"):o.push("\nbuffer += renderSection(name,stack,callback);"),o.push('\nbuffer += "')},x=function(e){o.push('";',v,'\nbuffer += lookup("'+f(e)+'",stack,"");','\nbuffer += "')},T=function(e){o.push('";',v,'\nbuffer += escapeHTML(lookup("'+f(e)+'",stack,""));','\nbuffer += "')},N=1,C,k;for(var L=0,A=t.length;L<A;++L)if(t.slice(L,L+i.length)===i){L+=i.length,C=t.substr(L,1),v="\nline = "+N+";",m=i,g=s,l=!0;switch(C){case"!":L++,k=null;break;case"=":L++,s="="+s,k=y;break;case">":L++,k=b;break;case"#":L++,k=w;break;case"^":L++,k=E;break;case"/":L++,k=S;break;case"{":s="}"+s;case"&":L++,c=!0,k=x;break;default:c=!0,k=T}var O=t.indexOf(s,L);if(O===-1)throw d(new Error('Tag "'+i+'" was not closed properly'),t,N,n.file);var M=t.substring(L,O);k&&k(M);var _=0;while(~(_=M.indexOf("\n",_)))N++,_++;L=O+s.length-1,i=m,s=g}else{C=t.substr(L,1);switch(C){case'"':case"\\":c=!0,o.push("\\"+C);break;case"\r":break;case"\n":u.push(o.length),o.push("\\n"),h(),N++;break;default:a(C)?u.push(o.length):c=!0,o.push(C)}}if(p.length!=0)throw d(new Error('Section "'+p[p.length-1].name+'" was not closed properly'),t,N,n.file);h(),o.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var D=o.join("").replace(/buffer \+= "";\n/g,"");return n.debug&&(typeof console!="undefined"&&console.log?console.log(D):typeof print=="function"&&print(D)),D}function y(e,t){var n="view,partials,stack,lookup,escapeHTML,renderSection,render",r=g(e,t),i=new Function(n,r);return function(n,r){r=r||{};var s=[n];try{return i(n,r,s,v,p,m,S)}catch(o){throw d(o.error,e,o.line,t.file)}}}function w(){b={}}function E(e,t){return t=t||{},t.cache!==!1?(b[e]||(b[e]=y(e,t)),b[e]):y(e,t)}function S(e,t,n){return E(e)(t,n)}e.name="mustache.js",e.version="0.5.0-dev",e.tags=["{{","}}"],e.parse=g,e.compile=E,e.render=S,e.clearCache=w,e.to_html=function(e,t,n,r){var i=S(e,t,n);if(typeof r!="function")return i;r(i)};var t=Object.prototype.toString,n=Array.isArray,r=Array.prototype.forEach,i=String.prototype.trim,s;n?s=n:s=function(e){return t.call(e)==="[object Array]"};var o;r?o=function(e,t,n){return r.call(e,t,n)}:o=function(e,t,n){for(var r=0,i=e.length;r<i;++r)t.call(n,e[r],r,e)};var u=/^\s*$/,f;if(i)f=function(e){return e==null?"":i.call(e)};else{var l,c;a("")?(l=/^\s+/,c=/\s+$/):(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),f=function(e){return e==null?"":String(e).replace(l,"").replace(c,"")}}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},b={}})(Mustache),!function(e,t){typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(e,t):this[e]=t()}("reqwest",function(){function handleReadyState(e,t,n){return function(){e&&e[readyState]==4&&(twoHundo.test(e.status)?t(e):n(e))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r])}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||"reqwest_"+i,u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0;a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e.success&&e.success(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f)}function getRequest(e,t,n){var r=(e.method||"GET").toUpperCase(),i=typeof e=="string"?e:e.url,s=e.processData!==!1&&e.data&&typeof e.data!="string"?reqwest.toQueryString(e.data):e.data||null,o;return(e.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),e.type=="jsonp"?handleJsonp(e,t,n,i):(o=xhr(),o.open(r,i,!0),setHeaders(o,e),o.onreadystatechange=handleReadyState(o,t,n),e.before&&e.before(o),o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(e)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(e,t,n){o.error&&o.error(e,t,n),complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(e.disabled||!n)return;switch(r){case"input":if(!/reset|button|image|file/i.test(e.type)){var s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value;(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u))}break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(var a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r,i=function(t,n){for(var i=0;i<n.length;i++){var s=t[byTag](n[i]);for(r=0;r<s.length;r++)serial(s[r],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),i(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e){var t="",n,r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"};if(isArray(e))for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value);else for(var s in e){if(!Object.hasOwnProperty.call(e,s))continue;var o=e[s];if(isArray(o))for(n=0;n<o.length;n++)i(s,o[n]);else i(s,e[s])}return t.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest}),!function(e,t,n){typeof module!="undefined"?module.exports=n(e,t):typeof define=="function"&&typeof define.amd=="object"?define(n):t[e]=n(e,t)}("bean",this,function(e,t){var n=window,r=t[e],i=/over|out/,s=/[^\.]*(?=\..*)\.|.*/,o=/\..*/,u="addEventListener",a="attachEvent",f="removeEventListener",l="detachEvent",c=document||{},h=c.documentElement||{},p=h[u],d=p?u:a,v=Array.prototype.slice,m=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,g=/mouse.*(wheel|scroll)/i,y=/^text/i,b=/^touch|^gesture/i,w={one:1},E=function(e,t,n){for(n=0;n<t.length;n++)e[t[n]]=1;return e}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(p?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend message readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),S=function(){function e(e,t){while((t=t.parentNode)!==null)if(t===e)return!0;return!1}function t(t){var n=t.relatedTarget;return n?n!==this&&n.prefix!=="xul"&&!/document/.test(this.toString())&&!e(this,n):n===null}return{mouseenter:{base:"mouseover",condition:t},mouseleave:{base:"mouseout",condition:t},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),x=function(){var e="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),t=e.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),n=t.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),r=e.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),s=e.concat(["data"]),o=e.concat("touches targetTouches changedTouches scale rotation".split(" ")),u="preventDefault",a=function(e){return function(){e[u]?e[u]():e.returnValue=!1}},f="stopPropagation",l=function(e){return function(){e[f]?e[f]():e.cancelBubble=!0}},p=function(e){return function(){e[u](),e[f](),e.stopped=!0}},d=function(e,t,n){var r,i;for(r=n.length;r--;)i=n[r],!(i in t)&&i in e&&(t[i]=e[i])};return function(v,w){var E={originalEvent:v,isNative:w};if(!v)return E;var S,x=v.type,T=v.target||v.srcElement;E[u]=a(v),E[f]=l(v),E.stop=p(E),E.target=T&&T.nodeType===3?T.parentNode:T;if(w){if(x.indexOf("key")!==-1)S=r,E.keyCode=v.which||v.keyCode;else if(m.test(x)){S=t,E.rightClick=v.which===3||v.button===2,E.pos={x:0,y:0};if(v.pageX||v.pageY)E.clientX=v.pageX,E.clientY=v.pageY;else if(v.clientX||v.clientY)E.clientX=v.clientX+c.body.scrollLeft+h.scrollLeft,E.clientY=v.clientY+c.body.scrollTop+h.scrollTop;i.test(x)&&(E.relatedTarget=v.relatedTarget||v[(x==="mouseover"?"from":"to")+"Element"])}else b.test(x)?S=o:g.test(x)?S=n:y.test(x)&&(S=s);d(v,E,S||e)}return E}}(),T=function(e,t){return!p&&!t&&(e===c||e===n)?h:e},N=function(){function e(e,t,n,r,i){this.element=e,this.type=t,this.handler=n,this.original=r,this.namespaces=i,this.custom=S[t],this.isNative=E[t]&&e[d],this.eventType=p||this.isNative?t:"propertychange",this.customType=!p&&!this.isNative&&t,this.target=T(e,this.isNative),this.eventSupport=this.target[d]}return e.prototype={inNamespaces:function(e){var t,n;if(!e)return!0;if(!this.namespaces)return!1;for(t=e.length;t--;)for(n=this.namespaces.length;n--;)if(e[t]===this.namespaces[n])return!0;return!1},matches:function(e,t,n){return this.element===e&&(!t||this.original===t)&&(!n||this.handler===n)}},e}(),C=function(){var e={},t=function(n,r,i,s,o){if(!r||r==="*")for(var u in e)u.charAt(0)==="$"&&t(n,u.substr(1),i,s,o);else{var a=0,f,l=e["$"+r],c=n==="*";if(!l)return;for(f=l.length;a<f;a++)if(c||l[a].matches(n,i,s))if(!o(l[a],l,a,r))return}},n=function(t,n,r){var i,s=e["$"+n];if(s)for(i=s.length;i--;)if(s[i].matches(t,r,null))return!0;return!1},r=function(e,n,r){var i=[];return t(e,n,r,null,function(e){return i.push(e)}),i},i=function(t){return(e["$"+t.type]||(e["$"+t.type]=[])).push(t),t},s=function(n){t(n.element,n.type,null,n.handler,function(t,n,r){return n.splice(r,1),n.length===0&&delete e["$"+t.type],!1})},o=function(){var t,n=[];for(t in e)t.charAt(0)==="$"&&(n=n.concat(e[t]));return n};return{has:n,get:r,put:i,del:s,entries:o}}(),k=p?function(e,t,n,r){e[r?u:f](t,n,!1)}:function(e,t,n,r,i){i&&r&&e["_on"+i]===null&&(e["_on"+i]=0),e[r?a:l]("on"+t,n)},L=function(e,t,r){return function(i){return i=x(i||((this.ownerDocument||this.document||this).parentWindow||n).event,!0),t.apply(e,[i].concat(r))}},A=function(e,t,r,i,s,o){return function(u){if(i?i.apply(this,arguments):p?!0:u&&u.propertyName==="_on"+r||!u)u&&(u=x(u||((this.ownerDocument||this.document||this).parentWindow||n).event,o)),t.apply(e,u&&(!s||s.length===0)?arguments:v.call(arguments,u?0:1).concat(s))}},O=function(e,t,n,r,i){return function(){e(t,n,i),r.apply(this,arguments)}},M=function(e,t,n,r){var i,s,u,a=t&&t.replace(o,""),f=C.get(e,a,n);for(i=0,s=f.length;i<s;i++)f[i].inNamespaces(r)&&((u=f[i]).eventSupport&&k(u.target,u.eventType,u.handler,!1,u.type),C.del(u))},_=function(e,t,n,r,i){var u,a=t.replace(o,""),f=t.replace(s,"").split(".");if(C.has(e,a,n))return e;a==="unload"&&(n=O(M,e,a,n,r)),S[a]&&(S[a].condition&&(n=A(e,n,a,S[a].condition,!0)),a=S[a].base||a),u=C.put(new N(e,a,n,r,f[0]&&f)),u.handler=u.isNative?L(e,u.handler,i):A(e,u.handler,a,!1,i,!1),u.eventSupport&&k(u.target,u.eventType,u.handler,!0,u.customType)},D=function(e,t,n){return function(r){var i,s,o=typeof e=="string"?n(e,this):e;for(i=r.target;i&&i!==this;i=i.parentNode)for(s=o.length;s--;)if(o[s]===i)return t.apply(i,arguments)}},P=function(e,t,n){var r,i,u,a,f,l=M,c=t&&typeof t=="string";if(c&&t.indexOf(" ")>0){t=t.split(" ");for(f=t.length;f--;)P(e,t[f],n);return e}u=c&&t.replace(o,""),u&&S[u]&&(u=S[u].type);if(!t||c){if(a=c&&t.replace(s,""))a=a.split(".");l(e,u,n,a)}else if(typeof t=="function")l(e,null,t);else for(r in t)t.hasOwnProperty(r)&&P(e,r,t[r]);return e},H=function(e,t,n,r,i){var s,o,u,a,f=n,l=n&&typeof n=="string";if(t&&!n&&typeof t=="object")for(s in t)t.hasOwnProperty(s)&&H.apply(this,[e,s,t[s]]);else{a=arguments.length>3?v.call(arguments,3):[],o=(l?n:t).split(" "),l&&(n=D(t,f=r,i))&&(a=v.call(a,1)),this===w&&(n=O(P,e,t,n,f));for(u=o.length;u--;)_(e,o[u],n,f,a)}return e},B=function(){return H.apply(w,arguments)},j=p?function(e,t,r){var i=c.createEvent(e?"HTMLEvents":"UIEvents");i[e?"initEvent":"initUIEvent"](t,!0,!0,n,1),r.dispatchEvent(i)}:function(e,t,n){n=T(n,e),e?n.fireEvent("on"+t,c.createEventObject()):n["_on"+t]++},F=function(e,t,n){var r,i,u,a,f,l=t.split(" ");for(r=l.length;r--;){t=l[r].replace(o,"");if(a=l[r].replace(s,""))a=a.split(".");if(!a&&!n&&e[d])j(E[t],t,e);else{f=C.get(e,t),n=[!1].concat(n);for(i=0,u=f.length;i<u;i++)f[i].inNamespaces(a)&&f[i].handler.apply(e,n)}}return e},I=function(e,t,n){var r=0,i=C.get(t,n),s=i.length;for(;r<s;r++)i[r].original&&H(e,i[r].type,i[r].original);return e},q={add:H,one:B,remove:P,clone:I,fire:F,noConflict:function(){return t[e]=r,this}};if(n[a]){var R=function(){var e,t=C.entries();for(e in t)t[e].type&&t[e].type!=="unload"&&P(t[e].element,t[e].type);n[l]("onunload",R),n.CollectGarbage&&n.CollectGarbage()};n[a]("onunload",R)}return q});var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};var html=function(e){function o(e){e=t(e);if(n.hasOwnProperty(e))return n[e];var r=e.match(i);return r?String.fromCharCode(parseInt(r[1],10)):(r=e.match(s))?String.fromCharCode(parseInt(r[1],16)):""}function u(e,t){return o(t)}function f(e){return e.replace(a,"")}function c(e){return e.replace(l,u)}function y(e){return e.replace(h,"&amp;").replace(d,"&lt;").replace(v,"&gt;").replace(m,"&#34;").replace(g,"&#61;")}function b(e){return e.replace(p,"&amp;$1").replace(d,"&lt;").replace(v,"&gt;")}function S(n){return function(i,s){i=String(i);var o=null,u=!1,a=[],l=void 0,h=void 0,p=void 0;n.startDoc&&n.startDoc(s);while(i){var d=i.match(u?w:E);i=i.substring(d[0].length);if(u){if(d[1]){var v=t(d[1]),m;if(d[2]){var g=d[3];switch(g.charCodeAt(0)){case 34:case 39:g=g.substring(1,g.length-1)}m=c(f(g))}else m=v;a.push(v,m)}else if(d[4]){h!==void 0&&(p?n.startTag&&n.startTag(l,a,s):n.endTag&&n.endTag(l,s));if(p&&h&(e.eflags.CDATA|e.eflags.RCDATA)){o===null?o=t(i):o=o.substring(o.length-i.length);var y=o.indexOf("</"+l);y<0&&(y=i.length),y&&(h&e.eflags.CDATA?n.cdata&&n.cdata(i.substring(0,y),s):n.rcdata&&n.rcdata(b(i.substring(0,y)),s),i=i.substring(y))}l=h=p=void 0,a.length=0,u=!1}}else if(d[1])n.pcdata&&n.pcdata(d[0],s);else if(d[3])p=!d[2],u=!0,l=t(d[3]),h=e.ELEMENTS.hasOwnProperty(l)?e.ELEMENTS[l]:void 0;else if(d[4])n.pcdata&&n.pcdata(d[4],s);else if(d[5]&&n.pcdata){var S=d[5];n.pcdata(S==="<"?"&lt;":S===">"?"&gt;":"&amp;",s)}}n.endDoc&&n.endDoc(s)}}function x(t){var n,r;return S({startDoc:function(e){n=[],r=!1},startTag:function(i,s,o){if(r)return;if(!e.ELEMENTS.hasOwnProperty(i))return;var u=e.ELEMENTS[i];if(u&e.eflags.FOLDABLE)return;if(u&e.eflags.UNSAFE){r=!(u&e.eflags.EMPTY);return}s=t(i,s);if(s){u&e.eflags.EMPTY||n.push(i),o.push("<",i);for(var a=0,f=s.length;a<f;a+=2){var l=s[a],c=s[a+1];c!==null&&c!==void 0&&o.push(" ",l,'="',y(c),'"')}o.push(">")}},endTag:function(t,i){if(r){r=!1;return}if(!e.ELEMENTS.hasOwnProperty(t))return;var s=e.ELEMENTS[t];if(!(s&(e.eflags.UNSAFE|e.eflags.EMPTY|e.eflags.FOLDABLE))){var o;if(s&e.eflags.OPTIONAL_ENDTAG)for(o=n.length;--o>=0;){var u=n[o];if(u===t)break;if(!(e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG))return}else for(o=n.length;--o>=0;)if(n[o]===t)break;if(o<0)return;for(var a=n.length;--a>o;){var u=n[a];e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG||i.push("</",u,">")}n.length=o,i.push("</",t,">")}},pcdata:function(e,t){r||t.push(e)},rcdata:function(e,t){r||t.push(e)},cdata:function(e,t){r||t.push(e)},endDoc:function(e){for(var t=n.length;--t>=0;)e.push("</",n[t],">");n.length=0}})}function N(t,n,i){var s=[];return x(function(s,o){for(var u=0;u<o.length;u+=2){var a=o[u],f=o[u+1],l=null,c;if((c=s+"::"+a,e.ATTRIBS.hasOwnProperty(c))||(c="*::"+a,e.ATTRIBS.hasOwnProperty(c)))l=e.ATTRIBS[c];if(l!==null)switch(l){case e.atype.NONE:break;case e.atype.SCRIPT:case e.atype.STYLE:f=null;break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:f=i?i(f):f;break;case e.atype.URI:var h=(""+f).match(T);h?!h[1]||r.test(h[1])?f=n&&n(f):f=null:f=null;break;case e.atype.URI_FRAGMENT:f&&"#"===f.charAt(0)?(f=i?i(f):f,f&&(f="#"+f)):f=null;break;default:f=null}else f=null;o[u+1]=f}return o})(t,s),s.join("")}var t;"script"==="SCRIPT".toLowerCase()?t=function(e){return e.toLowerCase()}:t=function(e){return e.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)|32)})};var n={lt:"<",gt:">",amp:"&",nbsp:"",quot:'"',apos:"'"},r=/^(?:https?|mailto|data)$/i,i=/^#(\d+)$/,s=/^#x([0-9A-Fa-f]+)$/,a=/\0/g,l=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,h=/&/g,p=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,d=/</g,v=/>/g,m=/\"/g,g=/\=/g,w=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),E=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),T=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:y,makeHtmlSanitizer:x,makeSaxParser:S,normalizeRCData:b,sanitize:N,unescapeEntities:c}}(html4),html_sanitize=html.sanitize;typeof window!="undefined"&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0;var Mustache=typeof module!="undefined"&&module.exports||{};(function(e){function a(e){return u.test(e)}function p(e){return String(e).replace(/[&<>"'\/]/g,function(e){return h[e]||e})}function d(e,t,n,r){r=r||"<template>";var i=t.split("\n"),s=Math.max(n-3,0),o=Math.min(i.length,n+3),u=i.slice(s,o),a;for(var f=0,l=u.length;f<l;++f)a=f+s+1,u[f]=(a===n?" >> ":"    ")+u[f];return e.template=t,e.line=n,e.file=r,e.message=[r+":"+n,u.join("\n"),"",e.message].join("\n"),e}function v(e,t,n){if(e===".")return t[t.length-1];var r=e.split("."),i=r.length-1,s=r[i],o,u,a=t.length,f,l;while(a){l=t.slice(0),u=t[--a],f=0;while(f<i){u=u[r[f++]];if(u==null)break;l.push(u)}if(u&&typeof u=="object"&&s in u){o=u[s];break}}return typeof o=="function"&&(o=o.call(l[l.length-1])),o==null?n:o}function m(e,t,n,r){var i="",u=v(e,t);if(r){if(u==null||u===!1||s(u)&&u.length===0)i+=n()}else if(s(u))o(u,function(e){t.push(e),i+=n(),t.pop()});else if(typeof u=="object")t.push(u),i+=n(),t.pop();else if(typeof u=="function"){var a=t[t.length-1],f=function(e){return S(e,a)};i+=u.call(a,n(),f)||""}else u&&(i+=n());return i}function g(t,n){n=n||{};var r=n.tags||e.tags,i=r[0],s=r[r.length-1],o=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],u=[],l=!1,c=!1,h=function(){if(l&&!c&&!n.space)while(u.length)o.splice(u.pop(),1);else u=[];l=!1,c=!1},p=[],v,m,g,y=function(e){r=f(e).split(/\s+/),m=r[0],g=r[r.length-1]},b=function(e){o.push('";',v,'\nvar partial = partials["'+f(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},w=function(e,r){var i=f(e);if(i==="")throw d(new Error("Section name may not be empty"),t,N,n.file);p.push({name:i,inverted:r}),o.push('";',v,'\nvar name = "'+i+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},E=function(e){w(e,!0)},S=function(e){var r=f(e),i=p.length!=0&&p[p.length-1].name;if(!i||r!=i)throw d(new Error('Section named "'+r+'" was never opened'),t,N,n.file);var s=p.pop();o.push('";',"\n    return buffer;","\n  };","\n})();"),s.inverted?o.push("\nbuffer += renderSection(name,stack,callback,true);"):o.push("\nbuffer += renderSection(name,stack,callback);"),o.push('\nbuffer += "')},x=function(e){o.push('";',v,'\nbuffer += lookup("'+f(e)+'",stack,"");','\nbuffer += "')},T=function(e){o.push('";',v,'\nbuffer += escapeHTML(lookup("'+f(e)+'",stack,""));','\nbuffer += "')},N=1,C,k;for(var L=0,A=t.length;L<A;++L)if(t.slice(L,L+i.length)===i){L+=i.length,C=t.substr(L,1),v="\nline = "+N+";",m=i,g=s,l=!0;switch(C){case"!":L++,k=null;break;case"=":L++,s="="+s,k=y;break;case">":L++,k=b;break;case"#":L++,k=w;break;case"^":L++,k=E;break;case"/":L++,k=S;break;case"{":s="}"+s;case"&":L++,c=!0,k=x;break;default:c=!0,k=T}var O=t.indexOf(s,L);if(O===-1)throw d(new Error('Tag "'+i+'" was not closed properly'),t,N,n.file);var M=t.substring(L,O);k&&k(M);var _=0;while(~(_=M.indexOf("\n",_)))N++,_++;L=O+s.length-1,i=m,s=g}else{C=t.substr(L,1);switch(C){case'"':case"\\":c=!0,o.push("\\"+C);break;case"\r":break;case"\n":u.push(o.length),o.push("\\n"),h(),N++;break;default:a(C)?u.push(o.length):c=!0,o.push(C)}}if(p.length!=0)throw d(new Error('Section "'+p[p.length-1].name+'" was not closed properly'),t,N,n.file);h(),o.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var D=o.join("").replace(/buffer \+= "";\n/g,"");return n.debug&&(typeof console!="undefined"&&console.log?console.log(D):typeof print=="function"&&print(D)),D}function y(e,t){var n="view,partials,stack,lookup,escapeHTML,renderSection,render",r=g(e,t),i=new Function(n,r);return function(n,r){r=r||{};var s=[n];try{return i(n,r,s,v,p,m,S)}catch(o){throw d(o.error,e,o.line,t.file)}}}function w(){b={}}function E(e,t){return t=t||{},t.cache!==!1?(b[e]||(b[e]=y(e,t)),b[e]):y(e,t)}function S(e,t,n){return E(e)(t,n)}e.name="mustache.js",e.version="0.5.0-dev",e.tags=["{{","}}"],e.parse=g,e.compile=E,e.render=S,e.clearCache=w,e.to_html=function(e,t,n,r){var i=S(e,t,n);if(typeof r!="function")return i;r(i)};var t=Object.prototype.toString,n=Array.isArray,r=Array.prototype.forEach,i=String.prototype.trim,s;n?s=n:s=function(e){return t.call(e)==="[object Array]"};var o;r?o=function(e,t,n){return r.call(e,t,n)}:o=function(e,t,n){for(var r=0,i=e.length;r<i;++r)t.call(n,e[r],r,e)};var u=/^\s*$/,f;if(i)f=function(e){return e==null?"":i.call(e)};else{var l,c;a("")?(l=/^\s+/,c=/\s+$/):(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),f=function(e){return e==null?"":String(e).replace(l,"").replace(c,"")}}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},b={}})(Mustache),!function(e,t){typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(e,t):this[e]=t()}("reqwest",function(){function handleReadyState(e,t,n){return function(){e&&e[readyState]==4&&(twoHundo.test(e.status)?t(e):n(e))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r])}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||"reqwest_"+i,u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0
;a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e.success&&e.success(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f)}function getRequest(e,t,n){var r=(e.method||"GET").toUpperCase(),i=typeof e=="string"?e:e.url,s=e.processData!==!1&&e.data&&typeof e.data!="string"?reqwest.toQueryString(e.data):e.data||null,o;return(e.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),e.type=="jsonp"?handleJsonp(e,t,n,i):(o=xhr(),o.open(r,i,!0),setHeaders(o,e),o.onreadystatechange=handleReadyState(o,t,n),e.before&&e.before(o),o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(e)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(e,t,n){o.error&&o.error(e,t,n),complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(e.disabled||!n)return;switch(r){case"input":if(!/reset|button|image|file/i.test(e.type)){var s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value;(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u))}break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(var a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r,i=function(t,n){for(var i=0;i<n.length;i++){var s=t[byTag](n[i]);for(r=0;r<s.length;r++)serial(s[r],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),i(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e){var t="",n,r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"};if(isArray(e))for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value);else for(var s in e){if(!Object.hasOwnProperty.call(e,s))continue;var o=e[s];if(isArray(o))for(n=0;n<o.length;n++)i(s,o[n]);else i(s,e[s])}return t.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest}),wax=wax||{},wax.attribution=function(){function n(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function r(e){return e}var e,t={};return t.content=function(t){return typeof t=="undefined"?e.innerHTML:(e.innerHTML=html_sanitize(t,n,r),this)},t.element=function(){return e},t.init=function(){return e=document.createElement("div"),e.className="wax-attribution",this},t.init()},wax=wax||{},wax.bwdetect=function(e,t){function a(){wax.bw=-1;var e=new Image;e.src=s;var t=!0,i=setTimeout(function(){t&&wax.bw==-1&&(n.bw(0),t=!1)},r);e.onload=function(){t&&wax.bw==-1&&(clearTimeout(i),n.bw(1),t=!1)}}var n={},r=e.threshold||400,s="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +(new Date),o=1,u=e.auto===undefined?!0:e.auto;return n.bw=function(e){if(!arguments.length)return o;var n=o;wax.bwlisteners&&wax.bwlisteners.length&&function(){listeners=wax.bwlisteners,wax.bwlisteners=[];for(i=0;i<listeners;i++)listeners[i](e)}(),wax.bw=e,o!=(o=e)&&t(e)},n.add=function(){return u&&a(),this},wax.bw==-1?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(n.bw)):wax.bw!==undefined?n.bw(wax.bw):n.add(),n},wax.formatter=function(x){function urlX(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function idX(e){return e}var formatter={},f;if(x&&typeof x=="string")try{eval("f = "+x)}catch(e){console&&console.log(e)}else x&&typeof x=="function"?f=x:f=function(){};return formatter.format=function(e,t){try{return html_sanitize(f(e,t),urlX,idX)}catch(n){console&&console.log(n)}},formatter},wax.gi=function(e,t){function s(e){return e>=93&&e--,e>=35&&e--,e-=32,e}t=t||{};var n={},r=t.resolution||4,i=t.tileSize||256;return n.grid_tile=function(){return e},n.getKey=function(t,n){if(!e||!e.grid)return;if(n<0||t<0)return;if(Math.floor(n)>=i||Math.floor(t)>=i)return;return s(e.grid[Math.floor(n/r)].charCodeAt(Math.floor(t/r)))},n.gridFeature=function(t,n){var r=this.getKey(t,n),i=e.keys;if(i&&i[r]&&e.data[i[r]])return e.data[i[r]]},n.tileFeature=function(t,n,r){if(!e)return;var i=wax.u.offset(r);return feature=this.gridFeature(t-i.left,n-i.top),feature},n},wax.gm=function(){function o(e){return typeof e=="string"&&(e=[e]),function(n){if(!n)return;var r=new RegExp("/(\\d+)\\/(\\d+)\\/(\\d+)\\.[\\w\\._]+"),i=r.exec(n);if(!i)return;return e[parseInt(i[2],10)%e.length].replace(/\{z\}/g,i[1]).replace(/\{x\}/g,i[2]).replace(/\{y\}/g,i[3])}}var e=4,t={},n={},r,i,s=function(e){return e.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json")};return n.formatter=function(e){return arguments.length?(i=wax.formatter(e),n):i},n.template=function(e){return arguments.length?(i=wax.template(e),n):i},n.gridUrl=function(e){return arguments.length?(e?s=typeof e=="function"?e:o(e):s=function(){return null},n):s},n.getGrid=function(t,r){var o=s(t);return!i||!o?r(null,null):(wax.request.get(o,function(t,n){if(t)return r(t,null);r(null,wax.gi(n,{formatter:i,resolution:e}))}),n)},n.tilejson=function(t){return arguments.length?(t.template?n.template(t.template):t.formatter?n.formatter(t.formatter):i=undefined,n.gridUrl(t.grids),t.resolution&&(e=t.resolution),r=t,n):r},n},wax=wax||{},wax.hash=function(e){function t(){return location.hash.substring(1)}function n(e){var t=window.location;t.replace(t.toString().replace(t.hash||/$/,"#"+e))}function o(t){var n=t.split("/");for(var r=0;r<n.length;r++){n[r]=Number(n[r]);if(isNaN(n[r]))return!0}if(n.length<3)return!0;n.length==3&&e.setCenterZoom(n)}function u(){var t=e.getCenterZoom();r!==t&&(r=t,n(r))}function a(e){if(e===r)return;o(r=e)&&u()}e=e||{};var r,i={},s=90-1e-8,f=wax.u.throttle(u,500);return i.add=function(){return a(t()),e.bindChange(f),this},i.remove=function(){return e.unbindChange(f),this},i.add()},wax=wax||{},wax.interaction=function(){function d(e){var t=o();for(var n=0;n<t.length;n++)if(t[n][0]<e.y&&t[n][0]+256>e.y&&t[n][1]<e.x&&t[n][1]+256>e.x)return t[n][2];return!1}function v(){return r?(window.clearTimeout(r),r=null,!0):!1}function m(r){if(n)return;var i=wax.u.eventoffset(r);t.screen_feature(i,function(n){n?bean.fire(t,"on",{parent:f(),data:n,formatter:e.formatter().format,e:r}):bean.fire(t,"off")})}function g(e){if(v())return;n=!0,i=wax.u.eventoffset(e),e.type==="mousedown"?bean.add(document.body,"click",b):e.type==="touchstart"&&e.touches.length===1&&(bean.fire(t,"off"),bean.add(f(),p))}function y(){bean.remove(f(),p),n=!1}function b(e){var o={},u=wax.u.eventoffset(e);n=!1;for(var a in e)o[a]=e[a];return bean.remove(document.body,"mouseup",b),bean.remove(f(),p),e.type==="touchend"?t.click(e,i):Math.round(u.y/s)===Math.round(i.y/s)&&Math.round(u.x/s)===Math.round(i.x/s)&&(r=window.setTimeout(function(){r=null,t.click(o,u)},300)),b}var e=wax.gm(),t={},n=!1,r=!1,i,s=4,o,u,a,f,l,c,h={mousemove:m,touchstart:g,mousedown:g},p={touchend:b,touchmove:b,touchcancel:y};return t.click=function(n,r){t.screen_feature(r,function(r){r&&bean.fire(t,"on",{parent:f(),data:r,formatter:e.formatter().format,e:n})})},t.screen_feature=function(t,n){var r=d(t);r||n(null),e.getGrid(r.src,function(e,i){if(e||!i)return n(null);var s=i.tileFeature(t.x,t.y,r);n(s)})},t.attach=function(e){return arguments.length?(u=e,t):u},t.detach=function(e){return arguments.length?(a=e,t):a},t.map=function(e){return arguments.length?(l=e,u&&u(l),bean.add(f(),h),bean.add(f(),"touchstart",g),t):l},t.grid=function(e){return arguments.length?(o=e,t):o},t.remove=function(e){return a&&a(l),bean.remove(f(),h),bean.fire(t,"remove"),t},t.tilejson=function(n){return arguments.length?(e.tilejson(n),t):e.tilejson()},t.formatter=function(){return e.formatter()},t.on=function(e,n){return bean.add(t,e,n),t},t.off=function(e,n){return bean.remove(t,e,n),t},t.gridmanager=function(n){return arguments.length?(e=n,t):e},t.parent=function(e){return f=e,t},t};var wax=wax||{};wax.legend=function(){function r(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function i(e){return e}var e,t={},n;return t.element=function(){return n},t.content=function(n){return arguments.length?(n?(e.innerHTML=html_sanitize(n,r,i),e.style.display="block"):(e.innerHTML="",e.style.display="none"),t):e.innerHTML},t.add=function(){return n=document.createElement("div"),n.className="wax-legends",e=n.appendChild(document.createElement("div")),e.className="wax-legend",e.style.display="none",t},t.add()};var wax=wax||{};wax.location=function(){function t(e){console.log(e);if(e.e.type==="mousemove"||!e.e.type)return;var t=e.formatter({format:"location"},e.data);t&&(window.location.href=t)}var e={};return e.events=function(){return{on:t}},e};var wax=wax||{};wax.movetip={},wax.movetip=function(){function o(e){var t=wax.u.eventoffset(e);n.height+t.y>r.top+r.height&&r.height>n.height&&(t.y-=n.height,i.className+=" flip-y"),n.width+t.x>r.left+r.width&&(t.x-=n.width,i.className+=" flip-x"),i.style.left=t.x+"px",i.style.top=t.y+"px"}function u(e){var t=document.createElement("div");return t.className="wax-tooltip wax-tooltip-0",t.innerHTML=e,t}function a(){i&&(i.parentNode.removeChild(i),i=null)}function f(t){var f;if(e)return;if(t.e.type==="mousemove"||!t.e.type){f=t.formatter({format:"teaser"},t.data);if(!f)return;a(),s.style.cursor="pointer",i=document.body.appendChild(u(f))}else{f=t.formatter({format:"teaser"},t.data);if(!f)return;a();var l=document.body.appendChild(u(f));l.className+=" wax-popup";var c=l.appendChild(document.createElement("a"));c.href="#close",c.className="close",c.innerHTML="Close",e=!0,i=l,n=wax.u.offset(i),r=wax.u.offset(s),o(t.e),bean.add(c,"click touchend",function(n){n.stop(),a(),e=!1})}i&&(n=wax.u.offset(i),r=wax.u.offset(s),o(t.e))}function l(){s.style.cursor="default",e||a()}var e=!1,t={},n,r,i,s;return t.parent=function(e){return arguments.length?(s=e,t):s},t.events=function(){return{on:f,off:l}},t};var wax=wax||{};wax.request={cache:{},locks:{},promises:{},get:function(e,t){if(this.cache[e])return t(this.cache[e][0],this.cache[e][1]);this.promises[e]=this.promises[e]||[],this.promises[e].push(t);if(this.locks[e])return;var n=this;this.locks[e]=!0,reqwest({url:e+(~e.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(t){n.locks[e]=!1,n.cache[e]=[null,t];for(var r=0;r<n.promises[e].length;r++)n.promises[e][r](n.cache[e][0],n.cache[e][1])},error:function(t){n.locks[e]=!1,n.cache[e]=[t,null];for(var r=0;r<n.promises[e].length;r++)n.promises[e][r](n.cache[e][0],n.cache[e][1])}})}},wax.template=function(e){function n(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function r(e){return e}var t={};return t.format=function(t,i){var s={};for(var o in i)s[o]=i[o];return t.format&&(s["__"+t.format+"__"]=!0),html_sanitize(Mustache.to_html(e,s),n,r)},t};if(!wax)var wax={};wax.tilejson=function(e,t){reqwest({url:e+(~e.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:t,error:t})};var wax=wax||{};wax.tooltip={},wax.tooltip=function(){function u(e){var t=document.createElement("div");return t.className="wax-tooltip wax-tooltip-0",t.innerHTML=e,t}function a(){this.parentNode&&this.parentNode.removeChild(this)}function f(){var e;while(e=r.pop())t&&s?(bean.add(e,s,a),e.className+=" wax-fade"):e.parentNode&&e.parentNode.removeChild(e)}function l(t){var n;if(t.e.type==="mousemove"||!t.e.type){if(!e){n=t.content||t.formatter({format:"teaser"},t.data);if(!n||n==i)return;f(),o.style.cursor="pointer",r.push(o.appendChild(u(n))),i=n}}else{n=t.content||t.formatter({format:"full"},t.data);if(!n){t.e.type&&t.e.type.match(/touch/)&&(n=t.content||t.formatter({format:"teaser"},t.data));if(!n)return}f(),o.style.cursor="pointer";var s=o.appendChild(u(n));s.className+=" wax-popup";var a=s.appendChild(document.createElement("a"));a.href="#close",a.className="close",a.innerHTML="Close",e=!0,r.push(s),bean.add(a,"touchstart mousedown",function(e){e.stop()}),bean.add(a,"click touchend",function(n){n.stop(),f(),e=!1})}}function c(){o.style.cursor="default",i=null,e||f()}var e=!1,t=!1,n={},r=[],i,s,o;return document.body.style["-webkit-transition"]!==undefined?s="webkitTransitionEnd":document.body.style.MozTransition!==undefined&&(s="transitionend"),n.parent=function(e){return arguments.length?(o=e,n):o},n.animate=function(e){return arguments.length?(t=e,n):t},n.events=function(){return{on:l,off:c}},n};var wax=wax||{};wax.u={offset:function(e){var t=e.offsetWidth||parseInt(e.style.width,10),n=e.offsetHeight||parseInt(e.style.height,10),r=document.body,i=0,s=0,o=function(e){if(e===r||e===document.documentElement)return;i+=e.offsetTop,s+=e.offsetLeft;var t=e.style.transform||e.style.WebkitTransform||e.style.OTransform||e.style.MozTransform||e.style.msTransform;if(t)if(match=t.match(/translate\((.+)px, (.+)px\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10);else if(match=t.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10);else if(match=t.match(/matrix3d\(([\-\d,\s]+)\)/)){var n=match[1].split(",");i+=parseInt(n[13],10),s+=parseInt(n[12],10)}else if(match=t.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10)};o(e);try{while(e=e.offsetParent)o(e)}catch(u){}i+=r.offsetTop,s+=r.offsetLeft,i+=r.parentNode.offsetTop,s+=r.parentNode.offsetLeft;var a=document.defaultView?window.getComputedStyle(r.parentNode,null):r.parentNode.currentStyle;return r.parentNode.offsetTop!==parseInt(a.marginTop,10)&&!isNaN(parseInt(a.marginTop,10))&&(i+=parseInt(a.marginTop,10),s+=parseInt(a.marginLeft,10)),{top:i,left:s,height:n,width:t}},$:function(e){return typeof e=="string"?document.getElementById(e):e},indexOf:function(e,t){var n=Array.prototype.indexOf;if(e===null)return-1;var r,i;if(n&&e.indexOf===n)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},eventoffset:function(e){var t=0,n=0;e||(e=window.event);if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};if(e.clientX||e.clientY){var r=document.documentElement,i=document.body,s=document.body.parentNode.currentStyle,o=parseInt(s.marginTop,10)||0,u=parseInt(s.marginLeft,10)||0;return{x:e.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0)+u,y:e.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)+o}}if(e.touches&&e.touches.length===1)return{x:e.touches[0].pageX,y:e.touches[0].pageY}},limit:function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}},throttle:function(e,t){return this.limit(e,t,!1)}},wax=wax||{},wax.mm=wax.mm||{},wax.mm.attribution=function(e,t){t=t||{};var n,r={};return r.element=function(){return n.element()},r.appendTo=function(e){return wax.u.$(e).appendChild(n.element()),this},r.init=function(){return n=wax.attribution(),n.content(t.attribution),n.element().className="wax-attribution wax-mm",this},r.init()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.boxselector=function(e,t,n){function m(t){var n=new MM.Point(t.clientX,t.clientY);n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var r=e.parent;r;r=r.offsetParent)n.x-=r.offsetLeft,n.y-=r.offsetTop;return n}function g(t){if(!t.shiftKey)return;return r=i=m(t),f=l=!0,u.left=r.x+"px",u.top=r.y+"px",u.width=u.height=0,h(document,"mousemove",b),h(document,"mouseup",w),e.parent.style.cursor="crosshair",MM.cancelEvent(t)}function y(e){var t=m(e),n={x:parseInt(o.offsetLeft,10),y:parseInt(o.offsetTop,10)},s={x:n.x+parseInt(o.offsetWidth,10),y:n.y+parseInt(o.offsetHeight,10)};f=t.x-n.x<=c||s.x-t.x<=c,l=t.y-n.y<=c||s.y-t.y<=c;if(l||f)return r={x:t.x-n.x<s.x-t.x?s.x:n.x,y:t.y-n.y<s.y-t.y?s.y:n.y},i={x:t.x-n.x<s.x-t.x?n.x:s.x,y:t.y-n.y<s.y-t.y?n.y:s.y},h(document,"mousemove",b),h(document,"mouseup",w),MM.cancelEvent(e)}function b(t){var n=m(t);return u.display="block",f&&(u.left=(n.x<r.x?n.x:r.x)+"px",u.width=Math.abs(n.x-r.x)-2*a+"px"),l&&(u.top=(n.y<r.y?n.y:r.y)+"px",u.height=Math.abs(n.y-r.y)-2*a+"px"),S(n,e.parent),MM.cancelEvent(t)}function w(t){var n=m(t),s=e.pointLocation(new MM.Point(f?n.x:i.x,l?n.y:i.y));l2=e.pointLocation(r),v.extent([new MM.Location(Math.max(s.lat,l2.lat),Math.min(s.lon,l2.lon)),new MM.Location(Math.min(s.lat,l2.lat),Math.max(s.lon,l2.lon))]),p(document,"mousemove",b),p(document,"mouseup",w),e.parent.style.cursor="auto"}function E(e){S(m(e),o)}function S(e,t){var n={x:parseInt(o.offsetLeft,10),y:parseInt(o.offsetTop,10)},r={x:n.x+parseInt(o.offsetWidth,10),y:n.y+parseInt(o.offsetHeight,10)},i="";e.y-n.y<=c?i="n":r.y-e.y<=c&&(i="s"),e.x-n.x<=c?i+="w":r.x-e.x<=c&&(i+="e"),i!==""&&(i+="-resize"),t.style.cursor=i}function x(e,t){if(!o||!d)return;var n=e.locationPoint(d[1]),r=e.locationPoint(d[0]),i=o.style;i.display="block",i.height="auto",i.width="auto",i.left=Math.max(0,r.x)+"px",i.top=Math.max(0,r.y)+"px",i.right=Math.max(0,e.dimensions.x-n.x)+"px",i.bottom=Math.max(0,e.dimensions.y-n.y)+"px"}var r=null,i=null,s=typeof n=="function"?n:n.callback,o,u,a=0,f=!1,l=!1,c=5,h=MM.addEvent,p=MM.removeEvent,d,v={};return v.extent=function(t,n){if(!t)return d;d=[new MM.Location(Math.max(t[0].lat,t[1].lat),Math.min(t[0].lon,t[1].lon)),new MM.Location(Math.min(t[0].lat,t[1].lat),Math.max(t[0].lon,t[1].lon))],x(e),n||s(d)},v.add=function(e){return o=o||document.createElement("div"),o.id=e.parent.id+"-boxselector-box",o.className="boxselector-box",e.parent.appendChild(o),u=o.style,a=parseInt(window.getComputedStyle(o).borderWidth,10),h(e.parent,"mousedown",g),h(o,"mousedown",y),h(e.parent,"mousemove",E),e.addCallback("drawn",x),this},v.remove=function(){e.parent.removeChild(o),p(e.parent,"mousedown",g),p(o,"mousedown",y),p(e.parent,"mousemove",E),e.removeCallback("drawn",x)},v.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax._={},wax.mm.bwdetect=function(e,t){t=t||{};var n=t.png||".png128",r=t.jpg||".jpg70",i=!1;return wax._.bw_png=n,wax._.bw_jpg=r,wax.bwdetect(t,function(t){wax._.bw=!t;for(var n=0;n<e.layers.length;n++)e.getLayerAt(n).provider instanceof wax.mm.connector&&e.getLayerAt(n).setProvider(e.getLayerAt(n).provider)})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.fullscreen=function(e){function o(e){e&&e.stop(),t?n.original():n.full()}function u(t,n){e.dimensions=new MM.Point(t,n),e.parent.style.width=Math.round(e.dimensions.x)+"px",e.parent.style.height=Math.round(e.dimensions.y)+"px",e.dispatchCallback("resized",e.dimensions)}var t=!1,n={},r,i=document.body,s;return n.add=function(e){return r=document.createElement("a"),r.className="wax-fullscreen",r.href="#fullscreen",r.innerHTML="fullscreen",bean.add(r,"click",o),this},n.full=function(){if(t)return;t=!0,s=[e.parent.offsetWidth,e.parent.offsetHeight],e.parent.className+=" wax-fullscreen-map",i.className+=" wax-fullscreen-view",u(e.parent.offsetWidth,e.parent.offsetHeight)},n.original=function(){if(!t)return;t=!1,e.parent.className=e.parent.className.replace(" wax-fullscreen-map",""),i.className=i.className.replace(" wax-fullscreen-view",""),u(s[0],s[1])},n.appendTo=function(e){return wax.u.$(e).appendChild(r),this},n.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.hash=function(e){return wax.hash({getCenterZoom:function(){var t=e.getCenter(),n=e.getZoom(),r=Math.max(0,Math.ceil(Math.log(n)/Math.LN2));return[n.toFixed(2),t.lat.toFixed(r),t.lon.toFixed(r)].join("/")},setCenterZoom:function(n){e.setCenterZoom(new MM.Location(n[1],n[2]),n[0])},bindChange:function(t){e.addCallback("drawn",t)},unbindChange:function(t){e.removeCallback("drawn",t)}})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.interaction=function(){function i(){var r=n.getLayerAt(0).levels[Math.round(n.getZoom())];return!e&&t!==undefined&&t.length?t:(t=function(e){var t=[];for(var n in e)if(e[n].parentNode===r){var i=wax.u.offset(e[n]);t.push([i.top,i.left,e[n]])}return t}(n.getLayerAt(0).tiles),t)}function s(){e=!0}function o(e){if(!arguments.length)return n;n=e;for(var t=0;t<r.length;t++)n.addCallback(r[t],s)}function u(e){for(var t=0;t<r.length;t++)n.removeCallback(r[t],s)}var e=!1,t,n,r=["zoomed","panned","centered","extentset","resized","drawn"];return wax.interaction().attach(o).detach(u).parent(function(){return n.parent}).grid(i)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.latlngtooltip=function(e){function i(t){var n=new MM.Point(t.clientX,t.clientY);n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var r=e.parent;r;r=r.offsetParent)n.x-=r.offsetLeft,n.y-=r.offsetTop;return n}function s(e){console.log("here"),n=!0}function o(e){n=!1}function u(r){if(!r.shiftKey||n){t.parentNode===e.parent&&e.parent.removeChild(t);return}var s=i(r),o=e.pointLocation(s),u=o.lat.toFixed(2)+", "+o.lon.toFixed(2);t.innerHTML=u,s.scale=s.width=s.height=1,s.x+=10,MM.moveElement(t,s),e.parent.appendChild(t)}var t,n=!1,r={};return r.add=function(){return MM.addEvent(e.parent,"mousemove",u),MM.addEvent(e.parent,"mousedown",s),MM.addEvent(e.parent,"mouseup",o),t=document.createElement("div"),t.className="wax-latlngtooltip",this},r.remove=function(){return MM.removeEvent(e.parent,"mousemove",u),MM.removeEvent(e.parent,"mousedown",s),MM.removeEvent(e.parent,"mouseup",o),this},r.add()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.legend=function(e,t){t=t||{};var n,r={};return r.add=function(){return n=wax.legend().content(t.legend||""),this},r.content=function(e){e&&n.content(e.legend||"")},r.element=function(){return n.element()},r.appendTo=function(e){return wax.u.$(e).appendChild(n.element()),this},r.add()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.pointselector=function(e,t,n){function l(t){var n=wax.u.eventoffset(t),r=new MM.Point(n.x,n.y),i={x:parseFloat(MM.getStyle(document.documentElement,"margin-left")),y:parseFloat(MM.getStyle(document.documentElement,"margin-top"))};isNaN(i.x)||(r.x-=i.x),isNaN(i.y)||(r.y-=i.y);for(var s=e.parent;s;s=s.offsetParent)r.x-=s.offsetLeft,r.y-=s.offsetTop;return r}function c(e){var t=[];for(var n=0;n<e.length;n++)t.push(new MM.Location(e[n].lat,e[n].lon));return t}function h(){var t=new MM.Point(0,0);for(var n=0;n<a.length;n++){var r=e.locationPoint(a[n]);a[n].pointDiv||(a[n].pointDiv=document.createElement("div"),a[n].pointDiv.className="wax-point-div",a[n].pointDiv.style.position="absolute",a[n].pointDiv.style.display="block",a[n].pointDiv.location=a[n],bean.add(a[n].pointDiv,"mouseup",function(r){var i=a[n];return function(t){MM.removeEvent(e.parent,"mouseup",d),u.deleteLocation(i,t)}}()),e.parent.appendChild(a[n].pointDiv)),a[n].pointDiv.style.left=r.x+"px",a[n].pointDiv.style.top=r.y+"px"}}function p(t){r=l(t),bean.add(e.parent,"mouseup",d)}function d(t){if(!r)return;i=l(t),MM.Point.distance(r,i)<s&&(u.addLocation(e.pointLocation(r)),f(c(a))),r=null}var r=null,i=null,s=5,o,u={},a=[],f=typeof n=="function"?n:n.callback;return u.addLocation=function(e){a.push(e),h(),f(c(a))},u.locations=function(e){return a},u.add=function(e){return bean.add(e.parent,"mousedown",p),e.addCallback("drawn",h),this},u.remove=function(e){bean.remove(e.parent,"mousedown",p),e.removeCallback("drawn",h);for(var t=a.length-1;t>-1;t--)u.deleteLocation(a[t]);return this},u.deleteLocation=function(e,t){if(!t||confirm("Delete this point?"))e.pointDiv.parentNode.removeChild(e.pointDiv),a.splice(wax.u.indexOf(a,e),1),f(c(a))},u.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoombox=function(e){function s(t){var n=new MM.Point(t.clientX,t.clientY);n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var r=e.parent;r;r=r.offsetParent)n.x-=r.offsetLeft,n.y-=r.offsetTop;return n}function o(t){if(!n)return;n=!1;var u=s(t),f=e.pointLocation(u),l=e.pointLocation(i);e.setExtent([f,l]),r.style.display="none",MM.removeEvent(e.parent,"mousemove",a),MM.removeEvent(e.parent,"mouseup",o),e.parent.style.cursor="auto"}function u(t){if(!t.shiftKey||!!this.drawing)return;return n=!0,i=s(t),r.style.left=i.x+"px",r.style.top=i.y+"px",MM.addEvent(e.parent,"mousemove",a),MM.addEvent(e.parent,"mouseup",o),e.parent.style.cursor="crosshair",MM.cancelEvent(t)}function a(e){if(!n)return;var t=s(e);return r.style.display="block",t.x<i.x?r.style.left=t.x+"px":r.style.left=i.x+"px",r.style.width=Math.abs(t.x-i.x)+"px",t.y<i.y?r.style.top=t.y+"px":r.style.top=i.y+"px",r.style.height=Math.abs(t.y-i.y)+"px",MM.cancelEvent(e)}var t={},n=!1,r,i=null;return t.add=function(e){return r=r||document.createElement("div"),r.id=e.parent.id+"-zoombox-box",r.className="zoombox-box",e.parent.appendChild(r),MM.addEvent(e.parent,"mousedown",u),this},t.remove=function(){e.parent.removeChild(r),MM.removeEvent(e.parent,"mousedown",u)},t.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoomer=function(e){var t=document.createElement("a");t.innerHTML="+",t.href="#",t.className="zoomer zoomin",bean.add(t,"mousedown dblclick",function(e){e.stop()}),bean.add(t,"click",function(t){t.stop(),e.zoomIn()},!1);var n=document.createElement("a");n.innerHTML="-",n.href="#",n.className="zoomer zoomout",bean.add(n,"mousedown dblclick",function(e){e.stop()}),bean.add(n,"click",function(t){t.stop(),e.zoomOut()});var r={add:function(e){return e.addCallback("drawn",function(e,r){e.coordinate.zoom===e.coordLimits[0].zoom?n.className="zoomer zoomout zoomdisabled":e.coordinate.zoom===e.coordLimits[1].zoom?t.className="zoomer zoomin zoomdisabled":(t.className="zoomer zoomin",n.className="zoomer zoomout")}),this},appendTo:function(e){return wax.u.$(e).appendChild(t),wax.u.$(e).appendChild(n),this}};return r.add(e)};var wax=wax||{};wax.mm=wax.mm||{},wax.mm._provider=function(e){this.options={tiles:e.tiles,scheme:e.scheme||"xyz",minzoom:e.minzoom||0,maxzoom:e.maxzoom||22,bounds:e.bounds||[-180,-90,180,90]}},wax.mm._provider.prototype={outerLimits:function(){return[this.locationCoordinate(new MM.Location(this.options.bounds[0],this.options.bounds[1])).zoomTo(this.options.minzoom),this.locationCoordinate(new MM.Location(this.options.bounds[2],this.options.bounds[3])).zoomTo(this.options.maxzoom)]},getTile:function(e){if(!(coord=this.sourceCoordinate(e)))return null;if(coord.zoom<this.options.minzoom||coord.zoom>this.options.maxzoom)return null;coord.row=this.options.scheme==="tms"?Math.pow(2,coord.zoom)-coord.row-1:coord.row;var t=this.options.tiles[parseInt(Math.pow(2,coord.zoom)*coord.row+coord.column,10)%this.options.tiles.length].replace("{z}",coord.zoom.toFixed(0)).replace("{x}",coord.column.toFixed(0)).replace("{y}",coord.row.toFixed(0));return wax._&&wax._.bw&&(t=t.replace(".png",wax._.bw_png).replace(".jpg",wax._.bw_jpg)),t}},MM&&MM.extend(wax.mm._provider,MM.MapProvider),wax.mm.connector=function(e){var t=new wax.mm._provider(e);return new MM.Layer(t)},wax=wax||{},wax.attribution=function(){function n(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function r(e){return e}var e,t={};return t.content=function(t){return typeof t=="undefined"?e.innerHTML:(e.innerHTML=html_sanitize(t,n,r),this)},t.element=function(){return e},t.init=function(){return e=document.createElement("div"),e.className="wax-attribution",this},t.init()},wax=wax||{},wax.bwdetect=function(e,t){function a(){wax.bw=-1;var e=new Image;e.src=s;var t=!0,i=setTimeout(function(){t&&wax.bw==-1&&(n.bw(0),t=!1)},r);e.onload=function(){t&&wax.bw==-1&&(clearTimeout(i),n.bw(1),t=!1)}}var n={},r=e.threshold||400,s="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +(new Date),o=1,u=e.auto===undefined?!0:e.auto;return n.bw=function(e){if(!arguments.length)return o;var n=o;wax.bwlisteners&&wax.bwlisteners.length&&function(){listeners=wax.bwlisteners,wax.bwlisteners=[];for(i=0;i<listeners;i++)listeners[i](e)}(),wax.bw=e,o!=(o=e)&&t(e)},n.add=function(){return u&&a(),this},wax.bw==-1?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(n.bw)):wax.bw!==undefined?n.bw(wax.bw):n.add(),n},wax.formatter=function(x){function urlX(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function idX(e){return e}var formatter={},f;if(x&&typeof x=="string")try{eval("f = "+x)}catch(e){console&&console.log(e)}else x&&typeof x=="function"?f=x:f=function(){};return formatter.format=function(e,t){try{return html_sanitize(f(e,t),urlX,idX)}catch(n){console&&console.log(n)}},formatter},wax.gi=function(e,t){function s(e){return e>=93&&e--,e>=35&&e--,e-=32,e}t=t||{};var n={},r=t.resolution||4,i=t.tileSize||256;return n.grid_tile=function(){return e},n.getKey=function(t,n){if(!e||!e.grid)return;if(n<0||t<0)return;if(Math.floor(n)>=i||Math.floor(t)>=i)return;return s(e.grid[Math.floor(n/r)].charCodeAt(Math.floor(t/r)))},n.gridFeature=function(t,n){var r=this.getKey(t,n),i=e.keys;if(i&&i[r]&&e.data[i[r]])return e.data[i[r]]},n.tileFeature=function(t,n,r){if(!e)return;var i=wax.u.offset(r);return feature=this.gridFeature(t-i.left,n-i.top),feature},n},wax.gm=function(){function o(e){return typeof e=="string"&&(e=[e]),function(n){if(!n)return;var r=new RegExp("/(\\d+)\\/(\\d+)\\/(\\d+)\\.[\\w\\._]+"),i=r.exec(n);if(!i)return;return e[parseInt(i[2],10)%e.length].replace(/\{z\}/g,i[1]).replace(/\{x\}/g,i[2]).replace(/\{y\}/g,i[3])}}var e=4,t={},n={},r,i,s=function(e){if(e)return e.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json")};return n.formatter=function(e){return arguments.length?(i=wax.formatter(e),n):i},n.template=function(e){return arguments.length?(i=wax.template(e),n):i},n.gridUrl=function(e){return arguments.length?(e?s=typeof e=="function"?e:o(e):s=function(){return null},n):s},n.getGrid=function(t,r){var o=s(t);return!i||!o?r(null,null):(wax.request.get(o,function(t,n){if(t)return r(t,null);r(null,wax.gi(n,{formatter:i,resolution:e}))}),n)},n.tilejson=function(t){return arguments.length?(t.template?n.template(t.template):t.formatter?n.formatter(t.formatter):i=undefined,n.gridUrl(t.grids),t.resolution&&(e=t.resolution),r=t,n):r},n},wax=wax||{},wax.hash=function(e){function t(){return location.hash.substring(1)}function n(e){var t=window.location;t.replace(t.toString().replace(t.hash||/$/,"#"+e
))}function o(t){var n=t.split("/");for(var r=0;r<n.length;r++){n[r]=Number(n[r]);if(isNaN(n[r]))return!0}if(n.length<3)return!0;n.length==3&&e.setCenterZoom(n)}function u(){var t=e.getCenterZoom();r!==t&&(r=t,n(r))}function a(e){if(e===r)return;o(r=e)&&u()}e=e||{};var r,i={},s=90-1e-8,f=wax.u.throttle(u,500);return i.add=function(){return a(t()),e.bindChange(f),this},i.remove=function(){return e.unbindChange(f),this},i.add()},wax=wax||{},wax.interaction=function(){function d(e){var t=o();for(var n=0;n<t.length;n++)if(t[n][0]<e.y&&t[n][0]+256>e.y&&t[n][1]<e.x&&t[n][1]+256>e.x)return t[n][2];return!1}function v(){return r?(window.clearTimeout(r),r=null,!0):!1}function m(r){if(n)return;var i=wax.u.eventoffset(r);t.screen_feature(i,function(n){n?bean.fire(t,"on",{parent:f(),data:n,formatter:e.formatter().format,e:r}):bean.fire(t,"off")})}function g(e){if(v())return;n=!0,i=wax.u.eventoffset(e),e.type==="mousedown"?bean.add(document.body,"click",b):e.type==="touchstart"&&e.touches.length===1&&(bean.fire(t,"off"),bean.add(f(),p))}function y(){bean.remove(f(),p),n=!1}function b(e){var o={},u=wax.u.eventoffset(e);n=!1;for(var a in e)o[a]=e[a];return bean.remove(document.body,"mouseup",b),bean.remove(f(),p),e.type==="touchend"?t.click(e,i):Math.round(u.y/s)===Math.round(i.y/s)&&Math.round(u.x/s)===Math.round(i.x/s)&&(r=window.setTimeout(function(){r=null,t.click(o,u)},300)),b}var e=wax.gm(),t={},n=!1,r=!1,i,s=4,o,u,a,f,l,c,h={mousemove:m,touchstart:g,mousedown:g},p={touchend:b,touchmove:b,touchcancel:y};return t.click=function(n,r){t.screen_feature(r,function(r){r&&bean.fire(t,"on",{parent:f(),data:r,formatter:e.formatter().format,e:n})})},t.screen_feature=function(t,n){var r=d(t);r||n(null),e.getGrid(r.src,function(e,i){if(e||!i)return n(null);var s=i.tileFeature(t.x,t.y,r);n(s)})},t.attach=function(e){return arguments.length?(u=e,t):u},t.detach=function(e){return arguments.length?(a=e,t):a},t.map=function(e){return arguments.length?(l=e,u&&u(l),bean.add(f(),h),bean.add(f(),"touchstart",g),t):l},t.grid=function(e){return arguments.length?(o=e,t):o},t.remove=function(e){return a&&a(l),bean.remove(f(),h),bean.fire(t,"remove"),t},t.tilejson=function(n){return arguments.length?(e.tilejson(n),t):e.tilejson()},t.formatter=function(){return e.formatter()},t.on=function(e,n){return bean.add(t,e,n),t},t.off=function(e,n){return bean.remove(t,e,n),t},t.gridmanager=function(n){return arguments.length?(e=n,t):e},t.parent=function(e){return f=e,t},t};var wax=wax||{};wax.legend=function(){function r(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function i(e){return e}var e,t={},n;return t.element=function(){return n},t.content=function(n){return arguments.length?(n?(e.innerHTML=html_sanitize(n,r,i),e.style.display="block"):(e.innerHTML="",e.style.display="none"),t):e.innerHTML},t.add=function(){return n=document.createElement("div"),n.className="wax-legends",e=n.appendChild(document.createElement("div")),e.className="wax-legend",e.style.display="none",t},t.add()};var wax=wax||{};wax.location=function(){function t(e){console.log(e);if(e.e.type==="mousemove"||!e.e.type)return;var t=e.formatter({format:"location"},e.data);t&&(window.location.href=t)}var e={};return e.events=function(){return{on:t}},e};var wax=wax||{};wax.movetip={},wax.movetip=function(){function o(e){var t=wax.u.eventoffset(e);n.height+t.y>r.top+r.height&&r.height>n.height&&(t.y-=n.height,i.className+=" flip-y"),n.width+t.x>r.left+r.width&&(t.x-=n.width,i.className+=" flip-x"),i.style.left=t.x+"px",i.style.top=t.y+"px"}function u(e){var t=document.createElement("div");return t.className="wax-tooltip wax-tooltip-0",t.innerHTML=e,t}function a(){i&&(i.parentNode.removeChild(i),i=null)}function f(t){var f;if(e)return;if(t.e.type==="mousemove"||!t.e.type){f=t.formatter({format:"teaser"},t.data);if(!f)return;a(),s.style.cursor="pointer",i=document.body.appendChild(u(f))}else{f=t.formatter({format:"teaser"},t.data);if(!f)return;a();var l=document.body.appendChild(u(f));l.className+=" wax-popup";var c=l.appendChild(document.createElement("a"));c.href="#close",c.className="close",c.innerHTML="Close",e=!0,i=l,n=wax.u.offset(i),r=wax.u.offset(s),o(t.e),bean.add(c,"click touchend",function(n){n.stop(),a(),e=!1})}i&&(n=wax.u.offset(i),r=wax.u.offset(s),o(t.e))}function l(){s.style.cursor="default",e||a()}var e=!1,t={},n,r,i,s;return t.parent=function(e){return arguments.length?(s=e,t):s},t.events=function(){return{on:f,off:l}},t};var wax=wax||{};wax.request={cache:{},locks:{},promises:{},get:function(e,t){if(this.cache[e])return t(this.cache[e][0],this.cache[e][1]);this.promises[e]=this.promises[e]||[],this.promises[e].push(t);if(this.locks[e])return;var n=this;this.locks[e]=!0,reqwest({url:e+(~e.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(t){n.locks[e]=!1,n.cache[e]=[null,t];for(var r=0;r<n.promises[e].length;r++)n.promises[e][r](n.cache[e][0],n.cache[e][1])},error:function(t){n.locks[e]=!1,n.cache[e]=[t,null];for(var r=0;r<n.promises[e].length;r++)n.promises[e][r](n.cache[e][0],n.cache[e][1])}})}},wax.template=function(e){function n(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function r(e){return e}var t={};return t.format=function(t,i){var s={};for(var o in i)s[o]=i[o];return t.format&&(s["__"+t.format+"__"]=!0),html_sanitize(Mustache.to_html(e,s),n,r)},t};if(!wax)var wax={};wax.tilejson=function(e,t){reqwest({url:e+(~e.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:t,error:t})};var wax=wax||{};wax.tooltip={},wax.tooltip=function(){function u(e){var t=document.createElement("div");return t.className="wax-tooltip wax-tooltip-0",t.innerHTML=e,t}function a(){this.parentNode&&this.parentNode.removeChild(this)}function f(){var e;while(e=r.pop())t&&s?(bean.add(e,s,a),e.className+=" wax-fade"):e.parentNode&&e.parentNode.removeChild(e)}function l(t){var n;if(t.e.type==="mousemove"||!t.e.type){if(!e){n=t.content||t.formatter({format:"teaser"},t.data);if(!n||n==i)return;f(),o.style.cursor="pointer",r.push(o.appendChild(u(n))),i=n}}else{n=t.content||t.formatter({format:"full"},t.data);if(!n){t.e.type&&t.e.type.match(/touch/)&&(n=t.content||t.formatter({format:"teaser"},t.data));if(!n)return}f(),o.style.cursor="pointer";var s=o.appendChild(u(n));s.className+=" wax-popup";var a=s.appendChild(document.createElement("a"));a.href="#close",a.className="close",a.innerHTML="Close",e=!0,r.push(s),bean.add(a,"touchstart mousedown",function(e){e.stop()}),bean.add(a,"click touchend",function(n){n.stop(),f(),e=!1})}}function c(){o.style.cursor="default",i=null,e||f()}var e=!1,t=!1,n={},r=[],i,s,o;return document.body.style["-webkit-transition"]!==undefined?s="webkitTransitionEnd":document.body.style.MozTransition!==undefined&&(s="transitionend"),n.parent=function(e){return arguments.length?(o=e,n):o},n.animate=function(e){return arguments.length?(t=e,n):t},n.events=function(){return{on:l,off:c}},n};var wax=wax||{};wax.u={offset:function(e){var t=e.offsetWidth||parseInt(e.style.width,10),n=e.offsetHeight||parseInt(e.style.height,10),r=document.body,i=0,s=0,o=function(e){if(e===r||e===document.documentElement)return;i+=e.offsetTop,s+=e.offsetLeft;var t=e.style.transform||e.style.WebkitTransform||e.style.OTransform||e.style.MozTransform||e.style.msTransform;if(t)if(match=t.match(/translate\((.+)px, (.+)px\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10);else if(match=t.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10);else if(match=t.match(/matrix3d\(([\-\d,\s]+)\)/)){var n=match[1].split(",");i+=parseInt(n[13],10),s+=parseInt(n[12],10)}else if(match=t.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))i+=parseInt(match[2],10),s+=parseInt(match[1],10)};o(e);try{while(e=e.offsetParent)o(e)}catch(u){}i+=r.offsetTop,s+=r.offsetLeft,i+=r.parentNode.offsetTop,s+=r.parentNode.offsetLeft;var a=document.defaultView?window.getComputedStyle(r.parentNode,null):r.parentNode.currentStyle;return r.parentNode.offsetTop!==parseInt(a.marginTop,10)&&!isNaN(parseInt(a.marginTop,10))&&(i+=parseInt(a.marginTop,10),s+=parseInt(a.marginLeft,10)),{top:i,left:s,height:n,width:t}},$:function(e){return typeof e=="string"?document.getElementById(e):e},indexOf:function(e,t){var n=Array.prototype.indexOf;if(e===null)return-1;var r,i;if(n&&e.indexOf===n)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},eventoffset:function(e){var t=0,n=0;e||(e=window.event);if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};if(e.clientX||e.clientY){var r=document.documentElement,i=document.body,s=document.body.parentNode.currentStyle,o=parseInt(s.marginTop,10)||0,u=parseInt(s.marginLeft,10)||0;return{x:e.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0)+u,y:e.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)+o}}if(e.touches&&e.touches.length===1)return{x:e.touches[0].pageX,y:e.touches[0].pageY}},limit:function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}},throttle:function(e,t){return this.limit(e,t,!1)}},wax=wax||{},wax.mm=wax.mm||{},wax.mm.attribution=function(e,t){t=t||{};var n,r={};return r.element=function(){return n.element()},r.appendTo=function(e){return wax.u.$(e).appendChild(n.element()),this},r.init=function(){return n=wax.attribution(),n.content(t.attribution),n.element().className="wax-attribution wax-mm",this},r.init()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.boxselector=function(e,t,n){function m(t){var n=new MM.Point(t.clientX,t.clientY);n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var r=e.parent;r;r=r.offsetParent)n.x-=r.offsetLeft,n.y-=r.offsetTop;return n}function g(t){if(!t.shiftKey)return;return r=i=m(t),f=l=!0,u.left=r.x+"px",u.top=r.y+"px",u.width=u.height=0,h(document,"mousemove",b),h(document,"mouseup",w),e.parent.style.cursor="crosshair",MM.cancelEvent(t)}function y(e){var t=m(e),n={x:parseInt(o.offsetLeft,10),y:parseInt(o.offsetTop,10)},s={x:n.x+parseInt(o.offsetWidth,10),y:n.y+parseInt(o.offsetHeight,10)};f=t.x-n.x<=c||s.x-t.x<=c,l=t.y-n.y<=c||s.y-t.y<=c;if(l||f)return r={x:t.x-n.x<s.x-t.x?s.x:n.x,y:t.y-n.y<s.y-t.y?s.y:n.y},i={x:t.x-n.x<s.x-t.x?n.x:s.x,y:t.y-n.y<s.y-t.y?n.y:s.y},h(document,"mousemove",b),h(document,"mouseup",w),MM.cancelEvent(e)}function b(t){var n=m(t);return u.display="block",f&&(u.left=(n.x<r.x?n.x:r.x)+"px",u.width=Math.abs(n.x-r.x)-2*a+"px"),l&&(u.top=(n.y<r.y?n.y:r.y)+"px",u.height=Math.abs(n.y-r.y)-2*a+"px"),S(n,e.parent),MM.cancelEvent(t)}function w(t){var n=m(t),s=e.pointLocation(new MM.Point(f?n.x:i.x,l?n.y:i.y));l2=e.pointLocation(r),v.extent([new MM.Location(Math.max(s.lat,l2.lat),Math.min(s.lon,l2.lon)),new MM.Location(Math.min(s.lat,l2.lat),Math.max(s.lon,l2.lon))]),p(document,"mousemove",b),p(document,"mouseup",w),e.parent.style.cursor="auto"}function E(e){S(m(e),o)}function S(e,t){var n={x:parseInt(o.offsetLeft,10),y:parseInt(o.offsetTop,10)},r={x:n.x+parseInt(o.offsetWidth,10),y:n.y+parseInt(o.offsetHeight,10)},i="";e.y-n.y<=c?i="n":r.y-e.y<=c&&(i="s"),e.x-n.x<=c?i+="w":r.x-e.x<=c&&(i+="e"),i!==""&&(i+="-resize"),t.style.cursor=i}function x(e,t){if(!o||!d)return;var n=e.locationPoint(d[1]),r=e.locationPoint(d[0]),i=o.style;i.display="block",i.height="auto",i.width="auto",i.left=Math.max(0,r.x)+"px",i.top=Math.max(0,r.y)+"px",i.right=Math.max(0,e.dimensions.x-n.x)+"px",i.bottom=Math.max(0,e.dimensions.y-n.y)+"px"}var r=null,i=null,s=typeof n=="function"?n:n.callback,o,u,a=0,f=!1,l=!1,c=5,h=MM.addEvent,p=MM.removeEvent,d,v={};return v.extent=function(t,n){if(!t)return d;d=[new MM.Location(Math.max(t[0].lat,t[1].lat),Math.min(t[0].lon,t[1].lon)),new MM.Location(Math.min(t[0].lat,t[1].lat),Math.max(t[0].lon,t[1].lon))],x(e),n||s(d)},v.add=function(e){return o=o||document.createElement("div"),o.id=e.parent.id+"-boxselector-box",o.className="boxselector-box",e.parent.appendChild(o),u=o.style,a=parseInt(window.getComputedStyle(o).borderWidth,10),h(e.parent,"mousedown",g),h(o,"mousedown",y),h(e.parent,"mousemove",E),e.addCallback("drawn",x),this},v.remove=function(){e.parent.removeChild(o),p(e.parent,"mousedown",g),p(o,"mousedown",y),p(e.parent,"mousemove",E),e.removeCallback("drawn",x)},v.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax._={},wax.mm.bwdetect=function(e,t){t=t||{};var n=t.png||".png128",r=t.jpg||".jpg70",i=!1;return wax._.bw_png=n,wax._.bw_jpg=r,wax.bwdetect(t,function(t){wax._.bw=!t;for(var n=0;n<e.layers.length;n++)e.getLayerAt(n).provider instanceof wax.mm.connector&&e.getLayerAt(n).setProvider(e.getLayerAt(n).provider)})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.fullscreen=function(e){function o(e){e&&e.stop(),t?n.original():n.full()}function u(t,n){e.dimensions=new MM.Point(t,n),e.parent.style.width=Math.round(e.dimensions.x)+"px",e.parent.style.height=Math.round(e.dimensions.y)+"px",e.dispatchCallback("resized",e.dimensions)}var t=!1,n={},r,i=document.body,s;return n.add=function(e){return r=document.createElement("a"),r.className="wax-fullscreen",r.href="#fullscreen",r.innerHTML="fullscreen",bean.add(r,"click",o),this},n.full=function(){if(t)return;t=!0,s=[e.parent.offsetWidth,e.parent.offsetHeight],e.parent.className+=" wax-fullscreen-map",i.className+=" wax-fullscreen-view",u(e.parent.offsetWidth,e.parent.offsetHeight)},n.original=function(){if(!t)return;t=!1,e.parent.className=e.parent.className.replace(" wax-fullscreen-map",""),i.className=i.className.replace(" wax-fullscreen-view",""),u(s[0],s[1])},n.appendTo=function(e){return wax.u.$(e).appendChild(r),this},n.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.hash=function(e){return wax.hash({getCenterZoom:function(){var t=e.getCenter(),n=e.getZoom(),r=Math.max(0,Math.ceil(Math.log(n)/Math.LN2));return[n.toFixed(2),t.lat.toFixed(r),t.lon.toFixed(r)].join("/")},setCenterZoom:function(n){e.setCenterZoom(new MM.Location(n[1],n[2]),n[0])},bindChange:function(t){e.addCallback("drawn",t)},unbindChange:function(t){e.removeCallback("drawn",t)}})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.interaction=function(){function i(){var r=n.getLayerAt(0).levels[Math.round(n.getZoom())];return!e&&t!==undefined&&t.length?t:(t=function(e){var t=[];for(var n in e)if(e[n].parentNode===r){var i=wax.u.offset(e[n]);t.push([i.top,i.left,e[n]])}return t}(n.getLayerAt(0).tiles),t)}function s(){e=!0}function o(e){if(!arguments.length)return n;n=e;for(var t=0;t<r.length;t++)n.addCallback(r[t],s)}function u(e){for(var t=0;t<r.length;t++)n.removeCallback(r[t],s)}var e=!1,t,n,r=["zoomed","panned","centered","extentset","resized","drawn"];return wax.interaction().attach(o).detach(u).parent(function(){return n.parent}).grid(i)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.latlngtooltip=function(e){function i(t){var n=new MM.Point(t.clientX,t.clientY);n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var r=e.parent;r;r=r.offsetParent)n.x-=r.offsetLeft,n.y-=r.offsetTop;return n}function s(e){console.log("here"),n=!0}function o(e){n=!1}function u(r){if(!r.shiftKey||n){t.parentNode===e.parent&&e.parent.removeChild(t);return}var s=i(r),o=e.pointLocation(s),u=o.lat.toFixed(2)+", "+o.lon.toFixed(2);t.innerHTML=u,s.scale=s.width=s.height=1,s.x+=10,MM.moveElement(t,s),e.parent.appendChild(t)}var t,n=!1,r={};return r.add=function(){return MM.addEvent(e.parent,"mousemove",u),MM.addEvent(e.parent,"mousedown",s),MM.addEvent(e.parent,"mouseup",o),t=document.createElement("div"),t.className="wax-latlngtooltip",this},r.remove=function(){return MM.removeEvent(e.parent,"mousemove",u),MM.removeEvent(e.parent,"mousedown",s),MM.removeEvent(e.parent,"mouseup",o),this},r.add()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.legend=function(e,t){t=t||{};var n,r={};return r.add=function(){return n=wax.legend().content(t.legend||""),this},r.content=function(e){e&&n.content(e.legend||"")},r.element=function(){return n.element()},r.appendTo=function(e){return wax.u.$(e).appendChild(n.element()),this},r.add()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.pointselector=function(e,t,n){function l(t){var n=wax.u.eventoffset(t),r=new MM.Point(n.x,n.y),i={x:parseFloat(MM.getStyle(document.documentElement,"margin-left")),y:parseFloat(MM.getStyle(document.documentElement,"margin-top"))};isNaN(i.x)||(r.x-=i.x),isNaN(i.y)||(r.y-=i.y);for(var s=e.parent;s;s=s.offsetParent)r.x-=s.offsetLeft,r.y-=s.offsetTop;return r}function c(e){var t=[];for(var n=0;n<e.length;n++)t.push(new MM.Location(e[n].lat,e[n].lon));return t}function h(){var t=new MM.Point(0,0);for(var n=0;n<a.length;n++){var r=e.locationPoint(a[n]);a[n].pointDiv||(a[n].pointDiv=document.createElement("div"),a[n].pointDiv.className="wax-point-div",a[n].pointDiv.style.position="absolute",a[n].pointDiv.style.display="block",a[n].pointDiv.location=a[n],bean.add(a[n].pointDiv,"mouseup",function(r){var i=a[n];return function(t){MM.removeEvent(e.parent,"mouseup",d),u.deleteLocation(i,t)}}()),e.parent.appendChild(a[n].pointDiv)),a[n].pointDiv.style.left=r.x+"px",a[n].pointDiv.style.top=r.y+"px"}}function p(t){r=l(t),bean.add(e.parent,"mouseup",d)}function d(t){if(!r)return;i=l(t),MM.Point.distance(r,i)<s&&(u.addLocation(e.pointLocation(r)),f(c(a))),r=null}var r=null,i=null,s=5,o,u={},a=[],f=typeof n=="function"?n:n.callback;return u.addLocation=function(e){a.push(e),h(),f(c(a))},u.locations=function(e){return a},u.add=function(e){return bean.add(e.parent,"mousedown",p),e.addCallback("drawn",h),this},u.remove=function(e){bean.remove(e.parent,"mousedown",p),e.removeCallback("drawn",h);for(var t=a.length-1;t>-1;t--)u.deleteLocation(a[t]);return this},u.deleteLocation=function(e,t){if(!t||confirm("Delete this point?"))e.pointDiv.parentNode.removeChild(e.pointDiv),a.splice(wax.u.indexOf(a,e),1),f(c(a))},u.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoombox=function(e){function s(t){var n=new MM.Point(t.clientX,t.clientY);n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var r=e.parent;r;r=r.offsetParent)n.x-=r.offsetLeft,n.y-=r.offsetTop;return n}function o(t){if(!n)return;n=!1;var u=s(t),f=e.pointLocation(u),l=e.pointLocation(i);e.setExtent([f,l]),r.style.display="none",MM.removeEvent(e.parent,"mousemove",a),MM.removeEvent(e.parent,"mouseup",o),e.parent.style.cursor="auto"}function u(t){if(!t.shiftKey||!!this.drawing)return;return n=!0,i=s(t),r.style.left=i.x+"px",r.style.top=i.y+"px",MM.addEvent(e.parent,"mousemove",a),MM.addEvent(e.parent,"mouseup",o),e.parent.style.cursor="crosshair",MM.cancelEvent(t)}function a(e){if(!n)return;var t=s(e);return r.style.display="block",t.x<i.x?r.style.left=t.x+"px":r.style.left=i.x+"px",r.style.width=Math.abs(t.x-i.x)+"px",t.y<i.y?r.style.top=t.y+"px":r.style.top=i.y+"px",r.style.height=Math.abs(t.y-i.y)+"px",MM.cancelEvent(e)}var t={},n=!1,r,i=null;return t.add=function(e){return r=r||document.createElement("div"),r.id=e.parent.id+"-zoombox-box",r.className="zoombox-box",e.parent.appendChild(r),MM.addEvent(e.parent,"mousedown",u),this},t.remove=function(){e.parent.removeChild(r),MM.removeEvent(e.parent,"mousedown",u)},t.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoomer=function(e){var t=document.createElement("a");t.innerHTML="+",t.href="#",t.className="zoomer zoomin",bean.add(t,"mousedown dblclick",function(e){e.stop()}),bean.add(t,"click",function(t){t.stop(),e.zoomIn()},!1);var n=document.createElement("a");n.innerHTML="-",n.href="#",n.className="zoomer zoomout",bean.add(n,"mousedown dblclick",function(e){e.stop()}),bean.add(n,"click",function(t){t.stop(),e.zoomOut()});var r={add:function(e){return e.addCallback("drawn",function(e,r){e.coordinate.zoom===e.coordLimits[0].zoom?n.className="zoomer zoomout zoomdisabled":e.coordinate.zoom===e.coordLimits[1].zoom?t.className="zoomer zoomin zoomdisabled":(t.className="zoomer zoomin",n.className="zoomer zoomout")}),this},appendTo:function(e){return wax.u.$(e).appendChild(t),wax.u.$(e).appendChild(n),this}};return r.add(e)};var wax=wax||{};wax.mm=wax.mm||{},wax.mm._provider=function(e){this.options={tiles:e.tiles,scheme:e.scheme||"xyz",minzoom:e.minzoom||0,maxzoom:e.maxzoom||22,bounds:e.bounds||[-180,-90,180,90]}},wax.mm._provider.prototype={outerLimits:function(){return[this.locationCoordinate(new MM.Location(this.options.bounds[0],this.options.bounds[1])).zoomTo(this.options.minzoom),this.locationCoordinate(new MM.Location(this.options.bounds[2],this.options.bounds[3])).zoomTo(this.options.maxzoom)]},getTile:function(e){if(!(coord=this.sourceCoordinate(e)))return null;if(coord.zoom<this.options.minzoom||coord.zoom>this.options.maxzoom)return null;coord.row=this.options.scheme==="tms"?Math.pow(2,coord.zoom)-coord.row-1:coord.row;var t=this.options.tiles[parseInt(Math.pow(2,coord.zoom)*coord.row+coord.column,10)%this.options.tiles.length].replace("{z}",coord.zoom.toFixed(0)).replace("{x}",coord.column.toFixed(0)).replace("{y}",coord.row.toFixed(0));return wax._&&wax._.bw&&(t=t.replace(".png",wax._.bw_png).replace(".jpg",wax._.bw_jpg)),t}},MM&&MM.extend(wax.mm._provider,MM.MapProvider),wax.mm.connector=function(e){var t=new wax.mm._provider(e);return new MM.Layer(t)},function(){var e={};e.load=function(e,t){wax.tilejson(e,function(e){e.zoom=e.center[2],e.center={lat:e.center[1],lon:e.center[0]},e.tiles&&(e.layer=new wax.mm.connector(e)),e.data?(e.markers=mmg().factory(simplestyle_factory),e.markers.url(e.data,function(){mmg_interaction(e.markers),t(e)})):t(e)})},e.auto=function(t,n){return function(r){var i=e.map(t);r.layer&&i.addLayer(r.layer),r.markers&&i.addLayer(r.markers),r.attribution&&wax.mm.attribution(i,r).appendTo(i.parent),r.legend&&wax.mm.legend(i,r).appendTo(i.parent),wax.mm.zoomer(i).appendTo(i.parent),wax.mm.zoombox(i),i.zoom(r.zoom).center(r.center),wax.mm.interaction().map(i).tilejson(r).on(wax.tooltip().parent(i.parent).events()),n&&n(i)}},e.markers=mmg;var t=[easey.TouchHandler,easey.DragHandler,easey.DoubleClickHandler,easey.MouseWheelHandler],n=[MM.TouchHandler,MM.DragHandler,MM.DoubleClickHandler,MM.MouseWheelHandler];MM.Map.prototype.smooth=function(e){while(this.eventHandlers.length)this.eventHandlers.pop().remove();if(e)for(var r=0;r<t.length;r++){var i=t[r]();this.eventHandlers.push(i),i.init(this)}else for(var s=0;s<n.length;s++){var i=n[s]();this.eventHandlers.push(i),i.init(this)}return this},MM.Map.prototype.on=function(e,t){e in this.callbackManager.callbacks&&this.addCallback(e,t)},e.map=function(e,t){return new MM.Map(e,t,null,[easey.TouchHandler(),easey.DragHandler(),easey.DoubleClickHandler(),easey.MouseWheelHandler()])},this.mapbox=e}(this);