/*!
  * bean.js - copyright Jacob Thornton 2011
  * https://github.com/fat/bean
  * MIT License
  * special thanks to:
  * dean edwards: http://dean.edwards.name/
  * dperini: https://github.com/dperini/nwevents
  * the entire mootools team: github.com/mootools/mootools-core
<<<<<<< HEAD
  */function mmg(){function a(a){a.coord||(a.coord=b.map.locationCoordinate(a.location));var c=b.map.coordinatePoint(a.coord),d;c.x<0?(d=new MM.Location(a.location.lat,a.location.lon),d.lon+=Math.ceil((j.lon-a.location.lon)/360)*360,c=b.map.locationPoint(d),a.coord=b.map.locationCoordinate(d)):c.x>b.map.dimensions.x&&(d=new MM.Location(a.location.lat,a.location.lon),d.lon-=Math.ceil((a.location.lon-k.lon)/360)*360,c=b.map.locationPoint(d),a.coord=b.map.locationCoordinate(d)),c.scale=1,c.width=c.height=0,MM.moveElement(a.element,c)}var b={},c=[],d=[],e=new MM.CallbackManager(b,["drawn","markeradded"]),f=null,g=function(a){var b=document.createElement("div");return b.className="mmg-default",b.style.position="absolute",b},h=function(a,b){return b.geometry.coordinates[1]-a.geometry.coordinates[1]},i,j=null,k=null,l=function(){return!0};return b.parent=document.createElement("div"),b.parent.style.cssText="position: absolute; top: 0px;left:0px; width:100%; height:100%; margin:0; padding:0; z-index:0",b.addCallback=function(a,c){return e.addCallback(a,c),b},b.removeCallback=function(a,c){return e.removeCallback(a,c),b},b.draw=function(){if(!b.map)return;j=b.map.pointLocation(new MM.Point(0,0)),k=b.map.pointLocation(new MM.Point(b.map.dimensions.x,0)),e.dispatchCallback("drawn",b);for(var c=0;c<d.length;c++)a(d[c])},b.add=function(a){return!a||!a.element?null:(b.parent.appendChild(a.element),d.push(a),e.dispatchCallback("markeradded",a),a)},b.remove=function(a){if(!a)return null;b.parent.removeChild(a.element);for(var c=0;c<d.length;c++)if(d[c]===a)return d.splice(c,1),a;return a},b.markers=function(a){if(!arguments.length)return d},b.add_feature=function(a){return b.features(b.features().concat([a]))},b.sort=function(a){return arguments.length?(h=a,b):h},b.features=function(a){if(!arguments.length)return c;while(b.parent.hasChildNodes())b.parent.removeChild(b.parent.lastChild);d=[],a||(a=[]),c=a.slice(),c.sort(h);for(var e=0;e<c.length;e++)l(c[e])&&b.add({element:g(c[e]),location:new MM.Location(c[e].geometry.coordinates[1],c[e].geometry.coordinates[0]),data:c[e]});return b.map&&b.map.coordinate&&b.map.draw(),b},b.url=function(a,c){function d(a){a&&a.features&&b.features(a.features),c&&c(a.features,b)}if(!arguments.length)return i;if(typeof reqwest=="undefined")throw"reqwest is required for url loading";return typeof a=="string"&&(a=[a]),i=a,reqwest(i[0].match(/geojsonp$/)?{url:i[0]+(~i[0].indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:d,error:d}:{url:i[0],type:"json",success:d,error:d}),b},b.extent=function(){var a=[{lat:Infinity,lon:Infinity},{lat:-Infinity,lon:-Infinity}],c=b.features();for(var d=0;d<c.length;d++){var e=c[d].geometry.coordinates;e[0]<a[0].lon&&(a[0].lon=e[0]),e[1]<a[0].lat&&(a[0].lat=e[1]),e[0]>a[1].lon&&(a[1].lon=e[0]),e[1]>a[1].lat&&(a[1].lat=e[1])}return a},b.factory=function(a){return arguments.length?(g=a,b.features(b.features()),b):g},b.filter=function(a){return arguments.length?(l=a,b.features(b.features()),b):l},b.destroy=function(){b.parent.parentNode&&b.parent.parentNode.removeChild(b.parent)},b}function mmg_interaction(a){function b(){a.map.addCallback("panned",function(){if(f)while(d.length)a.remove(d.pop())})}var c={},d=[],e=!0,f=!0,g=!0,h=null,i;c.formatter=function(a){return arguments.length?(i=a,c):i},c.formatter(function(a){var b="",c=a.properties;return c?(c.title&&(b+='<div class="mmg-title">'+c.title+"</div>"),c.description&&(b+='<div class="mmg-description">'+c.description+"</div>"),typeof html_sanitize!==undefined&&(b=html_sanitize(b,function(a){if(/^(https?:\/\/|data:image)/.test(a))return a},function(a){return a})),b):null}),c.hide_on_move=function(a){return arguments.length?(f=a,c):f},c.exclusive=function(a){return arguments.length?(e=a,c):e},c.show_on_hover=function(a){return arguments.length?(g=a,c):g},c.hide_tooltips=function(){while(d.length)a.remove(d.pop());for(var b=0;b<j.length;b++)delete j[b].clicked},c.bind_marker=function(b){var f=function(){b.clicked||(h=window.setTimeout(function(){c.hide_tooltips()},200))},j=function(j){var k=i(b.data);if(!k)return;e&&d.length>0&&(c.hide_tooltips(),h&&window.clearTimeout(h));var l=document.createElement("div");l.className="wax-movetip",l.style.width="100%";var m=l.appendChild(document.createElement("div"));m.style.cssText="position: absolute; pointer-events: none;";var n=m.appendChild(document.createElement("div"));n.className="wax-intip",n.style.cssText="pointer-events: auto;",typeof k=="string"?n.innerHTML=k:n.appendChild(k),m.style.bottom=b.element.offsetHeight/2+20+"px",g&&(l.onmouseover=function(){h&&window.clearTimeout(h)},l.onmouseout=f);var o={element:l,data:{},interactive:!1,location:b.location.copy()};d.push(o),a.add(o),a.draw()};b.element.onclick=b.element.ontouchstart=function(){j(),b.clicked=!0},g&&(b.element.onmouseover=j,b.element.onmouseout=f)};if(a){a.addCallback("drawn",b),a.removeCallback("drawn",b);var j=a.markers();for(var k=0;k<j.length;k++)c.bind_marker(j[k]);a.addCallback("markeradded",function(a,b){b.interactive!==!1&&c.bind_marker(b)})}return c}function mmg_csv(a){function b(a){var b;return c(a,function(a,c){if(c){var d={},e=-1,f=b.length;while(++e<f)d[b[e]]=a[e];return d}return b=a,null})}function c(a,b){function c(){if(g.lastIndex>=a.length)return e;if(j)return j=!1,d;var b=g.lastIndex;if(a.charCodeAt(b)===34){var c=b;while(c++<a.length)if(a.charCodeAt(c)===34){if(a.charCodeAt(c+1)!==34)break;c++}g.lastIndex=c+2;var f=a.charCodeAt(c+1);return f===13?(j=!0,a.charCodeAt(c+2)===10&&g.lastIndex++):f===10&&(j=!0),a.substring(b+1,c).replace(/""/g,'"')}var h=g.exec(a);return h?(j=h[0].charCodeAt(0)!==44,a.substring(b,h.index)):(g.lastIndex=a.length,a.substring(b))}var d={},e={},f=[],g=/\r\n|[,\r\n]/g,h=0,i,j;g.lastIndex=0;while((i=c())!==e){var k=[];while(i!==d&&i!==e)k.push(i),i=c();if(b&&!(k=b(k,h++)))continue;f.push(k)}return f}var d=[],e=b(a);if(!e.length)return callback(d);var f="",g="";for(var h in e[0])h.match(/^Lat/i)&&(f=h),h.match(/^Lon/i)&&(g=h);if(!f||!g)throw"CSV: Could not find latitude or longitude field";for(var i=0;i<e.length;i++)e[i][g]!==undefined&&e[i][g]!==undefined&&d.push({type:"Feature",properties:e[i],geometry:{type:"Point",coordinates:[parseFloat(e[i][g]),parseFloat(e[i][f])]}});return d}function mmg_csv_url(a,b){function c(a){return b(mmg_csv(a.responseText))}if(typeof reqwest=="undefined")throw"CSV: reqwest required for mmg_csv_url";reqwest({url:a,type:"string",success:c,error:c})}function simplestyle_factory(a){var b={small:[20,50],medium:[30,70],large:[35,90]},c=a.properties||{},d=c["marker-size"]||"medium",e=c["marker-symbol"]?"-"+c["marker-symbol"]:"",f=c["marker-color"]||"7e7e7e";f=f.replace("#","");var g=document.createElement("img");g.width=b[d][0],g.height=b[d][1],g.className="simplestyle-marker",g.alt=c.title||"",g.src=(simplestyle_factory.baseurl||"http://a.tiles.mapbox.com/v3/marker/")+"pin-"+d.charAt(0)+e+"+"+f+".png";var h=g.style;return h.position="absolute",h.clip="rect(auto auto "+b[d][1]*.75+"px auto)",h.marginTop=-(b[d][1]/2)+"px",h.marginLeft=-(b[d][0]/2)+"px",h.cursor="pointer",g}!function(a,b,c){typeof module!="undefined"?module.exports=c(a,b):typeof define=="function"&&typeof define.amd=="object"?define(c):b[a]=c(a,b)}("bean",this,function(a,b){var c=window,d=b[a],e=/over|out/,f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="attachEvent",j="removeEventListener",k="detachEvent",l="ownerDocument",m="target",n="querySelectorAll",o=document||{},p=o.documentElement||{},q=p[h],r=q?h:i,s=Array.prototype.slice,t=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,u=/mouse.*(wheel|scroll)/i,v=/^text/i,w=/^touch|^gesture/i,x={},y=function(a,b,c){for(c=0;c<b.length;c++)a[b[c]]=1;return a}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange message error abort scroll "+(q?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),z=function(){function a(a){var b=a.relatedTarget;return b?b!==this&&b.prefix!=="xul"&&!/document/.test(this.toString())&&!c(b,this):b===null}var b="compareDocumentPosition",c=b in p?function(a,c){return c[b]&&(c[b](a)&16)===16}:"contains"in p?function(a,b){return b=b.nodeType===9||b===window?p:b,b!==a&&b.contains(a)}:function(a,b){while(a=a.parentNode)if(a===b)return 1;return 0};return{mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),A=function(){var a="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),b=a.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),c=b.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),d=a.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),f=a.concat(["data"]),g=a.concat("touches targetTouches changedTouches scale rotation".split(" ")),h=a.concat(["data","origin","source"]),i="preventDefault",j=function(a){return function(){a[i]?a[i]():a.returnValue=!1}},k="stopPropagation",l=function(a){return function(){a[k]?a[k]():a.cancelBubble=!0}},n=function(a){return function(){a[i](),a[k](),a.stopped=!0}},q=function(a,b,c){var d,e;for(d=c.length;d--;)e=c[d],!(e in b)&&e in a&&(b[e]=a[e])};return function(r,s){var x={originalEvent:r,isNative:s};if(!r)return x;var y,z=r.type,A=r[m]||r.srcElement;x[i]=j(r),x[k]=l(r),x.stop=n(x),x[m]=A&&A.nodeType===3?A.parentNode:A;if(s){if(z.indexOf("key")!==-1)y=d,x.keyCode=r.keyCode||r.which;else if(t.test(z)){y=b,x.rightClick=r.which===3||r.button===2,x.pos={x:0,y:0};if(r.pageX||r.pageY)x.clientX=r.pageX,x.clientY=r.pageY;else if(r.clientX||r.clientY)x.clientX=r.clientX+o.body.scrollLeft+p.scrollLeft,x.clientY=r.clientY+o.body.scrollTop+p.scrollTop;e.test(z)&&(x.relatedTarget=r.relatedTarget||r[(z==="mouseover"?"from":"to")+"Element"])}else w.test(z)?y=g:u.test(z)?y=c:v.test(z)?y=f:z==="message"&&(y=h);q(r,x,y||a)}return x}}(),B=function(a,b){return!q&&!b&&(a===o||a===c)?p:a},C=function(){function a(a,b,c,d,e){var f=this.isNative=y[b]&&a[r];this.element=a,this.type=b,this.handler=c,this.original=d,this.namespaces=e,this.custom=z[b],this.eventType=q||f?b:"propertychange",this.customType=!q&&!f&&b,this[m]=B(a,f),this[r]=this[m][r]}return a.prototype={inNamespaces:function(a){var b,c;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)if(a[b]===this.namespaces[c])return!0;return!1},matches:function(a,b,c){return this.element===a&&(!b||this.original===b)&&(!c||this.handler===c)}},a}(),D=function(){var a={},b=function(c,d,e,f,g){if(!d||d==="*")for(var h in a)h.charAt(0)==="$"&&b(c,h.substr(1),e,f,g);else{var i=0,j,k=a["$"+d],l=c==="*";if(!k)return;for(j=k.length;i<j;i++)if(l||k[i].matches(c,e,f))if(!g(k[i],k,i,d))return}},c=function(b,c,d){var e,f=a["$"+c];if(f)for(e=f.length;e--;)if(f[e].matches(b,d,null))return!0;return!1},d=function(a,c,d){var e=[];return b(a,c,d,null,function(a){return e.push(a)}),e},e=function(b){return(a["$"+b.type]||(a["$"+b.type]=[])).push(b),b},f=function(c){b(c.element,c.type,null,c.handler,function(b,c,d){return c.splice(d,1),c.length===0&&delete a["$"+b.type],!1})},g=function(){var b,c=[];for(b in a)b.charAt(0)==="$"&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),E=o[n]?function(a,b){return b[n](a)}:function(){throw new Error("Bean: No selector engine installed")},F=function(a){E=a},G=q?function(a,b,c,d){a[d?h:j](b,c,!1)}:function(a,b,c,d,e){e&&d&&a["_on"+e]===null&&(a["_on"+e]=0),a[d?i:k]("on"+b,c)},H=function(a,b,d){var e=b.__beanDel,f=function(f){return f=A(f||((this[l]||this.document||this).parentWindow||c).event,!0),e&&(f.currentTarget=e.ft(f[m],a)),b.apply(a,[f].concat(d))};return f.__beanDel=e,f},I=function(a,b,d,e,f,g){var h=b.__beanDel,i=function(i){var j=h?h.ft(i[m],a):this;if(e?e.apply(j,arguments):q?!0:i&&i.propertyName==="_on"+d||!i)i&&(i=A(i||((this[l]||this.document||this).parentWindow||c).event,g),i.currentTarget=j),b.apply(a,i&&(!f||f.length===0)?arguments:s.call(arguments,i?0:1).concat(f))};return i.__beanDel=h,i},J=function(a,b,c,d,e){return function(){a(b,c,e),d.apply(this,arguments)}},K=function(a,b,c,d){var e,f,h,i=b&&b.replace(g,""),j=D.get(a,i,c);for(e=0,f=j.length;e<f;e++)j[e].inNamespaces(d)&&((h=j[e])[r]&&G(h[m],h.eventType,h.handler,!1,h.type),D.del(h))},L=function(a,b,c,d,e){var h,i=b.replace(g,""),j=b.replace(f,"").split(".");if(D.has(a,i,c))return a;i==="unload"&&(c=J(K,a,i,c,d)),z[i]&&(z[i].condition&&(c=I(a,c,i,z[i].condition,e,!0)),i=z[i].base||i),h=D.put(new C(a,i,c,d,j[0]&&j)),h.handler=h.isNative?H(a,h.handler,e):I(a,h.handler,i,!1,e,!1),h[r]&&G(h[m],h.eventType,h.handler,!0,h.customType)},M=function(a,b,c){var d=function(b,d){var e,f=typeof a=="string"?c(a,d):a;for(;b&&b!==d;b=b.parentNode)for(e=f.length;e--;)if(f[e]===b)return b},e=function(a){var c=d(a[m],this);c&&b.apply(c,arguments)};return e.__beanDel={ft:d,selector:a,$:c},e},N=function(a,b,c){var d,e,h,i,j=K,k=b&&typeof b=="string";if(k&&b.indexOf(" ")>0){b=b.split(" ");for(i=b.length;i--;)N(a,b[i],c);return a}e=k&&b.replace(g,""),e&&z[e]&&(e=z[e].type);if(!b||k){if(h=k&&b.replace(f,""))h=h.split(".");j(a,e,c,h)}else if(typeof b=="function")j(a,null,b);else for(d in b)b.hasOwnProperty(d)&&N(a,d,b[d]);return a},O=function(a,b,c,d,e){var f,g,h,i,j=c,k=c&&typeof c=="string";if(b&&!c&&typeof b=="object")for(f in b)b.hasOwnProperty(f)&&O.apply(this,[a,f,b[f]]);else{i=arguments.length>3?s.call(arguments,3):[],g=(k?c:b).split(" "),k&&(c=M(b,j=d,e||E))&&(i=s.call(i,1)),this===x&&(c=J(N,a,b,c,j));for(h=g.length;h--;)L(a,g[h],c,j,i)}return a},P=function(){return O.apply(x,arguments)},Q=q?function(a,b,d){var e=o.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,c,1),d.dispatchEvent(e)}:function(a,b,c){c=B(c,a),a?c.fireEvent("on"+b,o.createEventObject()):c["_on"+b]++},R=function(a,b,c){var d,e,h,i,j,k=b.split(" ");for(d=k.length;d--;){b=k[d].replace(g,"");if(i=k[d].replace(f,""))i=i.split(".");if(!i&&!c&&a[r])Q(y[b],b,a);else{j=D.get(a,b),c=[!1].concat(c);for(e=0,h=j.length;e<h;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c)}}return a},S=function(a,b,c){var d=0,e=D.get(b,c),f=e.length,g,h;for(;d<f;d++)e[d].original&&(h=e[d].handler.__beanDel,h?g=[a,h.selector,e[d].type,e[d].original,h.$]:g=[a,e[d].type,e[d].original],O.apply(null,g));return a},T={add:O,one:P,remove:N,clone:S,fire:R,setSelectorEngine:F,noConflict:function(){return b[a]=d,this}};if(c[i]){var U=function(){var a,b=D.entries();for(a in b)b[a].type&&b[a].type!=="unload"&&N(b[a].element,b[a].type);c[k]("onunload",U),c.CollectGarbage&&c.CollectGarbage()};c[i]("onunload",U)}return T});var Mustache=typeof module!="undefined"&&module.exports||{};(function(a){function h(a,b){return RegExp.prototype.test.call(a,b)}function i(a){return!h(d,a)}function l(a){var b=a.replace(k,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});return'"'+b+'"'}function m(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function o(a){return String(a).replace(/[&<>"'\/]/g,function(a){return n[a]})}function p(a){this.string=a,this.tail=a,this.pos=0}function q(a,b){this.view=a,this.parent=b,this.clearCache()}function r(){this.clearCache()}function s(a,b){typeof a=="string"&&(a=w(a));var c=['""'],d,e,f;for(var g=0,h=a.length;g<h;++g){d=a[g];switch(d.type){case"#":case"^":e=d.type==="#"?"_section":"_inverted",c.push("r."+e+"("+l(d.value)+", c, function (c, r) {\n"+"  "+s(d.tokens,!0)+"\n"+"})");break;case"{":case"&":case"name":f=d.type==="name"?"true":"false",c.push("r._name("+l(d.value)+", c, "+f+")");break;case">":c.push("r._partial("+l(d.value)+", c)");break;case"text":c.push(l(d.value))}}return c="return "+c.join(" + ")+";",b?c:new Function("c, r",c)}function t(a){if(a.length===2)return[new RegExp(m(a[0])+"\\s*"),new RegExp("\\s*"+m(a[1]))];throw new Error("Invalid tags: "+a.join(" "))}function u(a){var b=[],c=b,d=[],e,f;for(var g=0;g<a.length;++g){e=a[g];switch(e.type){case"#":case"^":e.tokens=[],d.push(e),c.push(e),c=e.tokens;break;case"/":if(d.length===0)throw new Error("Unopened section: "+e.value);f=d.pop();if(f.value!==e.value)throw new Error("Unclosed section: "+f.value);d.length>0?c=d[d.length-1].tokens:c=b;break;default:c.push(e)}}f=d.pop();if(f)throw new Error("Unclosed section: "+f.value);return b}function v(a){var b;for(var c=0;c<a.length;++c){var d=a[c];b&&b.type==="text"&&d.type==="text"?(b.value+=d.value,a.splice(c--,1)):b=d}}function w(d,h){h=h||a.tags;var j=t(h),k=new p(d),l=[],n=[],o=!1,q=!1,r=function(){if(o&&!q)while(n.length)l.splice(n.pop(),1);else n=[];o=!1,q=!1},s,w,x;while(!k.eos()){w=k.scanUntil(j[0]);if(w)for(var y=0,z=w.length;y<z;++y)x=w[y],i(x)?n.push(l.length):q=!0,l.push({type:"text",value:x}),x==="\n"&&r();if(!k.scan(j[0]))break;o=!0,s=k.scan(g)||"name",k.scan(b);if(s==="=")w=k.scanUntil(e),k.scan(e),k.scanUntil(j[1]);else if(s==="{"){var A=new RegExp("\\s*"+m("}"+h[1]));w=k.scanUntil(A),k.scan(f),k.scanUntil(j[1])}else w=k.scanUntil(j[1]);if(!k.scan(j[1]))throw new Error("Unclosed tag at "+k.pos);l.push({type:s,value:w});if(s==="name"||s==="{"||s==="&")q=!0;s==="="&&(h=w.split(c),j=t(h))}return v(l),u(l)}function y(){x.clearCache()}function z(a,b){return x.compile(a,b)}function A(a,b,c){return x.compilePartial(a,b,c)}function B(a,b,c){if(c)for(var d in c)A(d,c[d]);return x.render(a,b)}a.name="mustache.js",a.version="0.5.1-dev",a.tags=["{{","}}"],a.parse=w,a.clearCache=y,a.compile=z,a.compilePartial=A,a.render=B,a.Scanner=p,a.Context=q,a.Renderer=r,a.to_html=function(a,b,c,d){var e=B(a,b,c);if(typeof d!="function")return e;d(e)};var b=/\s*/,c=/\s+/,d=/\S/,e=/\s*=/,f=/\s*\}/,g=/#|\^|\/|>|\{|&|=|!/,j=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},k=/[\x00-\x2F\x3A-\x40\x5B-\x60\x7B-\xFF\u2028\u2029]/gm,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};a.isWhitespace=i,a.isArray=j,a.quote=l,a.escapeRe=m,a.escapeHtml=o,p.prototype.eos=function(){return this.tail===""},p.prototype.scan=function(a){var b=this.tail.match(a);return b&&b.index===0?(this.tail=this.tail.substring(b[0].length),this.pos+=b[0].length,b[0]):null},p.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:b=null;break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c}return b},q.make=function(a){return a instanceof q?a:new q(a)},q.prototype.clearCache=function(){this._cache={}},q.prototype.push=function(a){return new q(a,this)},q.prototype.lookup=function(a){var b=this._cache[a];if(!b){if(a===".")b=this.view;else{var c=this;while(c){if(a.indexOf(".")>0){var d=a.split("."),e=0;b=c.view;while(b&&e<d.length)b=b[d[e++]]}else b=c.view[a];if(b!=null)break;c=c.parent}}this._cache[a]=b}return typeof b=="function"&&(b=b.call(this.view)),b},r.prototype.clearCache=function(){this._cache={},this._partialCache={}},r.prototype.compile=function(a,b){var c=s(a),d=this;return function(a){return c(q.make(a),d)}},r.prototype.compilePartial=function(a,b,c){return this._partialCache[a]=this.compile(b,c),this._partialCache[a]},r.prototype.render=function(a,b){var c=this._cache[a];return c||(c=this.compile(a),this._cache[a]=c),c(b)},r.prototype._section=function(a,b,c){var d=b.lookup(a);switch(typeof d){case"object":if(j(d)){var e="";for(var f=0,g=d.length;f<g;++f)e+=c(b.push(d[f]),this);return e}return c(b.push(d),this);case"function":var h=c(b,this),i=this,k=function(a){return i.render(a,b)};return d.call(b.view,h,k)||"";default:if(d)return c(b,this)}return""},r.prototype._inverted=function(a,b,c){var d=b.lookup(a);return d==null||d===!1||j(d)&&d.length===0?c(b,this):""},r.prototype._partial=function(a,b){var c=this._partialCache[a];return c?c(b,this):""},r.prototype._name=function(a,b,c){var d=b.lookup(a);typeof d=="function"&&(d=d.call(b.view));var e=d==null?"":String(d);return c?o(e):e};var x=new r})(Mustache),!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&define.amd?define(a,b):this[a]=b()}("reqwest",function(){function handleReadyState(a,b,c){return function(){a&&a[readyState]==4&&(twoHundo.test(a.status)?b(a):c(a))}}function setHeaders(a,b){var c=b.headers||{},d;c.Accept=c.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],!b.crossOrigin&&!c[requestedWith]&&(c[requestedWith]=defaultHeaders.requestedWith),c[contentType]||(c[contentType]=b.contentType||defaultHeaders.contentType);for(d in c)c.hasOwnProperty(d)&&a.setRequestHeader(d,c[d])}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||"reqwest_"+e,h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0;i?i[3]==="?"?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,typeof j.onreadystatechange!="undefined"&&(j.event="onclick",j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){if(j[readyState]&&j[readyState]!=="complete"&&j[readyState]!=="loaded"||k)return!1;j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),a.success&&a.success(lastValue),lastValue=undefined,head.removeChild(j),k=1},head.appendChild(j)}function getRequest(a,b,c){var d=(a.method||"GET").toUpperCase(),e=typeof a=="string"?a:a.url,f=a.processData!==!1&&a.data&&typeof a.data!="string"?reqwest.toQueryString(a.data):a.data||null,g;return(a.type=="jsonp"||d=="GET")&&f&&(e=urlappend(e,f),f=null),a.type=="jsonp"?handleJsonp(a,b,c,e):(g=xhr(),g.open(d,e,!0),setHeaders(g,a),g.onreadystatechange=handleReadyState(g,b,c),a.before&&a.before(g),g.send(f),g)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){var b=a.match(/\.(json|jsonp|html|xml)(\?|$)/);return b?b[1]:"js"}function init(o,fn){function complete(a){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(a)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(a,b,c){o.error&&o.error(a,b,c),complete(a)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c=a.name,d=a.tagName.toLowerCase(),e=function(a){a&&!a.disabled&&b(c,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(a.disabled||!c)return;switch(d){case"input":if(!/reset|button|image|file/i.test(a.type)){var f=/checkbox/i.test(a.type),g=/radio/i.test(a.type),h=a.value;(!f&&!g||a.checked)&&b(c,normalize(f&&h===""?"on":h))}break;case"textarea":b(c,normalize(a.value));break;case"select":if(a.type.toLowerCase()==="select-one")e(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(var i=0;a.length&&i<a.length;i++)a.options[i].selected&&e(a.options[i])}}function eachFormElement(){var a=this,b,c,d,e=function(b,c){for(var e=0;e<c.length;e++){var f=b[byTag](c[e]);for(d=0;d<f.length;d++)serial(f[d],a)}};for(c=0;c<arguments.length;c++)b=arguments[c],/input|select|textarea/i.test(b.tagName)&&serial(b,a),e(b,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(arguments.length===0)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),a=="map"?b=serializeHash:a=="array"?b=reqwest.serializeArray:b=serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a){var b="",c,d=encodeURIComponent,e=function(a,c){b+=d(a)+"="+d(c)+"&"};if(isArray(a))for(c=0;a&&c<a.length;c++)e(a[c].name,a[c].value);else for(var f in a){if(!Object.hasOwnProperty.call(a,f))continue;var g=a[f];if(isArray(g))for(c=0;c<g.length;c++)e(f,g[c]);else e(f,a[f])}return b.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest});var previousMM=MM;if(!com){var com={};com.modestmaps||(com.modestmaps={})}var MM=com.modestmaps={noConflict:function(){return MM=previousMM,this}};(function(a){a.extend=function(a,b){for(var c in b.prototype)typeof a.prototype[c]=="undefined"&&(a.prototype[c]=b.prototype[c]);return a},a.getFrame=function(){return function(a){(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(+(new Date))},10)})(a)}}(),a.transformProperty=function(a){if(!this.document)return;var b=document.documentElement.style;for(var c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1}(["transformProperty","WebkitTransform","OTransform","MozTransform","msTransform"]),a.matrixString=function(b){b.scale*b.width%1&&(b.scale+=(1-b.scale*b.width%1)/b.width);var c=b.scale||1;return a._browser.webkit3d?"translate3d("+b.x.toFixed(0)+"px,"+b.y.toFixed(0)+"px, 0px)scale3d("+c+","+c+", 1)":"translate("+b.x.toFixed(6)+"px,"+b.y.toFixed(6)+"px)scale("+c+","+c+")"},a._browser=function(a){return{webkit:"WebKitCSSMatrix"in a,webkit3d:"WebKitCSSMatrix"in a&&"m11"in new WebKitCSSMatrix}}(this),a.moveElement=function(b,c){if(a.transformProperty){c.scale||(c.scale=1),c.width||(c.width=0),c.height||(c.height=0);var d=a.matrixString(c);b[a.transformProperty]!==d&&(b.style[a.transformProperty]=b[a.transformProperty]=d)}else b.style.left=c.x+"px",b.style.top=c.y+"px",c.width&&c.height&&c.scale&&(b.style.width=Math.ceil(c.width*c.scale)+"px",b.style.height=Math.ceil(c.height*c.scale)+"px")},a.cancelEvent=function(a){return a.cancelBubble=!0,a.cancel=!0,a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),!1},a.coerceLayer=function(b){return typeof b=="string"?new a.Layer(new a.TemplatedLayer(b)):"draw"in b&&typeof b.draw=="function"?b:new a.Layer(b)},a.addEvent=function(a,b,c){a.addEventListener?(a.addEventListener(b,c,!1),b=="mousewheel"&&a.addEventListener("DOMMouseScroll",c,!1)):a.attachEvent&&(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c]))},a.removeEvent=function(a,b,c){a.removeEventListener?(a.removeEventListener(b,c,!1),b=="mousewheel"&&a.removeEventListener("DOMMouseScroll",c,!1)):a.detachEvent&&(a.detachEvent("on"+b,a[b+c]),a[b+c]=null)},a.getStyle=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)},a.Point=function(a,b){this.x=parseFloat(a),this.y=parseFloat(b)},a.Point.prototype={x:0,y:0,toString:function(){return"("+this.x.toFixed(3)+", "+this.y.toFixed(3)+")"},copy:function(){return new a.Point(this.x,this.y)}},a.Point.distance=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},a.Point.interpolate=function(b,c,d){return new a.Point(b.x+(c.x-b.x)*d,b.y+(c.y-b.y)*d)},a.Coordinate=function(a,b,c){this.row=a,this.column=b,this.zoom=c},a.Coordinate.prototype={row:0,column:0,zoom:0,toString:function(){return"("+this.row.toFixed(3)+", "+this.column.toFixed(3)+" @"+this.zoom.toFixed(3)+")"},toKey:function(){return this.zoom+","+this.row+","+this.column},copy:function(){return new a.Coordinate(this.row,this.column,this.zoom)},container:function(){return new a.Coordinate(Math.floor(this.row),Math.floor(this.column),Math.floor(this.zoom))},zoomTo:function(b){var c=Math.pow(2,b-this.zoom);return new a.Coordinate(this.row*c,this.column*c,b)},zoomBy:function(b){var c=Math.pow(2,b);return new a.Coordinate(this.row*c,this.column*c,this.zoom+b)},up:function(b){return b===undefined&&(b=1),new a.Coordinate(this.row-b,this.column,this.zoom)},right:function(b){return b===undefined&&(b=1),new a.Coordinate(this.row,this.column+b,this.zoom)},down:function(b){return b===undefined&&(b=1),new a.Coordinate(this.row+b,this.column,this.zoom)},left:function(b){return b===undefined&&(b=1),new a.Coordinate(this.row,this.column-b,this.zoom)}},a.Location=function(a,b){this.lat=parseFloat(a),this.lon=parseFloat(b)},a.Location.prototype={lat:0,lon:0,toString:function(){return"("+this.lat.toFixed(3)+", "+this.lon.toFixed(3)+")"},copy:function(){return new a.Location(this.lat,this.lon)}},a.Location.distance=function(a,b,c){c||(c=6378e3);var d=Math.PI/180,e=a.lat*d,f=a.lon*d,g=b.lat*d,h=b.lon*d,i=Math.cos(e)*Math.cos(f)*Math.cos(g)*Math.cos(h),j=Math.cos(e)*Math.sin(f)*Math.cos(g)*Math.sin(h),k=Math.sin(e)*Math.sin(g);return Math.acos(i+j+k)*c},a.Location.interpolate=function(b,c,d){if(b.lat===c.lat&&b.lon===c.lon)return new a.Location(b.lat,b.lon);var e=Math.PI/180,f=b.lat*e,g=b.lon*e,h=c.lat*e,i=c.lon*e,j=2*Math.asin(Math.sqrt(Math.pow(Math.sin((f-h)/2),2)+Math.cos(f)*Math.cos(h)*Math.pow(Math.sin((g-i)/2),2))),k=Math.sin((1-d)*j)/Math.sin(j),l=Math.sin(d*j)/Math.sin(j),m=k*Math.cos(f)*Math.cos(g)+l*Math.cos(h)*Math.cos(i),n=k*Math.cos(f)*Math.sin(g)+l*Math.cos(h)*Math.sin(i),o=k*Math.sin(f)+l*Math.sin(h),p=Math.atan2(o,Math.sqrt(Math.pow(m,2)+Math.pow(n,2))),q=Math.atan2(n,m);return new a.Location(p/e,q/e)},a.Location.bearing=function(a,b){var c=Math.PI/180,d=a.lat*c,e=a.lon*c,f=b.lat*c,g=b.lon*c,h=Math.atan2(Math.sin(e-g)*Math.cos(f),Math.cos(d)*Math.sin(f)-Math.sin(d)*Math.cos(f)*Math.cos(e-g))/-(Math.PI/180);return h<0?h+360:h},a.Extent=function(b,c,d,e){if(b instanceof a.Location&&c instanceof a.Location){var f=b,g=c;b=f.lat,c=f.lon,d=g.lat,e=g.lon}isNaN(d)&&(d=b),isNaN(e)&&(e=c),this.north=Math.max(b,d),this.south=Math.min(b,d),this.east=Math.max(e,c),this.west=Math.min(e,c)},a.Extent.prototype={north:0,south:0,east:0,west:0,copy:function(){return new a.Extent(this.north,this.west,this.south,this.east)},toString:function(a){return isNaN(a)&&(a=3),[this.north.toFixed(a),this.west.toFixed(a),this.south.toFixed(a),this.east.toFixed(a)].join(", ")},northWest:function(
){return new a.Location(this.north,this.west)},southEast:function(){return new a.Location(this.south,this.east)},northEast:function(){return new a.Location(this.north,this.east)},southWest:function(){return new a.Location(this.south,this.west)},center:function(){return new a.Location(this.south+(this.north-this.south)/2,this.east+(this.west-this.east)/2)},encloseLocation:function(a){a.lat>this.north&&(this.north=a.lat),a.lat<this.south&&(this.south=a.lat),a.lon>this.east&&(this.east=a.lon),a.lon<this.west&&(this.west=a.lon)},encloseLocations:function(a){var b=a.length;for(var c=0;c<b;c++)this.encloseLocation(a[c])},setFromLocations:function(a){var b=a.length,c=a[0];this.north=this.south=c.lat,this.east=this.west=c.lon;for(var d=1;d<b;d++)this.encloseLocation(a[d])},encloseExtent:function(a){a.north>this.north&&(this.north=a.north),a.south<this.south&&(this.south=a.south),a.east>this.east&&(this.east=a.east),a.west<this.west&&(this.west=a.west)},containsLocation:function(a){return a.lat>=this.south&&a.lat<=this.north&&a.lon>=this.west&&a.lon<=this.east},toArray:function(){return[this.northWest(),this.southEast()]}},a.Extent.fromString=function(b){var c=b.split(/\s*,\s*/);if(c.length!=4)throw"Invalid extent string (expecting 4 comma-separated numbers)";return new a.Extent(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]))},a.Extent.fromArray=function(b){var c=new a.Extent;return c.setFromLocations(b),c},a.Transformation=function(a,b,c,d,e,f){this.ax=a,this.bx=b,this.cx=c,this.ay=d,this.by=e,this.cy=f},a.Transformation.prototype={ax:0,bx:0,cx:0,ay:0,by:0,cy:0,transform:function(b){return new a.Point(this.ax*b.x+this.bx*b.y+this.cx,this.ay*b.x+this.by*b.y+this.cy)},untransform:function(b){return new a.Point((b.x*this.by-b.y*this.bx-this.cx*this.by+this.cy*this.bx)/(this.ax*this.by-this.ay*this.bx),(b.x*this.ay-b.y*this.ax-this.cx*this.ay+this.cy*this.ax)/(this.bx*this.ay-this.by*this.ax))}},a.deriveTransformation=function(b,c,d,e,f,g,h,i,j,k,l,m){var n=a.linearSolution(b,c,d,f,g,h,j,k,l),o=a.linearSolution(b,c,e,f,g,i,j,k,m);return new a.Transformation(n[0],n[1],n[2],o[0],o[1],o[2])},a.linearSolution=function(a,b,c,d,e,f,g,h,i){a=parseFloat(a),b=parseFloat(b),c=parseFloat(c),d=parseFloat(d),e=parseFloat(e),f=parseFloat(f),g=parseFloat(g),h=parseFloat(h),i=parseFloat(i);var j=((f-i)*(b-e)-(c-f)*(e-h))/((d-g)*(b-e)-(a-d)*(e-h)),k=((f-i)*(a-d)-(c-f)*(d-g))/((e-h)*(a-d)-(b-e)*(d-g)),l=c-a*j-b*k;return[j,k,l]},a.Projection=function(b,c){c||(c=new a.Transformation(1,0,0,0,1,0)),this.zoom=b,this.transformation=c},a.Projection.prototype={zoom:0,transformation:null,rawProject:function(a){throw"Abstract method not implemented by subclass."},rawUnproject:function(a){throw"Abstract method not implemented by subclass."},project:function(a){return a=this.rawProject(a),this.transformation&&(a=this.transformation.transform(a)),a},unproject:function(a){return this.transformation&&(a=this.transformation.untransform(a)),a=this.rawUnproject(a),a},locationCoordinate:function(b){var c=new a.Point(Math.PI*b.lon/180,Math.PI*b.lat/180);return c=this.project(c),new a.Coordinate(c.y,c.x,this.zoom)},coordinateLocation:function(b){b=b.zoomTo(this.zoom);var c=new a.Point(b.column,b.row);return c=this.unproject(c),new a.Location(180*c.y/Math.PI,180*c.x/Math.PI)}},a.LinearProjection=function(b,c){a.Projection.call(this,b,c)},a.LinearProjection.prototype={rawProject:function(b){return new a.Point(b.x,b.y)},rawUnproject:function(b){return new a.Point(b.x,b.y)}},a.extend(a.LinearProjection,a.Projection),a.MercatorProjection=function(b,c){a.Projection.call(this,b,c)},a.MercatorProjection.prototype={rawProject:function(b){return new a.Point(b.x,Math.log(Math.tan(.25*Math.PI+.5*b.y)))},rawUnproject:function(b){return new a.Point(b.x,2*Math.atan(Math.pow(Math.E,b.y))-.5*Math.PI)}},a.extend(a.MercatorProjection,a.Projection),a.MapProvider=function(a){a&&(this.getTile=a)},a.MapProvider.prototype={tileLimits:[new a.Coordinate(0,0,0),(new a.Coordinate(1,1,0)).zoomTo(18)],getTileUrl:function(a){throw"Abstract method not implemented by subclass."},getTile:function(a){throw"Abstract method not implemented by subclass."},releaseTile:function(a){},setZoomRange:function(a,b){this.tileLimits[0]=this.tileLimits[0].zoomTo(a),this.tileLimits[1]=this.tileLimits[1].zoomTo(b)},sourceCoordinate:function(b){var c=this.tileLimits[0].zoomTo(b.zoom),d=this.tileLimits[1].zoomTo(b.zoom),e=Math.pow(2,b.zoom),f;return b.column<0?f=(b.column%e+e)%e:f=b.column%e,b.row<c.row||b.row>=d.row?null:f<c.column||f>=d.column?null:new a.Coordinate(b.row,f,b.zoom)}},a.Template=function(b,c){function f(a,b,c){var d="";for(var e=1;e<=c;e++)d+=(a>>c-e&1)<<1|b>>c-e&1;return d||"0"}var d=b.match(/{(Q|quadkey)}/);d&&(b=b.replace("{subdomains}","{S}").replace("{zoom}","{Z}").replace("{quadkey}","{Q}"));var e=c&&c.length&&b.indexOf("{S}")>=0,g=function(a){var g=this.sourceCoordinate(a);if(!g)return null;var h=b;if(e){var i=parseInt(g.zoom+g.row+g.column,10)%c.length;h=h.replace("{S}",c[i])}return d?h.replace("{Z}",g.zoom.toFixed(0)).replace("{Q}",f(g.row,g.column,g.zoom)):h.replace("{Z}",g.zoom.toFixed(0)).replace("{X}",g.column.toFixed(0)).replace("{Y}",g.row.toFixed(0))};a.MapProvider.call(this,g)},a.Template.prototype={getTile:function(a){return this.getTileUrl(a)}},a.extend(a.Template,a.MapProvider),a.TemplatedLayer=function(b,c){return new a.Layer(new a.Template(b,c))},a.getMousePoint=function(b,c){var d=new a.Point(b.clientX,b.clientY);d.x+=document.body.scrollLeft+document.documentElement.scrollLeft,d.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var e=c.parent;e;e=e.offsetParent)d.x-=e.offsetLeft,d.y-=e.offsetTop;return d},a.MouseWheelHandler=function(){function g(b){var g=0;e=e||(new Date).getTime();try{d.scrollTop=1e3,d.dispatchEvent(b),g=1e3-d.scrollTop}catch(h){g=b.wheelDelta||-b.detail*5}var i=(new Date).getTime()-e,j=a.getMousePoint(b,c);return Math.abs(g)>0&&i>200&&!f?(c.zoomByAbout(g>0?1:-1,j),e=(new Date).getTime()):f&&c.zoomByAbout(g*.001,j),a.cancelEvent(b)}var b={},c,d,e,f=!1;return b.init=function(e){c=e,d=document.body.appendChild(document.createElement("div")),d.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var f=d.appendChild(document.createElement("div"));return f.style.height="2000px",a.addEvent(c.parent,"mousewheel",g),b},b.precise=function(a){return arguments.length?(f=a,b):f},b.remove=function(){a.removeEvent(c.parent,"mousewheel",g),d.parentNode.removeChild(d)},b},a.DoubleClickHandler=function(){function d(b){var d=a.getMousePoint(b,c);return c.zoomByAbout(b.shiftKey?-1:1,d),a.cancelEvent(b)}var b={},c;return b.init=function(e){return c=e,a.addEvent(c.parent,"dblclick",d),b},b.remove=function(){a.removeEvent(c.parent,"dblclick",d)},b},a.DragHandler=function(){function e(b){if(b.shiftKey||b.button==2)return;return a.addEvent(document,"mouseup",f),a.addEvent(document,"mousemove",g),c=new a.Point(b.clientX,b.clientY),d.parent.style.cursor="move",a.cancelEvent(b)}function f(b){return a.removeEvent(document,"mouseup",f),a.removeEvent(document,"mousemove",g),c=null,d.parent.style.cursor="",a.cancelEvent(b)}function g(b){return c&&(d.panBy(b.clientX-c.x,b.clientY-c.y),c.x=b.clientX,c.y=b.clientY,c.t=+(new Date)),a.cancelEvent(b)}var b={},c,d;return b.init=function(c){return d=c,a.addEvent(d.parent,"mousedown",e),b},b.remove=function(){a.removeEvent(d.parent,"mousedown",e)},b},a.MouseHandler=function(){var b={},c,d;return b.init=function(e){return c=e,d=[a.DragHandler().init(c),a.DoubleClickHandler().init(c),a.MouseWheelHandler().init(c)],b},b.remove=function(){for(var a=0;a<d.length;a++)d[a].remove();return b},b},a.TouchHandler=function(){function l(){var a=document.createElement("div");return a.setAttribute("ongesturestart","return;"),typeof a.ongesturestart=="function"}function m(a){for(var b=0;b<a.touches.length;b+=1){var c=a.touches[b];if(c.identifier in g){var d=g[c.identifier];d.x=c.clientX,d.y=c.clientY,d.scale=a.scale}else g[c.identifier]={scale:a.scale,startPos:{x:c.clientX,y:c.clientY},x:c.clientX,y:c.clientY,time:(new Date).getTime()}}}function n(a,b){return a&&a.touch&&b.identifier==a.touch.identifier}function o(a){m(a)}function p(b){switch(b.touches.length){case 1:u(b.touches[0]);break;case 2:v(b)}return m(b),a.cancelEvent(b)}function q(b){var c=(new Date).getTime();b.touches.length===0&&j&&w(k);for(var f=0;f<b.changedTouches.length;f+=1){var h=b.changedTouches[f],i=g[h.identifier];if(!i||i.wasPinch)continue;var l={x:h.clientX,y:h.clientY},m=c-i.time,n=a.Point.distance(l,i.startPos);n>e||(m>d?(l.end=c,l.duration=m,r(l)):(l.time=c,s(l)))}var o={};for(var p=0;p<b.touches.length;p++)o[b.touches[p].identifier]=!0;for(var q in g)q in o||delete o[q];return a.cancelEvent(b)}function r(a){}function s(a){if(h.length&&a.time-h[0].time<f){t(a),h=[];return}h=[a]}function t(b){var d=c.getZoom(),e=Math.round(d)+1,f=e-d,g=new a.Point(b.x,b.y);c.zoomByAbout(f,g)}function u(a){var b={x:a.clientX,y:a.clientY},d=g[a.identifier];c.panBy(b.x-d.x,b.y-d.y)}function v(b){var d=b.touches[0],e=b.touches[1],f=new a.Point(d.clientX,d.clientY),h=new a.Point(e.clientX,e.clientY),i=g[d.identifier],l=g[e.identifier];i.wasPinch=!0,l.wasPinch=!0;var m=a.Point.interpolate(f,h,.5);c.zoomByAbout(Math.log(b.scale)/Math.LN2-Math.log(i.scale)/Math.LN2,m);var n=a.Point.interpolate(i,l,.5);c.panBy(m.x-n.x,m.y-n.y),j=!0,k=m}function w(a){if(i){var b=c.getZoom(),d=Math.round(b);c.zoomByAbout(d-b,a)}j=!1}var b={},c,d=250,e=30,f=350,g={},h=[],i=!0,j=!1,k=null;return b.init=function(d){return c=d,l()?(a.addEvent(c.parent,"touchstart",o),a.addEvent(c.parent,"touchmove",p),a.addEvent(c.parent,"touchend",q),b):b},b.remove=function(){return l()?(a.removeEvent(c.parent,"touchstart",o),a.removeEvent(c.parent,"touchmove",p),a.removeEvent(c.parent,"touchend",q),b):b},b},a.CallbackManager=function(a,b){this.owner=a,this.callbacks={};for(var c=0;c<b.length;c++)this.callbacks[b[c]]=[]},a.CallbackManager.prototype={owner:null,callbacks:null,addCallback:function(a,b){typeof b=="function"&&this.callbacks[a]&&this.callbacks[a].push(b)},removeCallback:function(a,b){if(typeof b=="function"&&this.callbacks[a]){var c=this.callbacks[a],d=c.length;for(var e=0;e<d;e++)if(c[e]===b){c.splice(e,1);break}}},dispatchCallback:function(a,b){if(this.callbacks[a])for(var c=0;c<this.callbacks[a].length;c+=1)try{this.callbacks[a][c](this.owner,b)}catch(d){}}},a.RequestManager=function(){this.loadingBay=document.createDocumentFragment(),this.requestsById={},this.openRequestCount=0,this.maxOpenRequests=4,this.requestQueue=[],this.callbackManager=new a.CallbackManager(this,["requestcomplete","requesterror"])},a.RequestManager.prototype={loadingBay:null,requestsById:null,requestQueue:null,openRequestCount:null,maxOpenRequests:null,callbackManager:null,addCallback:function(a,b){this.callbackManager.addCallback(a,b)},removeCallback:function(a,b){this.callbackManager.removeCallback(a,b)},dispatchCallback:function(a,b){this.callbackManager.dispatchCallback(a,b)},clear:function(){this.clearExcept({})},clearRequest:function(a){a in this.requestsById&&delete this.requestsById[a];for(var b=0;b<this.requestQueue.length;b++){var c=this.requestQueue[b];c&&c.id==a&&(this.requestQueue[b]=null)}},clearExcept:function(a){for(var b=0;b<this.requestQueue.length;b++){var c=this.requestQueue[b];c&&!(c.id in a)&&(this.requestQueue[b]=null)}var d=this.loadingBay.childNodes;for(var e=d.length-1;e>=0;e--){var f=d[e];f.id in a||(this.loadingBay.removeChild(f),this.openRequestCount--,f.src=f.coord=f.onload=f.onerror=null)}for(var g in this.requestsById)if(!(g in a)&&this.requestsById.hasOwnProperty(g)){var h=this.requestsById[g];delete this.requestsById[g],h!==null&&(h=h.id=h.coord=h.url=null)}},hasRequest:function(a){return a in this.requestsById},requestTile:function(a,b,c){if(!(a in this.requestsById)){var d={id:a,coord:b.copy(),url:c};this.requestsById[a]=d,c&&this.requestQueue.push(d)}},getProcessQueue:function(){if(!this._processQueue){var a=this;this._processQueue=function(){a.processQueue()}}return this._processQueue},processQueue:function(a){a&&this.requestQueue.length>8&&this.requestQueue.sort(a);while(this.openRequestCount<this.maxOpenRequests&&this.requestQueue.length>0){var b=this.requestQueue.pop();if(b){this.openRequestCount++;var c=document.createElement("img");c.id=b.id,c.style.position="absolute",c.coord=b.coord,this.loadingBay.appendChild(c),c.onload=c.onerror=this.getLoadComplete(),c.src=b.url,b=b.id=b.coord=b.url=null}}},_loadComplete:null,getLoadComplete:function(){if(!this._loadComplete){var a=this;this._loadComplete=function(c){c=c||window.event;var d=c.srcElement||c.target;d.onload=d.onerror=null,a.loadingBay.removeChild(d),a.openRequestCount--,delete a.requestsById[d.id],c.type==="load"&&(d.complete||d.readyState&&d.readyState=="complete")?a.dispatchCallback("requestcomplete",d):(a.dispatchCallback("requesterror",{element:d,url:""+d.src}),d.src=null),setTimeout(a.getProcessQueue(),0)}}return this._loadComplete}},a.Layer=function(b,c){this.parent=c||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new a.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),b&&this.setProvider(b)},a.Layer.prototype={map:null,parent:null,tiles:null,levels:null,requestManager:null,provider:null,emptyImage:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",_tileComplete:null,getTileComplete:function(){if(!this._tileComplete){var a=this;this._tileComplete=function(c,d){a.tiles[d.id]=d,a.positionTile(d)}}return this._tileComplete},getTileError:function(){if(!this._tileError){var a=this;this._tileError=function(c,d){d.src=a.emptyImage,a.tiles[d.id]=d,a.positionTile(d)}}return this._tileError},draw:function(){function c(a,c){if(a&&c){var d=a.coord,e=c.coord;if(d.zoom==e.zoom){var f=Math.abs(b.row-d.row-.5)+Math.abs(b.column-d.column-.5),g=Math.abs(b.row-e.row-.5)+Math.abs(b.column-e.column-.5);return f<g?1:f>g?-1:0}return d.zoom<e.zoom?1:d.zoom>e.zoom?-1:0}return a?1:c?-1:0}var b=this.map.coordinate.zoomTo(Math.round(this.map.coordinate.zoom)),d=Math.round(this.map.coordinate.zoom),e=this.map.pointCoordinate(new a.Point(0,0)).zoomTo(d).container(),f=this.map.pointCoordinate(this.map.dimensions).zoomTo(d).container().right().down(),g={},h=this.createOrGetLevel(e.zoom),i=e.copy();for(i.column=e.column;i.column<=f.column;i.column++)for(i.row=e.row;i.row<=f.row;i.row++){var j=this.inventoryVisibleTile(h,i);while(j.length)g[j.pop()]=!0}for(var k in this.levels)if(this.levels.hasOwnProperty(k)){var l=parseInt(k,10);if(l>=e.zoom-5&&l<e.zoom+2)continue;var m=this.levels[k];m.style.display="none";var n=this.tileElementsInLevel(m);while(n.length)this.provider.releaseTile(n[0].coord),this.requestManager.clearRequest(n[0].coord.toKey()),m.removeChild(n[0]),n.shift()}var o=e.zoom-5,p=e.zoom+2;for(var q=o;q<p;q++)this.adjustVisibleLevel(this.levels[q],q,g);this.requestManager.clearExcept(g),this.requestManager.processQueue(c)},inventoryVisibleTile:function(a,b){var c=b.toKey(),d=[c];if(c in this.tiles){var e=this.tiles[c];return e.parentNode!=a&&(a.appendChild(e),"reAddTile"in this.provider&&this.provider.reAddTile(c,b,e)),d}if(!this.requestManager.hasRequest(c)){var f=this.provider.getTile(b);typeof f=="string"?this.addTileImage(c,b,f):f&&this.addTileElement(c,b,f)}var g=!1,h=b.zoom;for(var i=1;i<=h;i++){var j=b.zoomBy(-i).container(),k=j.toKey();if(k in this.tiles){d.push(k),g=!0;break}}if(!g){var l=b.zoomBy(1);d.push(l.toKey()),l.column+=1,d.push(l.toKey()),l.row+=1,d.push(l.toKey()),l.column-=1,d.push(l.toKey())}return d},tileElementsInLevel:function(a){var b=[];for(var c=a.firstChild;c;c=c.nextSibling)c.nodeType==1&&b.push(c);return b},adjustVisibleLevel:function(b,c,d){if(!b)return;var e=1,f=this.map.coordinate.copy();if(!(b.childNodes.length>0))return b.style.display="none",!1;b.style.display="block",e=Math.pow(2,this.map.coordinate.zoom-c),f=f.zoomTo(c);var g=this.map.tileSize.x*e,h=this.map.tileSize.y*e,i=new a.Point(this.map.dimensions.x/2,this.map.dimensions.y/2),j=this.tileElementsInLevel(b);while(j.length){var k=j.pop();d[k.id]?a.moveElement(k,{x:Math.round(i.x+(k.coord.column-f.column)*g),y:Math.round(i.y+(k.coord.row-f.row)*h),scale:e,width:this.map.tileSize.x,height:this.map.tileSize.y}):(this.provider.releaseTile(k.coord),this.requestManager.clearRequest(k.coord.toKey()),b.removeChild(k))}},createOrGetLevel:function(a){if(a in this.levels)return this.levels[a];var b=document.createElement("div");return b.id=this.parent.id+"-zoom-"+a,b.style.cssText=this.parent.style.cssText,b.style.zIndex=a,this.parent.appendChild(b),this.levels[a]=b,b},addTileImage:function(a,b,c){this.requestManager.requestTile(a,b,c)},addTileElement:function(a,b,c){c.id=a,c.coord=b.copy(),this.positionTile(c)},positionTile:function(b){var c=this.map.coordinate.zoomTo(b.coord.zoom);b.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;width:"+this.map.tileSize.x+"px; height: "+this.map.tileSize.y+"px;",b.ondragstart=function(){return!1};var d=Math.pow(2,this.map.coordinate.zoom-b.coord.zoom);a.moveElement(b,{x:Math.round(this.map.dimensions.x/2+(b.coord.column-c.column)*this.map.tileSize.x),y:Math.round(this.map.dimensions.y/2+(b.coord.row-c.row)*this.map.tileSize.y),scale:d,width:this.map.tileSize.x,height:this.map.tileSize.y});var e=this.levels[b.coord.zoom];e.appendChild(b),b.className="map-tile-loaded",Math.round(this.map.coordinate.zoom)==b.coord.zoom&&(e.style.display="block"),this.requestRedraw()},_redrawTimer:undefined,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var a=this;this._redraw=function(){a.draw(),a._redrawTimer=0}}return this._redraw},setProvider:function(a){var b=this.provider===null;if(!b){this.requestManager.clear();for(var c in this.levels)if(this.levels.hasOwnProperty(c)){var d=this.levels[c];while(d.firstChild)this.provider.releaseTile(d.firstChild.coord),d.removeChild(d.firstChild)}}this.tiles={},this.provider=a,b||this.draw()},destroy:function(){this.requestManager.clear(),this.requestManager.removeCallback("requestcomplete",this.getTileComplete()),this.provider=null,this.parent.parentNode&&this.parent.parentNode.removeChild(this.parent),this.map=null}},a.Map=function(b,c,d,e){if(typeof b=="string"){b=document.getElementById(b);if(!b)throw"The ID provided to modest maps could not be found."}this.parent=b,this.parent.style.padding="0",this.parent.style.overflow="hidden";var f=a.getStyle(this.parent,"position");f!="relative"&&f!="absolute"&&(this.parent.style.position="relative"),this.layers=[],c||(c=[]),c instanceof Array||(c=[c]);for(var g=0;g<c.length;g++)this.addLayer(c[g]);this.projection=new a.MercatorProjection(0,a.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1)),this.tileSize=new a.Point(256,256),this.coordLimits=[new a.Coordinate(0,-Infinity,0),(new a.Coordinate(1,Infinity,0)).zoomTo(18)],this.coordinate=new a.Coordinate(.5,.5,0),d?(this.autoSize=!1,this.parent.style.width=Math.round(d.x)+"px",this.parent.style.height=Math.round(d.y)+"px"):(d=new a.Point(this.parent.offsetWidth,this.parent.offsetHeight),this.autoSize=!0,a.addEvent(window,"resize",this.windowResize())),this.dimensions=d,this.callbackManager=new a.CallbackManager(this,["zoomed","panned","centered","extentset","resized","drawn"]);if(e===undefined)this.eventHandlers=[a.MouseHandler().init(this),a.TouchHandler().init(this)];else{this.eventHandlers=e;if(e instanceof Array)for(var h=0;h<e.length;h++)e[h].init(this)}},a.Map.prototype={parent:null,dimensions:null,projection:null,coordinate:null,tileSize:null,coordLimits:null,layers:null,callbackManager:null,eventHandlers:null,autoSize:null,toString:function(){return"Map(#"+this.parent.id+")"},addCallback:function(a,b){return this.callbackManager.addCallback(a,b),this},removeCallback:function(a,b){return this.callbackManager.removeCallback(a,b),this},dispatchCallback:function(a,b){return this.callbackManager.dispatchCallback(a,b),this},windowResize:function(){if(!this._windowResize){var b=this;this._windowResize=function(c){b.dimensions=new a.Point(b.parent.offsetWidth,b.parent.offsetHeight),b.draw(),b.dispatchCallback("resized",[b.dimensions])}}return this._windowResize},setZoomRange:function(a,b){return this.coordLimits[0]=this.coordLimits[0].zoomTo(a),this.coordLimits[1]=this.coordLimits[1].zoomTo(b),this},zoomBy:function(b){return this.coordinate=this.enforceLimits(this.coordinate.zoomBy(b)),a.getFrame(this.getRedraw()),this.dispatchCallback("zoomed",b),this},zoomIn:function(){return this.zoomBy(1)},zoomOut:function(){return this.zoomBy(-1)},setZoom:function(a){return this.zoomBy(a-this.coordinate.zoom)},zoomByAbout:function(a,b){var c=this.pointLocation(b);this.coordinate=this.enforceLimits(this.coordinate.zoomBy(a));var d=this.locationPoint(c);return this.dispatchCallback("zoomed",a),this.panBy(b.x-d.x,b.y-d.y)},panBy:function(b,c){return this.coordinate.column-=b/this.tileSize.x,this.coordinate.row-=c/this.tileSize.y,this.coordinate=this.enforceLimits(this.coordinate),a.getFrame(this.getRedraw()),this.dispatchCallback("panned",[b,c]),this},panLeft:function(){return this.panBy(100,0)},panRight:function(){return this.panBy(-100,0)},panDown:function(){return this.panBy(0,-100)},panUp:function(){return this.panBy(0,100)},setCenter:function(a){return this.setCenterZoom(a,this.coordinate.zoom)},setCenterZoom:function(b,c){return this.coordinate=this.projection.locationCoordinate(b).zoomTo(parseFloat(c)||0),a.getFrame(this.getRedraw()),this.dispatchCallback("centered",[b,c]),this},extentCoordinate:function(b,c){b instanceof a.Extent&&(b=b.toArray());var d,e;for(var f=0;f<b.length;f++){var g=this.projection.locationCoordinate(b[f]);d?(d.row=Math.min(d.row,g.row),d.column=Math.min(d.column,g.column),d.zoom=Math.min(d.zoom,g.zoom),e.row=Math.max(e.row,g.row),e.column=Math.max(e.column,g.column),e.zoom=Math.max(e.zoom,g.zoom)):(d=g.copy(),e=g.copy())}var h=this.dimensions.x+1,i=this.dimensions.y+1,j=(e.column-d.column)/(h/this.tileSize.x),k=Math.log(j)/Math.log(2),l=d.zoom-(c?k:Math.ceil(k)),m=(e.row-d.row)/(i/this.tileSize.y),n=Math.log(m)/Math.log(2),o=d.zoom-(c?n:Math.ceil(n)),p=Math.min(l,o);p=Math.min(p,this.coordLimits[1].zoom),p=Math.max(p,this.coordLimits[0].zoom);var q=(d.row+e.row)/2,r=(d.column+e.column)/2,s=d.zoom;return(new a.Coordinate(q,r,s)).zoomTo(p)},setExtent:function(a,b){return this.coordinate=this.extentCoordinate(a,b),this.draw(),this.dispatchCallback("extentset",a),this},setSize:function(b){return this.dimensions=new a.Point(b.x,b.y),this.parent.style.width=Math.round(this.dimensions.x)+"px",this.parent.style.height=Math.round(this.dimensions.y)+"px",this.autoSize&&(a.removeEvent(window,"resize",this.windowResize()),this.autoSize=!1),this.draw(),this.dispatchCallback("resized",this.dimensions),this},coordinatePoint:function(b){b.zoom!=this.coordinate.zoom&&(b=b.zoomTo(this.coordinate.zoom));var c=new a.Point(this.dimensions.x/2,this.dimensions.y/2);return c.x+=this.tileSize.x*(b.column-this.coordinate.column),c.y+=this.tileSize.y*(b.row-this.coordinate.row),c},pointCoordinate:function(a){var b=this.coordinate.copy();return b.column+=(a.x-this.dimensions.x/2)/this.tileSize.x,b.row+=(a.y-this.dimensions.y/2)/this.tileSize.y,b},locationCoordinate:function(a){return this.projection.locationCoordinate(a)},coordinateLocation:function(a){return this.projection.coordinateLocation(a)},locationPoint:function(a){return this.coordinatePoint(this.locationCoordinate(a))},pointLocation:function(a){return this.coordinateLocation(this.pointCoordinate(a))},getExtent:function(){return new a.Extent(this.pointLocation(new a.Point(0,0)),this.pointLocation(this.dimensions))},extent:function(a,b){return a?this.setExtent(a,b):this.getExtent()},getCenter:function(){return this.projection.coordinateLocation(this.coordinate)},center:function(a){return a?this.setCenter(a):this.getCenter()},getZoom:function(){return this.coordinate.zoom},zoom:function(a){return a!==undefined?this.setZoom(a):this.getZoom()},getLayers:function(){return this.layers.slice()},getLayerAt:function(a){return this.layers[a]},addLayer:function(b){return this.layers.push(b),this.parent.appendChild(b.parent),b.map=this,this.coordinate&&a.getFrame(this.getRedraw()),this},removeLayer:function(a){for(var b=0;b<this.layers.length;b++)if(a==this.layers[b]){this.removeLayerAt(b);break}return this},setLayerAt:function(b,c){if(b<0||b>=this.layers.length)throw new Error("invalid index in setLayerAt(): "+b);if(this.layers[b]!=c){if(b<this.layers.length){var d=this.layers[b];this.parent.insertBefore(c.parent,d.parent),d.destroy()}else this.parent.appendChild(c.parent);this.layers[b]=c,c.map=this,a.getFrame(this.getRedraw())}return this},insertLayerAt:function(b,c){if(b<0||b>this.layers.length)throw new Error("invalid index in insertLayerAt(): "+b);if(b==this.layers.length)this.layers.push(c),this.parent.appendChild(c.parent);else{var d=this.layers[b];this.parent.insertBefore(c.parent,d.parent),this.layers.splice(b,0,c)}return c.map=this,a.getFrame(this.getRedraw()),this},removeLayerAt:function(a){if(a<0||a>=this.layers.length)throw new Error("invalid index in removeLayer(): "+a);var b=this.layers[a];return this.layers.splice(a,1),b.destroy(),this},swapLayersAt:function(a,b){if(a<0||a>=this.layers.length||b<0||b>=this.layers.length)throw new Error("invalid index in swapLayersAt(): "+index);var c=this.layers[a],d=this.layers[b],e=document.createElement("div");return this.parent.replaceChild(e,d.parent),this.parent.replaceChild(d.parent,c.parent),this.parent.replaceChild(c.parent,e),this.layers[a]=d,this.layers[b]=c,this},enforceZoomLimits:function(a){var b=this.coordLimits;if(b){var c=b[0].zoom,d=b[1].zoom;a.zoom<c?a=a.zoomTo(c):a.zoom>d&&(a=a.zoomTo(d))}return a},enforcePanLimits:function(b){if(this.coordLimits){b=b.copy();var c=this.coordLimits[0].zoomTo(b.zoom),d=this.coordLimits[1].zoomTo(b.zoom),e=this.pointCoordinate(new a.Point(0,0)).zoomTo(b.zoom),f=this.pointCoordinate(this.dimensions).zoomTo(b.zoom);d.row-c.row<f.row-e.row?b.row=(d.row+c.row)/2:e.row<c.row?b.row+=c.row-e.row:f.row>d.row&&(b.row-=f.row-d.row),d.column-c.column<f.column-e.column?b.column=(d.column+c.column)/2:e.column<c.column?b.column+=c.column-e.column:f.column>d.column&&(b.column-=f.column-d.column)}return b},enforceLimits:function(a){return this.enforcePanLimits(this.enforceZoomLimits(a))},draw:function(){this.coordinate=this.enforceLimits(this.coordinate);if(this.dimensions.x<=0||this.dimensions.y<=0){if(!this.autoSize)return;var b=this.parent.offsetWidth,c=this.parent.offsetHeight;this.dimensions=new a.Point(b,c);if(b<=0||c<=0)return}for(var d=0;d<this.layers.length;d++)this.layers[d].draw();this.dispatchCallback("drawn")},_redrawTimer:undefined,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var a=this;this._redraw=function(){a.draw(),a._redrawTimer=0}}return this._redraw},destroy:function(){for(var b=0;b<this.layers.length;b++)this.layers[b].destroy();this.layers=[],this.projection=null;for(var c=0;c<this.eventHandlers.length;c++)this.eventHandlers[c].remove();this.autoSize&&a.removeEvent(window,"resize",this.windowResize())}},a.mapByCenterZoom=function(b,c,d,e){var f=a.coerceLayer(c),g=new a.Map(b,f,!1);return g.setCenterZoom(d,e).draw(),g},a.mapByExtent=function(b,c,d,e){var f=a.coerceLayer(c),g=new a.Map(b,f,!1);return g.setExtent([d,e]).draw(),g},typeof module!="undefined"&&module.exports&&(module.exports={Point:a.Point,Projection:a.Projection,MercatorProjection:a.MercatorProjection,LinearProjection:a.LinearProjection,Transformation:a.Transformation,Location:a.Location,MapProvider:a.MapProvider,Template:a.Template,Coordinate:a.Coordinate,deriveTransformation:a.deriveTransformation})})(MM),!function(a,b,c){typeof module!="undefined"?module.exports=c(a,b):typeof define=="function"&&typeof define.amd=="object"?define(c):b[a]=c(a,b)}("bean",this,function(a,b){var c=window,d=b[a],e=/over|out/,f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="attachEvent",j="removeEventListener",k="detachEvent",l=document||{},m=l.documentElement||{},n=m[h],o=n?h:i,p=Array.prototype.slice,q=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,r=/mouse.*(wheel|scroll)/i,s=/^text/i,t=/^touch|^gesture/i,u={one:1},v=function(a,b,c){for(c=0;c<b.length;c++)a[b[c]]=1;return a}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(n?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend message readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),w=function(){function a(a,b){while((b=b.parentNode)!==null)if(b===a)return!0;return!1}function b(b){var c=b.relatedTarget;return c?c!==this&&c.prefix!=="xul"&&!/document/.test(this.toString())&&!a(this,c):c===null}return{mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),x=function(){var a="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),b=a.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),c=b.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),d=a.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),f=a.concat(["data"]),g=a.concat("touches targetTouches changedTouches scale rotation".split(" ")),h="preventDefault",i=function(a){return function(){a[h]?a[h]():a.returnValue=!1}},j="stopPropagation",k=function(a){return function(){a[j]?a[j]():a.cancelBubble=!0}},n=function(a){return function(){a[h](),a[j](),a.stopped=!0}},o=function(a,b,c){var d,e;for(d=c.length;d--;)e=c[d],!(e in b)&&e in a&&(b[e]=a[e])};return function(p,u){var v={originalEvent:p,isNative:u};if(!p)return v;var w,x=p.type,y=p.target||p.srcElement;v[h]=i(p),v[j]=k(p),v.stop=n(v),v.target=y&&y.nodeType===3?y.parentNode:y;if(u){if(x.indexOf("key")!==-1)w=d,v.keyCode=p.which||p.keyCode;else if(q.test(x)){w=b,v.rightClick=p.which===3||p.button===2,v.pos={x:0,y:0};if(p.pageX||p.pageY)v.clientX=p.pageX,v.clientY=p.pageY;else if(p.clientX||p.clientY)v.clientX=p.clientX+l.body.scrollLeft+m.scrollLeft,v.clientY=p.clientY+l.body.scrollTop+m.scrollTop;e.test(x)&&(v.relatedTarget=p.relatedTarget||p[(x==="mouseover"?"from":"to")+"Element"])}else t.test(x)?w=g:r.test(x)?w=c:s.test(x)&&(w=f);o(p,v,w||a)}return v}}(),y=function(a,b){return!n&&!b&&(a===l||a===c)?m:a},z=function(){function a(a,b,c,d,e){this.element=a,this.type=b,this.handler=c,this.original=d,this.namespaces=e,this.custom=w[b],this.isNative=v[b]&&a[o],this.eventType=n||this.isNative?b:"propertychange",this.customType=!n&&!this.isNative&&b,this.target=y(a,this.isNative),this.eventSupport=this.target[o]}return a.prototype={inNamespaces:function(a){var b,c;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)if(a[b]===this.namespaces[c])return!0;return!1},matches:function(a,b,c){return this.element===a&&(!b||this.original===b)&&(!c||this.handler===c)}},a}(),A=function(){var a={},b=function(c,d,e,f,g){if(!d||d==="*")for(var h in a)h.charAt(0)==="$"&&b(c,h.substr(1),e,f,g);else{var i=0,j,k=a["$"+d],l=c==="*";if(!k)return;for(j=k.length;i<j;i++)if(l||k[i].matches(c,e,f))if(!g(k[i],k,i,d))return}},c=function(b,c,d){var e,f=a["$"+c];if(f)for(e=f.length;e--;)if(f[e].matches(b,d,null))return!0;return!1},d=function(a,c,d){var e=[];return b(a,c,d,null,function(a){return e.push(a)}),e},e=function(b){return(a["$"+b
.type]||(a["$"+b.type]=[])).push(b),b},f=function(c){b(c.element,c.type,null,c.handler,function(b,c,d){return c.splice(d,1),c.length===0&&delete a["$"+b.type],!1})},g=function(){var b,c=[];for(b in a)b.charAt(0)==="$"&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),B=n?function(a,b,c,d){a[d?h:j](b,c,!1)}:function(a,b,c,d,e){e&&d&&a["_on"+e]===null&&(a["_on"+e]=0),a[d?i:k]("on"+b,c)},C=function(a,b,d){return function(e){return e=x(e||((this.ownerDocument||this.document||this).parentWindow||c).event,!0),b.apply(a,[e].concat(d))}},D=function(a,b,d,e,f,g){return function(h){if(e?e.apply(this,arguments):n?!0:h&&h.propertyName==="_on"+d||!h)h&&(h=x(h||((this.ownerDocument||this.document||this).parentWindow||c).event,g)),b.apply(a,h&&(!f||f.length===0)?arguments:p.call(arguments,h?0:1).concat(f))}},E=function(a,b,c,d,e){return function(){a(b,c,e),d.apply(this,arguments)}},F=function(a,b,c,d){var e,f,h,i=b&&b.replace(g,""),j=A.get(a,i,c);for(e=0,f=j.length;e<f;e++)j[e].inNamespaces(d)&&((h=j[e]).eventSupport&&B(h.target,h.eventType,h.handler,!1,h.type),A.del(h))},G=function(a,b,c,d,e){var h,i=b.replace(g,""),j=b.replace(f,"").split(".");if(A.has(a,i,c))return a;i==="unload"&&(c=E(F,a,i,c,d)),w[i]&&(w[i].condition&&(c=D(a,c,i,w[i].condition,!0)),i=w[i].base||i),h=A.put(new z(a,i,c,d,j[0]&&j)),h.handler=h.isNative?C(a,h.handler,e):D(a,h.handler,i,!1,e,!1),h.eventSupport&&B(h.target,h.eventType,h.handler,!0,h.customType)},H=function(a,b,c){return function(d){var e,f,g=typeof a=="string"?c(a,this):a;for(e=d.target;e&&e!==this;e=e.parentNode)for(f=g.length;f--;)if(g[f]===e)return b.apply(e,arguments)}},I=function(a,b,c){var d,e,h,i,j,k=F,l=b&&typeof b=="string";if(l&&b.indexOf(" ")>0){b=b.split(" ");for(j=b.length;j--;)I(a,b[j],c);return a}h=l&&b.replace(g,""),h&&w[h]&&(h=w[h].type);if(!b||l){if(i=l&&b.replace(f,""))i=i.split(".");k(a,h,c,i)}else if(typeof b=="function")k(a,null,b);else for(d in b)b.hasOwnProperty(d)&&I(a,d,b[d]);return a},J=function(a,b,c,d,e){var f,g,h,i,j=c,k=c&&typeof c=="string";if(b&&!c&&typeof b=="object")for(f in b)b.hasOwnProperty(f)&&J.apply(this,[a,f,b[f]]);else{i=arguments.length>3?p.call(arguments,3):[],g=(k?c:b).split(" "),k&&(c=H(b,j=d,e))&&(i=p.call(i,1)),this===u&&(c=E(I,a,b,c,j));for(h=g.length;h--;)G(a,g[h],c,j,i)}return a},K=function(){return J.apply(u,arguments)},L=n?function(a,b,d){var e=l.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,c,1),d.dispatchEvent(e)}:function(a,b,c){c=y(c,a),a?c.fireEvent("on"+b,l.createEventObject()):c["_on"+b]++},M=function(a,b,c){var d,e,h,i,j,k=b.split(" ");for(d=k.length;d--;){b=k[d].replace(g,"");if(i=k[d].replace(f,""))i=i.split(".");if(!i&&!c&&a[o])L(v[b],b,a);else{j=A.get(a,b),c=[!1].concat(c);for(e=0,h=j.length;e<h;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c)}}return a},N=function(a,b,c){var d=0,e=A.get(b,c),f=e.length;for(;d<f;d++)e[d].original&&J(a,e[d].type,e[d].original);return a},O={add:J,one:K,remove:I,clone:N,fire:M,noConflict:function(){return b[a]=d,this}};if(c[i]){var P=function(){var a,b=A.entries();for(a in b)b[a].type&&b[a].type!=="unload"&&I(b[a].element,b[a].type);c[k]("onunload",P),c.CollectGarbage&&c.CollectGarbage()};c[i]("onunload",P)}return O});var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};var html=function(a){function b(a){a=k(a);if(l.hasOwnProperty(a))return l[a];var b=a.match(n);return b?String.fromCharCode(parseInt(b[1],10)):(b=a.match(o))?String.fromCharCode(parseInt(b[1],16)):""}function c(a,c){return b(c)}function d(a){return a.replace(p,"")}function e(a){return a.replace(q,c)}function f(a){return a.replace(r,"&amp;").replace(t,"&lt;").replace(u,"&gt;").replace(v,"&#34;").replace(w,"&#61;")}function g(a){return a.replace(s,"&amp;$1").replace(t,"&lt;").replace(u,"&gt;")}function h(b){return function c(c,f){c=String(c);var h=null,i=!1,j=[],l=void 0,m=void 0,n=void 0;b.startDoc&&b.startDoc(f);while(c){var o=c.match(i?x:y);c=c.substring(o[0].length);if(i){if(o[1]){var p=k(o[1]),q;if(o[2]){var r=o[3];switch(r.charCodeAt(0)){case 34:case 39:r=r.substring(1,r.length-1)}q=e(d(r))}else q=p;j.push(p,q)}else if(o[4]){m!==void 0&&(n?b.startTag&&b.startTag(l,j,f):b.endTag&&b.endTag(l,f));if(n&&m&(a.eflags.CDATA|a.eflags.RCDATA)){h===null?h=k(c):h=h.substring(h.length-c.length);var s=h.indexOf("</"+l);s<0&&(s=c.length),s&&(m&a.eflags.CDATA?b.cdata&&b.cdata(c.substring(0,s),f):b.rcdata&&b.rcdata(g(c.substring(0,s)),f),c=c.substring(s))}l=m=n=void 0,j.length=0,i=!1}}else if(o[1])b.pcdata&&b.pcdata(o[0],f);else if(o[3])n=!o[2],i=!0,l=k(o[3]),m=a.ELEMENTS.hasOwnProperty(l)?a.ELEMENTS[l]:void 0;else if(o[4])b.pcdata&&b.pcdata(o[4],f);else if(o[5]&&b.pcdata){var t=o[5];b.pcdata(t==="<"?"&lt;":t===">"?"&gt;":"&amp;",f)}}b.endDoc&&b.endDoc(f)}}function i(b){var c,d;return h({startDoc:function(a){c=[],d=!1},startTag:function(e,g,h){if(d)return;if(!a.ELEMENTS.hasOwnProperty(e))return;var i=a.ELEMENTS[e];if(i&a.eflags.FOLDABLE)return;if(i&a.eflags.UNSAFE){d=!(i&a.eflags.EMPTY);return}g=b(e,g);if(g){i&a.eflags.EMPTY||c.push(e),h.push("<",e);for(var j=0,k=g.length;j<k;j+=2){var l=g[j],m=g[j+1];m!==null&&m!==void 0&&h.push(" ",l,'="',f(m),'"')}h.push(">")}},endTag:function(b,e){if(d){d=!1;return}if(!a.ELEMENTS.hasOwnProperty(b))return;var f=a.ELEMENTS[b];if(!(f&(a.eflags.UNSAFE|a.eflags.EMPTY|a.eflags.FOLDABLE))){var g;if(f&a.eflags.OPTIONAL_ENDTAG)for(g=c.length;--g>=0;){var h=c[g];if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(g=c.length;--g>=0;)if(c[g]===b)break;if(g<0)return;for(var i=c.length;--i>g;){var h=c[i];a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG||e.push("</",h,">")}c.length=g,e.push("</",b,">")}},pcdata:function(a,b){d||b.push(a)},rcdata:function(a,b){d||b.push(a)},cdata:function(a,b){d||b.push(a)},endDoc:function(a){for(var b=c.length;--b>=0;)a.push("</",c[b],">");c.length=0}})}function j(b,c,d){var e=[];return i(function f(b,e){for(var f=0;f<e.length;f+=2){var g=e[f],h=e[f+1],i=null,j;if((j=b+"::"+g,a.ATTRIBS.hasOwnProperty(j))||(j="*::"+g,a.ATTRIBS.hasOwnProperty(j)))i=a.ATTRIBS[j];if(i!==null)switch(i){case a.atype.NONE:break;case a.atype.SCRIPT:case a.atype.STYLE:h=null;break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:h=d?d(h):h;break;case a.atype.URI:var k=(""+h).match(z);k?!k[1]||m.test(k[1])?h=c&&c(h):h=null:h=null;break;case a.atype.URI_FRAGMENT:h&&"#"===h.charAt(0)?(h=d?d(h):h,h&&(h="#"+h)):h=null;break;default:h=null}else h=null;e[f+1]=h}return e})(b,e),e.join("")}var k;"script"==="SCRIPT".toLowerCase()?k=function(a){return a.toLowerCase()}:k=function(a){return a.replace(/[A-Z]/g,function(a){return String.fromCharCode(a.charCodeAt(0)|32)})};var l={lt:"<",gt:">",amp:"&",nbsp:"",quot:'"',apos:"'"},m=/^(?:https?|mailto|data)$/i,n=/^#(\d+)$/,o=/^#x([0-9A-Fa-f]+)$/,p=/\0/g,q=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,r=/&/g,s=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,t=/</g,u=/>/g,v=/\"/g,w=/\=/g,x=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),y=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),z=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:f,makeHtmlSanitizer:i,makeSaxParser:h,normalizeRCData:g,sanitize:j,unescapeEntities:e}}(html4),html_sanitize=html.sanitize;typeof window!="undefined"&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0;var Mustache=typeof module!="undefined"&&module.exports||{};(function(a){function b(a){return r.test(a)}function c(a){return String(a).replace(/[&<>"'\/]/g,function(a){return v[a]||a})}function d(a,b,c,d){d=d||"<template>";var e=b.split("\n"),f=Math.max(c-3,0),g=Math.min(e.length,c+3),h=e.slice(f,g),i;for(var j=0,k=h.length;j<k;++j)i=j+f+1,h[j]=(i===c?" >> ":"    ")+h[j];return a.template=b,a.line=c,a.file=d,a.message=[d+":"+c,h.join("\n"),"",a.message].join("\n"),a}function e(a,b,c){if(a===".")return b[b.length-1];var d=a.split("."),e=d.length-1,f=d[e],g,h,i=b.length,j,k;while(i){k=b.slice(0),h=b[--i],j=0;while(j<e){h=h[d[j++]];if(h==null)break;k.push(h)}if(h&&typeof h=="object"&&f in h){g=h[f];break}}return typeof g=="function"&&(g=g.call(k[k.length-1])),g==null?c:g}function f(a,b,c,d){var f="",g=e(a,b);if(d){if(g==null||g===!1||p(g)&&g.length===0)f+=c()}else if(p(g))q(g,function(a){b.push(a),f+=c(),b.pop()});else if(typeof g=="object")b.push(g),f+=c(),b.pop();else if(typeof g=="function"){var h=b[b.length-1],i=function(a){return k(a,h)};f+=g.call(h,c(),i)||""}else g&&(f+=c());return f}function g(c,e){e=e||{};var f=e.tags||a.tags,g=f[0],h=f[f.length-1],i=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],j=[],k=!1,l=!1,m=function(){if(k&&!l&&!e.space)while(j.length)i.splice(j.pop(),1);else j=[];k=!1,l=!1},n=[],o,p,q,r=function(a){f=s(a).split(/\s+/),p=f[0],q=f[f.length-1]},t=function(a){i.push('";',o,'\nvar partial = partials["'+s(a)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},u=function(a,b){var f=s(a);if(f==="")throw d(new Error("Section name may not be empty"),c,z,e.file);n.push({name:f,inverted:b}),i.push('";',o,'\nvar name = "'+f+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},v=function(a){u(a,!0)},w=function(a){var b=s(a),f=n.length!=0&&n[n.length-1].name;if(!f||b!=f)throw d(new Error('Section named "'+b+'" was never opened'),c,z,e.file);var g=n.pop();i.push('";',"\n    return buffer;","\n  };","\n})();"),g.inverted?i.push("\nbuffer += renderSection(name,stack,callback,true);"):i.push("\nbuffer += renderSection(name,stack,callback);"),i.push('\nbuffer += "')},x=function(a){i.push('";',o,'\nbuffer += lookup("'+s(a)+'",stack,"");','\nbuffer += "')},y=function(a){i.push('";',o,'\nbuffer += escapeHTML(lookup("'+s(a)+'",stack,""));','\nbuffer += "')},z=1,A,B;for(var C=0,D=c.length;C<D;++C)if(c.slice(C,C+g.length)===g){C+=g.length,A=c.substr(C,1),o="\nline = "+z+";",p=g,q=h,k=!0;switch(A){case"!":C++,B=null;break;case"=":C++,h="="+h,B=r;break;case">":C++,B=t;break;case"#":C++,B=u;break;case"^":C++,B=v;break;case"/":C++,B=w;break;case"{":h="}"+h;case"&":C++,l=!0,B=x;break;default:l=!0,B=y}var E=c.indexOf(h,C);if(E===-1)throw d(new Error('Tag "'+g+'" was not closed properly'),c,z,e.file);var F=c.substring(C,E);B&&B(F);var G=0;while(~(G=F.indexOf("\n",G)))z++,G++;C=E+h.length-1,g=p,h=q}else{A=c.substr(C,1);switch(A){case'"':case"\\":l=!0,i.push("\\"+A);break;case"\r":break;case"\n":j.push(i.length),i.push("\\n"),m(),z++;break;default:b(A)?j.push(i.length):l=!0,i.push(A)}}if(n.length!=0)throw d(new Error('Section "'+n[n.length-1].name+'" was not closed properly'),c,z,e.file);m(),i.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var H=i.join("").replace(/buffer \+= "";\n/g,"");return e.debug&&(typeof console!="undefined"&&console.log?console.log(H):typeof print=="function"&&print(H)),H}function h(a,b){var h="view,partials,stack,lookup,escapeHTML,renderSection,render",i=g(a,b),j=new Function(h,i);return function(g,h){h=h||{};var i=[g];try{return j(g,h,i,e,c,f,k)}catch(l){throw d(l.error,a,l.line,b.file)}}}function i(){w={}}function j(a,b){return b=b||{},b.cache!==!1?(w[a]||(w[a]=h(a,b)),w[a]):h(a,b)}function k(a,b,c){return j(a)(b,c)}a.name="mustache.js",a.version="0.5.0-dev",a.tags=["{{","}}"],a.parse=g,a.compile=j,a.render=k,a.clearCache=i,a.to_html=function(a,b,c,d){var e=k(a,b,c);if(typeof d!="function")return e;d(e)};var l=Object.prototype.toString,m=Array.isArray,n=Array.prototype.forEach,o=String.prototype.trim,p;m?p=m:p=function(a){return l.call(a)==="[object Array]"};var q;n?q=function(a,b,c){return n.call(a,b,c)}:q=function(a,b,c){for(var d=0,e=a.length;d<e;++d)b.call(c,a[d],d,a)};var r=/^\s*$/,s;if(o)s=function(a){return a==null?"":o.call(a)};else{var t,u;b("")?(t=/^\s+/,u=/\s+$/):(t=/^[\s\xA0]+/,u=/[\s\xA0]+$/),s=function(a){return a==null?"":String(a).replace(t,"").replace(u,"")}}var v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},w={}})(Mustache),!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&define.amd?define(a,b):this[a]=b()}("reqwest",function(){function handleReadyState(a,b,c){return function(){a&&a[readyState]==4&&(twoHundo.test(a.status)?b(a):c(a))}}function setHeaders(a,b){var c=b.headers||{},d;c.Accept=c.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],!b.crossOrigin&&!c[requestedWith]&&(c[requestedWith]=defaultHeaders.requestedWith),c[contentType]||(c[contentType]=b.contentType||defaultHeaders.contentType);for(d in c)c.hasOwnProperty(d)&&a.setRequestHeader(d,c[d])}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||"reqwest_"+e,h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0;i?i[3]==="?"?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,typeof j.onreadystatechange!="undefined"&&(j.event="onclick",j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){if(j[readyState]&&j[readyState]!=="complete"&&j[readyState]!=="loaded"||k)return!1;j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),a.success&&a.success(lastValue),lastValue=undefined,head.removeChild(j),k=1},head.appendChild(j)}function getRequest(a,b,c){var d=(a.method||"GET").toUpperCase(),e=typeof a=="string"?a:a.url,f=a.processData!==!1&&a.data&&typeof a.data!="string"?reqwest.toQueryString(a.data):a.data||null,g;return(a.type=="jsonp"||d=="GET")&&f&&(e=urlappend(e,f),f=null),a.type=="jsonp"?handleJsonp(a,b,c,e):(g=xhr(),g.open(d,e,!0),setHeaders(g,a),g.onreadystatechange=handleReadyState(g,b,c),a.before&&a.before(g),g.send(f),g)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){var b=a.match(/\.(json|jsonp|html|xml)(\?|$)/);return b?b[1]:"js"}function init(o,fn){function complete(a){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(a)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(a,b,c){o.error&&o.error(a,b,c),complete(a)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c=a.name,d=a.tagName.toLowerCase(),e=function(a){a&&!a.disabled&&b(c,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(a.disabled||!c)return;switch(d){case"input":if(!/reset|button|image|file/i.test(a.type)){var f=/checkbox/i.test(a.type),g=/radio/i.test(a.type),h=a.value;(!f&&!g||a.checked)&&b(c,normalize(f&&h===""?"on":h))}break;case"textarea":b(c,normalize(a.value));break;case"select":if(a.type.toLowerCase()==="select-one")e(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(var i=0;a.length&&i<a.length;i++)a.options[i].selected&&e(a.options[i])}}function eachFormElement(){var a=this,b,c,d,e=function(b,c){for(var e=0;e<c.length;e++){var f=b[byTag](c[e]);for(d=0;d<f.length;d++)serial(f[d],a)}};for(c=0;c<arguments.length;c++)b=arguments[c],/input|select|textarea/i.test(b.tagName)&&serial(b,a),e(b,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(arguments.length===0)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),a=="map"?b=serializeHash:a=="array"?b=reqwest.serializeArray:b=serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a){var b="",c,d=encodeURIComponent,e=function(a,c){b+=d(a)+"="+d(c)+"&"};if(isArray(a))for(c=0;a&&c<a.length;c++)e(a[c].name,a[c].value);else for(var f in a){if(!Object.hasOwnProperty.call(a,f))continue;var g=a[f];if(isArray(g))for(c=0;c<g.length;c++)e(f,g[c]);else e(f,a[f])}return b.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest}),wax=wax||{},wax.attribution=function(){var a,b={};return b.content=function(b){return typeof b=="undefined"?a.innerHTML:(a.innerHTML=wax.u.sanitize(b),this)},b.element=function(){return a},b.init=function(){return a=document.createElement("div"),a.className="map-attribution",this},b.init()},wax=wax||{},wax.bwdetect=function(a,b){function c(){wax.bw=-1;var a=new Image;a.src=f;var b=!0,c=setTimeout(function(){b&&wax.bw==-1&&(d.bw(0),b=!1)},e);a.onload=function(){b&&wax.bw==-1&&(clearTimeout(c),d.bw(1),b=!1)}}var d={},e=a.threshold||400,f="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +(new Date),g=1,h=a.auto===undefined?!0:a.auto;return d.bw=function(a){if(!arguments.length)return g;var c=g;wax.bwlisteners&&wax.bwlisteners.length&&function(){listeners=wax.bwlisteners,wax.bwlisteners=[];for(i=0;i<listeners;i++)listeners[i](a)}(),wax.bw=a,g!=(g=a)&&b(a)},d.add=function(){return h&&c(),this},wax.bw==-1?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(d.bw)):wax.bw!==undefined?d.bw(wax.bw):d.add(),d},wax.formatter=function(x){var formatter={},f;if(x&&typeof x=="string")try{eval("f = "+x)}catch(e){console&&console.log(e)}else x&&typeof x=="function"?f=x:f=function(){};return formatter.format=function(a,b){try{return wax.u.sanitize(f(a,b))}catch(c){console&&console.log(c)}},formatter},wax.gi=function(a,b){function c(a){return a>=93&&a--,a>=35&&a--,a-=32,a}b=b||{};var d={},e=b.resolution||4,f=b.tileSize||256;return d.grid_tile=function(){return a},d.getKey=function(b,d){if(!a||!a.grid)return;if(d<0||b<0)return;if(Math.floor(d)>=f||Math.floor(b)>=f)return;return c(a.grid[Math.floor(d/e)].charCodeAt(Math.floor(b/e)))},d.gridFeature=function(b,c){var d=this.getKey(b,c),e=a.keys;if(e&&e[d]&&a.data[e[d]])return a.data[e[d]]},d.tileFeature=function(b,c,d){if(!a)return;var e=wax.u.offset(d);return feature=this.gridFeature(b-e.left,c-e.top),feature},d},wax.gm=function(){function a(a){return typeof a=="string"&&(a=[a]),function b(b){if(!b)return;var c=new RegExp("/(\\d+)\\/(\\d+)\\/(\\d+)\\.[\\w\\._]+"),d=c.exec(b);if(!d)return;return a[parseInt(d[2],10)%a.length].replace(/\{z\}/g,d[1]).replace(/\{x\}/g,d[2]).replace(/\{y\}/g,d[3])}}var b=4,c={},d={},e,f,g=function(a){if(a)return a.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json")};return d.formatter=function(a){return arguments.length?(f=wax.formatter(a),d):f},d.template=function(a){return arguments.length?(f=wax.template(a),d):f},d.gridUrl=function(b){return arguments.length?(b?g=typeof b=="function"?b:a(b):g=function(){return null},d):g},d.getGrid=function(a,c){var e=g(a);return!f||!e?c(null,null):(wax.request.get(e,function(a,d){if(a)return c(a,null);c(null,wax.gi(d,{formatter:f,resolution:b}))}),d)},d.tilejson=function(a){return arguments.length?(a.template?d.template(a.template):a.formatter?d.formatter(a.formatter):f=undefined,d.gridUrl(a.grids),a.resolution&&(b=a.resolution),e=a,d):e},d},wax=wax||{},wax.hash=function(a){function b(){return location.hash.substring(1)}function c(a){var b=window.location;b.replace(b.toString().replace(b.hash||/$/,"#"+a))}function d(b){var c=b.split("/");for(var d=0;d<c.length;d++){c[d]=Number(c[d]);if(isNaN(c[d]))return!0}if(c.length<3)return!0;c.length==3&&a.setCenterZoom(c)}function e(){var b=a.getCenterZoom();g!==b&&(g=b,c(g))}function f(a){if(a===g)return;d(g=a)&&e()}a=a||{};var g,h={},i=90-1e-8,j=wax.u.throttle(e,500);return h.add=function(){return f(b()),a.bindChange(j),this},h.remove=function(){return a.unbindChange(j),this},h.add()},wax=wax||{},wax.interaction=function(){function a(a){var b=m();for(var c=0;c<b.length;c++)if(b[c][0]<a.y&&b[c][0]+256>a.y&&b[c][1]<a.x&&b[c][1]+256>a.x)return b[c][2];return!1}function b(){return j?(window.clearTimeout(j),j=null,!0):!1}function c(a){if(i)return;var b=wax.u.eventoffset(a);h.screen_feature(b,function(b){b?bean.fire(h,"on",{parent:p(),data:b,formatter:g.formatter().format,e:a}):bean.fire(h,"off")})}function d(a){if(b())return;i=!0,k=wax.u.eventoffset(a),a.type==="mousedown"?bean.add(document.body,"click",f):a.type==="touchstart"&&a.touches.length===1&&(bean.fire(h,"off"),bean.add(p(),t))}function e(){bean.remove(p(),t),i=!1}function f(a){var b={},c=wax.u.eventoffset(a);i=!1;for(var d in a)b[d]=a[d];return bean.remove(document.body,"mouseup",f),bean.remove(p(),t),a.type==="touchend"?h.click(a,k):Math.round(c.y/l)===Math.round(k.y/l)&&Math.round(c.x/l)===Math.round(k.x/l)&&(j=window.setTimeout(function(){j=null,h.click(b,c)},300)),f}var g=wax.gm(),h={},i=!1,j=!1,k,l=4,m,n,o,p,q,r,s={mousemove:c,touchstart:d,mousedown:d},t={touchend:f,touchmove:f,touchcancel:e};return h.click=function(a,b){h.screen_feature(b,function(b){b&&bean.fire(h,"on",{parent:p(),data:b,formatter:g.formatter().format,e:a})})},h.screen_feature=function(b,c){var d=a(b);d||c(null),g.getGrid(d.src,function(a,e){if(a||!e)return c(null);var f=e.tileFeature(b.x,b.y,d);c(f)})},h.attach=function(a){return arguments.length?(n=a,h):n},h.detach=function(a){return arguments.length?(o=a,h):o},h.map=function(a){return arguments.length?(q=a,n&&n(q),bean.add(p(),s),bean.add(p(),"touchstart",d),h):q},h.grid=function(a){return arguments.length?(m=a,h):m},h.remove=function(a){return o&&o(q),bean.remove(p(),s),bean.fire(h,"remove"),h},h.tilejson=function(a){return arguments.length?(g.tilejson(a),h):g.tilejson()},h.formatter=function(){return g.formatter()},h.on=function(a,b){return bean.add(h,a,b),h},h.off=function(a,b){return bean.remove(h,a,b),h},h.gridmanager=function(a){return arguments.length?(g=a,h):g},h.parent=function(a){return p=a,h},h};var wax=wax||{};wax.legend=function(){var a,b={},c;return b.element=function(){return c},b.content=function(c){return arguments.length?(a.innerHTML=wax.u.sanitize(c),a.style.display="block",a.innerHTML===""&&(a.style.display="none"),b):a.innerHTML},b.add=function(){return c=document.createElement("div"),c.className="map-legends",a=c.appendChild(document.createElement("div")),a.className="map-legend",a.style.display="none",b},b.add()};var wax=wax||{};wax.location=function(){function a(a){console.log(a);if(a.e.type==="mousemove"||!a.e.type)return;var b=a.formatter({format:"location"},a.data);b&&(window.location.href=b)}var b={};return b.events=function(){return{on:a}},b};var wax=wax||{};wax.movetip=wax.movetip||{},wax.movetip=function(){function a(a){var b=wax.u.eventoffset(a);b.y-i.top<h.height+5&&i.height>h.height&&(b.y+=h.height,j.className+=" flip-y"),j.style.left=b.x+"px",j.style.top=b.y-h.height-5+"px"}function b(a){var b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div");return c.innerHTML=a,c.className="inner",d.className="tip",b.className="wax-tooltip wax-tooltip-0",b.appendChild(c),b.appendChild(d),b}function c(){j&&(j.parentNode.removeChild(j),j=null)}function d(d){var e;if(f)return;if(d.e.type==="mousemove"||d.e.type==="touchend"||!d.e.type){e=d.formatter({format:"teaser"},d.data);if(!e)return;c(),k.style.cursor="pointer",j=document.body.appendChild(b(e))}j&&(h=wax.u.offset(j),i=wax.u.offset(k),a(d.e))}function e(){k.style.cursor="default",f||c()}var f=!1,g={},h,i,j,k;return g.parent=function(a){return arguments.length?(k=a,g):k},g.events=function(){return{on:d,off:e}},g};var wax=wax||{};wax.movetip={},wax.movetip=function(){function a(a){var b=wax.u.eventoffset(a);h.height+b.y>i.top+i.height&&i.height>h.height&&(b.y-=h.height,j.className+=" flip-y"),h.width+b.x>i.left+i.width&&(b.x-=h.width,j.className+=" flip-x"),j.style.left=b.x+"px",j.style.top=b.y+"px"}function b(a){var b=document.createElement("div");return b.className="map-tooltip map-tooltip-0",b.innerHTML=a,b}function c(){j&&(j.parentNode.removeChild(j),j=null)}function d(d){var e;if(f)return;if(d.e.type==="mousemove"||!d.e.type){e=d.formatter({format:"teaser"},d.data);if(!e)return;c(),k.style.cursor="pointer",j=document.body.appendChild(b(e))}else{e=d.formatter({format:"teaser"},d.data);if(!e)return;c();var g=document.body.appendChild(b(e));g.className+=" map-popup";var l=g.appendChild(document.createElement("a"));l.href="#close",l.className="close",l.innerHTML="Close",f=!0,j=g,h=wax.u.offset(j),i=wax.u.offset(k),a(d.e),bean.add(l,"click touchend",function(a){a.stop(),c(),f=!1})}j&&(h=wax.u.offset(j),i=wax.u.offset(k),a(d.e))}function e(){k.style.cursor="default",f||c()}var f=!1,g={},h,i,j,k;return g.parent=function(a){return arguments.length?(k=a,g):k},g.events=function(){return{on:d,off:e}},g};var wax=wax||{};wax.request={cache:{},locks:{},promises:{},get:function(a,b){if(this.cache[a])return b(this.cache[a][0],this.cache[a][1]);this.promises[a]=this.promises[a]||[],this.promises[a].push(b);if(this.locks[a])return;var c=this;this.locks[a]=!0,reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(b){c.locks[a]=!1,c.cache[a]=[null,b];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])},error:function(b){c.locks[a]=!1,c.cache[a]=[b,null];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])}})}},wax.template=function(a){var b={};return b.format=function(b,c){var d={};for(var e in c)d[e]=c[e
];return b.format&&(d["__"+b.format+"__"]=!0),wax.u.sanitize(Mustache.to_html(a,d))},b};if(!wax)var wax={};wax.tilejson=function(a,b){reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:b,error:b})};var wax=wax||{};wax.tooltip={},wax.tooltip=function(){function a(a){var b=document.createElement("div");return b.className="map-tooltip map-tooltip-0",b.innerHTML=a,b}function b(){this.parentNode&&this.parentNode.removeChild(this)}function c(){var a;while(a=i.pop())g&&k?(bean.add(a,k,b),a.className+=" map-fade"):a.parentNode&&a.parentNode.removeChild(a)}function d(b){var d;if(b.e.type==="mousemove"||!b.e.type){if(!f){d=b.content||b.formatter({format:"teaser"},b.data);if(!d||d==j)return;c(),l.style.cursor="pointer",i.push(l.appendChild(a(d))),j=d}}else{d=b.content||b.formatter({format:"full"},b.data);if(!d){b.e.type&&b.e.type.match(/touch/)&&(d=b.content||b.formatter({format:"teaser"},b.data));if(!d)return}c(),l.style.cursor="pointer";var e=l.appendChild(a(d));e.className+=" map-popup";var g=e.appendChild(document.createElement("a"));g.href="#close",g.className="close",g.innerHTML="Close",f=!0,i.push(e),bean.add(g,"touchstart mousedown",function(a){a.stop()}),bean.add(g,"click touchend",function(a){a.stop(),c(),f=!1})}}function e(){l.style.cursor="default",j=null,f||c()}var f=!1,g=!1,h={},i=[],j,k,l;return document.body.style["-webkit-transition"]!==undefined?k="webkitTransitionEnd":document.body.style.MozTransition!==undefined&&(k="transitionend"),h.parent=function(a){return arguments.length?(l=a,h):l},h.animate=function(a){return arguments.length?(g=a,h):g},h.events=function(){return{on:d,off:e}},h};var wax=wax||{};wax.u={offset:function(a){var b=a.offsetWidth||parseInt(a.style.width,10),c=a.offsetHeight||parseInt(a.style.height,10),d=document.body,e=0,f=0,g=function(a){if(a===d||a===document.documentElement)return;e+=a.offsetTop,f+=a.offsetLeft;var b=a.style.transform||a.style.WebkitTransform||a.style.OTransform||a.style.MozTransform||a.style.msTransform;if(b){var c;if(c=b.match(/translate\((.+)px, (.+)px\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10);else if(c=b.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10);else if(c=b.match(/matrix3d\(([\-\d,\s]+)\)/)){var g=c[1].split(",");e+=parseInt(g[13],10),f+=parseInt(g[12],10)}else if(c=b.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10)}};g(a);try{while(a=a.offsetParent)g(a)}catch(h){}e+=d.offsetTop,f+=d.offsetLeft,e+=d.parentNode.offsetTop,f+=d.parentNode.offsetLeft;var i=document.defaultView?window.getComputedStyle(d.parentNode,null):d.parentNode.currentStyle;return d.parentNode.offsetTop!==parseInt(i.marginTop,10)&&!isNaN(parseInt(i.marginTop,10))&&(e+=parseInt(i.marginTop,10),f+=parseInt(i.marginLeft,10)),{top:e,left:f,height:c,width:b}},$:function(a){return typeof a=="string"?document.getElementById(a):a},indexOf:function(a,b){var c=Array.prototype.indexOf;if(a===null)return-1;var d,e;if(c&&a.indexOf===c)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},eventoffset:function(a){var b=0,c=0;a||(a=window.event);if(a.pageX||a.pageY)return{x:a.pageX,y:a.pageY};if(a.clientX||a.clientY){var d=document.documentElement,e=document.body,f=document.body.parentNode.currentStyle,g=parseInt(f.marginTop,10)||0,h=parseInt(f.marginLeft,10)||0;return{x:a.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0)+h,y:a.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)+g}}if(a.touches&&a.touches.length===1)return{x:a.touches[0].pageX,y:a.touches[0].pageY}},limit:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,b)}},throttle:function(a,b){return this.limit(a,b,!1)},sanitize:function(a){function b(a){if(/^(https?:\/\/|data:image)/.test(a))return a}function c(a){return a}return a?html_sanitize(a,b,c):""}},wax=wax||{},wax.mm=wax.mm||{},wax.mm.attribution=function(a,b){b=b||{};var c,d={};return d.element=function(){return c.element()},d.appendTo=function(a){return wax.u.$(a).appendChild(c.element()),d},d.init=function(){return c=wax.attribution(),c.content(b.attribution),c.element().className="map-attribution map-mm",d},d.init()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.boxselector=function(a,b,c){function d(b){var c=new MM.Point(b.clientX,b.clientY);c.x+=document.body.scrollLeft+document.documentElement.scrollLeft,c.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var d=a.parent;d;d=d.offsetParent)c.x-=d.offsetLeft,c.y-=d.offsetTop;return c}function e(b){if(!b.shiftKey)return;return l=m=d(b),r=s=!0,p.left=l.x+"px",p.top=l.y+"px",p.width=p.height=0,u(document,"mousemove",g),u(document,"mouseup",h),a.parent.style.cursor="crosshair",MM.cancelEvent(b)}function f(a){var b=d(a),c={x:parseInt(o.offsetLeft,10),y:parseInt(o.offsetTop,10)},e={x:c.x+parseInt(o.offsetWidth,10),y:c.y+parseInt(o.offsetHeight,10)};r=b.x-c.x<=t||e.x-b.x<=t,s=b.y-c.y<=t||e.y-b.y<=t;if(s||r)return l={x:b.x-c.x<e.x-b.x?e.x:c.x,y:b.y-c.y<e.y-b.y?e.y:c.y},m={x:b.x-c.x<e.x-b.x?c.x:e.x,y:b.y-c.y<e.y-b.y?c.y:e.y},u(document,"mousemove",g),u(document,"mouseup",h),MM.cancelEvent(a)}function g(b){var c=d(b);return p.display="block",r&&(p.left=(c.x<l.x?c.x:l.x)+"px",p.width=Math.abs(c.x-l.x)-2*q+"px"),s&&(p.top=(c.y<l.y?c.y:l.y)+"px",p.height=Math.abs(c.y-l.y)-2*q+"px"),j(c,a.parent),MM.cancelEvent(b)}function h(b){var c=d(b),e=a.pointLocation(new MM.Point(r?c.x:m.x,s?c.y:m.y));l2=a.pointLocation(l),x.extent([new MM.Location(Math.max(e.lat,l2.lat),Math.min(e.lon,l2.lon)),new MM.Location(Math.min(e.lat,l2.lat),Math.max(e.lon,l2.lon))]),v(document,"mousemove",g),v(document,"mouseup",h),a.parent.style.cursor="auto"}function i(a){j(d(a),o)}function j(a,b){var c={x:parseInt(o.offsetLeft,10),y:parseInt(o.offsetTop,10)},d={x:c.x+parseInt(o.offsetWidth,10),y:c.y+parseInt(o.offsetHeight,10)},e="";a.y-c.y<=t?e="n":d.y-a.y<=t&&(e="s"),a.x-c.x<=t?e+="w":d.x-a.x<=t&&(e+="e"),e!==""&&(e+="-resize"),b.style.cursor=e}function k(a,b){if(!o||!w)return;var c=a.locationPoint(w[1]),d=a.locationPoint(w[0]),e=o.style;e.display="block",e.height="auto",e.width="auto",e.left=Math.max(0,d.x)+"px",e.top=Math.max(0,d.y)+"px",e.right=Math.max(0,a.dimensions.x-c.x)+"px",e.bottom=Math.max(0,a.dimensions.y-c.y)+"px"}var l=null,m=null,n=typeof c=="function"?c:c.callback,o,p,q=0,r=!1,s=!1,t=5,u=MM.addEvent,v=MM.removeEvent,w,x={};return x.extent=function(b,c){if(!b)return w;w=[new MM.Location(Math.max(b[0].lat,b[1].lat),Math.min(b[0].lon,b[1].lon)),new MM.Location(Math.min(b[0].lat,b[1].lat),Math.max(b[0].lon,b[1].lon))],k(a),c||n(w)},x.add=function(a){return o=o||document.createElement("div"),o.id=a.parent.id+"-boxselector-box",o.className="boxselector-box",a.parent.appendChild(o),p=o.style,q=parseInt(window.getComputedStyle(o).borderWidth,10),u(a.parent,"mousedown",e),u(o,"mousedown",f),u(a.parent,"mousemove",i),a.addCallback("drawn",k),this},x.remove=function(){a.parent.removeChild(o),v(a.parent,"mousedown",e),v(o,"mousedown",f),v(a.parent,"mousemove",i),a.removeCallback("drawn",k)},x.add(a)},wax=wax||{},wax.mm=wax.mm||{},wax._={},wax.mm.bwdetect=function(a,b){b=b||{};var c=b.png||".png128",d=b.jpg||".jpg70",e=!1;return wax._.bw_png=c,wax._.bw_jpg=d,wax.bwdetect(b,function(b){wax._.bw=!b;for(var c=0;c<a.layers.length;c++)a.getLayerAt(c).provider instanceof wax.mm.connector&&a.getLayerAt(c).setProvider(a.getLayerAt(c).provider)})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.fullscreen=function(a){function b(a){a&&a.stop(),d?e.original():e.full()}function c(b,c){a.dimensions=new MM.Point(b,c),a.parent.style.width=Math.round(a.dimensions.x)+"px",a.parent.style.height=Math.round(a.dimensions.y)+"px",a.dispatchCallback("resized",a.dimensions)}var d=!1,e={},f,g=document.body,h;return e.add=function(a){return f=document.createElement("a"),f.className="map-fullscreen",f.href="#fullscreen",f.innerHTML="fullscreen",bean.add(f,"click",b),this},e.full=function(){if(d)return;d=!0,h=[a.parent.offsetWidth,a.parent.offsetHeight],a.parent.className+=" map-fullscreen-map",g.className+=" map-fullscreen-view",c(a.parent.offsetWidth,a.parent.offsetHeight)},e.original=function(){if(!d)return;d=!1,a.parent.className=a.parent.className.replace(" map-fullscreen-map",""),g.className=g.className.replace(" map-fullscreen-view",""),c(h[0],h[1])},e.appendTo=function(a){return wax.u.$(a).appendChild(f),this},e.add(a)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.hash=function(a){return wax.hash({getCenterZoom:function(){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return[c.toFixed(2),b.lat.toFixed(d),b.lon.toFixed(d)].join("/")},setCenterZoom:function b(b){a.setCenterZoom(new MM.Location(b[1],b[2]),b[0])},bindChange:function(b){a.addCallback("drawn",b)},unbindChange:function(b){a.removeCallback("drawn",b)}})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.interaction=function(){function a(){var a=g.getLayerAt(0).levels[Math.round(g.getZoom())];return!e&&f!==undefined&&f.length?f:(f=function(b){var c=[];for(var d in b)if(b[d].parentNode===a){var e=wax.u.offset(b[d]);c.push([e.top,e.left,b[d]])}return c}(g.getLayerAt(0).tiles),f)}function b(){e=!0}function c(a){if(!arguments.length)return g;g=a;for(var c=0;c<h.length;c++)g.addCallback(h[c],b)}function d(a){for(var c=0;c<h.length;c++)g.removeCallback(h[c],b)}var e=!1,f,g,h=["zoomed","panned","centered","extentset","resized","drawn"];return wax.interaction().attach(c).detach(d).parent(function(){return g.parent}).grid(a)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.legend=function(a,b){b=b||{};var c,d={};return d.add=function(){return c=wax.legend().content(b.legend),d},d.content=function(a){return arguments.length?(c.content(d),d):c.content()},d.element=function(){return c.element()},d.appendTo=function(a){return wax.u.$(a).appendChild(c.element()),d},d.add()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.pointselector=function(a,b,c){function d(b){var c=wax.u.eventoffset(b),d=new MM.Point(c.x,c.y),e={x:parseFloat(MM.getStyle(document.documentElement,"margin-left")),y:parseFloat(MM.getStyle(document.documentElement,"margin-top"))};isNaN(e.x)||(d.x-=e.x),isNaN(e.y)||(d.y-=e.y);for(var f=a.parent;f;f=f.offsetParent)d.x-=f.offsetLeft,d.y-=f.offsetTop;return d}function e(a){var b=[];for(var c=0;c<a.length;c++)b.push(new MM.Location(a[c].lat,a[c].lon));return b}function f(){var b=new MM.Point(0,0);for(var c=0;c<n.length;c++){var d=a.locationPoint(n[c]);n[c].pointDiv||(n[c].pointDiv=document.createElement("div"),n[c].pointDiv.className="map-point-div",n[c].pointDiv.style.position="absolute",n[c].pointDiv.style.display="block",n[c].pointDiv.location=n[c],bean.add(n[c].pointDiv,"mouseup",function(b){var d=n[c];return function(b){MM.removeEvent(a.parent,"mouseup",h),m.deleteLocation(d,b)}}()),a.parent.appendChild(n[c].pointDiv)),n[c].pointDiv.style.left=d.x+"px",n[c].pointDiv.style.top=d.y+"px"}}function g(b){i=d(b),bean.add(a.parent,"mouseup",h)}function h(b){if(!i)return;j=d(b),MM.Point.distance(i,j)<k&&(m.addLocation(a.pointLocation(i)),o(e(n))),i=null}var i=null,j=null,k=5,l,m={},n=[],o=typeof c=="function"?c:c.callback;return m.addLocation=function(a){n.push(a),f(),o(e(n))},m.locations=function(a){return n},m.add=function(a){return bean.add(a.parent,"mousedown",g),a.addCallback("drawn",f),this},m.remove=function(a){bean.remove(a.parent,"mousedown",g),a.removeCallback("drawn",f);for(var b=n.length-1;b>-1;b--)m.deleteLocation(n[b]);return this},m.deleteLocation=function(a,b){if(!b||confirm("Delete this point?"))a.pointDiv.parentNode.removeChild(a.pointDiv),n.splice(wax.u.indexOf(n,a),1),o(e(n))},m.add(a)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoombox=function(a){function b(b){var c=new MM.Point(b.clientX,b.clientY);c.x+=document.body.scrollLeft+document.documentElement.scrollLeft,c.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var d=a.parent;d;d=d.offsetParent)c.x-=d.offsetLeft,c.y-=d.offsetTop;return c}function c(d){if(!g)return;g=!1;var f=b(d),j=a.pointLocation(f),k=a.pointLocation(i);a.setExtent([j,k]),h.style.display="none",MM.removeEvent(a.parent,"mousemove",e),MM.removeEvent(a.parent,"mouseup",c),a.parent.style.cursor="auto"}function d(d){if(!d.shiftKey||!!this.drawing)return;return g=!0,i=b(d),h.style.left=i.x+"px",h.style.top=i.y+"px",MM.addEvent(a.parent,"mousemove",e),MM.addEvent(a.parent,"mouseup",c),a.parent.style.cursor="crosshair",MM.cancelEvent(d)}function e(a){if(!g)return;var c=b(a);return h.style.display="block",c.x<i.x?h.style.left=c.x+"px":h.style.left=i.x+"px",h.style.width=Math.abs(c.x-i.x)+"px",c.y<i.y?h.style.top=c.y+"px":h.style.top=i.y+"px",h.style.height=Math.abs(c.y-i.y)+"px",MM.cancelEvent(a)}var f={},g=!1,h,i=null;return f.add=function(a){return h=h||document.createElement("div"),h.id=a.parent.id+"-zoombox-box",h.className="zoombox-box",a.parent.appendChild(h),MM.addEvent(a.parent,"mousedown",d),this},f.remove=function(){a.parent.removeChild(h),MM.removeEvent(a.parent,"mousedown",d)},f.add(a)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoomer=function(a){var b={},c=document.createElement("a");c.innerHTML="+",c.href="#",c.className="zoomer zoomin",bean.add(c,"mousedown dblclick",function(a){a.stop()}),bean.add(c,"touchstart click",function(b){b.stop(),a.zoomIn()},!1);var d=document.createElement("a");return d.innerHTML="-",d.href="#",d.className="zoomer zoomout",bean.add(d,"mousedown dblclick",function(a){a.stop()}),bean.add(d,"touchstart click",function(b){b.stop(),a.zoomOut()}),b.add=function(a){return a.addCallback("drawn",function(a,b){a.coordinate.zoom===a.coordLimits[0].zoom?d.className="zoomer zoomout zoomdisabled":a.coordinate.zoom===a.coordLimits[1].zoom?c.className="zoomer zoomin zoomdisabled":(c.className="zoomer zoomin",d.className="zoomer zoomout")}),b},b.appendTo=function(a){return wax.u.$(a).appendChild(c),wax.u.$(a).appendChild(d),b},b.add(a)};var wax=wax||{};wax.mm=wax.mm||{},wax.mm._provider=function(a){this.options={tiles:a.tiles,scheme:a.scheme||"xyz",minzoom:a.minzoom||0,maxzoom:a.maxzoom||22,bounds:a.bounds||[-180,-90,180,90]}},wax.mm._provider.prototype={outerLimits:function(){return[this.locationCoordinate(new MM.Location(this.options.bounds[0],this.options.bounds[1])).zoomTo(this.options.minzoom),this.locationCoordinate(new MM.Location(this.options.bounds[2],this.options.bounds[3])).zoomTo(this.options.maxzoom)]},getTile:function(a){if(!(coord=this.sourceCoordinate(a)))return null;if(coord.zoom<this.options.minzoom||coord.zoom>this.options.maxzoom)return null;coord.row=this.options.scheme==="tms"?Math.pow(2,coord.zoom)-coord.row-1:coord.row;var b=this.options.tiles[parseInt(Math.pow(2,coord.zoom)*coord.row+coord.column,10)%this.options.tiles.length].replace("{z}",coord.zoom.toFixed(0)).replace("{x}",coord.column.toFixed(0)).replace("{y}",coord.row.toFixed(0));return wax._&&wax._.bw&&(b=b.replace(".png",wax._.bw_png).replace(".jpg",wax._.bw_jpg)),b}},MM&&MM.extend(wax.mm._provider,MM.MapProvider),wax.mm.connector=function(a){var b=new wax.mm._provider(a);return new MM.Layer(b)},function(a,b){var c=function(){function j(a,b,c){return c===0?a:c===1?b:a+(b-a)*c}function l(a,c){var d=new b.Point(i.dimensions.x/2,i.dimensions.y/2);return d.x+=i.tileSize.x*(c.column-a.column),d.y+=i.tileSize.y*(c.row-a.row),d}var a={},c=!1,d=!1,e={easeIn:function(a){return a*a},easeOut:function(a){return Math.sin(a*Math.PI/2)},easeInOut:function(a){return(1-Math.cos(Math.PI*a))/2},linear:function(a){return a}},f=e.easeOut,g,h,i;a.stop=function(){d=!0},a.running=function(){return c},a.point=function(b){return h=i.pointCoordinate(b),a},a.zoom=function(b){return h=i.enforceZoomLimits(h.zoomTo(b)),a},a.location=function(b){return h=i.locationCoordinate(b),a},a.from=function(b){return arguments.length?(g=b.copy(),a):g.copy()},a.to=function(b){return arguments.length?(h=i.enforceZoomLimits(b.copy()),a):h.copy()},a.path=function(b){return m=k[b],a},a.easing=function(b){return f=e[b],a},a.map=function(b){return arguments.length?(i=b,g=i.coordinate.copy(),h=i.coordinate.copy(),a):i};var k={};k.screen=function(a,c,d){var e=j(a.zoom,c.zoom,d),f=a.copy(),g=c.copy().zoomTo(a.zoom);return(new b.Coordinate(j(f.row,g.row,d),j(f.column,g.column,d),f.zoom)).zoomTo(e)},k.about=function(a,b,c){var d=j(a.zoom,b.zoom,c),e=b.copy().zoomTo(a.zoom),f=a.copy().zoomTo(d),g=b.copy().zoomTo(d),h=l(a,e),k=l(f,g);return f.column-=(h.x-k.x)/i.tileSize.x,f.row-=(h.y-k.y)/i.tileSize.y,f};var m=k.screen;a.t=function(b){return i.coordinate=m(g,h,f(b)),i.draw(),a},a.future=function(a){var b=[];for(var c=0;c<a;c++)b.push(m(g,h,c/(a-1)));return b};var n;return a.resetRun=function(){return n=+(new Date),a},a.run=function(a,e){function j(){var k=+(new Date)-n;if(d)return void (d=c=!1);if(k>a){c=!1,i.coordinate=m(g,h,1),i.draw();if(e)return e(i)}else i.coordinate=m(g,h,f(k/a)),i.draw(),b.getFrame(j)}a=a||1e3,n=+(new Date),c=!0,b.getFrame(j)},a.optimal=function(c,d,e){function f(a){return a*a}function k(a){return(Math.exp(a)-Math.exp(-a))/2}function l(a){return(Math.exp(a)+Math.exp(-a))/2}function n(a){return k(a)/l(a)}function y(a){var b=f(r)-f(q)+(a?-1:1)*Math.pow(d,4)*f(x-w),c=2*(a?r:q)*f(d)*(x-w);return b/c}function z(a){return Math.log(-y(a)+Math.sqrt(f(y(a))+1))}c=c||.9,d=d||1.42,i.coordinate=g;var o=i.pointCoordinate(new b.Point(0,0)).zoomTo(0),p=i.pointCoordinate(i.dimensions).zoomTo(0),q=Math.max(p.column-o.column,p.row-o.row),r=q*Math.pow(2,g.zoom-h.zoom),s=g.zoomTo(0),t=h.zoomTo(0),u={x:s.column,y:s.row},v={x:t.column,y:t.row},w=0,x=Math.sqrt(f(v.x-u.x)+f(v.y-u.y)),A=z(0),B=z(1),C=(B-A)/d,D=function(a){return q*l(A)/l(d*a+A)},E=function(a){return q/f(d)*l(A)*n(d*a+A)-q/f(d)*k(A)+w};if(Math.abs(x)<1e-6){if(Math.abs(q-r)<1e-6)return;var F=r<q?-1:1;C=Math.abs(Math.log(r/q))/d,E=function(a){return w},D=function(a){return q*Math.exp(F*d*a)}}m=function(a,c,d){if(d==1)return h;var e=d*C,f=E(e),g=a.zoom+Math.log(q/D(e))/Math.LN2,i=j(u.x,v.x,f/x),k=j(u.y,v.y,f/x);return(new b.Coordinate(k,i,0)).zoomTo(g)},a.easing("linear"),a.run(C/c*1e3,e)},a};this.easey=c}(this,MM),function(a,b){easey.TouchHandler=function(){function r(a){var e={x:0,y:0},g=Math.max(.001,(a-d)/1e3);n&&o&&p>+(new Date)-50?(e.x=n.x-o.x,e.y=n.y-o.y,f.x=e.x,f.y=e.y):(f.x-=f.x*j,f.y-=f.y*j,Math.abs(f.x)<.001&&(f.x=0),Math.abs(f.y)<.001&&(f.y=0)),(f.x||f.y)&&c.panBy(f.x,f.y),d=a,b.getFrame(r)}function s(a,b){return a&&a.touch&&b.identifier==a.touch.identifier}function t(a){for(var b=0;b<a.touches.length;b+=1){var c=a.touches[b];if(c.identifier in k){var d=k[c.identifier];d.x=c.clientX,d.y=c.clientY,d.scale=a.scale}else k[c.identifier]={scale:a.scale,startPos:{x:c.clientX,y:c.screenY},x:c.clientX,y:c.clientY,time:(new Date).getTime()}}}function u(a){return t(a),b.cancelEvent(a)}function v(a){switch(a.touches.length){case 1:z(a.touches[0]);break;case 2:A(a)}return t(a),b.cancelEvent(a)}function w(a){if(l.length&&a.time-l[0].time<i){x(a),l=[];return}l=[a]}function x(a){easey().map(c).to(c.pointCoordinate(a).zoomTo(c.getZoom()+1)).path("about").run(200,function(){c.dispatchCallback("zoomed")})}function y(){var a=document.createElement("div");return a.setAttribute("ongesturestart","return;"),typeof a.ongesturestart=="function"}function z(a){p=+(new Date),o=n,n={x:a.clientX,y:a.clientY}}function A(a){var d=a.touches[0],e=a.touches[1],f=new b.Point(d.clientX,d.clientY),g=new b.Point(e.clientX,e.clientY),h=k[d.identifier],i=k[e.identifier];h.wasPinch=!0,i.wasPinch=!0;var j=b.Point.interpolate(f,g,.5);c.zoomByAbout(Math.log(a.scale)/Math.LN2-Math.log(h.scale)/Math.LN2,j);var l=b.Point.interpolate(h,i,.5);c.panBy(j.x-l.x,j.y-l.y),m=!0,q=j}function B(a){var b=c.getZoom(),d=Math.round(b);c.zoomByAbout(d-b,a),m=!1}function C(a){var c=(new Date).getTime();a.touches.length===0&&m&&B(q),o=n=null;for(var d=0;d<a.changedTouches.length;d+=1){var e=a.changedTouches[d],f=k[e.identifier];if(!f||f.wasPinch)continue;var i={x:e.clientX,y:e.clientY},j=c-f.time,l=b.Point.distance(i,f.startPos);l>h||(j>g?(i.end=c,i.duration=j,onHold(i)):(i.time=c,w(i)))}var p={};for(var r=0;r<a.touches.length;r++)p[a.touches[r].identifier]=!0;for(var s in k)s in p||delete p[s];return b.cancelEvent(a)}var a={},c,d=0,e=25,f=null,g=250,h=30,i=350,j=.1,k={},l=[],m=!1,n=null,o=null,p=null,q=null;return a.init=function(a){c=a;if(!y())return!1;b.addEvent(c.parent,"touchstart",u),b.addEvent(c.parent,"touchmove",v),b.addEvent(c.parent,"touchend",C),d=(new Date).getTime(),f={x:0,y:0},b.getFrame(r)},a.remove=function(){if(!y())return!1;b.removeEvent(c.parent,"touchstart",u),b.removeEvent(c.parent,"touchmove",v),b.removeEvent(c.parent,"touchend",C)},a},easey.DoubleClickHandler=function(){function d(a){var d=b.getMousePoint(a,c);return z=c.getZoom()+(a.shiftKey?-1:1),easey().map(c).to(c.pointCoordinate(b.getMousePoint(a,c)).zoomTo(z)).path("about").run(100,function(){c.dispatchCallback("zoomed")}),b.cancelEvent(a)}var a={},c;return a.init=function(e){return c=e,b.addEvent(c.parent,"dblclick",d),a},a.remove=function(){b.removeEvent(c.parent,"dblclick",d)},a},easey.MouseWheelHandler=function(){function h(a){function j(){c.dispatchCallback("zoomed")}var g=0;f=f||(new Date).getTime();try{d.scrollTop=1e3,d.dispatchEvent(a),g=1e3-d.scrollTop}catch(h){g=a.wheelDelta||-a.detail*5}var i=(new Date).getTime()-f;if(!e.running()){var k=b.getMousePoint(a,c),l=c.getZoom();e.map(c).easing("easeOut").to(c.pointCoordinate(b.getMousePoint(a,c)).zoomTo(l+(g>0?1:-1))).path("about").run(100,j),f=(new Date).getTime()}else i>150&&(e.zoom(e.to().zoom+(g>0?1:-1)).from(c.coordinate).resetRun(),f=(new Date).getTime());return b.cancelEvent(a)}var a={},c,d,e=easey(),f,g=!1;return a.init=function(e){c=e,d=document.body.appendChild(document.createElement("div")),d.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var f=d.appendChild(document.createElement("div"));return f.style.height="2000px",b.addEvent(c.parent,"mousewheel",h),a},a.precise=function(b){return arguments.length?(g=b,a):g},a.remove=function(){b.removeEvent(c.parent,"mousewheel",h),d.parentNode.removeChild(d)},a},easey.DragHandler=function(){function o(a){c.parent.focus()}function p(a){if(a.shiftKey||a.button==2)return;return b.addEvent(document,"mousemove",q),b.addEvent(document,"mouseup",r),j=k=b.getMousePoint(a,c),l=m=+(new Date),c.parent.style.cursor="move",b.cancelEvent(a)}function q(a){if(j)return n&&(k=j,m=l,n=!1),j=b.getMousePoint(a,c),l=+(new Date),b.cancelEvent(a)}function r(a){b.removeEvent(document,"mousemove",q),b.removeEvent(document,"mouseup",r);if(+(new Date)-m<50){dt=Math.max(1,l-m);var d={x:0,y:0};d.x=j.x-k.x,d.y=j.y-k.y,e.x=d.x/dt,e.y=d.y/dt}else e.x=0,e.y=0;return j=k=null,l=lastMoveTime=null,c.parent.style.cursor="",b.cancelEvent(a)}function s(a){var h={x:0,y:0},i=Math.max(1,a-d);j&&k?n||(h.x=j.x-k.x,h.y=j.y-k.y,c.panBy(h.x,h.y),n=!0):(e.x*=Math.pow(1-f,i*60/1e3),e.y*=Math.pow(1-f,i*60/1e3),Math.abs(e.x)<.001&&(e.x=0),Math.abs(e.y)<.001&&(e.y=0),(e.x||e.y)&&c.panBy(e.x*i,e.y*i)),d=a,g||b.getFrame(s)}var a={},c,d=0,e=null,f=.15,g=!1,h=null,i=0,j=null,k=null,l=null,m=null,n=!0;return a.init=function(a){c=a,b.addEvent(c.parent,"click",o),b.addEvent(c.parent,"mousedown",p),d=(new Date).getTime(),e={x:0,y:0},g=!1,b.getFrame(s)},a.remove=function(){b.removeEvent(c.parent,"click",o),b.removeEvent(c.parent,"mousedown",p),g=!0},a}}(this,MM),function(){function a(a,b){return a.style[b]?a.style[b]:a.currentStyle?a.currentStyle[b]:document.defaultView&&document.defaultView.getComputedStyle?(b=b.replace(/([A-Z])/g,"-$1"),b=b.toLowerCase(),s=document.defaultView.getComputedStyle(a,""),s&&s.getPropertyValue(b)):null}var b={};b.load=function(a,b){a.indexOf("http")!==0&&(a="http://a.tiles.mapbox.com/v3/"+a+".jsonp"),wax.tilejson(a,function(a){a.zoom=a.center[2],a.center={lat:a.center[1],lon:a.center[0]},a.thumbnail="http://a.tiles.mapbox.com/v3/"+a.id+".png",a.tiles&&(a.layer=new wax.mm.connector(a)),a.data?(a.markers=mmg().factory(simplestyle_factory),a.markers.url(a.data,function(){mmg_interaction(a.markers),b(a)})):b(a)})},b.auto=function(c,d){return function(e){var f=b.map(c);f.controls=document.createElement("div"),f.controls.style.cssText="position: absolute; z-index: 1000",f.controls.id="controls",f.parent.appendChild(f.controls);var g,h=["height","width"];for(g in h){var i=h[g];if(a(f.parent,i)==="0px"||a(f.parent,i)==="auto")f.parent.style[i]="400px"}e.layer&&f.addLayer(e.layer),e.markers&&f.addLayer(e.markers),e.attribution&&wax.mm.attribution(f,e).appendTo(f.parent),e.legend&&wax.mm.legend(f,e).appendTo(f.parent),e.fullscreen&&wax.mm.fullscreen(f,e).appendTo(f.controls),wax.mm.zoomer(f).appendTo(f.controls),wax.mm.zoombox(f),f.zoom(e.zoom).center(e.center),wax.mm.interaction().map(f).tilejson(e).on(wax.tooltip().parent(f.parent).events()),f.setZoomRange(e.minzoom,e.maxzoom),d&&d(f,e)}},b.markers=function(){var a=mmg().factory(simplestyle_factory);return mmg_interaction(a),a};var c=[easey.TouchHandler,easey.DragHandler,easey.DoubleClickHandler,easey.MouseWheelHandler],d=[MM.TouchHandler,MM.DragHandler,MM.DoubleClickHandler,MM.MouseWheelHandler];MM.Map.prototype.smooth=function(a){while(this.eventHandlers.length)this.eventHandlers.pop().remove();if(a)for(var b=0;b<c.length;b++){var e=c[b]();this.eventHandlers.push(e),e.init(this)}else for(var f=0;f<d.length;f++){var g=d[f]();this.eventHandlers.push(g),g.init(this)}return this},b.map=function(a,b){var c=new MM.Map(a,b,null,[easey.TouchHandler(),easey.DragHandler(),easey.DoubleClickHandler(),easey.MouseWheelHandler()]);return c.center=function(a,b){if(!a||!b)return a?this.setCenter(a):this.getCenter();easey().map(this).to(this.locationCoordinate(a)).optimal(null,null,b.callback||function(){})},c.zoom=function(a,b){if(a===undefined||!b)return a!==undefined?this.setZoom(a):this.getZoom();easey().map(this).to(this.locationCoordinate(this.getCenter()).copy().zoomTo(a)).run(600)},c.centerzoom=function(a,b,c){if(a&&b!==undefined&&c)easey().map(this).to(this.locationCoordinate(a).zoomTo(b)).run(c.duration||1e3,c.callback||function(){});else if(a&&b!==undefined)return this.setCenterZoom(a,b)},c},this.mapbox=b}(this),typeof mapbox=="undefined"&&(mapbox={}),mapbox.provider=function(a){this.options={tiles:a.tiles,scheme:a.scheme||"xyz",minzoom:a.minzoom||0,maxzoom:a.maxzoom||22,bounds:a.bounds||[-180,-90,180,90]}},mapbox.provider.prototype={tileLimits:[new MM.Coordinate(0,0,0),(new MM.Coordinate(1,1,0)).zoomTo(18)],releaseTile:function(a){},getTile:function(a){return(coord=this.sourceCoordinate(a))?coord.zoom<this.options.minzoom||coord.zoom>this.options.maxzoom?null:this.options.tiles[parseInt(Math.pow(2,coord.zoom)*coord.row+coord.column,10)%this.options.tiles.length].replace("{z}",coord.zoom.toFixed(0)).replace("{x}",coord.column.toFixed(0)).replace("{y}",coord.row.toFixed(0)):null},setZoomRange:function(a,b){this.tileLimits[0]=this.tileLimits[0].zoomTo(a),this.tileLimits[1]=this.tileLimits[1].zoomTo(b)},sourceCoordinate:function(a){var b=this.tileLimits[0].zoomTo(a.zoom),c=this.tileLimits[1].zoomTo(a.zoom),d=Math.pow(2,a.zoom),e;return a.column<0?e=(a.column%d+d)%d:e=a.column%d,a.row<b.row||a.row>=c.row?null:e<b.column||e>=c.column?null:new MM.Coordinate(a.row,e,a.zoom)}},mapbox.layer=function(){if(!(this instanceof mapbox.layer))return new mapbox.layer;this._tilejson={},this._url="",this.parent=document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new MM.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),this.setProvider(new mapbox.provider({tiles:["data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="]}))},mapbox.layer.prototype.refresh=function(){var a=this;return wax.tilejson(this._url,function(b){a.tilejson(b)}),this},mapbox.layer.prototype.url=function(a){return arguments.length?(this._url=a,this.refresh()):this.url},mapbox.layer.prototype.id=function(a){return this.url("http://a.tiles.mapbox.com/v3/"+a+".jsonp"),this.refresh()},mapbox.layer.prototype.tilejson=function(a){return arguments.length?(this.setProvider(new mapbox.provider(a)),this._tilejson=a,this):this._tilejson},mapbox.layer.prototype.name=function(a){return arguments.length?(this.name=name,this):this.name},MM.extend(mapbox.layer,MM.Layer);
=======
  */function simplestyle_factory(e){var t={small:[20,50],medium:[30,70],large:[35,90]},n=e.properties||{},r=n["marker-size"]||"medium",i=n["marker-symbol"]?"-"+n["marker-symbol"]:"",s=n["marker-color"]||"7e7e7e";s=s.replace("#","");var o=document.createElement("img");o.width=t[r][0],o.height=t[r][1],o.className="simplestyle-marker",o.alt=n.title||"",o.src=(simplestyle_factory.baseurl||"http://a.tiles.mapbox.com/v3/marker/")+"pin-"+r.charAt(0)+i+"+"+s+".png"+(window.devicePixelRatio===2?"@2x":"");var u=o.style;return u.position="absolute",u.clip="rect(auto auto "+t[r][1]*.75+"px auto)",u.marginTop=-(t[r][1]/2)+"px",u.marginLeft=-(t[r][0]/2)+"px",u.cursor="pointer",u.pointerEvents="all",o}!function(e,t,n){typeof module!="undefined"?module.exports=n(e,t):typeof define=="function"&&typeof define.amd=="object"?define(n):t[e]=n(e,t)}("bean",this,function(e,t){var n=window,r=t[e],i=/over|out/,s=/[^\.]*(?=\..*)\.|.*/,o=/\..*/,u="addEventListener",a="attachEvent",f="removeEventListener",l="detachEvent",c="ownerDocument",h="target",p="querySelectorAll",d=document||{},v=d.documentElement||{},m=v[u],g=m?u:a,y=Array.prototype.slice,b=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,w=/mouse.*(wheel|scroll)/i,E=/^text/i,S=/^touch|^gesture/i,x={},T=function(e,t,n){for(n=0;n<t.length;n++)e[t[n]]=1;return e}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange message error abort scroll "+(m?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),N=function(){function e(e){var t=e.relatedTarget;return t?t!==this&&t.prefix!=="xul"&&!/document/.test(this.toString())&&!n(t,this):t===null}var t="compareDocumentPosition",n=t in v?function(e,n){return n[t]&&(n[t](e)&16)===16}:"contains"in v?function(e,t){return t=t.nodeType===9||t===window?v:t,t!==e&&t.contains(e)}:function(e,t){while(e=e.parentNode)if(e===t)return 1;return 0};return{mouseenter:{base:"mouseover",condition:e},mouseleave:{base:"mouseout",condition:e},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),C=function(){var e="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),t=e.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),n=t.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),r=e.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),s=e.concat(["data"]),o=e.concat("touches targetTouches changedTouches scale rotation".split(" ")),u=e.concat(["data","origin","source"]),a="preventDefault",f=function(e){return function(){e[a]?e[a]():e.returnValue=!1}},l="stopPropagation",c=function(e){return function(){e[l]?e[l]():e.cancelBubble=!0}},p=function(e){return function(){e[a](),e[l](),e.stopped=!0}},m=function(e,t,n){var r,i;for(r=n.length;r--;)i=n[r],!(i in t)&&i in e&&(t[i]=e[i])};return function(g,y){var x={originalEvent:g,isNative:y};if(!g)return x;var T,N=g.type,C=g[h]||g.srcElement;x[a]=f(g),x[l]=c(g),x.stop=p(x),x[h]=C&&C.nodeType===3?C.parentNode:C;if(y){if(N.indexOf("key")!==-1)T=r,x.keyCode=g.keyCode||g.which;else if(b.test(N)){T=t,x.rightClick=g.which===3||g.button===2,x.pos={x:0,y:0};if(g.pageX||g.pageY)x.clientX=g.pageX,x.clientY=g.pageY;else if(g.clientX||g.clientY)x.clientX=g.clientX+d.body.scrollLeft+v.scrollLeft,x.clientY=g.clientY+d.body.scrollTop+v.scrollTop;i.test(N)&&(x.relatedTarget=g.relatedTarget||g[(N==="mouseover"?"from":"to")+"Element"])}else S.test(N)?T=o:w.test(N)?T=n:E.test(N)?T=s:N==="message"&&(T=u);m(g,x,T||e)}return x}}(),k=function(e,t){return!m&&!t&&(e===d||e===n)?v:e},L=function(){function e(e,t,n,r,i){var s=this.isNative=T[t]&&e[g];this.element=e,this.type=t,this.handler=n,this.original=r,this.namespaces=i,this.custom=N[t],this.eventType=m||s?t:"propertychange",this.customType=!m&&!s&&t,this[h]=k(e,s),this[g]=this[h][g]}return e.prototype={inNamespaces:function(e){var t,n;if(!e)return!0;if(!this.namespaces)return!1;for(t=e.length;t--;)for(n=this.namespaces.length;n--;)if(e[t]===this.namespaces[n])return!0;return!1},matches:function(e,t,n){return this.element===e&&(!t||this.original===t)&&(!n||this.handler===n)}},e}(),A=function(){var e={},t=function(n,r,i,s,o){if(!r||r==="*")for(var u in e)u.charAt(0)==="$"&&t(n,u.substr(1),i,s,o);else{var a=0,f,l=e["$"+r],c=n==="*";if(!l)return;for(f=l.length;a<f;a++)if(c||l[a].matches(n,i,s))if(!o(l[a],l,a,r))return}},n=function(t,n,r){var i,s=e["$"+n];if(s)for(i=s.length;i--;)if(s[i].matches(t,r,null))return!0;return!1},r=function(e,n,r){var i=[];return t(e,n,r,null,function(e){return i.push(e)}),i},i=function(t){return(e["$"+t.type]||(e["$"+t.type]=[])).push(t),t},s=function(n){t(n.element,n.type,null,n.handler,function(t,n,r){return n.splice(r,1),n.length===0&&delete e["$"+t.type],!1})},o=function(){var t,n=[];for(t in e)t.charAt(0)==="$"&&(n=n.concat(e[t]));return n};return{has:n,get:r,put:i,del:s,entries:o}}(),O=d[p]?function(e,t){return t[p](e)}:function(){throw new Error("Bean: No selector engine installed")},M=function(e){O=e},_=m?function(e,t,n,r){e[r?u:f](t,n,!1)}:function(e,t,n,r,i){i&&r&&e["_on"+i]===null&&(e["_on"+i]=0),e[r?a:l]("on"+t,n)},D=function(e,t,r){var i=t.__beanDel,s=function(s){return s=C(s||((this[c]||this.document||this).parentWindow||n).event,!0),i&&(s.currentTarget=i.ft(s[h],e)),t.apply(e,[s].concat(r))};return s.__beanDel=i,s},P=function(e,t,r,i,s,o){var u=t.__beanDel,a=function(a){var f=u?u.ft(a[h],e):this;if(i?i.apply(f,arguments):m?!0:a&&a.propertyName==="_on"+r||!a)a&&(a=C(a||((this[c]||this.document||this).parentWindow||n).event,o),a.currentTarget=f),t.apply(e,a&&(!s||s.length===0)?arguments:y.call(arguments,a?0:1).concat(s))};return a.__beanDel=u,a},H=function(e,t,n,r,i){return function(){e(t,n,i),r.apply(this,arguments)}},B=function(e,t,n,r){var i,s,u,a=t&&t.replace(o,""),f=A.get(e,a,n);for(i=0,s=f.length;i<s;i++)f[i].inNamespaces(r)&&((u=f[i])[g]&&_(u[h],u.eventType,u.handler,!1,u.type),A.del(u))},j=function(e,t,n,r,i){var u,a=t.replace(o,""),f=t.replace(s,"").split(".");if(A.has(e,a,n))return e;a==="unload"&&(n=H(B,e,a,n,r)),N[a]&&(N[a].condition&&(n=P(e,n,a,N[a].condition,i,!0)),a=N[a].base||a),u=A.put(new L(e,a,n,r,f[0]&&f)),u.handler=u.isNative?D(e,u.handler,i):P(e,u.handler,a,!1,i,!1),u[g]&&_(u[h],u.eventType,u.handler,!0,u.customType)},F=function(e,t,n){var r=function(t,r){var i,s=typeof e=="string"?n(e,r):e;for(;t&&t!==r;t=t.parentNode)for(i=s.length;i--;)if(s[i]===t)return t},i=function(e){var n=r(e[h],this);n&&t.apply(n,arguments)};return i.__beanDel={ft:r,selector:e,$:n},i},I=function(e,t,n){var r,i,u,a,f=B,l=t&&typeof t=="string";if(l&&t.indexOf(" ")>0){t=t.split(" ");for(a=t.length;a--;)I(e,t[a],n);return e}i=l&&t.replace(o,""),i&&N[i]&&(i=N[i].type);if(!t||l){if(u=l&&t.replace(s,""))u=u.split(".");f(e,i,n,u)}else if(typeof t=="function")f(e,null,t);else for(r in t)t.hasOwnProperty(r)&&I(e,r,t[r]);return e},q=function(e,t,n,r,i){var s,o,u,a,f=n,l=n&&typeof n=="string";if(t&&!n&&typeof t=="object")for(s in t)t.hasOwnProperty(s)&&q.apply(this,[e,s,t[s]]);else{a=arguments.length>3?y.call(arguments,3):[],o=(l?n:t).split(" "),l&&(n=F(t,f=r,i||O))&&(a=y.call(a,1)),this===x&&(n=H(I,e,t,n,f));for(u=o.length;u--;)j(e,o[u],n,f,a)}return e},R=function(){return q.apply(x,arguments)},U=m?function(e,t,r){var i=d.createEvent(e?"HTMLEvents":"UIEvents");i[e?"initEvent":"initUIEvent"](t,!0,!0,n,1),r.dispatchEvent(i)}:function(e,t,n){n=k(n,e),e?n.fireEvent("on"+t,d.createEventObject()):n["_on"+t]++},z=function(e,t,n){var r,i,u,a,f,l=t.split(" ");for(r=l.length;r--;){t=l[r].replace(o,"");if(a=l[r].replace(s,""))a=a.split(".");if(!a&&!n&&e[g])U(T[t],t,e);else{f=A.get(e,t),n=[!1].concat(n);for(i=0,u=f.length;i<u;i++)f[i].inNamespaces(a)&&f[i].handler.apply(e,n)}}return e},W=function(e,t,n){var r=0,i=A.get(t,n),s=i.length,o,u;for(;r<s;r++)i[r].original&&(u=i[r].handler.__beanDel,u?o=[e,u.selector,i[r].type,i[r].original,u.$]:o=[e,i[r].type,i[r].original],q.apply(null,o));return e},X={add:q,one:R,remove:I,clone:W,fire:z,setSelectorEngine:M,noConflict:function(){return t[e]=r,this}};if(n[a]){var V=function(){var e,t=A.entries();for(e in t)t[e].type&&t[e].type!=="unload"&&I(t[e].element,t[e].type);n[l]("onunload",V),n.CollectGarbage&&n.CollectGarbage()};n[a]("onunload",V)}return X});var Mustache=typeof module!="undefined"&&module.exports||{};(function(e){function u(e,t){return RegExp.prototype.test.call(e,t)}function a(e){return!u(r,e)}function c(e){var t=e.replace(l,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)});return'"'+t+'"'}function h(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function d(e){return String(e).replace(/[&<>"'\/]/g,function(e){return p[e]})}function v(e){this.string=e,this.tail=e,this.pos=0}function m(e,t){this.view=e,this.parent=t,this.clearCache()}function g(){this.clearCache()}function y(e,t){typeof e=="string"&&(e=S(e));var n=['""'],r,i,s;for(var o=0,u=e.length;o<u;++o){r=e[o];switch(r.type){case"#":case"^":i=r.type==="#"?"_section":"_inverted",n.push("r."+i+"("+c(r.value)+", c, function (c, r) {\n"+"  "+y(r.tokens,!0)+"\n"+"})");break;case"{":case"&":case"name":s=r.type==="name"?"true":"false",n.push("r._name("+c(r.value)+", c, "+s+")");break;case">":n.push("r._partial("+c(r.value)+", c)");break;case"text":n.push(c(r.value))}}return n="return "+n.join(" + ")+";",t?n:new Function("c, r",n)}function b(e){if(e.length===2)return[new RegExp(h(e[0])+"\\s*"),new RegExp("\\s*"+h(e[1]))];throw new Error("Invalid tags: "+e.join(" "))}function w(e){var t=[],n=t,r=[],i,s;for(var o=0;o<e.length;++o){i=e[o];switch(i.type){case"#":case"^":i.tokens=[],r.push(i),n.push(i),n=i.tokens;break;case"/":if(r.length===0)throw new Error("Unopened section: "+i.value);s=r.pop();if(s.value!==i.value)throw new Error("Unclosed section: "+s.value);r.length>0?n=r[r.length-1].tokens:n=t;break;default:n.push(i)}}s=r.pop();if(s)throw new Error("Unclosed section: "+s.value);return t}function E(e){var t;for(var n=0;n<e.length;++n){var r=e[n];t&&t.type==="text"&&r.type==="text"?(t.value+=r.value,e.splice(n--,1)):t=r}}function S(r,u){u=u||e.tags;var f=b(u),l=new v(r),c=[],p=[],d=!1,m=!1,g=function(){if(d&&!m)while(p.length)c.splice(p.pop(),1);else p=[];d=!1,m=!1},y,S,x;while(!l.eos()){S=l.scanUntil(f[0]);if(S)for(var T=0,N=S.length;T<N;++T)x=S[T],a(x)?p.push(c.length):m=!0,c.push({type:"text",value:x}),x==="\n"&&g();if(!l.scan(f[0]))break;d=!0,y=l.scan(o)||"name",l.scan(t);if(y==="=")S=l.scanUntil(i),l.scan(i),l.scanUntil(f[1]);else if(y==="{"){var C=new RegExp("\\s*"+h("}"+u[1]));S=l.scanUntil(C),l.scan(s),l.scanUntil(f[1])}else S=l.scanUntil(f[1]);if(!l.scan(f[1]))throw new Error("Unclosed tag at "+l.pos);c.push({type:y,value:S});if(y==="name"||y==="{"||y==="&")m=!0;y==="="&&(u=S.split(n),f=b(u))}return E(c),w(c)}function T(){x.clearCache()}function N(e,t){return x.compile(e,t)}function C(e,t,n){return x.compilePartial(e,t,n)}function k(e,t,n){if(n)for(var r in n)C(r,n[r]);return x.render(e,t)}e.name="mustache.js",e.version="0.5.1-dev",e.tags=["{{","}}"],e.parse=S,e.clearCache=T,e.compile=N,e.compilePartial=C,e.render=k,e.Scanner=v,e.Context=m,e.Renderer=g,e.to_html=function(e,t,n,r){var i=k(e,t,n);if(typeof r!="function")return i;r(i)};var t=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,s=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/,f=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},l=/[\x00-\x2F\x3A-\x40\x5B-\x60\x7B-\xFF\u2028\u2029]/gm,p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.isWhitespace=a,e.isArray=f,e.quote=c,e.escapeRe=h,e.escapeHtml=d,v.prototype.eos=function(){return this.tail===""},v.prototype.scan=function(e){var t=this.tail.match(e);return t&&t.index===0?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):null},v.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t=null;break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},m.make=function(e){return e instanceof m?e:new m(e)},m.prototype.clearCache=function(){this._cache={}},m.prototype.push=function(e){return new m(e,this)},m.prototype.lookup=function(e){var t=this._cache[e];if(!t){if(e===".")t=this.view;else{var n=this;while(n){if(e.indexOf(".")>0){var r=e.split("."),i=0;t=n.view;while(t&&i<r.length)t=t[r[i++]]}else t=n.view[e];if(t!=null)break;n=n.parent}}this._cache[e]=t}return typeof t=="function"&&(t=t.call(this.view)),t},g.prototype.clearCache=function(){this._cache={},this._partialCache={}},g.prototype.compile=function(e,t){var n=y(e),r=this;return function(e){return n(m.make(e),r)}},g.prototype.compilePartial=function(e,t,n){return this._partialCache[e]=this.compile(t,n),this._partialCache[e]},g.prototype.render=function(e,t){var n=this._cache[e];return n||(n=this.compile(e),this._cache[e]=n),n(t)},g.prototype._section=function(e,t,n){var r=t.lookup(e);switch(typeof r){case"object":if(f(r)){var i="";for(var s=0,o=r.length;s<o;++s)i+=n(t.push(r[s]),this);return i}return n(t.push(r),this);case"function":var u=n(t,this),a=this,l=function(e){return a.render(e,t)};return r.call(t.view,u,l)||"";default:if(r)return n(t,this)}return""},g.prototype._inverted=function(e,t,n){var r=t.lookup(e);return r==null||r===!1||f(r)&&r.length===0?n(t,this):""},g.prototype._partial=function(e,t){var n=this._partialCache[e];return n?n(t,this):""},g.prototype._name=function(e,t,n){var r=t.lookup(e);typeof r=="function"&&(r=r.call(t.view));var i=r==null?"":String(r);return n?d(i):i};var x=new g})(Mustache),!function(e,t){typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(e,t):this[e]=t()}("reqwest",function(){function handleReadyState(e,t,n){return function(){e&&e[readyState]==4&&(twoHundo.test(e.status)?t(e):n(e))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r])}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||"reqwest_"+i,u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0;a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e.success&&e.success(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f)}function getRequest(e,t,n){var r=(e.method||"GET").toUpperCase(),i=typeof e=="string"?e:e.url,s=e.processData!==!1&&e.data&&typeof e.data!="string"?reqwest.toQueryString(e.data):e.data||null,o;return(e.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),e.type=="jsonp"?handleJsonp(e,t,n,i):(o=xhr(),o.open(r,i,!0),setHeaders(o,e),o.onreadystatechange=handleReadyState(o,t,n),e.before&&e.before(o),o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(e)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(e,t,n){o.error&&o.error(e,t,n),complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(e.disabled||!n)return;switch(r){case"input":if(!/reset|button|image|file/i.test(e.type)){var s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value;(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u))}break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(var a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r,i=function(t,n){for(var i=0;i<n.length;i++){var s=t[byTag](n[i]);for(r=0;r<s.length;r++)serial(s[r],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),i(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e){var t="",n,r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"};if(isArray(e))for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value);else for(var s in e){if(!Object.hasOwnProperty.call(e,s))continue;var o=e[s];if(isArray(o))for(n=0;n<o.length;n++)i(s,o[n]);else i(s,e[s])}return t.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest});var previousMM=MM;if(!com){var com={};com.modestmaps||(com.modestmaps={})}var MM=com.modestmaps={noConflict:function(){return MM=previousMM,this}};(function(e){e.extend=function(e,t){for(var n in t.prototype)typeof e.prototype[n]=="undefined"&&(e.prototype[n]=t.prototype[n]);return e},e.getFrame=function(){return function(e){(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(+(new Date))},10)})(e)}}(),e.transformProperty=function(e){if(!this.document)return;var t=document.documentElement.style;for(var n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}(["transformProperty","WebkitTransform","OTransform","MozTransform","msTransform"]),e.matrixString=function(t){t.scale*t.width%1&&(t.scale+=(1-t.scale*t.width%1)/t.width);var n=t.scale||1;return e._browser.webkit3d?"translate3d("+t.x.toFixed(0)+"px,"+t.y.toFixed(0)+"px, 0px)scale3d("+n+","+n+", 1)":"translate("+t.x.toFixed(6)+"px,"+t.y.toFixed(6)+"px)scale("+n+","+n+")"},e._browser=function(e){return{webkit:"WebKitCSSMatrix"in e,webkit3d:"WebKitCSSMatrix"in e&&"m11"in new WebKitCSSMatrix}}(this),e.moveElement=function(t,n){if(e.transformProperty){n.scale||(n.scale=1),n.width||(n.width=0),n.height||(n.height=0);var r=e.matrixString(n);t[e.transformProperty]!==r&&(t.style[e.transformProperty]=t[e.transformProperty]=r)}else t.style.left=n.x+"px",t.style.top=n.y+"px",n.width&&n.height&&n.scale&&(t.style.width=Math.ceil(n.width*n.scale)+"px",t.style.height=Math.ceil(n.height*n.scale)+"px")},e.cancelEvent=function(e){return e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},e.coerceLayer=function(t){return typeof t=="string"?new e.Layer(new e.TemplatedLayer(t)):"draw"in t&&typeof t.draw=="function"?t:new e.Layer(t)},e.addEvent=function(e,t,n){e.addEventListener?(e.addEventListener(t,n,!1),t=="mousewheel"&&e.addEventListener("DOMMouseScroll",n,!1)):e.attachEvent&&(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n]))},e.removeEvent=function(e,t,n){e.removeEventListener?(e.removeEventListener(t,n,!1),t=="mousewheel"&&e.removeEventListener("DOMMouseScroll",n,!1)):e.detachEvent&&(e.detachEvent("on"+t,e[t+n]),e[t+n]=null)},e.getStyle=function(e,t){if(e.currentStyle)return e.currentStyle[t];if(window.getComputedStyle)return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)},e.Point=function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},e.Point.prototype={x:0,y:0,toString:function(){return"("+this.x.toFixed(3)+", "+this.y.toFixed(3)+")"},copy:function(){return new e.Point(this.x,this.y)}},e.Point.distance=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},e.Point.interpolate=function(t,n,r){return new e.Point(t.x+(n.x-t.x)*r,t.y+(n.y-t.y)*r)},e.Coordinate=function(e,t,n){this.row=e,this.column=t,this.zoom=n},e.Coordinate.prototype={row:0,column:0,zoom:0,toString:function(){return"("+this.row.toFixed(3)+", "+this.column.toFixed(3)+" @"+this.zoom.toFixed(3)+")"},toKey:function(){return this.zoom+","+this.row+","+this.column},copy:function(){return new e.Coordinate(this.row,this.column,this.zoom)},container:function(){return new e.Coordinate(Math.floor(this.row),Math.floor(this.column),Math.floor(this.zoom))},zoomTo:function(t){var n=Math.pow(2,t-this.zoom);return new e.Coordinate(this.row*n,this.column*n,t)},zoomBy:function(t){var n=Math.pow(2,t);return new e.Coordinate(this.row*n,this.column*n,this.zoom+t)},up:function(t){return t===undefined&&(t=1),new e.Coordinate(this.row-t,this.column,this.zoom)},right:function(t){return t===undefined&&(t=1),new e.Coordinate(this.row,this.column+t,this.zoom)},down:function(t){return t===undefined&&(t=1),new e.Coordinate(this.row+t,this.column,this.zoom)},left:function(t){return t===undefined&&(t=1),new e.Coordinate(this.row,this.column-t,this.zoom)}},e.Location=function(e,t){this.lat=parseFloat(e),this.lon=parseFloat(t)},e.Location.prototype={lat:0,lon:0,toString:function(){return"("+this.lat.toFixed(3)+", "+this.lon.toFixed(3)+")"},copy:function(){return new e.Location(this.lat,this.lon)}},e.Location.distance=function(e,t,n){n||(n=6378e3);var r=Math.PI/180,i=e.lat*r,s=e.lon*r,o=t.lat*r,u=t.lon*r,a=Math.cos(i)*Math.cos(s)*Math.cos(o)*Math.cos(u),f=Math.cos(i)*Math.sin(s)*Math.cos(o)*Math.sin(u),l=Math.sin(i)*Math.sin(o);return Math.acos(a+f+l)*n},e.Location.interpolate=function(t,n,r){if(t.lat===n.lat&&t.lon===n.lon)return new e.Location(t.lat,t.lon);var i=Math.PI/180,s=t.lat*i,o=t.lon*i,u=n.lat*i,f=n.lon*i,l=2*Math.asin(Math.sqrt(Math.pow(Math.sin((s-u)/2),2)+Math.cos(s)*Math.cos(u)*Math.pow(Math.sin((o-f)/2),2))),c=Math.sin((1-r)*l)/Math.sin(l),h=Math.sin(r*l)/Math.sin(l),p=c*Math.cos(s)*Math.cos(o)+h*Math.cos(u)*Math.cos(f),d=c*Math.cos(s)*Math.sin(o)+h*Math.cos(u)*Math.sin(f),v=c*Math.sin(s)+h*Math.sin(u),m=Math.atan2(v,Math.sqrt(Math.pow(p,2)+Math.pow(d,2))),g=Math.atan2(d,p);return new e.Location(m/i,g/i)},e.Location.bearing=function(e,t){var n=Math.PI/180,r=e.lat*n,i=e.lon*n,s=t.lat*n,o=t.lon*n,u=Math.atan2(Math.sin(i-o)*Math.cos(s),Math.cos(r)*Math.sin(s)-Math.sin(r)*Math.cos(s)*Math.cos(i-o))/-(Math.PI/180);return u<0?u+360:u},e.Extent=function(t,n,r,i){if(t instanceof e.Location&&n instanceof e.Location){var s=t,o=n;t=s.lat,n=s.lon,r=o.lat,i=o.lon}isNaN(r)&&(r=t),isNaN(i)&&(i=n),this.north=Math.max(t,r),this.south=Math.min(t,r),this.east=Math.max(i,n),this.west=Math.min(i,n)},e.Extent.prototype={north:0,south:0,east:0,west:0,copy:function(){return new e.Extent(this.north,this.west,this.south,this.east)},toString:function(e){return isNaN(e)&&(e=3),[this.north.toFixed(e),this.west.toFixed(e),this.south.toFixed(e),this.east.toFixed(e)].join(", ")},northWest:function(){return new e.Location(this.north,this.west)},southEast:function(){return new e.Location(this.south,this.east)},northEast:function(){return new e.Location(this.north,this.east)},southWest:function(){return new e.Location(this.south,this.west)},center:function(){return new e.Location(this.south+(this.north-this.south)/2,this.east+(this.west-this.east)/2)},encloseLocation:function(e){e.lat>this.north&&(this.north=e.lat),e.lat<this.south&&(this.south=e.lat),e.lon>this.east&&(this.east=e.lon),e.lon<this.west&&(this.west=e.lon)},encloseLocations:function(e){var t=e.length;for(var n=0;n<t;n++)this.encloseLocation(e[n])},setFromLocations:function(e){var t=e.length,n=e[0];this.north=this.south=n.lat,this.east=this.west=n.lon;for(var r=1;r<t;r++)this.encloseLocation(e[r])},encloseExtent:function(e){e.north>this.north&&(this.north=e.north),e.south<this.south&&(this.south=e.south),e.east>this.east&&(this.east=e.east),e.west<this.west&&(this.west=e.west)},containsLocation:function(e){return e.lat>=this.south&&e.lat<=this.north&&e.lon>=this.west&&e.lon<=this.east},toArray:function(){return[this.northWest(),this.southEast()]}},e.Extent.fromString=function(t){var n=t.split(/\s*,\s*/);if(n.length!=4)throw"Invalid extent string (expecting 4 comma-separated numbers)";return new e.Extent(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))},e.Extent.fromArray=function(t){var n=new e.Extent;return n.setFromLocations(t),n},e.Transformation=function(e,t,n,r,i,s){this.ax=e,this.bx=t,this.cx=n,this.ay=r,this.by=i,this.cy=s},e.Transformation.prototype={ax:0,bx:0,cx:0,ay:0,by:0,cy:0,transform:function(t){return new e.Point(this.ax*t.x+this.bx*t.y+this.cx,this.ay*t.x+this.by*t.y+this.cy)},untransform:function(t){return new e.Point((t.x*this.by-t.y*this.bx-this.cx*this.by+this.cy*this.bx)/(this.ax*this.by-this.ay*this.bx),(t.x*this.ay-t.y*this.ax-this.cx*this.ay+this.cy*this.ax)/(this.bx*this.ay-this.by*this.ax))}},e.deriveTransformation=function(t,n,r,i,s,o,u,f,l,c,h,p){var d=e.linearSolution(t,n,r,s,o,u,l,c,h),v=e.linearSolution(t,n,i,s,o,f,l,c,p);return new e.Transformation(d[0],d[1],d[2],v[0],v[1],v[2])},e.linearSolution=function(e,t,n,r,i,s,o,u,a){e=parseFloat(e),t=parseFloat(t),n=parseFloat(n),r=parseFloat(r),i=parseFloat(i),s=parseFloat(s),o=parseFloat(o),u=parseFloat(u),a=parseFloat(a);var f=((s-a)*(t-i)-(n-s)*(i-u))/((r-o)*(t-i)-(e-r)*(i-u)),l=((s-a)*(e-r)-(n-s)*(r-o))/((i-u)*(e-r)-(t-i)*(r-o)),c=n-e*f-t*l;return[f,l,c]},e.Projection=function(t,n){n||(n=new e.Transformation(1,0,0,0,1,0)),this.zoom=t,this.transformation=n},e.Projection.prototype={zoom:0,transformation:null,rawProject:function(e){throw"Abstract method not implemented by subclass."},rawUnproject:function(e){throw"Abstract method not implemented by subclass."},project:function(e){return e=this.rawProject(e),this.transformation&&(e=this.transformation.transform(e)),e},unproject:function(e){return this.transformation&&(e=this.transformation.untransform(e)),e=this.rawUnproject(e),e},locationCoordinate:function(t){var n=new e.Point(Math.PI*t.lon/180,Math.PI*t.lat/180);return n=this.project(n),new e.Coordinate(n.y,n.x,this.zoom)},coordinateLocation:function(t){t=t.zoomTo(this.zoom);var n=new e.Point(t.column,t.row);return n=this.unproject(n),new e.Location(180*n.y/Math.PI,180*n.x/Math.PI)}},e.LinearProjection=function(t,n){e.Projection.call(this,t,n)},e.LinearProjection.prototype={rawProject:function(t){return new e.Point(t.x,t.y)},rawUnproject:function(t){return new e.Point(t.x,t.y)}},e.extend(e.LinearProjection,e.Projection),e.MercatorProjection=function(t,n){e.Projection.call(this,t,n)},e.MercatorProjection.prototype={rawProject:function(t){return new e.Point(t.x,Math.log(Math.tan(.25*Math.PI+.5*t.y)))},rawUnproject:function(t){return new e.Point(t.x,2*Math.atan(Math.pow(Math.E,t.y))-.5*Math.PI)}},e.extend(e.MercatorProjection,e.Projection),e.MapProvider=function(e){e&&(this.getTile=e)},e.MapProvider.prototype={tileLimits:[new e.Coordinate(0,0,0),(new e.Coordinate(1,1,0)).zoomTo(18)],getTileUrl:function(e){throw"Abstract method not implemented by subclass."},getTile:function(e){throw"Abstract method not implemented by subclass."},releaseTile:function(e){},setZoomRange:function(e,t){this.tileLimits[0]=this.tileLimits[0].zoomTo(e),this.tileLimits[1]=this.tileLimits[1].zoomTo(t)},sourceCoordinate:function(t){var n=this.tileLimits[0].zoomTo(t.zoom),r=this.tileLimits[1].zoomTo(t.zoom),i=Math.pow(2,t.zoom),s;return t.column<0?s=(t.column%i+i)%i:s=t.column%i,t.row<n.row||t.row>=r.row?null:s<n.column||s>=r.column?null:new e.Coordinate(t.row,s,t.zoom)}},e.Template=function(t,n){function s(e,t,n){var r="";for(var i=1;i<=n;i++)r+=(e>>n-i&1)<<1|t>>n-i&1;return r||"0"}var r=t.match(/{(Q|quadkey)}/);r&&(t=t.replace("{subdomains}","{S}").replace("{zoom}","{Z}").replace("{quadkey}","{Q}"));var i=n&&n.length&&t.indexOf("{S}")>=0,o=function(e){var o=this.sourceCoordinate(e);if(!o)return null;var u=t;if(i){var a=parseInt(o.zoom+o.row+o.column,10)%n.length;u=u.replace("{S}",n[a])}return r?u.replace("{Z}",o.zoom.toFixed(0)).replace("{Q}",s(o.row,o.column,o.zoom)):u.replace("{Z}",o.zoom.toFixed(0)).replace("{X}",o.column.toFixed(0)).replace("{Y}",o.row.toFixed(0))};e.MapProvider.call(this,o)},e.Template.prototype={getTile:function(e){return this.getTileUrl(e)}},e.extend(e.Template,e.MapProvider),e.TemplatedLayer=function(t,n){return new e.Layer(new e.Template(t,n))},e.getMousePoint=function(t,n){var r=new e.Point(t.clientX,t.clientY);r.x+=document.body.scrollLeft+document.documentElement.scrollLeft,r.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var i=n.parent;i;i=i.offsetParent)r.x-=i.offsetLeft,r.y-=i.offsetTop;return r},e.MouseWheelHandler=function(){function o(t){var o=0;i=i||(new Date).getTime();try{r.scrollTop=1e3,r.dispatchEvent(t),o=1e3-r.scrollTop}catch(u){o=t.wheelDelta||-t.detail*5}var l=(new Date).getTime()-i,h=e.getMousePoint(t,n);return Math.abs(o)>0&&l>200&&!s?(n.zoomByAbout(o>0?1:-1,h),i=(new Date).getTime()):s&&n.zoomByAbout(o*.001,h),e.cancelEvent(t)}var t={},n,r,i,s=!1;return t.init=function(i){n=i,r=document.body.appendChild(document.createElement("div")),r.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var s=r.appendChild(document.createElement("div"));return s.style.height="2000px",e.addEvent(n.parent,"mousewheel",o),t},t.precise=function(e){return arguments.length?(s=e,t):
s},t.remove=function(){e.removeEvent(n.parent,"mousewheel",o),r.parentNode.removeChild(r)},t},e.DoubleClickHandler=function(){function r(t){var r=e.getMousePoint(t,n);return n.zoomByAbout(t.shiftKey?-1:1,r),e.cancelEvent(t)}var t={},n;return t.init=function(i){return n=i,e.addEvent(n.parent,"dblclick",r),t},t.remove=function(){e.removeEvent(n.parent,"dblclick",r)},t},e.DragHandler=function(){function i(t){if(t.shiftKey||t.button==2)return;return e.addEvent(document,"mouseup",s),e.addEvent(document,"mousemove",o),n=new e.Point(t.clientX,t.clientY),r.parent.style.cursor="move",e.cancelEvent(t)}function s(t){return e.removeEvent(document,"mouseup",s),e.removeEvent(document,"mousemove",o),n=null,r.parent.style.cursor="",e.cancelEvent(t)}function o(t){return n&&(r.panBy(t.clientX-n.x,t.clientY-n.y),n.x=t.clientX,n.y=t.clientY,n.t=+(new Date)),e.cancelEvent(t)}var t={},n,r;return t.init=function(n){return r=n,e.addEvent(r.parent,"mousedown",i),t},t.remove=function(){e.removeEvent(r.parent,"mousedown",i)},t},e.MouseHandler=function(){var t={},n,r;return t.init=function(i){return n=i,r=[e.DragHandler().init(n),e.DoubleClickHandler().init(n),e.MouseWheelHandler().init(n)],t},t.remove=function(){for(var e=0;e<r.length;e++)r[e].remove();return t},t},e.TouchHandler=function(){function h(){var e=document.createElement("div");return e.setAttribute("ongesturestart","return;"),typeof e.ongesturestart=="function"}function p(e){for(var t=0;t<e.touches.length;t+=1){var n=e.touches[t];if(n.identifier in o){var r=o[n.identifier];r.x=n.clientX,r.y=n.clientY,r.scale=e.scale}else o[n.identifier]={scale:e.scale,startPos:{x:n.clientX,y:n.clientY},x:n.clientX,y:n.clientY,time:(new Date).getTime()}}}function d(e,t){return e&&e.touch&&t.identifier==e.touch.identifier}function v(e){p(e)}function m(t){switch(t.touches.length){case 1:E(t.touches[0]);break;case 2:S(t)}return p(t),e.cancelEvent(t)}function g(t){var n=(new Date).getTime();t.touches.length===0&&l&&x(c);for(var s=0;s<t.changedTouches.length;s+=1){var u=t.changedTouches[s],f=o[u.identifier];if(!f||f.wasPinch)continue;var h={x:u.clientX,y:u.clientY},p=n-f.time,d=e.Point.distance(h,f.startPos);d>i||(p>r?(h.end=n,h.duration=p,y(h)):(h.time=n,b(h)))}var v={};for(var m=0;m<t.touches.length;m++)v[t.touches[m].identifier]=!0;for(var g in o)g in v||delete v[g];return e.cancelEvent(t)}function y(e){}function b(e){if(u.length&&e.time-u[0].time<s){w(e),u=[];return}u=[e]}function w(t){var r=n.getZoom(),i=Math.round(r)+1,s=i-r,o=new e.Point(t.x,t.y);n.zoomByAbout(s,o)}function E(e){var t={x:e.clientX,y:e.clientY},r=o[e.identifier];n.panBy(t.x-r.x,t.y-r.y)}function S(t){var r=t.touches[0],i=t.touches[1],s=new e.Point(r.clientX,r.clientY),u=new e.Point(i.clientX,i.clientY),f=o[r.identifier],h=o[i.identifier];f.wasPinch=!0,h.wasPinch=!0;var p=e.Point.interpolate(s,u,.5);n.zoomByAbout(Math.log(t.scale)/Math.LN2-Math.log(f.scale)/Math.LN2,p);var d=e.Point.interpolate(f,h,.5);n.panBy(p.x-d.x,p.y-d.y),l=!0,c=p}function x(e){if(f){var t=n.getZoom(),r=Math.round(t);n.zoomByAbout(r-t,e)}l=!1}var t={},n,r=250,i=30,s=350,o={},u=[],f=!0,l=!1,c=null;return t.init=function(r){return n=r,h()?(e.addEvent(n.parent,"touchstart",v),e.addEvent(n.parent,"touchmove",m),e.addEvent(n.parent,"touchend",g),t):t},t.remove=function(){return h()?(e.removeEvent(n.parent,"touchstart",v),e.removeEvent(n.parent,"touchmove",m),e.removeEvent(n.parent,"touchend",g),t):t},t},e.CallbackManager=function(e,t){this.owner=e,this.callbacks={};for(var n=0;n<t.length;n++)this.callbacks[t[n]]=[]},e.CallbackManager.prototype={owner:null,callbacks:null,addCallback:function(e,t){typeof t=="function"&&this.callbacks[e]&&this.callbacks[e].push(t)},removeCallback:function(e,t){if(typeof t=="function"&&this.callbacks[e]){var n=this.callbacks[e],r=n.length;for(var i=0;i<r;i++)if(n[i]===t){n.splice(i,1);break}}},dispatchCallback:function(e,t){if(this.callbacks[e])for(var n=0;n<this.callbacks[e].length;n+=1)try{this.callbacks[e][n](this.owner,t)}catch(r){}}},e.RequestManager=function(){this.loadingBay=document.createDocumentFragment(),this.requestsById={},this.openRequestCount=0,this.maxOpenRequests=4,this.requestQueue=[],this.callbackManager=new e.CallbackManager(this,["requestcomplete","requesterror"])},e.RequestManager.prototype={loadingBay:null,requestsById:null,requestQueue:null,openRequestCount:null,maxOpenRequests:null,callbackManager:null,addCallback:function(e,t){this.callbackManager.addCallback(e,t)},removeCallback:function(e,t){this.callbackManager.removeCallback(e,t)},dispatchCallback:function(e,t){this.callbackManager.dispatchCallback(e,t)},clear:function(){this.clearExcept({})},clearRequest:function(e){e in this.requestsById&&delete this.requestsById[e];for(var t=0;t<this.requestQueue.length;t++){var n=this.requestQueue[t];n&&n.id==e&&(this.requestQueue[t]=null)}},clearExcept:function(e){for(var t=0;t<this.requestQueue.length;t++){var n=this.requestQueue[t];n&&!(n.id in e)&&(this.requestQueue[t]=null)}var r=this.loadingBay.childNodes;for(var i=r.length-1;i>=0;i--){var s=r[i];s.id in e||(this.loadingBay.removeChild(s),this.openRequestCount--,s.src=s.coord=s.onload=s.onerror=null)}for(var o in this.requestsById)if(!(o in e)&&this.requestsById.hasOwnProperty(o)){var u=this.requestsById[o];delete this.requestsById[o],u!==null&&(u=u.id=u.coord=u.url=null)}},hasRequest:function(e){return e in this.requestsById},requestTile:function(e,t,n){if(!(e in this.requestsById)){var r={id:e,coord:t.copy(),url:n};this.requestsById[e]=r,n&&this.requestQueue.push(r)}},getProcessQueue:function(){if(!this._processQueue){var e=this;this._processQueue=function(){e.processQueue()}}return this._processQueue},processQueue:function(e){e&&this.requestQueue.length>8&&this.requestQueue.sort(e);while(this.openRequestCount<this.maxOpenRequests&&this.requestQueue.length>0){var t=this.requestQueue.pop();if(t){this.openRequestCount++;var n=document.createElement("img");n.id=t.id,n.style.position="absolute",n.coord=t.coord,this.loadingBay.appendChild(n),n.onload=n.onerror=this.getLoadComplete(),n.src=t.url,t=t.id=t.coord=t.url=null}}},_loadComplete:null,getLoadComplete:function(){if(!this._loadComplete){var e=this;this._loadComplete=function(t){t=t||window.event;var n=t.srcElement||t.target;n.onload=n.onerror=null,e.loadingBay.removeChild(n),e.openRequestCount--,delete e.requestsById[n.id],t.type==="load"&&(n.complete||n.readyState&&n.readyState=="complete")?e.dispatchCallback("requestcomplete",n):(e.dispatchCallback("requesterror",{element:n,url:""+n.src}),n.src=null),setTimeout(e.getProcessQueue(),0)}}return this._loadComplete}},e.Layer=function(t,n){this.parent=n||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new e.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),t&&this.setProvider(t)},e.Layer.prototype={map:null,parent:null,tiles:null,levels:null,requestManager:null,provider:null,emptyImage:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",_tileComplete:null,getTileComplete:function(){if(!this._tileComplete){var e=this;this._tileComplete=function(t,n){e.tiles[n.id]=n,e.positionTile(n)}}return this._tileComplete},getTileError:function(){if(!this._tileError){var e=this;this._tileError=function(t,n){n.src=e.emptyImage,e.tiles[n.id]=n,e.positionTile(n)}}return this._tileError},draw:function(){function n(e,n){if(e&&n){var r=e.coord,i=n.coord;if(r.zoom==i.zoom){var s=Math.abs(t.row-r.row-.5)+Math.abs(t.column-r.column-.5),o=Math.abs(t.row-i.row-.5)+Math.abs(t.column-i.column-.5);return s<o?1:s>o?-1:0}return r.zoom<i.zoom?1:r.zoom>i.zoom?-1:0}return e?1:n?-1:0}var t=this.map.coordinate.zoomTo(Math.round(this.map.coordinate.zoom)),r=Math.round(this.map.coordinate.zoom),i=this.map.pointCoordinate(new e.Point(0,0)).zoomTo(r).container(),s=this.map.pointCoordinate(this.map.dimensions).zoomTo(r).container().right().down(),o={},u=this.createOrGetLevel(i.zoom),f=i.copy();for(f.column=i.column;f.column<=s.column;f.column++)for(f.row=i.row;f.row<=s.row;f.row++){var l=this.inventoryVisibleTile(u,f);while(l.length)o[l.pop()]=!0}for(var c in this.levels)if(this.levels.hasOwnProperty(c)){var h=parseInt(c,10);if(h>=i.zoom-5&&h<i.zoom+2)continue;var p=this.levels[c];p.style.display="none";var d=this.tileElementsInLevel(p);while(d.length)this.provider.releaseTile(d[0].coord),this.requestManager.clearRequest(d[0].coord.toKey()),p.removeChild(d[0]),d.shift()}var v=i.zoom-5,m=i.zoom+2;for(var g=v;g<m;g++)this.adjustVisibleLevel(this.levels[g],g,o);this.requestManager.clearExcept(o),this.requestManager.processQueue(n)},inventoryVisibleTile:function(e,t){var n=t.toKey(),r=[n];if(n in this.tiles){var i=this.tiles[n];return i.parentNode!=e&&(e.appendChild(i),"reAddTile"in this.provider&&this.provider.reAddTile(n,t,i)),r}if(!this.requestManager.hasRequest(n)){var s=this.provider.getTile(t);typeof s=="string"?this.addTileImage(n,t,s):s&&this.addTileElement(n,t,s)}var o=!1,u=t.zoom;for(var a=1;a<=u;a++){var f=t.zoomBy(-a).container(),l=f.toKey();if(l in this.tiles){r.push(l),o=!0;break}}if(!o){var c=t.zoomBy(1);r.push(c.toKey()),c.column+=1,r.push(c.toKey()),c.row+=1,r.push(c.toKey()),c.column-=1,r.push(c.toKey())}return r},tileElementsInLevel:function(e){var t=[];for(var n=e.firstChild;n;n=n.nextSibling)n.nodeType==1&&t.push(n);return t},adjustVisibleLevel:function(t,n,r){if(!t)return;var i=1,s=this.map.coordinate.copy();if(!(t.childNodes.length>0))return t.style.display="none",!1;t.style.display="block",i=Math.pow(2,this.map.coordinate.zoom-n),s=s.zoomTo(n);var o=this.map.tileSize.x*i,u=this.map.tileSize.y*i,f=new e.Point(this.map.dimensions.x/2,this.map.dimensions.y/2),l=this.tileElementsInLevel(t);while(l.length){var c=l.pop();r[c.id]?e.moveElement(c,{x:Math.round(f.x+(c.coord.column-s.column)*o),y:Math.round(f.y+(c.coord.row-s.row)*u),scale:i,width:this.map.tileSize.x,height:this.map.tileSize.y}):(this.provider.releaseTile(c.coord),this.requestManager.clearRequest(c.coord.toKey()),t.removeChild(c))}},createOrGetLevel:function(e){if(e in this.levels)return this.levels[e];var t=document.createElement("div");return t.id=this.parent.id+"-zoom-"+e,t.style.cssText=this.parent.style.cssText,t.style.zIndex=e,this.parent.appendChild(t),this.levels[e]=t,t},addTileImage:function(e,t,n){this.requestManager.requestTile(e,t,n)},addTileElement:function(e,t,n){n.id=e,n.coord=t.copy(),this.positionTile(n)},positionTile:function(t){var n=this.map.coordinate.zoomTo(t.coord.zoom);t.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;width:"+this.map.tileSize.x+"px; height: "+this.map.tileSize.y+"px;",t.ondragstart=function(){return!1};var r=Math.pow(2,this.map.coordinate.zoom-t.coord.zoom);e.moveElement(t,{x:Math.round(this.map.dimensions.x/2+(t.coord.column-n.column)*this.map.tileSize.x),y:Math.round(this.map.dimensions.y/2+(t.coord.row-n.row)*this.map.tileSize.y),scale:r,width:this.map.tileSize.x,height:this.map.tileSize.y});var i=this.levels[t.coord.zoom];i.appendChild(t),t.className="map-tile-loaded",Math.round(this.map.coordinate.zoom)==t.coord.zoom&&(i.style.display="block"),this.requestRedraw()},_redrawTimer:undefined,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var e=this;this._redraw=function(){e.draw(),e._redrawTimer=0}}return this._redraw},setProvider:function(e){var t=this.provider===null;if(!t){this.requestManager.clear();for(var n in this.levels)if(this.levels.hasOwnProperty(n)){var r=this.levels[n];while(r.firstChild)this.provider.releaseTile(r.firstChild.coord),r.removeChild(r.firstChild)}}this.tiles={},this.provider=e,t||this.draw()},destroy:function(){this.requestManager.clear(),this.requestManager.removeCallback("requestcomplete",this.getTileComplete()),this.provider=null,this.parent.parentNode&&this.parent.parentNode.removeChild(this.parent),this.map=null}},e.Map=function(t,n,r,i){if(typeof t=="string"){t=document.getElementById(t);if(!t)throw"The ID provided to modest maps could not be found."}this.parent=t,this.parent.style.padding="0",this.parent.style.overflow="hidden";var s=e.getStyle(this.parent,"position");s!="relative"&&s!="absolute"&&(this.parent.style.position="relative"),this.layers=[],n||(n=[]),n instanceof Array||(n=[n]);for(var o=0;o<n.length;o++)this.addLayer(n[o]);this.projection=new e.MercatorProjection(0,e.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1)),this.tileSize=new e.Point(256,256),this.coordLimits=[new e.Coordinate(0,-Infinity,0),(new e.Coordinate(1,Infinity,0)).zoomTo(18)],this.coordinate=new e.Coordinate(.5,.5,0),r?(this.autoSize=!1,this.parent.style.width=Math.round(r.x)+"px",this.parent.style.height=Math.round(r.y)+"px"):(r=new e.Point(this.parent.offsetWidth,this.parent.offsetHeight),this.autoSize=!0,e.addEvent(window,"resize",this.windowResize())),this.dimensions=r,this.callbackManager=new e.CallbackManager(this,["zoomed","panned","centered","extentset","resized","drawn"]);if(i===undefined)this.eventHandlers=[e.MouseHandler().init(this),e.TouchHandler().init(this)];else{this.eventHandlers=i;if(i instanceof Array)for(var u=0;u<i.length;u++)i[u].init(this)}},e.Map.prototype={parent:null,dimensions:null,projection:null,coordinate:null,tileSize:null,coordLimits:null,layers:null,callbackManager:null,eventHandlers:null,autoSize:null,toString:function(){return"Map(#"+this.parent.id+")"},addCallback:function(e,t){return this.callbackManager.addCallback(e,t),this},removeCallback:function(e,t){return this.callbackManager.removeCallback(e,t),this},dispatchCallback:function(e,t){return this.callbackManager.dispatchCallback(e,t),this},windowResize:function(){if(!this._windowResize){var t=this;this._windowResize=function(n){t.dimensions=new e.Point(t.parent.offsetWidth,t.parent.offsetHeight),t.draw(),t.dispatchCallback("resized",[t.dimensions])}}return this._windowResize},setZoomRange:function(e,t){return this.coordLimits[0]=this.coordLimits[0].zoomTo(e),this.coordLimits[1]=this.coordLimits[1].zoomTo(t),this},zoomBy:function(t){return this.coordinate=this.enforceLimits(this.coordinate.zoomBy(t)),e.getFrame(this.getRedraw()),this.dispatchCallback("zoomed",t),this},zoomIn:function(){return this.zoomBy(1)},zoomOut:function(){return this.zoomBy(-1)},setZoom:function(e){return this.zoomBy(e-this.coordinate.zoom)},zoomByAbout:function(e,t){var n=this.pointLocation(t);this.coordinate=this.enforceLimits(this.coordinate.zoomBy(e));var r=this.locationPoint(n);return this.dispatchCallback("zoomed",e),this.panBy(t.x-r.x,t.y-r.y)},panBy:function(t,n){return this.coordinate.column-=t/this.tileSize.x,this.coordinate.row-=n/this.tileSize.y,this.coordinate=this.enforceLimits(this.coordinate),e.getFrame(this.getRedraw()),this.dispatchCallback("panned",[t,n]),this},panLeft:function(){return this.panBy(100,0)},panRight:function(){return this.panBy(-100,0)},panDown:function(){return this.panBy(0,-100)},panUp:function(){return this.panBy(0,100)},setCenter:function(e){return this.setCenterZoom(e,this.coordinate.zoom)},setCenterZoom:function(t,n){return this.coordinate=this.projection.locationCoordinate(t).zoomTo(parseFloat(n)||0),e.getFrame(this.getRedraw()),this.dispatchCallback("centered",[t,n]),this},extentCoordinate:function(t,n){t instanceof e.Extent&&(t=t.toArray());var r,i;for(var s=0;s<t.length;s++){var o=this.projection.locationCoordinate(t[s]);r?(r.row=Math.min(r.row,o.row),r.column=Math.min(r.column,o.column),r.zoom=Math.min(r.zoom,o.zoom),i.row=Math.max(i.row,o.row),i.column=Math.max(i.column,o.column),i.zoom=Math.max(i.zoom,o.zoom)):(r=o.copy(),i=o.copy())}var u=this.dimensions.x+1,f=this.dimensions.y+1,l=(i.column-r.column)/(u/this.tileSize.x),c=Math.log(l)/Math.log(2),h=r.zoom-(n?c:Math.ceil(c)),p=(i.row-r.row)/(f/this.tileSize.y),d=Math.log(p)/Math.log(2),v=r.zoom-(n?d:Math.ceil(d)),m=Math.min(h,v);m=Math.min(m,this.coordLimits[1].zoom),m=Math.max(m,this.coordLimits[0].zoom);var g=(r.row+i.row)/2,y=(r.column+i.column)/2,b=r.zoom;return(new e.Coordinate(g,y,b)).zoomTo(m)},setExtent:function(e,t){return this.coordinate=this.extentCoordinate(e,t),this.draw(),this.dispatchCallback("extentset",e),this},setSize:function(t){return this.dimensions=new e.Point(t.x,t.y),this.parent.style.width=Math.round(this.dimensions.x)+"px",this.parent.style.height=Math.round(this.dimensions.y)+"px",this.autoSize&&(e.removeEvent(window,"resize",this.windowResize()),this.autoSize=!1),this.draw(),this.dispatchCallback("resized",this.dimensions),this},coordinatePoint:function(t){t.zoom!=this.coordinate.zoom&&(t=t.zoomTo(this.coordinate.zoom));var n=new e.Point(this.dimensions.x/2,this.dimensions.y/2);return n.x+=this.tileSize.x*(t.column-this.coordinate.column),n.y+=this.tileSize.y*(t.row-this.coordinate.row),n},pointCoordinate:function(e){var t=this.coordinate.copy();return t.column+=(e.x-this.dimensions.x/2)/this.tileSize.x,t.row+=(e.y-this.dimensions.y/2)/this.tileSize.y,t},locationCoordinate:function(e){return this.projection.locationCoordinate(e)},coordinateLocation:function(e){return this.projection.coordinateLocation(e)},locationPoint:function(e){return this.coordinatePoint(this.locationCoordinate(e))},pointLocation:function(e){return this.coordinateLocation(this.pointCoordinate(e))},getExtent:function(){return new e.Extent(this.pointLocation(new e.Point(0,0)),this.pointLocation(this.dimensions))},extent:function(e,t){return e?this.setExtent(e,t):this.getExtent()},getCenter:function(){return this.projection.coordinateLocation(this.coordinate)},center:function(e){return e?this.setCenter(e):this.getCenter()},getZoom:function(){return this.coordinate.zoom},zoom:function(e){return e!==undefined?this.setZoom(e):this.getZoom()},getLayers:function(){return this.layers.slice()},getLayerAt:function(e){return this.layers[e]},addLayer:function(t){return this.layers.push(t),this.parent.appendChild(t.parent),t.map=this,this.coordinate&&e.getFrame(this.getRedraw()),this},removeLayer:function(e){for(var t=0;t<this.layers.length;t++)if(e==this.layers[t]){this.removeLayerAt(t);break}return this},setLayerAt:function(t,n){if(t<0||t>=this.layers.length)throw new Error("invalid index in setLayerAt(): "+t);if(this.layers[t]!=n){if(t<this.layers.length){var r=this.layers[t];this.parent.insertBefore(n.parent,r.parent),r.destroy()}else this.parent.appendChild(n.parent);this.layers[t]=n,n.map=this,e.getFrame(this.getRedraw())}return this},insertLayerAt:function(t,n){if(t<0||t>this.layers.length)throw new Error("invalid index in insertLayerAt(): "+t);if(t==this.layers.length)this.layers.push(n),this.parent.appendChild(n.parent);else{var r=this.layers[t];this.parent.insertBefore(n.parent,r.parent),this.layers.splice(t,0,n)}return n.map=this,e.getFrame(this.getRedraw()),this},removeLayerAt:function(e){if(e<0||e>=this.layers.length)throw new Error("invalid index in removeLayer(): "+e);var t=this.layers[e];return this.layers.splice(e,1),t.destroy(),this},swapLayersAt:function(e,t){if(e<0||e>=this.layers.length||t<0||t>=this.layers.length)throw new Error("invalid index in swapLayersAt(): "+index);var n=this.layers[e],r=this.layers[t],i=document.createElement("div");return this.parent.replaceChild(i,r.parent),this.parent.replaceChild(r.parent,n.parent),this.parent.replaceChild(n.parent,i),this.layers[e]=r,this.layers[t]=n,this},enforceZoomLimits:function(e){var t=this.coordLimits;if(t){var n=t[0].zoom,r=t[1].zoom;e.zoom<n?e=e.zoomTo(n):e.zoom>r&&(e=e.zoomTo(r))}return e},enforcePanLimits:function(t){if(this.coordLimits){t=t.copy();var n=this.coordLimits[0].zoomTo(t.zoom),r=this.coordLimits[1].zoomTo(t.zoom),i=this.pointCoordinate(new e.Point(0,0)).zoomTo(t.zoom),s=this.pointCoordinate(this.dimensions).zoomTo(t.zoom);r.row-n.row<s.row-i.row?t.row=(r.row+n.row)/2:i.row<n.row?t.row+=n.row-i.row:s.row>r.row&&(t.row-=s.row-r.row),r.column-n.column<s.column-i.column?t.column=(r.column+n.column)/2:i.column<n.column?t.column+=n.column-i.column:s.column>r.column&&(t.column-=s.column-r.column)}return t},enforceLimits:function(e){return this.enforcePanLimits(this.enforceZoomLimits(e))},draw:function(){this.coordinate=this.enforceLimits(this.coordinate);if(this.dimensions.x<=0||this.dimensions.y<=0){if(!this.autoSize)return;var t=this.parent.offsetWidth,n=this.parent.offsetHeight;this.dimensions=new e.Point(t,n);if(t<=0||n<=0)return}for(var r=0;r<this.layers.length;r++)this.layers[r].draw();this.dispatchCallback("drawn")},_redrawTimer:undefined,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var e=this;this._redraw=function(){e.draw(),e._redrawTimer=0}}return this._redraw},destroy:function(){for(var t=0;t<this.layers.length;t++)this.layers[t].destroy();this.layers=[],this.projection=null;for(var n=0;n<this.eventHandlers.length;n++)this.eventHandlers[n].remove();this.autoSize&&e.removeEvent(window,"resize",this.windowResize())}},e.mapByCenterZoom=function(t,n,r,i){var s=e.coerceLayer(n),o=new e.Map(t,s,!1);return o.setCenterZoom(r,i).draw(),o},e.mapByExtent=function(t,n,r,i){var s=e.coerceLayer(n),o=new e.Map(t,s,!1);return o.setExtent([r,i]).draw(),o},typeof module!="undefined"&&module.exports&&(module.exports={Point:e.Point,Projection:e.Projection,MercatorProjection:e.MercatorProjection,LinearProjection:e.LinearProjection,Transformation:e.Transformation,Location:e.Location,MapProvider:e.MapProvider,Template:e.Template,Coordinate:e.Coordinate,deriveTransformation:e.deriveTransformation})})(MM),!function(e,t,n){typeof module!="undefined"?module.exports=n(e,t):typeof define=="function"&&typeof define.amd=="object"?define(n):t[e]=n(e,t)}("bean",this,function(e,t){var n=window,r=t[e],i=/over|out/,s=/[^\.]*(?=\..*)\.|.*/,o=/\..*/,u="addEventListener",a="attachEvent",f="removeEventListener",l="detachEvent",c=document||{},h=c.documentElement||{},p=h[u],d=p?u:a,v=Array.prototype.slice,m=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,g=/mouse.*(wheel|scroll)/i,y=/^text/i,b=/^touch|^gesture/i,w={one:1},E=function(e,t,n){for(n=0;n<t.length;n++)e[t[n]]=1;return e}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(p?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend message readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),S=function(){function e(e,t){while((t=t.parentNode)!==null)if(t===e)return!0;return!1}function t(t){var n=t.relatedTarget;return n?n!==this&&n.prefix!=="xul"&&!/document/.test(this.toString())&&!e(this,n):n===null}return{mouseenter:{base:"mouseover",condition:t},mouseleave:{base:"mouseout",condition:t},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),x=function(){var e="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),t=e.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),n=t.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),r=e.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),s=e.concat(["data"]),o=e.concat("touches targetTouches changedTouches scale rotation".split(" ")),u="preventDefault",a=function(e){return function(){e[u]?e[u]():e.returnValue=!1}},f="stopPropagation",l=function(e){return function(){e[f]?e[f]():e.cancelBubble=!0}},p=function(e){return function(){e[u](),e[f](),e.stopped=!0}},d=function(e,t,n){var r,i;for(r=n.length;r--;)i=n[r],!(i in t)&&i in e&&(t[i]=e[i])};return function(v,w){var E={originalEvent:v,isNative:w};if(!v)return E;var S,x=v.type,T=v.target||v.srcElement;E[u]=a(v),E[f]=l(v),E.stop=p(E),E.target=T&&T.nodeType===3?T.parentNode:T;if(w){if(x.indexOf("key")!==-1)S=r,E.keyCode=v.which||v.keyCode;else if(m.test(x)){S=t,E.rightClick=v.which===3||v.button===2,E.pos={x:0,y:0};if(v.pageX||v.pageY)E.clientX=v.pageX,E.clientY=v.pageY;else if(v.clientX||v.clientY)E.clientX=v.clientX+c.body.scrollLeft+h.scrollLeft,E.clientY=v.clientY+c.body.scrollTop+h.scrollTop;i.test(x)&&(E.relatedTarget=v.relatedTarget||v[(x==="mouseover"?"from":"to")+"Element"])}else b.test(x)?S=o:g.test(x)?S=n:y.test(x)&&(S=s);d(v,E,S||e)}return E}}(),T=function(e,t){return!p&&!t&&(e===c||e===n)?h:e},N=function(){function e(e,t,n,r,i){this.element=e,this.type=t,this.handler=n,this.original=r,this.namespaces=i,this.custom=S[t],this.isNative=E[t]&&e[d],this.eventType=p||this.isNative?t:"propertychange",this.customType=!p&&!this.isNative&&t,this.target=T(e,this.isNative),this.eventSupport=this.target[d]}return e.prototype={inNamespaces:function(e){var t,n;if(!e)return!0;if(!this.namespaces)return!1;for(t=e.length;t--;)for(n=this.namespaces.length;n--;)if(e[t]===this.namespaces[n])return!0;return!1},matches:function(e,t,n){return this.element===e&&(!t||this.original===t)&&(!n||this.handler===n)}},e}(),C=function(){var e={},t=function(n,r,i,s,o){if(!r||r==="*")for(var u in e)u.charAt(0)==="$"&&t(n,u.substr(1),i,s,o);else{var a=0,f,l=e["$"+r],c=n==="*";if(!l)return;for(f=l.length;a<f;a++)if(c||l[a].matches(n,i,s))if(!o(l[a],l,a,r))return}},n=function(t,n,r){var i,s=e["$"+n];if(s)for(i=s.length;i--;)if(s[i].matches(t,r,null))return!0;return!1},r=function(e,n,r){var i=[];return t(e,n,r,null,function(e){return i.push(e)}),i},i=function(t){return(e["$"+t.type]||(e["$"+t.type]=[])).push(t),t},s=function(n){t(n.element,n.type,null,n.handler,function(t,n,r){return n.splice(r,1),n.length===0&&delete e["$"+t.type],!1})},o=function(){var t,n=[];for(t in e)t.charAt(0)==="$"&&(n=n.concat(e[t]));return n};return{has:n,get:r,put:i,del:s,entries:o}}(),k=p?function(e,t,n,r){e[r?u:f](t,n,!1)}:function(e,t,n,r,i){i&&r&&e["_on"+i]===null&&(e["_on"+i]=0),e[r?a:l]("on"+t,n)},L=function(e,t,r){return function(i){return i=x(i||((this.ownerDocument||this.document||this).parentWindow||n).event,!0),t.apply(e,[i].concat(r))}},A=function(e,t,r,i,s,o){return function(u){if(i?i.apply(this,arguments):p?!0:u&&u.propertyName==="_on"+r||!u)u&&(u=x(u||((this.ownerDocument||this.document||this).parentWindow||n).event,o)),t.apply(e,u&&(!s||s.length===0)?arguments:v.call(arguments,u?0:1).concat(s))}},O=function(e,t,n,r,i){return function(){e(t,n,i),r.apply(this,arguments)}},M=function(e,t,n,r){var i,s,u,a=t&&t.replace(o,""),f=C.get(e,a,n);for(i=0,s=f.length;i<s;i++)f[i].inNamespaces(r)&&((u=f[i]).eventSupport&&k(u.target,u.eventType,u.handler,!1,u.type),C.del(u))},_=function(e,t,n,r,i){var u,a=t.replace(o,""),f=t.replace(s,"").split(".");if(C.has(e,a,n))return e;a==="unload"&&(n=O(M,e,a,n,r)),S[a]&&(S[a].condition&&(n=A(e,n,a,S[a].condition,!0)),a=S[a].base||a),u=C.put(new N(e,a,n,r,f[0]&&f)),u.handler=u.isNative?L(e,u.handler,i):A(e,u.handler,a,!1,i,!1),u.eventSupport&&k(u.target,u.eventType,u.handler,!0,u.customType)},D=function(e,t,n){return function(r){var i,s,o=typeof e=="string"?n(e,this):e;for(i=r.target;i&&i!==this;i=i.parentNode)for(s=o.length;s--;)if(o[s]===i)return t.apply(i,arguments)}},P=function(e,t,n){var r,i,u,a,f,l=M,c=t&&typeof t=="string";if(c&&t.indexOf(" ")>0){t=t.split(" ");for(f=t.length;f--;)P(e,t[f],n);return e}u=c&&t.replace(o,""),u&&S[u]&&(u=S[u].type);if(!t||c){if(a=c&&t.replace(s,""))a=a.split(".");l(e,u,n,a)}else if(typeof t=="function")l(e,null,t);else for(r in t)t.hasOwnProperty(r)&&P(e,r,t[r]);return e},H=function(e,t,n,r,i){var s,o,u,a,f=n,l=n&&typeof n=="string";if(t&&!n&&typeof t=="object")for(s in t)t.hasOwnProperty(s)&&H.apply(this,[e,s,t[s]]);else{a=arguments.length>3?v.call(arguments,3):[],o=(l?n:t).split(" "),l&&(n=D(t,f=r,i))&&(a=v.call(a,1)),this===w&&(n=O(P,e,t,n,f));for(u=o.length;u--;)_(e,o[u],n,f,a)}return e},B=function(){return H.apply(w,arguments)},j=p?function(e,t,r){var i=c.createEvent(e?"HTMLEvents":"UIEvents");i[e?"initEvent":"initUIEvent"](t,!0,!0,n,1),r.dispatchEvent(i)}:function(e,t,n){n=T(n,e),e?n.fireEvent("on"+t,c.createEventObject()):n["_on"+t]++},F=function(e,t,n){var r,i,u,a,f,l=t.split(" ");for(r=l.length;r--;){t=l[r].replace(o,"");if(a=l[r].replace(s,""))a=a.split(".");if(!a&&!n&&e[d])j(E[t],t,e);else{f=C.get(e,t),n=[!1].concat(n);for(i=0,u=f.length;i<u;i++)f[i].inNamespaces(a)&&f[i].handler.apply(e,n)}}return e},I=function(e,t,n){var r=0,i=C.get(t,n),s=i.length;for(;r<s;r++)i[r].original&&H(e,i[r].type,i[r].original);return e},q={add:H,one:B,remove:P,clone:I,fire:F,noConflict:function(){return t[e]=r,this}};if(n[a]){var R=function(){var e,t=C.entries();for(e in t)t[e].type&&t[e].type!=="unload"&&P(t[e].element,t[e].type);n[l]("onunload",R),n.CollectGarbage&&n.CollectGarbage()};n[a]("onunload",R)}return q});var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign"
:0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};var html=function(e){function t(e){e=l(e);if(c.hasOwnProperty(e))return c[e];var t=e.match(p);return t?String.fromCharCode(parseInt(t[1],10)):(t=e.match(d))?String.fromCharCode(parseInt(t[1],16)):""}function n(e,n){return t(n)}function r(e){return e.replace(v,"")}function i(e){return e.replace(m,n)}function s(e){return e.replace(g,"&amp;").replace(b,"&lt;").replace(w,"&gt;").replace(E,"&#34;").replace(S,"&#61;")}function o(e){return e.replace(y,"&amp;$1").replace(b,"&lt;").replace(w,"&gt;")}function u(t){return function n(n,s){n=String(n);var u=null,a=!1,f=[],c=void 0,h=void 0,p=void 0;t.startDoc&&t.startDoc(s);while(n){var d=n.match(a?x:T);n=n.substring(d[0].length);if(a){if(d[1]){var v=l(d[1]),m;if(d[2]){var g=d[3];switch(g.charCodeAt(0)){case 34:case 39:g=g.substring(1,g.length-1)}m=i(r(g))}else m=v;f.push(v,m)}else if(d[4]){h!==void 0&&(p?t.startTag&&t.startTag(c,f,s):t.endTag&&t.endTag(c,s));if(p&&h&(e.eflags.CDATA|e.eflags.RCDATA)){u===null?u=l(n):u=u.substring(u.length-n.length);var y=u.indexOf("</"+c);y<0&&(y=n.length),y&&(h&e.eflags.CDATA?t.cdata&&t.cdata(n.substring(0,y),s):t.rcdata&&t.rcdata(o(n.substring(0,y)),s),n=n.substring(y))}c=h=p=void 0,f.length=0,a=!1}}else if(d[1])t.pcdata&&t.pcdata(d[0],s);else if(d[3])p=!d[2],a=!0,c=l(d[3]),h=e.ELEMENTS.hasOwnProperty(c)?e.ELEMENTS[c]:void 0;else if(d[4])t.pcdata&&t.pcdata(d[4],s);else if(d[5]&&t.pcdata){var b=d[5];t.pcdata(b==="<"?"&lt;":b===">"?"&gt;":"&amp;",s)}}t.endDoc&&t.endDoc(s)}}function a(t){var n,r;return u({startDoc:function(e){n=[],r=!1},startTag:function(i,o,u){if(r)return;if(!e.ELEMENTS.hasOwnProperty(i))return;var a=e.ELEMENTS[i];if(a&e.eflags.FOLDABLE)return;if(a&e.eflags.UNSAFE){r=!(a&e.eflags.EMPTY);return}o=t(i,o);if(o){a&e.eflags.EMPTY||n.push(i),u.push("<",i);for(var f=0,l=o.length;f<l;f+=2){var c=o[f],h=o[f+1];h!==null&&h!==void 0&&u.push(" ",c,'="',s(h),'"')}u.push(">")}},endTag:function(t,i){if(r){r=!1;return}if(!e.ELEMENTS.hasOwnProperty(t))return;var s=e.ELEMENTS[t];if(!(s&(e.eflags.UNSAFE|e.eflags.EMPTY|e.eflags.FOLDABLE))){var o;if(s&e.eflags.OPTIONAL_ENDTAG)for(o=n.length;--o>=0;){var u=n[o];if(u===t)break;if(!(e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG))return}else for(o=n.length;--o>=0;)if(n[o]===t)break;if(o<0)return;for(var a=n.length;--a>o;){var u=n[a];e.ELEMENTS[u]&e.eflags.OPTIONAL_ENDTAG||i.push("</",u,">")}n.length=o,i.push("</",t,">")}},pcdata:function(e,t){r||t.push(e)},rcdata:function(e,t){r||t.push(e)},cdata:function(e,t){r||t.push(e)},endDoc:function(e){for(var t=n.length;--t>=0;)e.push("</",n[t],">");n.length=0}})}function f(t,n,r){var i=[];return a(function s(t,i){for(var s=0;s<i.length;s+=2){var o=i[s],u=i[s+1],a=null,f;if((f=t+"::"+o,e.ATTRIBS.hasOwnProperty(f))||(f="*::"+o,e.ATTRIBS.hasOwnProperty(f)))a=e.ATTRIBS[f];if(a!==null)switch(a){case e.atype.NONE:break;case e.atype.SCRIPT:case e.atype.STYLE:u=null;break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:u=r?r(u):u;break;case e.atype.URI:var l=(""+u).match(N);l?!l[1]||h.test(l[1])?u=n&&n(u):u=null:u=null;break;case e.atype.URI_FRAGMENT:u&&"#"===u.charAt(0)?(u=r?r(u):u,u&&(u="#"+u)):u=null;break;default:u=null}else u=null;i[s+1]=u}return i})(t,i),i.join("")}var l;"script"==="SCRIPT".toLowerCase()?l=function(e){return e.toLowerCase()}:l=function(e){return e.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)|32)})};var c={lt:"<",gt:">",amp:"&",nbsp:"",quot:'"',apos:"'"},h=/^(?:https?|mailto|data)$/i,p=/^#(\d+)$/,d=/^#x([0-9A-Fa-f]+)$/,v=/\0/g,m=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,g=/&/g,y=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,b=/</g,w=/>/g,E=/\"/g,S=/\=/g,x=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),T=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),N=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:s,makeHtmlSanitizer:a,makeSaxParser:u,normalizeRCData:o,sanitize:f,unescapeEntities:i}}(html4),html_sanitize=html.sanitize;typeof window!="undefined"&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0;var Mustache=typeof module!="undefined"&&module.exports||{};(function(e){function t(e){return g.test(e)}function n(e){return String(e).replace(/[&<>"'\/]/g,function(e){return E[e]||e})}function r(e,t,n,r){r=r||"<template>";var i=t.split("\n"),s=Math.max(n-3,0),o=Math.min(i.length,n+3),u=i.slice(s,o),a;for(var f=0,l=u.length;f<l;++f)a=f+s+1,u[f]=(a===n?" >> ":"    ")+u[f];return e.template=t,e.line=n,e.file=r,e.message=[r+":"+n,u.join("\n"),"",e.message].join("\n"),e}function i(e,t,n){if(e===".")return t[t.length-1];var r=e.split("."),i=r.length-1,s=r[i],o,u,a=t.length,f,l;while(a){l=t.slice(0),u=t[--a],f=0;while(f<i){u=u[r[f++]];if(u==null)break;l.push(u)}if(u&&typeof u=="object"&&s in u){o=u[s];break}}return typeof o=="function"&&(o=o.call(l[l.length-1])),o==null?n:o}function s(e,t,n,r){var s="",o=i(e,t);if(r){if(o==null||o===!1||v(o)&&o.length===0)s+=n()}else if(v(o))m(o,function(e){t.push(e),s+=n(),t.pop()});else if(typeof o=="object")t.push(o),s+=n(),t.pop();else if(typeof o=="function"){var u=t[t.length-1],a=function(e){return l(e,u)};s+=o.call(u,n(),a)||""}else o&&(s+=n());return s}function o(n,i){i=i||{};var s=i.tags||e.tags,o=s[0],u=s[s.length-1],a=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],f=[],l=!1,c=!1,h=function(){if(l&&!c&&!i.space)while(f.length)a.splice(f.pop(),1);else f=[];l=!1,c=!1},p=[],d,v,m,g=function(e){s=y(e).split(/\s+/),v=s[0],m=s[s.length-1]},b=function(e){a.push('";',d,'\nvar partial = partials["'+y(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},w=function(e,t){var s=y(e);if(s==="")throw r(new Error("Section name may not be empty"),n,N,i.file);p.push({name:s,inverted:t}),a.push('";',d,'\nvar name = "'+s+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},E=function(e){w(e,!0)},S=function(e){var t=y(e),s=p.length!=0&&p[p.length-1].name;if(!s||t!=s)throw r(new Error('Section named "'+t+'" was never opened'),n,N,i.file);var o=p.pop();a.push('";',"\n    return buffer;","\n  };","\n})();"),o.inverted?a.push("\nbuffer += renderSection(name,stack,callback,true);"):a.push("\nbuffer += renderSection(name,stack,callback);"),a.push('\nbuffer += "')},x=function(e){a.push('";',d,'\nbuffer += lookup("'+y(e)+'",stack,"");','\nbuffer += "')},T=function(e){a.push('";',d,'\nbuffer += escapeHTML(lookup("'+y(e)+'",stack,""));','\nbuffer += "')},N=1,C,k;for(var L=0,A=n.length;L<A;++L)if(n.slice(L,L+o.length)===o){L+=o.length,C=n.substr(L,1),d="\nline = "+N+";",v=o,m=u,l=!0;switch(C){case"!":L++,k=null;break;case"=":L++,u="="+u,k=g;break;case">":L++,k=b;break;case"#":L++,k=w;break;case"^":L++,k=E;break;case"/":L++,k=S;break;case"{":u="}"+u;case"&":L++,c=!0,k=x;break;default:c=!0,k=T}var O=n.indexOf(u,L);if(O===-1)throw r(new Error('Tag "'+o+'" was not closed properly'),n,N,i.file);var M=n.substring(L,O);k&&k(M);var _=0;while(~(_=M.indexOf("\n",_)))N++,_++;L=O+u.length-1,o=v,u=m}else{C=n.substr(L,1);switch(C){case'"':case"\\":c=!0,a.push("\\"+C);break;case"\r":break;case"\n":f.push(a.length),a.push("\\n"),h(),N++;break;default:t(C)?f.push(a.length):c=!0,a.push(C)}}if(p.length!=0)throw r(new Error('Section "'+p[p.length-1].name+'" was not closed properly'),n,N,i.file);h(),a.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var D=a.join("").replace(/buffer \+= "";\n/g,"");return i.debug&&(typeof console!="undefined"&&console.log?console.log(D):typeof print=="function"&&print(D)),D}function u(e,t){var u="view,partials,stack,lookup,escapeHTML,renderSection,render",a=o(e,t),f=new Function(u,a);return function(o,u){u=u||{};var a=[o];try{return f(o,u,a,i,n,s,l)}catch(c){throw r(c.error,e,c.line,t.file)}}}function a(){S={}}function f(e,t){return t=t||{},t.cache!==!1?(S[e]||(S[e]=u(e,t)),S[e]):u(e,t)}function l(e,t,n){return f(e)(t,n)}e.name="mustache.js",e.version="0.5.0-dev",e.tags=["{{","}}"],e.parse=o,e.compile=f,e.render=l,e.clearCache=a,e.to_html=function(e,t,n,r){var i=l(e,t,n);if(typeof r!="function")return i;r(i)};var c=Object.prototype.toString,h=Array.isArray,p=Array.prototype.forEach,d=String.prototype.trim,v;h?v=h:v=function(e){return c.call(e)==="[object Array]"};var m;p?m=function(e,t,n){return p.call(e,t,n)}:m=function(e,t,n){for(var r=0,i=e.length;r<i;++r)t.call(n,e[r],r,e)};var g=/^\s*$/,y;if(d)y=function(e){return e==null?"":d.call(e)};else{var b,w;t("")?(b=/^\s+/,w=/\s+$/):(b=/^[\s\xA0]+/,w=/[\s\xA0]+$/),y=function(e){return e==null?"":String(e).replace(b,"").replace(w,"")}}var E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},S={}})(Mustache),!function(e,t){typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(e,t):this[e]=t()}("reqwest",function(){function handleReadyState(e,t,n){return function(){e&&e[readyState]==4&&(twoHundo.test(e.status)?t(e):n(e))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r])}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||"reqwest_"+i,u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0;a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e.success&&e.success(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f)}function getRequest(e,t,n){var r=(e.method||"GET").toUpperCase(),i=typeof e=="string"?e:e.url,s=e.processData!==!1&&e.data&&typeof e.data!="string"?reqwest.toQueryString(e.data):e.data||null,o;return(e.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),e.type=="jsonp"?handleJsonp(e,t,n,i):(o=xhr(),o.open(r,i,!0),setHeaders(o,e),o.onreadystatechange=handleReadyState(o,t,n),e.before&&e.before(o),o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(e)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(e,t,n){o.error&&o.error(e,t,n),complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(e.disabled||!n)return;switch(r){case"input":if(!/reset|button|image|file/i.test(e.type)){var s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value;(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u))}break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(var a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r,i=function(t,n){for(var i=0;i<n.length;i++){var s=t[byTag](n[i]);for(r=0;r<s.length;r++)serial(s[r],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),i(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e){var t="",n,r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"};if(isArray(e))for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value);else for(var s in e){if(!Object.hasOwnProperty.call(e,s))continue;var o=e[s];if(isArray(o))for(n=0;n<o.length;n++)i(s,o[n]);else i(s,e[s])}return t.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest}),wax=wax||{},wax.attribution=function(){var e,t={};return t.content=function(t){return typeof t=="undefined"?e.innerHTML:(e.innerHTML=wax.u.sanitize(t),this)},t.element=function(){return e},t.init=function(){return e=document.createElement("div"),e.className="map-attribution",this},t.init()},wax=wax||{},wax.bwdetect=function(e,t){function n(){wax.bw=-1;var e=new Image;e.src=o;var t=!0,n=setTimeout(function(){t&&wax.bw==-1&&(r.bw(0),t=!1)},s);e.onload=function(){t&&wax.bw==-1&&(clearTimeout(n),r.bw(1),t=!1)}}var r={},s=e.threshold||400,o="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +(new Date),u=1,a=e.auto===undefined?!0:e.auto;return r.bw=function(e){if(!arguments.length)return u;var n=u;wax.bwlisteners&&wax.bwlisteners.length&&function(){listeners=wax.bwlisteners,wax.bwlisteners=[];for(i=0;i<listeners;i++)listeners[i](e)}(),wax.bw=e,u!=(u=e)&&t(e)},r.add=function(){return a&&n(),this},wax.bw==-1?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(r.bw)):wax.bw!==undefined?r.bw(wax.bw):r.add(),r},wax.formatter=function(x){var formatter={},f;if(x&&typeof x=="string")try{eval("f = "+x)}catch(e){console&&console.log(e)}else x&&typeof x=="function"?f=x:f=function(){};return formatter.format=function(e,t){try{return wax.u.sanitize(f(e,t))}catch(n){console&&console.log(n)}},formatter},wax.gi=function(e,t){function n(e){return e>=93&&e--,e>=35&&e--,e-=32,e}t=t||{};var r={},i=t.resolution||4,s=t.tileSize||256;return r.grid_tile=function(){return e},r.getKey=function(t,r){if(!e||!e.grid)return;if(r<0||t<0)return;if(Math.floor(r)>=s||Math.floor(t)>=s)return;return n(e.grid[Math.floor(r/i)].charCodeAt(Math.floor(t/i)))},r.gridFeature=function(t,n){var r=this.getKey(t,n),i=e.keys;if(i&&i[r]&&e.data[i[r]])return e.data[i[r]]},r.tileFeature=function(t,n,r){if(!e)return;var i=wax.u.offset(r);return feature=this.gridFeature(t-i.left,n-i.top),feature},r},wax.gm=function(){function e(e){return typeof e=="string"&&(e=[e]),function t(t){if(!t)return;var n=new RegExp("/(\\d+)\\/(\\d+)\\/(\\d+)\\.[\\w\\._]+"),r=n.exec(t);if(!r)return;return e[parseInt(r[2],10)%e.length].replace(/\{z\}/g,r[1]).replace(/\{x\}/g,r[2]).replace(/\{y\}/g,r[3])}}var t=4,n={},r={},i,s,o=function(e){if(e)return e.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json")};return r.formatter=function(e){return arguments.length?(s=wax.formatter(e),r):s},r.template=function(e){return arguments.length?(s=wax.template(e),r):s},r.gridUrl=function(t){return arguments.length?(t?o=typeof t=="function"?t:e(t):o=function(){return null},r):o},r.getGrid=function(e,n){var i=o(e);return!s||!i?n(null,null):(wax.request.get(i,function(e,r){if(e)return n(e,null);n(null,wax.gi(r,{formatter:s,resolution:t}))}),r)},r.tilejson=function(e){return arguments.length?(e.template?r.template(e.template):e.formatter?r.formatter(e.formatter):s=undefined,r.gridUrl(e.grids),e.resolution&&(t=e.resolution),i=e,r):i},r},wax=wax||{},wax.hash=function(e){function t(){return location.hash.substring(1)}function n(e){var t=window.location;t.replace(t.toString().replace(t.hash||/$/,"#"+e))}function r(t){var n=t.split("/");for(var r=0;r<n.length;r++){n[r]=Number(n[r]);if(isNaN(n[r]))return!0}if(n.length<3)return!0;n.length==3&&e.setCenterZoom(n)}function i(){var t=e.getCenterZoom();o!==t&&(o=t,n(o))}function s(e){if(e===o)return;r(o=e)&&i()}e=e||{};var o,u={},a=90-1e-8,f=wax.u.throttle(i,500);return u.add=function(){return s(t()),e.bindChange(f),this},u.remove=function(){return e.unbindChange(f),this},u.add()},wax=wax||{},wax.interaction=function(){function e(e){var t=h();for(var n=0;n<t.length;n++)if(t[n][0]<e.y&&t[n][0]+256>e.y&&t[n][1]<e.x&&t[n][1]+256>e.x)return t[n][2];return!1}function t(){return f?(window.clearTimeout(f),f=null,!0):!1}function n(e){if(a)return;var t=wax.u.eventoffset(e);u.screen_feature(t,function(t){t?bean.fire(u,"on",{parent:v(),data:t,formatter:o.formatter().format,e:e}):bean.fire(u,"off")})}function r(e){if(t())return;a=!0,l=wax.u.eventoffset(e),e.type==="mousedown"?bean.add(document.body,"click",s):e.type==="touchstart"&&e.touches.length===1&&(bean.fire(u,"off"),bean.add(v(),b))}function i(){bean.remove(v(),b),a=!1}function s(e){var t={},n=wax.u.eventoffset(e);a=!1;for(var r in e)t[r]=e[r];return bean.remove(document.body,"mouseup",s),bean.remove(v(),b),e.type==="touchend"?u.click(e,l):Math.round(n.y/c)===Math.round(l.y/c)&&Math.round(n.x/c)===Math.round(l.x/c)&&(f=window.setTimeout(function(){f=null,u.click(t,n)},300)),s}var o=wax.gm(),u={},a=!1,f=!1,l,c=4,h,p,d,v,m,g,y={mousemove:n,touchstart:r,mousedown:r},b={touchend:s,touchmove:s,touchcancel:i};return u.click=function(e,t){u.screen_feature(t,function(t){t&&bean.fire(u,"on",{parent:v(),data:t,formatter:o.formatter().format,e:e})})},u.screen_feature=function(t,n){var r=e(t);r||n(null),o.getGrid(r.src,function(e,i){if(e||!i)return n(null);var s=i.tileFeature(t.x,t.y,r);n(s)})},u.attach=function(e){return arguments.length?(p=e,u):p},u.detach=function(e){return arguments.length?(d=e,u):d},u.map=function(e){return arguments.length?(m=e,p&&p(m),bean.add(v(),y),bean.add(v(),"touchstart",r),u):m},u.grid=function(e){return arguments.length?(h=e,u):h},u.remove=function(e){return d&&d(m),bean.remove(v(),y),bean.fire(u,"remove"),u},u.tilejson=function(e){return arguments.length?(o.tilejson(e),u):o.tilejson()},u.formatter=function(){return o.formatter()},u.on=function(e,t){return bean.add(u,e,t),u},u.off=function(e,t){return bean.remove(u,e,t),u},u.gridmanager=function(e){return arguments.length?(o=e,u):o},u.parent=function(e){return v=e,u},u};var wax=wax||{};wax.legend=function(){var e,t={},n;return t.element=function(){return n},t.content=function(n){return arguments.length?(e.innerHTML=wax.u.sanitize(n),e.style.display="block",e.innerHTML===""&&(e.style.display="none"),t):e.innerHTML},t.add=function(){return n=document.createElement("div"),n.className="map-legends",e=n.appendChild(document.createElement("div")),e.className="map-legend",e.style.display="none",t},t.add()};var wax=wax||{};wax.location=function(){function e(e){console.log(e);if(e.e.type==="mousemove"||!e.e.type)return;var t=e.formatter({format:"location"},e.data);t&&(window.location.href=t)}var t={};return t.events=function(){return{on:e}},t};var wax=wax||{};wax.movetip=wax.movetip||{},wax.movetip=function(){function e(e){var t=wax.u.eventoffset(e);t.y-a.top<u.height+5&&a.height>u.height&&(t.y+=u.height,f.className+=" flip-y"),f.style.left=t.x+"px",f.style.top=t.y-u.height-5+"px"}function t(e){var t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div");return n.innerHTML=e,n.className="inner",r.className="tip",t.className="wax-tooltip wax-tooltip-0",t.appendChild(n),t.appendChild(r),t}function n(){f&&(f.parentNode.removeChild(f),f=null)}function r(r){var i;if(s)return;if(r.e.type==="mousemove"||r.e.type==="touchend"||!r.e.type){i=r.formatter({format:"teaser"},r.data);if(!i)return;n(),l.style.cursor="pointer",f=document.body.appendChild(t(i))}f&&(u=wax.u.offset(f),a=wax.u.offset(l),e(r.e))}function i(){l.style.cursor="default",s||n()}var s=!1,o={},u,a,f,l;return o.parent=function(e){return arguments.length?(l=e,o):l},o.events=function(){return{on:r,off:i}},o};var wax=wax||{};wax.movetip={},wax.movetip=function(){function e(e){var t=wax.u.eventoffset(e);u.height+t.y>a.top+a.height&&a.height>u.height&&(t.y-=u.height,f.className+=" flip-y"),u.width+t.x>a.left+a.width&&(t.x-=u.width,f.className+=" flip-x"),f.style.left=t.x+"px",f.style.top=t.y+"px"}function t(e){var t=document.createElement("div");return t.className="map-tooltip map-tooltip-0",t.innerHTML=e,t}function n(){f&&(f.parentNode.removeChild(f),f=null)}function r(r){var i;if(s)return;if(r.e.type==="mousemove"||!r.e.type){i=r.formatter({format:"teaser"},r.data);if(!i)return;n(),l.style.cursor="pointer",f=document.body.appendChild(t(i))}else{i=r.formatter({format:"teaser"},r.data);if(!i)return;n();var o=document.body.appendChild(t(i));o.className+=" map-popup";var p=o.appendChild(document.createElement("a"));p.href="#close",p.className="close",p.innerHTML="Close",s=!0,f=o,u=wax.u.offset(f),a=wax.u.offset(l),e(r.e),bean.add(p,"click touchend",function(e){e.stop(),n(),s=!1})}f&&(u=wax.u.offset(f),a=wax.u.offset(l),e(r.e))}function i(){l.style.cursor="default",s||n()}var s=!1,o={},u,a,f,l;return o.parent=function(e){return arguments.length?(l=e,o):l},o.events=function(){return{on:r,off:i}},o};var wax=wax||{};wax.request={cache:{},locks:{},promises:{},get:function(e,t){if(this.cache[e])return t(this.cache[e][0],this.cache[e][1]);this.promises[e]=this.promises[e]||[],this.promises[e].push(t);if(this.locks[e])return;var n=this;this.locks[e]=!0,reqwest({url:e+(~e.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(t){n.locks[e]=!1,n.cache[e]=[null,t];for(var r=0;r<n.promises[e].length;r++)n.promises[e][r](n.cache[e][0],n.cache[e][1])},error:function(t){n.locks[e]=!1,n.cache[e]=[t,null];for(var r=0;r<n.promises[e].length;r++)n.promises[e][r](n.cache[e][0],n.cache[e][1])}})}},wax.template=function(e){var t={};return t.format=function(t,n){var r={};for(var i in n)r[i]=n[i];return t.format&&(r["__"+t.format+"__"]=!0),wax.u.sanitize(Mustache.to_html(e,r))},t};if(!wax)var wax={};wax.tilejson=function(e,t){reqwest({url:e+(~e.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:t,error:t})};var wax=wax||{};wax.tooltip={},wax.tooltip=function(){function e(e){var t=document.createElement("div");return t.className="map-tooltip map-tooltip-0",t.innerHTML=e,t}function t(){this.parentNode&&this.parentNode.removeChild(this)}function n(){var e;while(e=a.pop())o&&l?(bean.add(e,l,t),e.className+=" map-fade"):e.parentNode&&e.parentNode.removeChild(e)}function r(t){var r;if(t.e.type==="mousemove"||!t.e.type){if(!s){r=t.content||t.formatter({format:"teaser"},t.data);if(!r||r==f)return;n(),c.style.cursor="pointer",a.push(c.appendChild(e(r))),f=r}}else{r=t.content||t.formatter({format:"full"},t.data);if(!r){t.e.type&&t.e.type.match(/touch/)&&(r=t.content||t.formatter({format:"teaser"},t.data));if(!r)return}n(),c.style.cursor="pointer";var i=c.appendChild(e(r));i.className+=" map-popup";var o=i.appendChild(document.createElement("a"));o.href="#close",o.className="close",o.innerHTML="Close",s=!0,a.push(i),bean.add(o,"touchstart mousedown",function(e){e.stop()}),bean.add(o,"click touchend",function(e){e.stop(),n(),s=!1})}}function i(){c.style.cursor="default",f=null,s||n()}var s=!1,o=!1,u={},a=[],f,l,c;return document.body.style["-webkit-transition"]!==undefined?l="webkitTransitionEnd":document.body.style.MozTransition!==undefined&&(l="transitionend"),u.parent=function(e){return arguments.length?(c=e,u):c},u.animate=function(e){return arguments.length?(o=e,u):o},u.events=function(){return{on:r,off:i}},u};var wax=wax||{};wax.u={offset:function(e){var t=e.offsetWidth||parseInt(e.style.width,10),n=e.offsetHeight||parseInt(e.style.height,10),r=document.body,i=0,s=0,o=function(e){if(e===r||e===document.documentElement)return;i+=e.offsetTop,s+=e.offsetLeft;var t=e.style.transform||e.style.WebkitTransform||e.style.OTransform||e.style.MozTransform||e.style.msTransform;if(t){var n;if(n=t.match(/translate\((.+)px, (.+)px\)/))i+=parseInt(n[2],10),s+=parseInt(n[1],10);else if(n=t.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))i+=parseInt(n[2],10),s+=parseInt(n[1],10);else if(n=t.match(/matrix3d\(([\-\d,\s]+)\)/)){var o=n[1].split(",");i+=parseInt(o[13],10),s+=parseInt(o[12],10)}else if(n=t.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))i+=parseInt(n[2],10),s+=parseInt(n[1],10)}};o(e);try{while(e=e.offsetParent)o(e)}catch(u){}i+=r.offsetTop,s+=r.offsetLeft,i+=r.parentNode.offsetTop,s+=r.parentNode.offsetLeft;var a=document.defaultView?window.getComputedStyle(r.parentNode,null):r.parentNode.currentStyle;return r.parentNode.offsetTop!==parseInt(a.marginTop,10)&&!isNaN(parseInt(a.marginTop,10))&&(i+=parseInt(a.marginTop,10),s+=parseInt(a.marginLeft,10)),{top:i,left:s,height:n,width:t}},$:function(e){return typeof e=="string"?document.getElementById(e):e},indexOf:function(e,t){var n=Array.prototype.indexOf;if(e===null)return-1;var r,i;if(n&&e.indexOf===n)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},eventoffset:function(e){var t=0,n=0;e||(e=window.event);if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};if(e.clientX||e.clientY){var r=document.documentElement,i=document.body,s=document.body.parentNode.currentStyle,o=parseInt(s.marginTop,10)||0,u=parseInt(s.marginLeft,10)||0;return{x:e.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0)+u,y:e.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)+o}}if(e.touches&&e.touches.length===1)return{x:e.touches[0].pageX,y:e.touches[0].pageY}},limit:function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}},throttle:function(e,t){return this.limit(e,t,!1)},sanitize:function(e){function t(e){if(/^(https?:\/\/|data:image)/.test(e))return e}function n(e){return e}return e?html_sanitize(e,t,n):""}},wax=wax||{},wax.mm=wax.mm||{},wax.mm.attribution=function(e,t){t=t||{};var n,r={};return r.element=function(){return n.element()},r.appendTo=function(e){return wax.u.$(e).appendChild(n.element()),r},r.init=function(){return n=wax.attribution(),n.content(t.attribution),n.element().className="map-attribution map-mm",r},r.init()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.boxselector=function(e,t,n){function r(t){var n=new MM.Point(t.clientX,t.clientY);n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var r=e.parent;r;r=r.offsetParent)n.x-=r.offsetLeft,n.y-=r.offsetTop;return n}function i(t){if(!t.shiftKey)return;return c=h=r(t),g=y=!0,v.left=c.x+"px",v.top=c.y+"px",v.width=v.height=0,w(document,"mousemove",o),w(document,"mouseup",u),e.parent.style.cursor="crosshair",MM.cancelEvent(t)}function s(e){var t=r(e),n={x:parseInt(d.offsetLeft,10),y:parseInt(d.offsetTop,10)},i={x:n.x+parseInt(d.offsetWidth,10),y:n.y+parseInt(d.offsetHeight,10)};g=t.x-n.x<=b||i.x-t.x<=b,y=t.y-n.y<=b||i.y-t.y<=b;if(y||g)return c={x:t.x-n.x<i.x-t.x?i.x:n.x,y:t.y-n.y<i.y-t.y?i.y:n.y},h={x:t.x-n.x<i.x-t.x?n.x:i.x,y:t.y-n.y<i.y-t.y?n.y:i.y},w(document,"mousemove",o),w(document,"mouseup",u),MM.cancelEvent(e)}function o(t){var n=r(t);return v.display="block",g&&(v.left=(n.x<c.x?n.x:c.x)+"px",v.width=Math.abs(n.x-c.x)-2*m+"px"),y&&(v.top=(n.y<c.y?n.y:c.y)+"px",v.height=Math.abs(n.y-c.y)-2*m+"px"),f(n,e.parent),MM.cancelEvent(t)}function u(t){var n=r(t),i=e.pointLocation(new MM.Point(g?n.x:h.x,y?n.y:h.y));l2=e.pointLocation(c),x.extent([new MM.Location(Math.max(i.lat,l2.lat),Math.min(i.lon,l2.lon)),new MM.Location(Math.min(i.lat,l2.lat),Math.max(i.lon,l2.lon))]),E(document,"mousemove",o),E(document,"mouseup",u),e.parent.style.cursor="auto"}function a(e){f(r(e),d)}function f(e,t){var n={x:parseInt(d.offsetLeft,10),y:parseInt(d.offsetTop,10)},r={x:n.x+parseInt(d.offsetWidth,10),y:n.y+parseInt(d.offsetHeight,10)},i="";e.y-n.y<=b?i="n":r.y-e.y<=b&&(i="s"),e.x-n.x<=b?i+="w":r.x-e.x<=b&&(i+="e"),i!==""&&(i+="-resize"),t.style.cursor=i}function l(e,t){if(!d||!S)return;var n=e.locationPoint(S[1]),r=e.locationPoint(S[0]),i=d.style;i.display="block",i.height="auto",i.width="auto",i.left=Math.max(0,r.x)+"px",i.top=Math.max(0,r.y)+"px",i.right=Math.max(0,e.dimensions.x-n.x)+"px",i.bottom=Math.max(0,e.dimensions.y-n.y)+"px"}var c=null,
h=null,p=typeof n=="function"?n:n.callback,d,v,m=0,g=!1,y=!1,b=5,w=MM.addEvent,E=MM.removeEvent,S,x={};return x.extent=function(t,n){if(!t)return S;S=[new MM.Location(Math.max(t[0].lat,t[1].lat),Math.min(t[0].lon,t[1].lon)),new MM.Location(Math.min(t[0].lat,t[1].lat),Math.max(t[0].lon,t[1].lon))],l(e),n||p(S)},x.add=function(e){return d=d||document.createElement("div"),d.id=e.parent.id+"-boxselector-box",d.className="boxselector-box",e.parent.appendChild(d),v=d.style,m=parseInt(window.getComputedStyle(d).borderWidth,10),w(e.parent,"mousedown",i),w(d,"mousedown",s),w(e.parent,"mousemove",a),e.addCallback("drawn",l),this},x.remove=function(){e.parent.removeChild(d),E(e.parent,"mousedown",i),E(d,"mousedown",s),E(e.parent,"mousemove",a),e.removeCallback("drawn",l)},x.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax._={},wax.mm.bwdetect=function(e,t){t=t||{};var n=t.png||".png128",r=t.jpg||".jpg70",i=!1;return wax._.bw_png=n,wax._.bw_jpg=r,wax.bwdetect(t,function(t){wax._.bw=!t;for(var n=0;n<e.layers.length;n++)e.getLayerAt(n).provider instanceof wax.mm.connector&&e.getLayerAt(n).setProvider(e.getLayerAt(n).provider)})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.fullscreen=function(e){function t(e){e&&e.stop(),r?i.original():i.full()}function n(t,n){e.dimensions=new MM.Point(t,n),e.parent.style.width=Math.round(e.dimensions.x)+"px",e.parent.style.height=Math.round(e.dimensions.y)+"px",e.dispatchCallback("resized",e.dimensions)}var r=!1,i={},s,o=document.body,u;return i.add=function(e){return s=document.createElement("a"),s.className="map-fullscreen",s.href="#fullscreen",s.innerHTML="fullscreen",bean.add(s,"click",t),this},i.full=function(){if(r)return;r=!0,u=[e.parent.offsetWidth,e.parent.offsetHeight],e.parent.className+=" map-fullscreen-map",o.className+=" map-fullscreen-view",n(e.parent.offsetWidth,e.parent.offsetHeight)},i.original=function(){if(!r)return;r=!1,e.parent.className=e.parent.className.replace(" map-fullscreen-map",""),o.className=o.className.replace(" map-fullscreen-view",""),n(u[0],u[1])},i.appendTo=function(e){return wax.u.$(e).appendChild(s),this},i.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.hash=function(e){return wax.hash({getCenterZoom:function(){var t=e.getCenter(),n=e.getZoom(),r=Math.max(0,Math.ceil(Math.log(n)/Math.LN2));return[n.toFixed(2),t.lat.toFixed(r),t.lon.toFixed(r)].join("/")},setCenterZoom:function t(t){e.setCenterZoom(new MM.Location(t[1],t[2]),t[0])},bindChange:function(t){e.addCallback("drawn",t)},unbindChange:function(t){e.removeCallback("drawn",t)}})},wax=wax||{},wax.mm=wax.mm||{},wax.mm.interaction=function(){function e(){var e=o.getLayerAt(0).levels[Math.round(o.getZoom())];return!i&&s!==undefined&&s.length?s:(s=function(t){var n=[];for(var r in t)if(t[r].parentNode===e){var i=wax.u.offset(t[r]);n.push([i.top,i.left,t[r]])}return n}(o.getLayerAt(0).tiles),s)}function t(){i=!0}function n(e){if(!arguments.length)return o;o=e;for(var n=0;n<u.length;n++)o.addCallback(u[n],t)}function r(e){for(var n=0;n<u.length;n++)o.removeCallback(u[n],t)}var i=!1,s,o,u=["zoomed","panned","centered","extentset","resized","drawn"];return wax.interaction().attach(n).detach(r).parent(function(){return o.parent}).grid(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.legend=function(e,t){t=t||{};var n,r={};return r.add=function(){return n=wax.legend().content(t.legend),r},r.content=function(e){return arguments.length?(n.content(r),r):n.content()},r.element=function(){return n.element()},r.appendTo=function(e){return wax.u.$(e).appendChild(n.element()),r},r.add()},wax=wax||{},wax.mm=wax.mm||{},wax.mm.pointselector=function(e,t,n){function r(t){var n=wax.u.eventoffset(t),r=new MM.Point(n.x,n.y),i={x:parseFloat(MM.getStyle(document.documentElement,"margin-left")),y:parseFloat(MM.getStyle(document.documentElement,"margin-top"))};isNaN(i.x)||(r.x-=i.x),isNaN(i.y)||(r.y-=i.y);for(var s=e.parent;s;s=s.offsetParent)r.x-=s.offsetLeft,r.y-=s.offsetTop;return r}function i(e){var t=[];for(var n=0;n<e.length;n++)t.push(new MM.Location(e[n].lat,e[n].lon));return t}function s(){var t=new MM.Point(0,0);for(var n=0;n<p.length;n++){var r=e.locationPoint(p[n]);p[n].pointDiv||(p[n].pointDiv=document.createElement("div"),p[n].pointDiv.className="map-point-div",p[n].pointDiv.style.position="absolute",p[n].pointDiv.style.display="block",p[n].pointDiv.location=p[n],bean.add(p[n].pointDiv,"mouseup",function(t){var r=p[n];return function(t){MM.removeEvent(e.parent,"mouseup",u),h.deleteLocation(r,t)}}()),e.parent.appendChild(p[n].pointDiv)),p[n].pointDiv.style.left=r.x+"px",p[n].pointDiv.style.top=r.y+"px"}}function o(t){a=r(t),bean.add(e.parent,"mouseup",u)}function u(t){if(!a)return;f=r(t),MM.Point.distance(a,f)<l&&(h.addLocation(e.pointLocation(a)),d(i(p))),a=null}var a=null,f=null,l=5,c,h={},p=[],d=typeof n=="function"?n:n.callback;return h.addLocation=function(e){p.push(e),s(),d(i(p))},h.locations=function(e){return p},h.add=function(e){return bean.add(e.parent,"mousedown",o),e.addCallback("drawn",s),this},h.remove=function(e){bean.remove(e.parent,"mousedown",o),e.removeCallback("drawn",s);for(var t=p.length-1;t>-1;t--)h.deleteLocation(p[t]);return this},h.deleteLocation=function(e,t){if(!t||confirm("Delete this point?"))e.pointDiv.parentNode.removeChild(e.pointDiv),p.splice(wax.u.indexOf(p,e),1),d(i(p))},h.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoombox=function(e){function t(t){var n=new MM.Point(t.clientX,t.clientY);n.x+=document.body.scrollLeft+document.documentElement.scrollLeft,n.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var r=e.parent;r;r=r.offsetParent)n.x-=r.offsetLeft,n.y-=r.offsetTop;return n}function n(r){if(!o)return;o=!1;var s=t(r),l=e.pointLocation(s),h=e.pointLocation(a);e.setExtent([l,h]),u.style.display="none",MM.removeEvent(e.parent,"mousemove",i),MM.removeEvent(e.parent,"mouseup",n),e.parent.style.cursor="auto"}function r(r){if(!r.shiftKey||!!this.drawing)return;return o=!0,a=t(r),u.style.left=a.x+"px",u.style.top=a.y+"px",MM.addEvent(e.parent,"mousemove",i),MM.addEvent(e.parent,"mouseup",n),e.parent.style.cursor="crosshair",MM.cancelEvent(r)}function i(e){if(!o)return;var n=t(e);return u.style.display="block",n.x<a.x?u.style.left=n.x+"px":u.style.left=a.x+"px",u.style.width=Math.abs(n.x-a.x)+"px",n.y<a.y?u.style.top=n.y+"px":u.style.top=a.y+"px",u.style.height=Math.abs(n.y-a.y)+"px",MM.cancelEvent(e)}var s={},o=!1,u,a=null;return s.add=function(e){return u=u||document.createElement("div"),u.id=e.parent.id+"-zoombox-box",u.className="zoombox-box",e.parent.appendChild(u),MM.addEvent(e.parent,"mousedown",r),this},s.remove=function(){e.parent.removeChild(u),MM.removeEvent(e.parent,"mousedown",r)},s.add(e)},wax=wax||{},wax.mm=wax.mm||{},wax.mm.zoomer=function(e){var t={},n=document.createElement("a");n.innerHTML="+",n.href="#",n.className="zoomer zoomin",bean.add(n,"mousedown dblclick",function(e){e.stop()}),bean.add(n,"touchstart click",function(t){t.stop(),e.zoomIn()},!1);var r=document.createElement("a");return r.innerHTML="-",r.href="#",r.className="zoomer zoomout",bean.add(r,"mousedown dblclick",function(e){e.stop()}),bean.add(r,"touchstart click",function(t){t.stop(),e.zoomOut()}),t.add=function(e){return e.addCallback("drawn",function(e,t){e.coordinate.zoom===e.coordLimits[0].zoom?r.className="zoomer zoomout zoomdisabled":e.coordinate.zoom===e.coordLimits[1].zoom?n.className="zoomer zoomin zoomdisabled":(n.className="zoomer zoomin",r.className="zoomer zoomout")}),t},t.appendTo=function(e){return wax.u.$(e).appendChild(n),wax.u.$(e).appendChild(r),t},t.add(e)};var wax=wax||{};wax.mm=wax.mm||{},wax.mm._provider=function(e){this.options={tiles:e.tiles,scheme:e.scheme||"xyz",minzoom:e.minzoom||0,maxzoom:e.maxzoom||22,bounds:e.bounds||[-180,-90,180,90]}},wax.mm._provider.prototype={outerLimits:function(){return[this.locationCoordinate(new MM.Location(this.options.bounds[0],this.options.bounds[1])).zoomTo(this.options.minzoom),this.locationCoordinate(new MM.Location(this.options.bounds[2],this.options.bounds[3])).zoomTo(this.options.maxzoom)]},getTile:function(e){if(!(coord=this.sourceCoordinate(e)))return null;if(coord.zoom<this.options.minzoom||coord.zoom>this.options.maxzoom)return null;coord.row=this.options.scheme==="tms"?Math.pow(2,coord.zoom)-coord.row-1:coord.row;var t=this.options.tiles[parseInt(Math.pow(2,coord.zoom)*coord.row+coord.column,10)%this.options.tiles.length].replace("{z}",coord.zoom.toFixed(0)).replace("{x}",coord.column.toFixed(0)).replace("{y}",coord.row.toFixed(0));return wax._&&wax._.bw&&(t=t.replace(".png",wax._.bw_png).replace(".jpg",wax._.bw_jpg)),t}},MM&&MM.extend(wax.mm._provider,MM.MapProvider),wax.mm.connector=function(e){var t=new wax.mm._provider(e);return new MM.Layer(t)},function(e,t){var n=function(){function f(e,t,n){return n===0?e:n===1?t:e+(t-e)*n}function c(e,n){var r=new t.Point(a.dimensions.x/2,a.dimensions.y/2);return r.x+=a.tileSize.x*(n.column-e.column),r.y+=a.tileSize.y*(n.row-e.row),r}var e={},n=!1,r=!1,i={easeIn:function(e){return e*e},easeOut:function(e){return Math.sin(e*Math.PI/2)},easeInOut:function(e){return(1-Math.cos(Math.PI*e))/2},linear:function(e){return e}},s=i.easeOut,o,u,a;e.stop=function(){r=!0},e.running=function(){return n},e.point=function(t){return u=a.pointCoordinate(t),e},e.zoom=function(t){return u=a.enforceZoomLimits(u.zoomTo(t)),e},e.location=function(t){return u=a.locationCoordinate(t),e},e.from=function(t){return arguments.length?(o=t.copy(),e):o.copy()},e.to=function(t){return arguments.length?(u=a.enforceZoomLimits(t.copy()),e):u.copy()},e.path=function(t){return h=l[t],e},e.easing=function(t){return s=i[t],e},e.map=function(t){return arguments.length?(a=t,o=a.coordinate.copy(),u=a.coordinate.copy(),e):a};var l={};l.screen=function(e,n,r){var i=f(e.zoom,n.zoom,r),s=e.copy(),o=n.copy().zoomTo(e.zoom);return(new t.Coordinate(f(s.row,o.row,r),f(s.column,o.column,r),s.zoom)).zoomTo(i)},l.about=function(e,t,n){var r=f(e.zoom,t.zoom,n),i=t.copy().zoomTo(e.zoom),s=e.copy().zoomTo(r),o=t.copy().zoomTo(r),u=c(e,i),l=c(s,o);return s.column-=(u.x-l.x)/a.tileSize.x,s.row-=(u.y-l.y)/a.tileSize.y,s};var h=l.screen;e.t=function(t){return a.coordinate=h(o,u,s(t)),a.draw(),e},e.future=function(e){var t=[];for(var n=0;n<e;n++)t.push(h(o,u,n/(e-1)));return t};var p;return e.resetRun=function(){return p=+(new Date),e},e.run=function(e,i){function f(){var l=+(new Date)-p;if(r)return void (r=n=!1);if(l>e){n=!1,a.coordinate=h(o,u,1),a.draw();if(i)return i(a)}else a.coordinate=h(o,u,s(l/e)),a.draw(),t.getFrame(f)}e=e||1e3,p=+(new Date),n=!0,t.getFrame(f)},e.optimal=function(n,r,i){function s(e){return e*e}function l(e){return(Math.exp(e)-Math.exp(-e))/2}function c(e){return(Math.exp(e)+Math.exp(-e))/2}function p(e){return l(e)/c(e)}function T(e){var t=s(g)-s(m)+(e?-1:1)*Math.pow(r,4)*s(x-S),n=2*(e?g:m)*s(r)*(x-S);return t/n}function N(e){return Math.log(-T(e)+Math.sqrt(s(T(e))+1))}n=n||.9,r=r||1.42,a.coordinate=o;var d=a.pointCoordinate(new t.Point(0,0)).zoomTo(0),v=a.pointCoordinate(a.dimensions).zoomTo(0),m=Math.max(v.column-d.column,v.row-d.row),g=m*Math.pow(2,o.zoom-u.zoom),y=o.zoomTo(0),b=u.zoomTo(0),w={x:y.column,y:y.row},E={x:b.column,y:b.row},S=0,x=Math.sqrt(s(E.x-w.x)+s(E.y-w.y)),C=N(0),k=N(1),L=(k-C)/r,A=function(e){return m*c(C)/c(r*e+C)},O=function(e){return m/s(r)*c(C)*p(r*e+C)-m/s(r)*l(C)+S};if(Math.abs(x)<1e-6){if(Math.abs(m-g)<1e-6)return;var M=g<m?-1:1;L=Math.abs(Math.log(g/m))/r,O=function(e){return S},A=function(e){return m*Math.exp(M*r*e)}}h=function(e,n,r){if(r==1)return u;var i=r*L,s=O(i),o=e.zoom+Math.log(m/A(i))/Math.LN2,a=f(w.x,E.x,s/x),l=f(w.y,E.y,s/x);return(new t.Coordinate(l,a,0)).zoomTo(o)},e.easing("linear"),e.run(L/n*1e3,i)},e};this.easey=n}(this,MM),function(e,t){easey.TouchHandler=function(){function g(e){var i={x:0,y:0},o=Math.max(.001,(e-r)/1e3);p&&d&&v>+(new Date)-50?(i.x=p.x-d.x,i.y=p.y-d.y,s.x=i.x,s.y=i.y):(s.x-=s.x*f,s.y-=s.y*f,Math.abs(s.x)<.001&&(s.x=0),Math.abs(s.y)<.001&&(s.y=0)),(s.x||s.y)&&n.panBy(s.x,s.y),r=e,t.getFrame(g)}function y(e,t){return e&&e.touch&&t.identifier==e.touch.identifier}function b(e){for(var t=0;t<e.touches.length;t+=1){var n=e.touches[t];if(n.identifier in l){var r=l[n.identifier];r.x=n.clientX,r.y=n.clientY,r.scale=e.scale}else l[n.identifier]={scale:e.scale,startPos:{x:n.clientX,y:n.screenY},x:n.clientX,y:n.clientY,time:(new Date).getTime()}}}function w(e){return b(e),t.cancelEvent(e)}function E(e){switch(e.touches.length){case 1:N(e.touches[0]);break;case 2:C(e)}return b(e),t.cancelEvent(e)}function S(e){if(c.length&&e.time-c[0].time<a){x(e),c=[];return}c=[e]}function x(e){easey().map(n).to(n.pointCoordinate(e).zoomTo(n.getZoom()+1)).path("about").run(200,function(){n.dispatchCallback("zoomed")})}function T(){var e=document.createElement("div");return e.setAttribute("ongesturestart","return;"),typeof e.ongesturestart=="function"}function N(e){v=+(new Date),d=p,p={x:e.clientX,y:e.clientY}}function C(e){var r=e.touches[0],i=e.touches[1],s=new t.Point(r.clientX,r.clientY),o=new t.Point(i.clientX,i.clientY),u=l[r.identifier],a=l[i.identifier];u.wasPinch=!0,a.wasPinch=!0;var f=t.Point.interpolate(s,o,.5);n.zoomByAbout(Math.log(e.scale)/Math.LN2-Math.log(u.scale)/Math.LN2,f);var c=t.Point.interpolate(u,a,.5);n.panBy(f.x-c.x,f.y-c.y),h=!0,m=f}function k(e){var t=n.getZoom(),r=Math.round(t);n.zoomByAbout(r-t,e),h=!1}function L(e){var n=(new Date).getTime();e.touches.length===0&&h&&k(m),d=p=null;for(var r=0;r<e.changedTouches.length;r+=1){var i=e.changedTouches[r],s=l[i.identifier];if(!s||s.wasPinch)continue;var a={x:i.clientX,y:i.clientY},f=n-s.time,c=t.Point.distance(a,s.startPos);c>u||(f>o?(a.end=n,a.duration=f,onHold(a)):(a.time=n,S(a)))}var v={};for(var g=0;g<e.touches.length;g++)v[e.touches[g].identifier]=!0;for(var y in l)y in v||delete v[y];return t.cancelEvent(e)}var e={},n,r=0,i=25,s=null,o=250,u=30,a=350,f=.1,l={},c=[],h=!1,p=null,d=null,v=null,m=null;return e.init=function(e){n=e;if(!T())return!1;t.addEvent(n.parent,"touchstart",w),t.addEvent(n.parent,"touchmove",E),t.addEvent(n.parent,"touchend",L),r=(new Date).getTime(),s={x:0,y:0},t.getFrame(g)},e.remove=function(){if(!T())return!1;t.removeEvent(n.parent,"touchstart",w),t.removeEvent(n.parent,"touchmove",E),t.removeEvent(n.parent,"touchend",L)},e},easey.DoubleClickHandler=function(){function r(e){var r=t.getMousePoint(e,n);return z=n.getZoom()+(e.shiftKey?-1:1),easey().map(n).to(n.pointCoordinate(t.getMousePoint(e,n)).zoomTo(z)).path("about").run(100,function(){n.dispatchCallback("zoomed")}),t.cancelEvent(e)}var e={},n;return e.init=function(i){return n=i,t.addEvent(n.parent,"dblclick",r),e},e.remove=function(){t.removeEvent(n.parent,"dblclick",r)},e},easey.MouseWheelHandler=function(){function u(e){function f(){n.dispatchCallback("zoomed")}var o=0;s=s||(new Date).getTime();try{r.scrollTop=1e3,r.dispatchEvent(e),o=1e3-r.scrollTop}catch(u){o=e.wheelDelta||-e.detail*5}var a=(new Date).getTime()-s;if(!i.running()){var l=t.getMousePoint(e,n),c=n.getZoom();i.map(n).easing("easeOut").to(n.pointCoordinate(t.getMousePoint(e,n)).zoomTo(c+(o>0?1:-1))).path("about").run(100,f),s=(new Date).getTime()}else a>150&&(i.zoom(i.to().zoom+(o>0?1:-1)).from(n.coordinate).resetRun(),s=(new Date).getTime());return t.cancelEvent(e)}var e={},n,r,i=easey(),s,o=!1;return e.init=function(i){n=i,r=document.body.appendChild(document.createElement("div")),r.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var s=r.appendChild(document.createElement("div"));return s.style.height="2000px",t.addEvent(n.parent,"mousewheel",u),e},e.precise=function(t){return arguments.length?(o=t,e):o},e.remove=function(){t.removeEvent(n.parent,"mousewheel",u),r.parentNode.removeChild(r)},e},easey.DragHandler=function(){function d(e){n.parent.focus()}function v(e){if(e.shiftKey||e.button==2)return;return t.addEvent(document,"mousemove",m),t.addEvent(document,"mouseup",g),f=l=t.getMousePoint(e,n),c=h=+(new Date),n.parent.style.cursor="move",t.cancelEvent(e)}function m(e){if(f)return p&&(l=f,h=c,p=!1),f=t.getMousePoint(e,n),c=+(new Date),t.cancelEvent(e)}function g(e){t.removeEvent(document,"mousemove",m),t.removeEvent(document,"mouseup",g);if(+(new Date)-h<50){dt=Math.max(1,c-h);var r={x:0,y:0};r.x=f.x-l.x,r.y=f.y-l.y,i.x=r.x/dt,i.y=r.y/dt}else i.x=0,i.y=0;return f=l=null,c=lastMoveTime=null,n.parent.style.cursor="",t.cancelEvent(e)}function y(e){var u={x:0,y:0},a=Math.max(1,e-r);f&&l?p||(u.x=f.x-l.x,u.y=f.y-l.y,n.panBy(u.x,u.y),p=!0):(i.x*=Math.pow(1-s,a*60/1e3),i.y*=Math.pow(1-s,a*60/1e3),Math.abs(i.x)<.001&&(i.x=0),Math.abs(i.y)<.001&&(i.y=0),(i.x||i.y)&&n.panBy(i.x*a,i.y*a)),r=e,o||t.getFrame(y)}var e={},n,r=0,i=null,s=.15,o=!1,u=null,a=0,f=null,l=null,c=null,h=null,p=!0;return e.init=function(e){n=e,t.addEvent(n.parent,"click",d),t.addEvent(n.parent,"mousedown",v),r=(new Date).getTime(),i={x:0,y:0},o=!1,t.getFrame(y)},e.remove=function(){t.removeEvent(n.parent,"click",d),t.removeEvent(n.parent,"mousedown",v),o=!0},e}}(this,MM),typeof mapbox=="undefined"&&(mapbox={}),mapbox.markers=function(){function e(e){e.coord||(e.coord=t.map.locationCoordinate(e.location));var n=t.map.coordinatePoint(e.coord),r;n.x<0?(r=new MM.Location(e.location.lat,e.location.lon),r.lon+=Math.ceil((f.lon-e.location.lon)/360)*360,n=t.map.locationPoint(r),e.coord=t.map.locationCoordinate(r)):n.x>t.map.dimensions.x&&(r=new MM.Location(e.location.lat,e.location.lon),r.lon-=Math.ceil((e.location.lon-l.lon)/360)*360,n=t.map.locationPoint(r),e.coord=t.map.locationCoordinate(r)),n.scale=1,n.width=n.height=0,MM.moveElement(e.element,n)}var t={},n=[],r=[],i=new MM.CallbackManager(t,["drawn","markeradded"]),s=null,o=simplestyle_factory,u=function(e,t){return t.geometry.coordinates[1]-e.geometry.coordinates[1]},a,f=null,l=null,c=function(){return!0};return t.parent=document.createElement("div"),t.parent.style.cssText="position: absolute; top: 0px;left:0px; width:100%; height:100%; margin:0; padding:0; z-index:0;pointer-events:none;",t.addCallback=function(e,n){return i.addCallback(e,n),t},t.removeCallback=function(e,n){return i.removeCallback(e,n),t},t.draw=function(){if(!t.map)return;f=t.map.pointLocation(new MM.Point(0,0)),l=t.map.pointLocation(new MM.Point(t.map.dimensions.x,0)),i.dispatchCallback("drawn",t);for(var n=0;n<r.length;n++)e(r[n])},t.add=function(e){return!e||!e.element?null:(t.parent.appendChild(e.element),r.push(e),i.dispatchCallback("markeradded",e),e)},t.remove=function(e){if(!e)return null;t.parent.removeChild(e.element);for(var n=0;n<r.length;n++)if(r[n]===e)return r.splice(n,1),e;return e},t.markers=function(e){if(!arguments.length)return r},t.add_feature=function(e){return t.features(t.features().concat([e]))},t.sort=function(e){return arguments.length?(u=e,t):u},t.features=function(e){if(!arguments.length)return n;while(t.parent.hasChildNodes())t.parent.removeChild(t.parent.lastChild);r=[],e||(e=[]),n=e.slice(),n.sort(u);for(var i=0;i<n.length;i++)c(n[i])&&t.add({element:o(n[i]),location:new MM.Location(n[i].geometry.coordinates[1],n[i].geometry.coordinates[0]),data:n[i]});return t.map&&t.map.coordinate&&t.map.draw(),t},t.url=function(e,n){function r(e){e&&e.features&&t.features(e.features),n&&n(e.features,t)}if(!arguments.length)return a;if(typeof reqwest=="undefined")throw"reqwest is required for url loading";return typeof e=="string"&&(e=[e]),a=e,reqwest(a[0].match(/geojsonp$/)?{url:a[0]+(~a[0].indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:r,error:r}:{url:a[0],type:"json",success:r,error:r}),t},t.extent=function(){var e=[{lat:Infinity,lon:Infinity},{lat:-Infinity,lon:-Infinity}],n=t.features();for(var r=0;r<n.length;r++){var i=n[r].geometry.coordinates;i[0]<e[0].lon&&(e[0].lon=i[0]),i[1]<e[0].lat&&(e[0].lat=i[1]),i[0]>e[1].lon&&(e[1].lon=i[0]),i[1]>e[1].lat&&(e[1].lat=i[1])}return e},t.factory=function(e){return arguments.length?(o=e,t.features(t.features()),t):o},t.filter=function(e){return arguments.length?(c=e,t.features(t.features()),t):c},t.destroy=function(){t.parent.parentNode&&t.parent.parentNode.removeChild(t.parent)},t},mmg=mapbox.markers,mapbox.markers.interaction=function(e){function t(){e.map.addCallback("panned",function(){if(s)while(r.length)e.remove(r.pop())})}var n={},r=[],i=!0,s=!0,o=!0,u=null,a;n.formatter=function(e){return arguments.length?(a=e,n):a},n.formatter(function(e){var t="",n=e.properties;return n?(n.title&&(t+='<div class="marker-title">'+n.title+"</div>"),n.description&&(t+='<div class="marker-description">'+n.description+"</div>"),typeof html_sanitize!==undefined&&(t=html_sanitize(t,function(e){if(/^(https?:\/\/|data:image)/.test(e))return e},function(e){return e})),t):null}),n.hide_on_move=function(e){return arguments.length?(s=e,n):s},n.exclusive=function(e){return arguments.length?(i=e,n):i},n.show_on_hover=function(e){return arguments.length?(o=e,n):o},n.hide_tooltips=function(){while(r.length)e.remove(r.pop());for(var t=0;t<f.length;t++)delete f[t].clicked},n.bind_marker=function(t){var s=function(){t.clicked||(u=window.setTimeout(function(){n.hide_tooltips()},200))},f=function(f){var l=a(t.data);if(!l)return;i&&r.length>0&&(n.hide_tooltips(),u&&window.clearTimeout(u));var p=document.createElement("div");p.className="marker-tooltip",p.style.width="100%";var v=p.appendChild(document.createElement("div"));v.style.cssText="position: absolute; pointer-events: none;";var m=v.appendChild(document.createElement("div"));m.className="marker-popup",m.style.cssText="pointer-events: auto;",typeof l=="string"?m.innerHTML=l:m.appendChild(l),v.style.bottom=t.element.offsetHeight/2+20+"px",o&&(p.onmouseover=function(){u&&window.clearTimeout(u)},p.onmouseout=s);var y={element:p,data:{},interactive:!1,location:t.location.copy()};r.push(y),e.add(y),e.draw()};t.element.onclick=t.element.ontouchstart=function(){f(),t.clicked=!0},o&&(t.element.onmouseover=f,t.element.onmouseout=s)};if(e){e.addCallback("drawn",t),e.removeCallback("drawn",t);var f=e.markers();for(var l=0;l<f.length;l++)n.bind_marker(f[l]);e.addCallback("markeradded",function(e,t){t.interactive!==!1&&n.bind_marker(t)})}return n},mmg_interaction=mapbox.markers.interaction,mapbox.markers.csv_to_geojson=function(e){function t(e){var t;return n(e,function(e,n){if(n){var r={},i=-1,s=t.length;while(++i<s)r[t[i]]=e[i];return r}return t=e,null})}function n(e,t){function n(){if(o.lastIndex>=e.length)return i;if(f)return f=!1,r;var t=o.lastIndex;if(e.charCodeAt(t)===34){var n=t;while(n++<e.length)if(e.charCodeAt(n)===34){if(e.charCodeAt(n+1)!==34)break;n++}o.lastIndex=n+2;var s=e.charCodeAt(n+1);return s===13?(f=!0,e.charCodeAt(n+2)===10&&o.lastIndex++):s===10&&(f=!0),e.substring(t+1,n).replace(/""/g,'"')}var u=o.exec(e);return u?(f=u[0].charCodeAt(0)!==44,e.substring(t,u.index)):(o.lastIndex=e.length,e.substring(t))}var r={},i={},s=[],o=/\r\n|[,\r\n]/g,u=0,a,f;o.lastIndex=0;while((a=n())!==i){var l=[];while(a!==r&&a!==i)l.push(a),a=n();if(t&&!(l=t(l,u++)))continue;s.push(l)}return s}var r=[],i=t(e);if(!i.length)return callback(r);var s="",o="";for(var u in i[0])u.match(/^Lat/i)&&(s=u),u.match(/^Lon/i)&&(o=u);if(!s||!o)throw"CSV: Could not find latitude or longitude field";for(var a=0;a<i.length;a++)i[a][o]!==undefined&&i[a][o]!==undefined&&r.push({type:"Feature",properties:i[a],geometry:{type:"Point",coordinates:[parseFloat(i[a][o]),parseFloat(i[a][s])]}});return r},mapbox.markers.csv_url_to_geojson=function(e,t){function n(e){return t(mmg_csv(e.responseText))}if(typeof reqwest=="undefined")throw"CSV: reqwest required for mmg_csv_url";reqwest({url:e,type:"string",success:n,error:n})},function(){var e={};e.load=function(e,t){e.indexOf("http")!==0&&(e="http://a.tiles.mapbox.com/v3/"+e+".jsonp"),wax.tilejson(e,function(e){e.zoom=e.center[2],e.center={lat:e.center[1],lon:e.center[0]},e.thumbnail="http://a.tiles.mapbox.com/v3/"+e.id+".png",e.tiles&&(e.layer=new wax.mm.connector(e)),e.data?(e.markers=mmg().factory(simplestyle_factory),e.markers.url(e.data,function(){mmg_interaction(e.markers),t(e)})):t(e)})},e.auto=function(t,n){return function(r){var i=e.map(t);r.layer&&i.addLayer(r.layer),r.markers&&i.addLayer(r.markers),r.attribution&&wax.mm.attribution(i,r).appendTo(i.parent),r.legend&&wax.mm.legend(i,r).appendTo(i.parent),wax.mm.zoomer(i).appendTo(i.parent),wax.mm.zoombox(i),i.zoom(r.zoom).center(r.center),wax.mm.interaction().map(i).tilejson(r).on(wax.tooltip().parent(i.parent).events()),i.setZoomRange(r.minzoom,r.maxzoom),n&&n(i,r)}},e.markers=function(){var e=mmg().factory(simplestyle_factory);return mmg_interaction(e),e};var t=[easey.TouchHandler,easey.DragHandler,easey.DoubleClickHandler,easey.MouseWheelHandler],n=[MM.TouchHandler,MM.DragHandler,MM.DoubleClickHandler,MM.MouseWheelHandler];MM.Map.prototype.smooth=function(e){while(this.eventHandlers.length)this.eventHandlers.pop().remove();if(e)for(var r=0;r<t.length;r++){var i=t[r]();this.eventHandlers.push(i),i.init(this)}else for(var s=0;s<n.length;s++){var o=n[s]();this.eventHandlers.push(o),o.init(this)}return this},e.map=function(e,t){var n=new MM.Map(e,t,null,[easey.TouchHandler(),easey.DragHandler(),easey.DoubleClickHandler(),easey.MouseWheelHandler()]);return n.center=function(e,t){if(!e||!t)return e?this.setCenter(e):this.getCenter();easey().map(this).to(this.locationCoordinate(e)).optimal(null,null,t.callback||function(){})},n.zoom=function(e,t){if(e===undefined||!t)return e!==undefined?this.setZoom(e):this.getZoom();easey().map(this).to(this.locationCoordinate(this.getCenter()).copy().zoomTo(e)).run(600)},n.centerzoom=function(e,t,n){if(e&&t!==undefined&&n)easey().map(this).to(this.locationCoordinate(e).zoomTo(t)).run(n.duration||1e3,n.callback||function(){});else if(e&&t!==undefined)return this.setCenterZoom(e,t)},n},this.mapbox=e}(this),typeof mapbox=="undefined"&&(mapbox={}),mapbox.provider=function(e){this.options={tiles:e.tiles,scheme:e.scheme||"xyz",minzoom:e.minzoom||0,maxzoom:e.maxzoom||22,bounds:e.bounds||[-180,-90,180,90]}},mapbox.provider.prototype={tileLimits:[new MM.Coordinate(0,0,0),(new MM.Coordinate(1,1,0)).zoomTo(18)],releaseTile:function(e){},getTile:function(e){return(coord=this.sourceCoordinate(e))?coord.zoom<this.options.minzoom||coord.zoom>this.options.maxzoom?null:this.options.tiles[parseInt(Math.pow(2,coord.zoom)*coord.row+coord.column,10)%this.options.tiles.length].replace("{z}",coord.zoom.toFixed(0)).replace("{x}",coord.column.toFixed(0)).replace("{y}",coord.row.toFixed(0)):null},setZoomRange:function(e,t){this.tileLimits[0]=this.tileLimits[0].zoomTo(e),this.tileLimits[1]=this.tileLimits[1].zoomTo(t)},sourceCoordinate:function(e){var t=this.tileLimits[0].zoomTo(e.zoom),n=this.tileLimits[1].zoomTo(e.zoom),r=Math.pow(2,e.zoom),i;return e.column<0?i=(e.column%r+r)%r:i=e.column%r,e.row<t.row||e.row>=n.row?null:i<t.column||i>=n.column?null:new MM.Coordinate(e.row,i,e.zoom)}},mapbox.layer=function(){if(!(this instanceof mapbox.layer))return new mapbox.layer;this._tilejson={},this._url="",this.parent=document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.levels={},this.requestManager=new MM.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),this.setProvider(new mapbox.provider({tiles:["data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="]}))},mapbox.layer.prototype.refresh=function(){var e=this;return wax.tilejson(this._url,function(t){e.tilejson(t)}),this},mapbox.layer.prototype.url=function(e){return arguments.length?(this._url=e,this.refresh()):this.url},mapbox.layer.prototype.id=function(e){return this.url("http://a.tiles.mapbox.com/v3/"+e+".jsonp"),this.refresh()},mapbox.layer.prototype.tilejson=function(e){return arguments.length?(this.setProvider(new mapbox.provider(e)),this._tilejson=e,this):this._tilejson},mapbox.layer.prototype.name=function(e){return arguments.length?(this.name=name,this):this.name},MM.extend(mapbox.layer,MM.Layer);
>>>>>>> 4b1cb0686cf3c5305cf8a3f1f3e533b54c277065
